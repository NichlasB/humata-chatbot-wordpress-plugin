(()=>{var h=window.humataConfig||{},W="humata_chat_history",ye="humata_conversation_id",re="humata_theme_preference",j="humata_turnstile_verified";var It='<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"><path d="M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2"></path><circle cx="12" cy="7" r="4"></circle></svg>',Nt='<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"><path d="M12 8V4H8"></path><rect width="16" height="12" x="4" y="8" rx="2"></rect><path d="M2 14h2"></path><path d="M20 14h2"></path><path d="M15 13v2"></path><path d="M9 13v2"></path></svg>';function V(c,E){let x=E==="user"?h.userAvatarUrl:h.botAvatarUrl;if(x&&x.length>0){let p=document.createElement("img");p.src=x,p.alt=E==="user"?"User":"Bot",p.className="humata-avatar-img",c.innerHTML="",c.appendChild(p)}else c.innerHTML=E==="user"?It:Nt}(function(){"use strict";let c={},E=!1,x=null,p=null,S=3e3,F=!1,K=null,Y=null,ve=!1,qt=null;function we(){c={container:document.getElementById("humata-chat-container"),messages:document.getElementById("humata-chat-messages"),input:document.getElementById("humata-chat-input"),inputCounter:document.getElementById("humata-chat-input-counter"),sendButton:document.getElementById("humata-send-button"),scrollToggle:document.getElementById("humata-scroll-toggle"),exportPdfButton:document.getElementById("humata-export-pdf"),clearButton:document.getElementById("humata-clear-chat"),themeToggle:document.getElementById("humata-theme-toggle"),welcomeMessage:document.getElementById("humata-welcome-message")},!(!c.container||!c.messages||!c.input)&&(F=c.container.classList.contains("humata-chat-embedded"),S=et(),c.input&&S>0&&(c.input.maxLength=S),Ke(),Je(),c.welcomeMessage&&N(c.welcomeMessage.querySelector(".humata-message-content")),Bt(),Xe(),Ae(),_(),c.input&&c.input.focus(),_(),Ve())}function Ve(){if(!window.visualViewport)return;let e=document.getElementById("humata-chat-input-container");if(!e)return;let n=document.getElementById("humata-chat-page-footer");function t(){return document.querySelector(".humata-trigger-pages:not(.humata-trigger-pages--hidden)")||n}let o=window.visualViewport.height,r=!1,l=!1,s=!1;function a(){s||(s=!0,requestAnimationFrame(function(){s=!1;let i=window.visualViewport,u=i.offsetTop+i.height,m=window.innerHeight-u;if(o-i.height>150){r||(r=!0,document.body.classList.add("humata-keyboard-open"));let y=!1,L=t();if(L){let R=L.getBoundingClientRect(),D=e.offsetHeight,z=i.height+i.offsetTop,f=z-D;R.top<=z&&R.top>0&&(y=!0)}y?(l||(l=!0,e.classList.add("humata-input-detached")),e.style.position="",e.style.bottom="",e.style.left="",e.style.right="",e.style.transform=""):(l&&(l=!1,e.classList.remove("humata-input-detached")),e.style.position="fixed",e.style.bottom="0",e.style.left="0",e.style.right="0",e.style.transform="translateY("+-m+"px)")}else r&&(r=!1,l=!1,document.body.classList.remove("humata-keyboard-open"),e.classList.remove("humata-input-detached")),e.style.position="",e.style.bottom="",e.style.left="",e.style.right="",e.style.transform=""}))}window.visualViewport.addEventListener("resize",a),window.visualViewport.addEventListener("scroll",a),window.addEventListener("scroll",a,{passive:!0}),c.input&&(c.input.addEventListener("focus",function(){setTimeout(a,300)}),c.input.addEventListener("blur",function(){setTimeout(a,100)}))}function Ke(){let e=localStorage.getItem(re),n=h.theme||"auto",t=e||n;t==="auto"&&(t=window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light"),ae(t),n==="auto"&&!e&&window.matchMedia("(prefers-color-scheme: dark)").addEventListener("change",function(o){localStorage.getItem(re)||ae(o.matches?"dark":"light")})}function ae(e){let n=document.documentElement,t=document.body;n.classList.remove("humata-theme-dark","humata-theme-light"),t.classList.remove("humata-theme-dark","humata-theme-light"),e==="dark"?(n.classList.add("humata-theme-dark"),t.classList.add("humata-theme-dark")):(n.classList.add("humata-theme-light"),t.classList.add("humata-theme-light"))}function Ye(){let n=document.documentElement.classList.contains("humata-theme-dark")?"light":"dark";localStorage.setItem(re,n),ae(n)}function $(){return h.turnstile&&h.turnstile.enabled&&h.turnstile.siteKey}function Ee(){return $()?sessionStorage.getItem(j)==="true":!0}function $e(){sessionStorage.setItem(j,"true")}function Te(){return new Promise(function(e,n){if(window.turnstile){ve=!0,e();return}let t=document.createElement("script");t.src="https://challenges.cloudflare.com/turnstile/v0/api.js?onload=onTurnstileLoad",t.async=!0,t.defer=!0,window.onTurnstileLoad=function(){ve=!0,e()},t.onerror=function(){n(new Error("Failed to load Turnstile script"))},document.head.appendChild(t)})}function Ge(){return new Promise(function(e,n){if(Ee()){e(null);return}let t=document.getElementById("humata-turnstile-container");if(!t){e(null);return}Te().then(function(){if(console.log("Turnstile script loaded, preparing to render widget"),Y!==null&&window.turnstile){try{window.turnstile.remove(Y)}catch(r){}Y=null}t.innerHTML='<div id="humata-turnstile-widget"></div>',t.style.display="flex";let o=document.getElementById("humata-turnstile-widget");console.log("Turnstile container visible, widget container:",o),setTimeout(function(){try{Y=window.turnstile.render(o,{sitekey:h.turnstile.siteKey,appearance:h.turnstile.appearance||"managed",theme:document.documentElement.classList.contains("humata-theme-dark")?"dark":"light",size:"normal",callback:function(r){K=r,t.style.display="none",t.innerHTML="",e(r)},"error-callback":function(r){console.error("Turnstile error:",r),t.style.display="none",t.innerHTML="",n(new Error("Turnstile verification failed: "+(r||"unknown")))},"expired-callback":function(){K=null}}),setTimeout(function(){o.querySelector("iframe")||(t.style.display="none")},100)}catch(r){console.error("Turnstile render error:",r),t.style.display="none",t.innerHTML="",n(r)}},50)}).catch(function(o){console.error("Turnstile script load error:",o),n(o)})})}function Je(){$()&&Te().catch(function(){})}function Xe(){c.sendButton&&c.sendButton.addEventListener("click",Me),c.input&&(c.input.addEventListener("keydown",rt),c.input.addEventListener("input",Ae)),c.scrollToggle&&c.scrollToggle.addEventListener("click",ot),F&&c.messages?c.messages.addEventListener("scroll",_,{passive:!0}):window.addEventListener("scroll",_,{passive:!0}),c.messages&&c.messages.addEventListener("click",tt),c.clearButton&&c.clearButton.addEventListener("click",Ht),c.exportPdfButton&&c.exportPdfButton.addEventListener("click",Mt),c.themeToggle&&c.themeToggle.addEventListener("click",Ye),Qe(),Ze()}function Ze(){let e=document.getElementById("humata-medical-disclaimer-link"),n=document.getElementById("humata-medical-disclaimer-modal");!e||!n||(e.addEventListener("click",function(t){t.preventDefault(),be(n,e)}),n.addEventListener("click",function(t){t.target.closest("[data-humata-disclaimer-close]")&&(t.preventDefault(),ie(n))}))}function Qe(){document.addEventListener("click",function(e){let n=e.target.closest("[data-humata-page-modal]");if(!n)return;e.preventDefault();let t=n.getAttribute("data-humata-page-modal"),o=document.getElementById("humata-page-modal-"+t);o&&be(o,n)}),document.addEventListener("click",function(e){let n=e.target.closest("[data-humata-page-close-modal]");if(!n)return;let t=n.closest(".humata-help-modal");t&&(e.preventDefault(),ie(t))}),document.addEventListener("keydown",function(e){if(e.key!=="Escape")return;let n=document.querySelector(".humata-help-modal.is-open");n&&(e.preventDefault(),ie(n))})}let B=null;function be(e,n){B=n||document.activeElement,e.hidden=!1,e.classList.add("is-open"),e.setAttribute("aria-hidden","false"),document.documentElement.classList.add("humata-help-modal-open"),document.body.classList.add("humata-help-modal-open");let t=e.querySelector(".humata-help-modal__close");if(t)try{t.focus({preventScroll:!0})}catch(o){t.focus()}}function ie(e){if(e.classList.remove("is-open"),e.setAttribute("aria-hidden","true"),e.hidden=!0,document.documentElement.classList.remove("humata-help-modal-open"),document.body.classList.remove("humata-help-modal-open"),B&&typeof B.focus=="function")try{B.focus({preventScroll:!0})}catch(n){B.focus()}B=null}function et(){let e=parseInt(h.maxPromptChars,10);if(Number.isFinite(e)&&e>0)return e;if(c.input){let n=parseInt(c.input.getAttribute("maxlength"),10);if(Number.isFinite(n)&&n>0)return n}return 3e3}function G(){if(!c.input||!c.inputCounter)return;let e=(c.input.value||"").length,n=S||3e3;c.inputCounter.textContent=e+"/"+n,c.inputCounter.classList.toggle("humata-input-counter-over",e>n)}function tt(e){let n=e.target.closest(".humata-regenerate-button");if(n){let s=n.closest(".humata-message");if(!s||E||p)return;let a=s.previousElementSibling;for(;a&&!a.classList.contains("humata-message-user");)a=a.previousElementSibling;if(!a)return;let i=a.querySelector(".humata-message-content");if(!i)return;let u=q(i);if(!u)return;let d=xe(a);Ce(a),oe(),pe(u,d);return}let t=e.target.closest(".humata-copy-button");if(t){let s=t.closest(".humata-message");if(!s)return;let a=s.querySelector(".humata-message-content");if(!a)return;let i=gt(a);if(!i||!i.text&&!i.html)return;ft(i).then(function(){pt(t)}).catch(function(){yt(t)});return}let o=e.target.closest(".humata-edit-button");if(o){let s=o.closest(".humata-message");if(!s||E)return;nt(s);return}if(e.target.closest(".humata-edit-cancel")){J();return}e.target.closest(".humata-edit-save")&&Le()}function se(e){if(c.input){if(c.input.disabled=!e,c.sendButton)if(!e)c.sendButton.disabled=!0;else{let n=c.input.value||"";c.sendButton.disabled=!n.trim()||n.length>S}G()}}function nt(e){var a,i,u,d;if(!e||!e.classList.contains("humata-message-user"))return;let n=e.querySelector(".humata-message-content");if(!n||p&&p.messageEl===e)return;J();let t=q(n);if(!t)return;p={messageEl:e,contentEl:n,originalText:t},e.classList.add("humata-message-editing"),n.classList.add("humata-message-content-editing"),n.textContent="";let o=document.createElement("textarea");o.className="humata-edit-textarea",o.value=t,o.rows=1,o.maxLength=S;let r=document.createElement("div");r.className="humata-edit-actions";let l=document.createElement("button");l.type="button",l.className="humata-edit-cancel",l.innerHTML=Tt(),l.setAttribute("title",((a=h.i18n)==null?void 0:a.cancel)||"Cancel"),l.setAttribute("aria-label",((i=h.i18n)==null?void 0:i.cancel)||"Cancel");let s=document.createElement("button");s.type="button",s.className="humata-edit-save",s.innerHTML=Oe(),s.setAttribute("title",((u=h.i18n)==null?void 0:u.save)||"Save"),s.setAttribute("aria-label",((d=h.i18n)==null?void 0:d.save)||"Save"),r.appendChild(l),r.appendChild(s),n.appendChild(o),n.appendChild(r),se(!1),o.addEventListener("input",function(){Se(o)}),o.addEventListener("keydown",function(m){if(m.key==="Escape"){m.preventDefault(),J();return}m.key==="Enter"&&(m.ctrlKey||m.metaKey)&&(m.preventDefault(),Le())}),requestAnimationFrame(function(){Se(o),o.focus(),o.setSelectionRange(o.value.length,o.value.length)})}function Se(e){if(!e)return;e.style.height="auto";let t=(parseInt(getComputedStyle(e).lineHeight)||24)*8,o=Math.min(e.scrollHeight,t);e.style.height=o+"px",G()}function J(){p&&(ke(p.messageEl,p.originalText),p=null,se(!0),c.input&&c.input.focus())}function Le(){var r;if(!p||E)return;let e=p.contentEl.querySelector(".humata-edit-textarea");if(!e){J();return}let n=e.value,t=n.trim();if(!t){e.focus();return}if(n.length>S){let l=((r=h.i18n)==null?void 0:r.errorPromptTooLong)||"Message is too long. Maximum is "+S+" characters.";A(l,"bot",!0),e.focus();return}let o=xe(p.messageEl);ke(p.messageEl,t),Ce(p.messageEl),p=null,se(!0),oe(),pe(t,o)}function ke(e,n){if(!e)return;let t=e.querySelector(".humata-message-content");t&&(e.classList.remove("humata-message-editing"),t.classList.remove("humata-message-content-editing"),t.innerHTML="",t.textContent=n,N(t),ue(t))}function Ce(e){if(!c.messages||!e)return;ge();let n=e.nextSibling;for(;n;){let t=n.nextSibling;n.nodeType===1&&n.remove(),n=t}}function xe(e){if(!c.messages)return[];let n=[],t=c.messages.querySelectorAll(".humata-message:not(#humata-welcome-message):not(.humata-message-loading)");for(let o=0;o<t.length;o++){let r=t[o];if(r===e)break;let l=r.classList.contains("humata-message-user");if(r.classList.contains("humata-message-error"))continue;let a=r.querySelector(".humata-message-content");if(!a)continue;let i=q(a);i&&n.push({type:l?"user":"bot",content:i})}return n}function _(){if(!c.scrollToggle)return;let e,n,t;F&&c.messages?(e=c.messages.scrollHeight,n=c.messages.clientHeight,t=c.messages.scrollTop):(e=document.documentElement.scrollHeight,n=window.innerHeight,t=window.scrollY||document.documentElement.scrollTop);let o=e-n;if(o<=50){c.scrollToggle.style.display="none";return}c.scrollToggle.style.display="";let r=e-(t+n),l=o*.3,s=r<=l;c.scrollToggle.classList.toggle("humata-scroll-toggle-top",s);let a=c.scrollToggle.getAttribute("data-label-top")||"Scroll to top",i=c.scrollToggle.getAttribute("data-label-bottom")||"Scroll to bottom",u=s?a:i;c.scrollToggle.setAttribute("title",u),c.scrollToggle.setAttribute("aria-label",u)}function ot(){if(!c.scrollToggle)return;let e=c.scrollToggle.classList.contains("humata-scroll-toggle-top");if(F&&c.messages){let n=e?0:c.messages.scrollHeight;c.messages.scrollTo({top:n,behavior:"smooth"})}else{let n=e?0:document.documentElement.scrollHeight;window.scrollTo({top:n,behavior:"smooth"})}}function Ae(){let e=c.input;e.style.height="auto";let t=(parseInt(getComputedStyle(e).lineHeight)||24)*5,o=Math.min(e.scrollHeight,t);e.style.height=o+"px";let r=e.value.length>S;G(),c.sendButton&&(c.sendButton.disabled=!e.value.trim()||r)}function rt(e){e.key==="Enter"&&!e.shiftKey&&(e.preventDefault(),Me())}function Me(){var o;let e=c.input.value,n=e.trim();if(!n||E)return;if(e.length>S){let r=((o=h.i18n)==null?void 0:o.errorPromptTooLong)||"Message is too long. Maximum is "+S+" characters.";A(r,"bot",!0),c.input&&c.input.focus();return}let t=at();he=n,A(n,"user"),c.input.value="",c.input.style.height="auto",c.sendButton&&(c.sendButton.disabled=!0),G(),pe(n,t)}function at(){if(!c.messages)return[];let e=[];return c.messages.querySelectorAll(".humata-message:not(#humata-welcome-message):not(.humata-message-loading)").forEach(function(t){let o=t.classList.contains("humata-message-user");if(t.classList.contains("humata-message-error"))return;let l=t.querySelector(".humata-message-content");if(!l)return;let s=q(l);s&&e.push({type:o?"user":"bot",content:s})}),e}function it(){let e=document.querySelector(".humata-trigger-pages");e&&!e.classList.contains("humata-trigger-pages--hidden")&&e.classList.add("humata-trigger-pages--hidden")}function A(e,n,t=!1){c.welcomeMessage&&(c.welcomeMessage.style.display="none"),n==="user"&&it();let o=document.createElement("div");o.className="humata-message humata-message-"+n,t&&o.classList.add("humata-message-error");let r=document.createElement("div");r.className="humata-message-avatar",V(r,n);let l=document.createElement("div");return l.className="humata-message-content",n==="bot"&&!t?l.innerHTML=st(e):l.textContent=e,N(l),n==="bot"&&_e(l),n==="user"&&!t&&ue(l),o.appendChild(r),o.appendChild(l),c.messages.appendChild(o),n==="bot"&&!t&&Ue(),fe(),oe(),o}function st(e){if(!e)return"";let n=P(String(e).replace(/\r\n?/g,`
`)),t=[];n=n.replace(/```([a-zA-Z0-9_-]*)\n?([\s\S]*?)```/g,function(r,l,s){let a="%%HUMATA_CODEBLOCK_"+t.length+"%%",i=ct(l||"plaintext");return t.push('<pre><code class="language-'+i+'">'+s.trim()+"</code></pre>"),`
`+a+`
`});let o=Fe(n);return o=lt(o),o=o.replace(/%%HUMATA_CODEBLOCK_(\d+)%%/g,function(r,l){let s=parseInt(l,10);return Number.isFinite(s)&&t[s]?t[s]:""}),o}function lt(e){if(!e||typeof e!="string")return e;let n=/<\/ol>(\s*(?:<p>[\s\S]*?<\/p>|<ul>[\s\S]*?<\/ul>|<blockquote>[\s\S]*?<\/blockquote>|<hr>)+\s*)<ol>/g,t=e,o="";for(;t!==o;)o=t,t=t.replace(n,function(r,l){return l+"</ol><ol>"});return t=t.replace(/<\/ol>\s*<ol>/g,""),t}let X=null;function He(e){return e==null?"":(X||(X=document.createElement("textarea")),X.innerHTML=String(e),X.value)}function ct(e){return String(e||"").toLowerCase().replace(/[^\w-]+/g,"")||"plaintext"}function Be(e){if(!e)return"";let n=He(String(e)).trim();if(!n)return"";let t=n.replace(/[\u0000-\u001F\u007F\s]+/g,"");if(!t)return"";if(t.startsWith("#")||t.startsWith("/")||t.startsWith("./")||t.startsWith("../")||t.startsWith("?")||t.startsWith("//"))return P(n);let o=t.match(/^([a-zA-Z][a-zA-Z0-9+.-]*):/);if(o){let r=(o[1]||"").toLowerCase();if(!(r==="http"||r==="https"||r==="mailto"||r==="tel"))return""}return P(n)}let Z=null;function Q(e){return!!e&&/[A-Za-z0-9]/.test(e)}function ut(){if(Z!==null)return Z;let e=Array.isArray(h.autoLinks)?h.autoLinks:[],n=[];for(let t=0;t<e.length;t++){let o=e[t];if(!o||typeof o!="object")continue;let r=String(o.phrase||"").trim(),l=String(o.url||"").trim();if(!r||!l)continue;let s=Be(l);if(s&&(n.push({phrase:r,phraseLower:r.toLowerCase(),href:He(s),len:r.length,startsWord:Q(r.charAt(0)),endsWord:Q(r.charAt(r.length-1))}),n.length>=200))break}return n.sort(function(t,o){return o.len-t.len}),Z=n,Z}function dt(e,n){if(!e)return[];let t=String(e),o=t.toLowerCase(),r=[];function l(s,a){for(let i=0;i<r.length;i++){let u=r[i];if(s<u.end&&u.start<a)return!0}return!1}for(let s=0;s<n.length;s++){let a=n[s];if(!a||!a.phraseLower)continue;let i=0;for(;i=o.indexOf(a.phraseLower,i),i!==-1;){let u=i,d=i+a.phraseLower.length;if(a.startsWord){let m=u>0?t.charAt(u-1):"";if(m&&Q(m)){i=i+1;continue}}if(a.endsWord){let m=d<t.length?t.charAt(d):"";if(m&&Q(m)){i=i+1;continue}}l(u,d)||r.push({start:u,end:d,href:a.href}),i=d}}return r}function mt(e){if(!e)return e;let n=ut();if(!n||!n.length||typeof document=="undefined"||!document.createElement||!document.createTreeWalker||typeof NodeFilter=="undefined")return e;let t=document.createElement("div");try{t.innerHTML=String(e)}catch(s){return e}let o;try{o=document.createTreeWalker(t,NodeFilter.SHOW_TEXT,{acceptNode:function(s){let a=s&&s.nodeValue?String(s.nodeValue):"";if(!a||!a.trim())return NodeFilter.FILTER_REJECT;let i=s.parentNode;for(;i&&i!==t;){let u=i.nodeName;if(u==="A"||u==="CODE"||u==="PRE")return NodeFilter.FILTER_REJECT;i=i.parentNode}return NodeFilter.FILTER_ACCEPT}})}catch(s){return e}let r=[],l;for(;l=o.nextNode();)r.push(l);for(let s=0;s<r.length;s++){let a=r[s],i=a&&a.nodeValue?String(a.nodeValue):"";if(!i)continue;let u=dt(i,n);if(!u.length)continue;u.sort(function(T,g){return T.start-g.start});let d=document.createDocumentFragment(),m=0;for(let T=0;T<u.length;T++){let g=u[T];if(!g||g.start<m)continue;g.start>m&&d.appendChild(document.createTextNode(i.slice(m,g.start)));let y=document.createElement("a");y.setAttribute("href",g.href),y.setAttribute("target","_blank"),y.setAttribute("rel","noopener noreferrer"),y.textContent=i.slice(g.start,g.end),d.appendChild(y),m=g.end}m<i.length&&d.appendChild(document.createTextNode(i.slice(m))),a.parentNode&&a.parentNode.replaceChild(d,a)}return t.innerHTML}function I(e){return!e||/^\s*$/.test(e)}function Ie(e){return/^%%HUMATA_CODEBLOCK_\d+%%$/.test(String(e||"").trim())}function Ne(e){return/^\s{0,3}(-{3,}|\*{3,})\s*$/.test(String(e||""))}function qe(e){let n=String(e||"").match(/^\s{0,3}(#{1,6})\s+(.+?)\s*$/);return n?{level:n[1].length,text:n[2]}:null}function le(e){return/^\s{0,3}>\s?/.test(String(e||""))}function ht(e){return String(e||"").replace(/^\s{0,3}>\s?/,"")}function ee(e){return/^\s{0,3}[-+*]\s+/.test(String(e||""))}function te(e){return/^\s{0,3}\d+\.\s+/.test(String(e||""))}function ne(e){if(!e)return"";let n=String(e),t=[];return n=n.replace(/`([^`]+)`/g,function(o,r){let l="%%HUMATA_CODESPAN_"+t.length+"%%";return t.push("<code>"+r+"</code>"),l}),n=n.replace(/\[([^\]]+)\]\(([^)]+)\)/g,function(o,r,l){let s=Be(l);return s?'<a href="'+s+'" target="_blank" rel="noopener noreferrer">'+r+"</a>":r+" ("+l+")"}),n=n.replace(/\*\*([^*]+)\*\*/g,"<strong>$1</strong>"),n=n.replace(/(^|[^*])\*([^*\n]+)\*(?!\*)/g,"$1<em>$2</em>"),n=mt(n),n=n.replace(/%%HUMATA_CODESPAN_(\d+)%%/g,function(o,r){let l=parseInt(r,10);return Number.isFinite(l)&&t[l]?t[l]:o}),n}function Fe(e){if(!e)return"";let n=String(e).split(`
`),t=[],o=0;for(;o<n.length;){let r=n[o];if(I(r)){o++;continue}if(Ie(r)){t.push(String(r).trim()),o++;continue}if(Ne(r)){t.push("<hr>"),o++;continue}let l=qe(r);if(l){t.push("<h"+l.level+">"+ne(l.text)+"</h"+l.level+">"),o++;continue}if(le(r)){let i=[];for(;o<n.length&&le(n[o]);)i.push(ht(n[o])),o++;t.push("<blockquote>"+Fe(i.join(`
`))+"</blockquote>");continue}if(ee(r)){let i=[];for(;o<n.length;){let u=n[o];if(I(u)){let m=o+1;for(;m<n.length&&I(n[m]);)m++;if(m<n.length&&ee(n[m])){o=m;continue}break}if(!ee(u))break;let d=String(u).replace(/^\s{0,3}[-+*]\s+/,"");i.push("<li>"+ne(d)+"</li>"),o++}t.push("<ul>"+i.join("")+"</ul>");continue}if(te(r)){let i=[];for(;o<n.length;){let u=n[o];if(I(u)){let m=o+1;for(;m<n.length&&I(n[m]);)m++;if(m<n.length&&te(n[m])){o=m;continue}break}if(!te(u))break;let d=String(u).replace(/^\s{0,3}\d+\.\s+/,"");i.push("<li>"+ne(d)+"</li>"),o++}t.push("<ol>"+i.join("")+"</ol>");continue}let s=[];for(;o<n.length;){let i=n[o];if(I(i)||Ie(i)||Ne(i)||qe(i)||le(i)||ee(i)||te(i))break;s.push(String(i).trim()),o++}let a=s.join(" ").trim();a&&t.push("<p>"+ne(a)+"</p>")}return t.join("")}function P(e){let n=document.createElement("div");return n.textContent=e,n.innerHTML}function ce(e){if(!e)return null;let n=e.querySelector(".humata-message-actions");return n||(n=document.createElement("div"),n.className="humata-message-actions",e.appendChild(n),n)}function N(e){if(!e||e.querySelector(".humata-copy-button"))return;e.classList.add("humata-message-content-has-copy");let n=document.createElement("button");n.type="button",n.className="humata-copy-button",n.innerHTML=vt(),n.setAttribute("title","Copy"),n.setAttribute("aria-label","Copy message");let t=ce(e);t&&t.appendChild(n)}function _e(e){var o,r;if(!e||e.querySelector(".humata-regenerate-button"))return;e.classList.add("humata-message-content-has-regenerate");let n=document.createElement("button");n.type="button",n.className="humata-regenerate-button",n.innerHTML=Et(),n.setAttribute("title",((o=h.i18n)==null?void 0:o.regenerate)||"Regenerate"),n.setAttribute("aria-label",((r=h.i18n)==null?void 0:r.regenerate)||"Regenerate");let t=ce(e);t&&t.appendChild(n)}function ue(e){var o,r;if(!e||e.querySelector(".humata-edit-button"))return;e.classList.add("humata-message-content-has-edit");let n=document.createElement("button");n.type="button",n.className="humata-edit-button",n.innerHTML=wt(),n.setAttribute("title",((o=h.i18n)==null?void 0:o.editMessage)||"Edit message"),n.setAttribute("aria-label",((r=h.i18n)==null?void 0:r.editMessage)||"Edit message");let t=ce(e);t&&t.appendChild(n)}function q(e){let n=e?e.querySelector(".humata-edit-textarea"):null;if(n)return(n.value||"").trim();let t=e.cloneNode(!0);return t.querySelectorAll(".humata-copy-button").forEach(function(o){o.remove()}),t.querySelectorAll(".humata-regenerate-button").forEach(function(o){o.remove()}),t.querySelectorAll(".humata-edit-button").forEach(function(o){o.remove()}),t.querySelectorAll(".humata-edit-actions").forEach(function(o){o.remove()}),t.querySelectorAll(".humata-message-actions").forEach(function(o){o.remove()}),t.querySelectorAll(".humata-bot-response-disclaimer").forEach(function(o){o.remove()}),t.querySelectorAll(".humata-intent-links").forEach(function(o){o.remove()}),t.querySelectorAll(".humata-accordions").forEach(function(o){o.remove()}),((t.innerText||t.textContent||"")+"").trim()}function de(e){let n=e.cloneNode(!0);return n.querySelectorAll(".humata-copy-button").forEach(function(t){t.remove()}),n.querySelectorAll(".humata-regenerate-button").forEach(function(t){t.remove()}),n.querySelectorAll(".humata-edit-button").forEach(function(t){t.remove()}),n.querySelectorAll(".humata-edit-actions").forEach(function(t){t.remove()}),n.querySelectorAll(".humata-message-actions").forEach(function(t){t.remove()}),n.querySelectorAll(".humata-bot-response-disclaimer").forEach(function(t){t.remove()}),n.querySelectorAll(".humata-intent-links").forEach(function(t){t.remove()}),n.querySelectorAll(".humata-accordions").forEach(function(t){t.remove()}),n.innerHTML}function gt(e){let n=e?e.querySelector(".humata-edit-textarea"):null;if(n){let o=(n.value||"").trim();return{text:o,html:o?"<div>"+P(o).replace(/\n/g,"<br>")+"</div>":""}}let t=e?de(e):"";return t?{text:Pe(t),html:"<div>"+t+"</div>"}:{text:"",html:""}}function Pe(e){if(!e)return"";let n=document.createElement("div");n.innerHTML=e;let t=me(n,{listStack:[]});return String(t||"").replace(/\r\n?/g,`
`).replace(/[ \t]+\n/g,`
`).replace(/\n{3,}/g,`

`).trim()}function me(e,n){if(!e)return"";let t=e.nodeType;if(t===3)return e.nodeValue||"";if(t!==1)return"";let o=(e.tagName||"").toLowerCase();function r(){let a="",i=e.childNodes||[];for(let u=0;u<i.length;u++)a+=me(i[u],n);return a}function l(a){return a?a.endsWith(`
`)?a:a+`
`:`
`}function s(a){let i=l(a);return i.endsWith(`

`)||(i+=`
`),i}if(o==="br")return`
`;if(o==="hr")return`

`;if(o==="pre"){let a=e.textContent||"";return s(a.replace(/\n$/,""))}if(o==="p"||o==="div"||o==="section"){let a=r().trim();return a?s(a):""}if(o==="blockquote"){let a=r().trim();return a?s(a):""}if(/^h[1-6]$/.test(o)){let a=r().trim();return a?s(a):""}if(o==="ul"||o==="ol"){n.listStack.push({type:o,index:0});let a="",i=e.childNodes||[];for(let u=0;u<i.length;u++)a+=me(i[u],n);return n.listStack.pop(),s(a.trim())}if(o==="li"){let a=n.listStack||[],i=a.length?a[a.length-1]:null,u="- ";i&&i.type==="ol"?(i.index+=1,u=String(i.index)+". "):i&&i.type==="ul"&&(u="\u2022 ");let d=a.length>1?"  ".repeat(a.length-1):"",m=r().trim();return m?d+u+m+`
`:""}return r()}function ft(e){if(e==null)return Promise.reject(new Error("Nothing to copy"));if(typeof e=="string")return De(e);let n=String(e.text||""),t=String(e.html||"");if(t&&navigator.clipboard&&navigator.clipboard.write&&typeof ClipboardItem!="undefined")try{let o=new ClipboardItem({"text/plain":new Blob([n],{type:"text/plain"}),"text/html":new Blob([t],{type:"text/html"})});return navigator.clipboard.write([o]).catch(function(){return Re(t)})}catch(o){}return t?Re(t):De(n)}function Re(e){return new Promise(function(n,t){try{let o=document.createElement("div");o.setAttribute("aria-hidden","true"),o.style.position="fixed",o.style.left="-9999px",o.style.top="0",o.style.width="1px",o.style.height="1px",o.style.overflow="hidden",o.innerHTML=e,document.body.appendChild(o);let r=window.getSelection?window.getSelection():null,l=[];if(r&&r.rangeCount)for(let a=0;a<r.rangeCount;a++)l.push(r.getRangeAt(a).cloneRange());if(r){let a=document.createRange();a.selectNodeContents(o),r.removeAllRanges(),r.addRange(a)}let s=document.execCommand("copy");if(r){r.removeAllRanges();for(let a=0;a<l.length;a++)r.addRange(l[a])}o.remove(),s?n():t(new Error("Copy failed"))}catch(o){t(o)}})}function De(e){return navigator.clipboard&&navigator.clipboard.writeText?navigator.clipboard.writeText(e).catch(function(){return ze(e)}):ze(e)}function ze(e){return new Promise(function(n,t){try{let o=document.createElement("textarea");o.value=String(e||""),o.setAttribute("readonly",""),o.style.position="fixed",o.style.top="-9999px",o.style.left="-9999px",document.body.appendChild(o),o.select(),o.setSelectionRange(0,o.value.length);let r=document.execCommand("copy");o.remove(),r?n():t(new Error("Copy failed"))}catch(o){t(o)}})}function pt(e){e&&(e.dataset.humataCopyDefault||(e.dataset.humataCopyDefault=e.innerHTML),e._humataCopyResetTimer&&clearTimeout(e._humataCopyResetTimer),e.innerHTML=Oe(),e.classList.add("humata-copy-button-success"),e.setAttribute("title","Copied"),e.setAttribute("aria-label","Copied"),e._humataCopyResetTimer=setTimeout(function(){e.innerHTML=e.dataset.humataCopyDefault,e.classList.remove("humata-copy-button-success"),e.setAttribute("title","Copy"),e.setAttribute("aria-label","Copy message")},1500))}function yt(e){e&&(e.setAttribute("title","Copy failed"),e.setAttribute("aria-label","Copy failed"),e._humataCopyResetTimer&&clearTimeout(e._humataCopyResetTimer),e._humataCopyResetTimer=setTimeout(function(){e.setAttribute("title","Copy"),e.setAttribute("aria-label","Copy message")},1500))}function vt(){return'<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"><rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect><path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path></svg>'}function wt(){return'<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"><path d="M12 20h9"></path><path d="M16.5 3.5a2.121 2.121 0 0 1 3 3L7 19l-4 1 1-4Z"></path></svg>'}function Et(){return'<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"><polyline points="23 4 23 10 17 10"></polyline><polyline points="1 20 1 14 7 14"></polyline><path d="M3.51 9a9 9 0 0 1 14.13-3.36L23 10"></path><path d="M1 14l5.36 5.36A9 9 0 0 0 20.49 15"></path></svg>'}function Oe(){return'<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"><path d="M20 6 9 17l-5-5"></path></svg>'}function Tt(){return'<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"><path d="M18 6 6 18"></path><path d="m6 6 12 12"></path></svg>'}function bt(){let e=h.botResponseDisclaimer;if(!e||typeof e!="string"||!e.trim())return null;let n=document.getElementById("humata-bot-response-disclaimer");return n||(n=document.createElement("div"),n.id="humata-bot-response-disclaimer",n.className="humata-bot-response-disclaimer",n.innerHTML="<p>"+e+"</p>"),n}function Ue(){let e=bt();if(!e)return;if(!c.messages){e.remove();return}let n=c.messages.querySelectorAll(".humata-message-bot:not(.humata-message-error):not(.humata-message-loading):not(#humata-welcome-message)");if(!n.length){e.remove();return}let o=n[n.length-1].querySelector(".humata-message-content");if(!o){e.remove();return}o.appendChild(e)}function St(){let e=document.getElementById("humata-bot-response-disclaimer");e&&e.remove()}function We(e){return String(e||"").replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}function Lt(e){let n=h.intentLinks;if(!n||!Array.isArray(n)||!n.length)return[];if(!e||typeof e!="string")return[];let t=[],o=new Set;for(let r=0;r<n.length;r++){let l=n[r],s=l.keywords,a=l.links;if(!s||!Array.isArray(s)||!s.length||!a||!Array.isArray(a)||!a.length)continue;let i=!1;for(let u=0;u<s.length;u++){let d=s[u];if(!d)continue;if(new RegExp("\\b"+We(d)+"\\b","i").test(e)){i=!0;break}}if(i)for(let u=0;u<a.length;u++){let d=a[u];!d||!d.title||!d.url||o.has(d.url)||(o.add(d.url),t.push({title:d.title,url:d.url}))}}return t}function kt(e){var r;if(!e||!e.length)return null;let n=document.createElement("div");n.className="humata-intent-links";let t=document.createElement("span");t.className="humata-intent-links-label",t.textContent=((r=h.i18n)==null?void 0:r.relatedResources)||"Related resources:",n.appendChild(t);let o=document.createElement("div");o.className="humata-intent-links-pills";for(let l=0;l<e.length;l++){let s=e[l],a=document.createElement("a");a.href=s.url,a.target="_blank",a.rel="noopener noreferrer",a.className="humata-intent-link",a.textContent=s.title,o.appendChild(a)}return n.appendChild(o),n}function Ct(e){let n=h.intentLinks;if(!n||!Array.isArray(n)||!n.length)return[];if(!e||typeof e!="string")return[];let t=[],o=new Set;for(let r=0;r<n.length;r++){let l=n[r],s=l.keywords,a=l.accordions;if(!s||!Array.isArray(s)||!s.length||!a||!Array.isArray(a)||!a.length)continue;let i=!1;for(let u=0;u<s.length;u++){let d=s[u];if(!d)continue;if(new RegExp("\\b"+We(d)+"\\b","i").test(e)){i=!0;break}}if(i)for(let u=0;u<a.length;u++){let d=a[u];!d||!d.title||!d.content||o.has(d.title)||(o.add(d.title),t.push({title:d.title,content:d.content}))}}return t}function xt(e){if(!e||!e.length)return null;let n=document.createElement("div");n.className="humata-accordions";for(let t=0;t<e.length;t++){let o=e[t],r=document.createElement("div");r.className="humata-accordion-item";let l=document.createElement("button");l.type="button",l.className="humata-accordion-toggle",l.innerHTML="<span>"+P(o.title)+'</span><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="6 9 12 15 18 9"></polyline></svg>',l.addEventListener("click",function(){r.classList.toggle("open")});let s=document.createElement("div");s.className="humata-accordion-content",s.innerHTML=o.content,r.appendChild(l),r.appendChild(s),n.appendChild(r)}return n}function je(e,n){if(!e||!n)return;let t=e.querySelector(".humata-message-content");if(!t)return;let o=Ct(n),r=Lt(n),l=xt(o);if(l){e._humataIntentAccordions=o;let i=t.querySelector(".humata-message-actions");i?t.insertBefore(l,i):t.appendChild(l)}if(!r.length)return;let s=kt(r);if(!s)return;e._humataIntentLinks=r;let a=t.querySelector(".humata-bot-response-disclaimer");a?t.insertBefore(s,a):t.appendChild(s)}let he="";function At(){var l;St();let e=document.createElement("div");e.className="humata-message humata-message-bot humata-message-loading",e.id="humata-loading-indicator";let n=document.createElement("div");n.className="humata-message-avatar",V(n,"bot");let t=document.createElement("div");t.className="humata-message-content";let o=String(h.secondLlmProvider||"").toLowerCase(),r=o!==""&&o!=="none";if(r?t.innerHTML='<div class="humata-typing-indicator"><span></span><span></span><span></span></div><div class="humata-loading-status" aria-live="polite" aria-atomic="true"><span class="humata-loading-status-text"></span></div>':t.innerHTML='<div class="humata-typing-indicator"><span></span><span></span><span></span></div>',e.appendChild(n),e.appendChild(t),c.messages.appendChild(e),r){let s=t.querySelector(".humata-loading-status-text");if(s){let a=["Processing your question\u2026",((l=h.i18n)==null?void 0:l.thinking)||"Thinking\u2026","Reviewing for accuracy\u2026","Just a few moments more\u2026","Almost ready\u2026","Finalizing answer\u2026"],i=0;s.textContent=a[i],s.style.opacity="1",e._humataStatusTimer=setInterval(function(){i=(i+1)%a.length,s.style.opacity="0",e._humataStatusFadeTimer=setTimeout(function(){s.textContent=a[i],s.style.opacity="1"},180)},2e3)}}return fe(),e}function ge(){let e=document.getElementById("humata-loading-indicator");e&&(e._humataStatusTimer&&clearInterval(e._humataStatusTimer),e._humataStatusFadeTimer&&clearTimeout(e._humataStatusFadeTimer),e.remove())}function fe(){F&&c.messages?c.messages.scrollTop=c.messages.scrollHeight:window.scrollTo({top:document.documentElement.scrollHeight,behavior:"smooth"}),_()}async function pe(e,n=[]){var t,o,r,l,s,a,i,u;if(!E){E=!0;try{let d=null;if($()&&!Ee())try{d=await Ge()}catch(y){console.error("Turnstile error:",y),E=!1,A(((t=h.i18n)==null?void 0:t.errorTurnstile)||"Human verification failed. Please try again.","bot",!0);return}At();let m={"Content-Type":"application/json","X-WP-Nonce":h.wpNonce,"X-Humata-Nonce":h.nonce};d&&(m["X-Turnstile-Token"]=d);let T=await fetch(h.apiUrl,{method:"POST",credentials:"same-origin",headers:m,body:JSON.stringify({message:e,history:n})});ge();let g=await T.json();if(!T.ok){let y=((o=h.i18n)==null?void 0:o.errorRequestFailed)||"Your message request failed. Try again. If problem persists, please contact us.",L=((r=h.i18n)==null?void 0:r.errorGeneric)||"An error occurred. Please try again.";T.status===429?L=((l=h.i18n)==null?void 0:l.errorRateLimit)||"Too many requests. Please wait a moment.":g&&g.code==="turnstile_required"?(sessionStorage.removeItem(j),K=null,L=((s=h.i18n)==null?void 0:s.errorTurnstileRequired)||"Please complete the human verification to continue."):g&&g.code==="turnstile_failed"?(sessionStorage.removeItem(j),K=null,L=((a=h.i18n)==null?void 0:a.errorTurnstileFailed)||"Human verification failed. Please try again."):g&&typeof g.message=="string"&&g.message.trim()!==""?L=/\b(straico|humata|anthropic|claude)\b/i.test(g.message)?y:g.message:L=y,A(L,"bot",!0);return}if($()&&d&&$e(),g.success&&g.answer){let y=A(g.answer,"bot");y&&he&&(je(y,he),oe())}else A(((i=h.i18n)==null?void 0:i.errorGeneric)||"An error occurred. Please try again.","bot",!0)}catch(d){ge(),A(((u=h.i18n)==null?void 0:u.errorNetwork)||"Network error. Please check your connection.","bot",!0)}finally{E=!1,c.input.focus()}}}function Mt(){let e=c.exportPdfButton;e&&(e.disabled=!0);try{let m=function(){let f=String(d.getFullYear()),k=String(d.getMonth()+1).padStart(2,"0"),b=String(d.getDate()).padStart(2,"0"),C="chat-export-"+f+"-"+k+"-"+b;if(x){let v=String(x).replace(/[^\w-]+/g,"").slice(0,40);v&&(C+="-"+v)}return C+".pdf"},T=function(f){return String(f||"").replace(/\u00A0/g," ").replace(/[\u200B\u200C\u200D\uFEFF]/g,"").replace(/\u2022/g,"-").replace(/[\u2018\u2019]/g,"'").replace(/[\u201C\u201D]/g,'"').replace(/[\u2013\u2014]/g,"-").replace(/\u2026/g,"...").replace(/\r\n?/g,`
`).trim()},g=function(f,k,b){try{t.text(f,k,b)}catch(C){t.text(String(f||"").replace(/[^\x09\x0A\x0D\x20-\x7E]/g,"?"),k,b)}},n=window.jspdf&&window.jspdf.jsPDF?window.jspdf.jsPDF:window.jsPDF||null;if(!n)return;let t=new n({unit:"pt",format:"a4"}),o=t.internal.pageSize.getWidth?t.internal.pageSize.getWidth():t.internal.pageSize.width,r=t.internal.pageSize.getHeight?t.internal.pageSize.getHeight():t.internal.pageSize.height,l=40,s=40,a=o-l*2,i=14,u=s,d=new Date,y=document.querySelector(".humata-chat-title"),L=((y?y.textContent:"")||"Chat Export").trim();t.setFont("helvetica","bold"),t.setFontSize(16),g(L||"Chat Export",l,u),u+=22,t.setFont("helvetica","normal"),t.setFontSize(10),g(d.toLocaleString(),l,u),u+=24;let R=c.messages?c.messages.querySelectorAll(".humata-message:not(#humata-welcome-message):not(.humata-message-loading)"):[],D=[];R.forEach(function(f){let k=f.querySelector(".humata-message-content");if(!k)return;let b=f.classList.contains("humata-message-user"),C=f.classList.contains("humata-message-error"),v="";if(b)v=q(k);else{let O=de(k);v=Pe(O)}if(v=T(v),!v)return;let w=null;!b&&!C&&f._humataIntentLinks&&f._humataIntentLinks.length&&(w=f._humataIntentLinks);let M=null;!b&&!C&&f._humataIntentAccordions&&f._humataIntentAccordions.length&&(M=f._humataIntentAccordions),D.push({role:b?"You":"Assistant",text:v,isError:C,intentLinks:w,intentAccordions:M})});let z=new Set;if(!D.length){t.setFont("helvetica","normal"),t.setFontSize(12),g("No messages.",l,u),t.save(m());return}D.forEach(function(f){var C;t.setFont("helvetica","bold"),t.setFontSize(13);let k=f.role+(f.isError?" (error)":"")+":";u+i>r-s&&(t.addPage(),u=s),g(k,l,u),u+=i,t.setFont("helvetica","normal"),t.setFontSize(12);let b=t.splitTextToSize(f.text,a);for(let v=0;v<b.length;v++)u+i>r-s&&(t.addPage(),u=s),g(b[v],l,u),u+=i;if(f.intentAccordions&&f.intentAccordions.length){let v=f.intentAccordions.filter(function(w){return z.has(w.title)?!1:(z.add(w.title),!0)});if(v.length){u+=4;for(let w=0;w<v.length;w++){let M=v[w];t.setFont("helvetica","bold"),t.setFontSize(11),u+i>r-s&&(t.addPage(),u=s),g("\u25B8 "+M.title,l,u),u+=i,t.setFont("helvetica","normal"),t.setFontSize(11);let O=M.content.replace(/<br\s*\/?>/gi,`
`).replace(/<\/p>/gi,`
`).replace(/<[^>]+>/g,"").replace(/&nbsp;/g," ").replace(/&amp;/g,"&").replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&quot;/g,'"').trim(),U=t.splitTextToSize(O,a-10);for(let H=0;H<U.length;H++)u+i>r-s&&(t.addPage(),u=s),g("  "+U[H],l,u),u+=i;u+=2}}}if(f.intentLinks&&f.intentLinks.length){u+=4,t.setFont("helvetica","italic"),t.setFontSize(11);let v=((C=h.i18n)==null?void 0:C.relatedResources)||"Related resources:";u+i>r-s&&(t.addPage(),u=s),g(v,l,u),u+=i,t.setFont("helvetica","normal");for(let w=0;w<f.intentLinks.length;w++){let M=f.intentLinks[w],O="\u2022 "+M.title+" - "+M.url,U=t.splitTextToSize(O,a);for(let H=0;H<U.length;H++)u+i>r-s&&(t.addPage(),u=s),g(U[H],l,u),u+=i}}u+=i}),t.save(m())}catch(n){console.error(n)}finally{e&&(e.disabled=!1)}}function Ht(){var e;if(c.messages&&(c.messages.innerHTML=""),c.welcomeMessage)c.welcomeMessage.style.display="",c.messages.appendChild(c.welcomeMessage),N(c.welcomeMessage.querySelector(".humata-message-content"));else{let n=document.createElement("div");n.id="humata-welcome-message",n.className="humata-message humata-message-bot";let t=document.createElement("div");t.className="humata-message-avatar",V(t,"bot");let o=document.createElement("div");o.className="humata-message-content",o.innerHTML="<p>"+(((e=h.i18n)==null?void 0:e.welcome)||"Hello! I'm here to help answer your questions. What would you like to know?")+"</p>",n.appendChild(t),n.appendChild(o),c.messages.appendChild(n),c.welcomeMessage=n,N(o)}localStorage.removeItem(W),localStorage.removeItem(ye),x=null,c.input&&c.input.focus()}function oe(){if(!c.messages)return;let e=[],n=c.messages.querySelectorAll(".humata-message:not(#humata-welcome-message):not(.humata-message-loading)"),t="";n.forEach(function(o){let r=o.classList.contains("humata-message-user"),l=o.classList.contains("humata-message-error"),s=o.querySelector(".humata-message-content");if(s){let a={type:r?"user":"bot",content:r?q(s):de(s),isError:l};r?t=a.content:a.triggerUserMessage=t,e.push(a)}});try{localStorage.setItem(W,JSON.stringify(e))}catch(o){}}function Bt(){try{let e=localStorage.getItem(W);if(!e)return;let n=JSON.parse(e);if(!Array.isArray(n)||n.length===0)return;c.welcomeMessage&&(c.welcomeMessage.style.display="none"),n.forEach(function(t){let o=document.createElement("div");o.className="humata-message humata-message-"+t.type,t.isError&&o.classList.add("humata-message-error");let r=document.createElement("div");r.className="humata-message-avatar",V(r,t.type);let l=document.createElement("div");l.className="humata-message-content",t.type==="user"?l.textContent=t.content:l.innerHTML=t.content,N(l),t.type==="bot"&&_e(l),t.type==="user"&&!t.isError&&ue(l),o.appendChild(r),o.appendChild(l),c.messages.appendChild(o),t.type==="bot"&&!t.isError&&t.triggerUserMessage&&je(o,t.triggerUserMessage)}),x=localStorage.getItem(ye),Ue(),fe()}catch(e){localStorage.removeItem(W)}}document.readyState==="loading"?document.addEventListener("DOMContentLoaded",we):we()})();})();
//# sourceMappingURL=chat-widget.js.map
