(()=>{var h=window.humataConfig||{},z="humata_chat_history",ge="humata_conversation_id",te="humata_theme_preference",U="humata_turnstile_verified";var At='<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"><path d="M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2"></path><circle cx="12" cy="7" r="4"></circle></svg>',Mt='<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"><path d="M12 8V4H8"></path><rect width="16" height="12" x="4" y="8" rx="2"></rect><path d="M2 14h2"></path><path d="M20 14h2"></path><path d="M15 13v2"></path><path d="M9 13v2"></path></svg>';function W(c,E){let C=E==="user"?h.userAvatarUrl:h.botAvatarUrl;if(C&&C.length>0){let p=document.createElement("img");p.src=C,p.alt=E==="user"?"User":"Bot",p.className="humata-avatar-img",c.innerHTML="",c.appendChild(p)}else c.innerHTML=E==="user"?At:Mt}(function(){"use strict";let c={},E=!1,C=null,p=null,S=3e3,_=!1,j=null,O=null,fe=!1,Ht=null;function pe(){c={container:document.getElementById("humata-chat-container"),messages:document.getElementById("humata-chat-messages"),input:document.getElementById("humata-chat-input"),inputCounter:document.getElementById("humata-chat-input-counter"),sendButton:document.getElementById("humata-send-button"),scrollToggle:document.getElementById("humata-scroll-toggle"),exportPdfButton:document.getElementById("humata-export-pdf"),clearButton:document.getElementById("humata-clear-chat"),themeToggle:document.getElementById("humata-theme-toggle"),welcomeMessage:document.getElementById("humata-welcome-message")},!(!c.container||!c.messages||!c.input)&&(_=c.container.classList.contains("humata-chat-embedded"),S=Ze(),c.input&&S>0&&(c.input.maxLength=S),Oe(),$e(),c.welcomeMessage&&N(c.welcomeMessage.querySelector(".humata-message-content")),xt(),Ge(),ke(),F(),c.input&&c.input.focus(),F())}function Oe(){let e=localStorage.getItem(te),t=h.theme||"auto",n=e||t;n==="auto"&&(n=window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light"),ne(n),t==="auto"&&!e&&window.matchMedia("(prefers-color-scheme: dark)").addEventListener("change",function(r){localStorage.getItem(te)||ne(r.matches?"dark":"light")})}function ne(e){let t=document.documentElement,n=document.body;t.classList.remove("humata-theme-dark","humata-theme-light"),n.classList.remove("humata-theme-dark","humata-theme-light"),e==="dark"?(t.classList.add("humata-theme-dark"),n.classList.add("humata-theme-dark")):(t.classList.add("humata-theme-light"),n.classList.add("humata-theme-light"))}function Ke(){let t=document.documentElement.classList.contains("humata-theme-dark")?"light":"dark";localStorage.setItem(te,t),ne(t)}function K(){return h.turnstile&&h.turnstile.enabled&&h.turnstile.siteKey}function ye(){return K()?sessionStorage.getItem(U)==="true":!0}function Ve(){sessionStorage.setItem(U,"true")}function ve(){return new Promise(function(e,t){if(window.turnstile){fe=!0,e();return}let n=document.createElement("script");n.src="https://challenges.cloudflare.com/turnstile/v0/api.js?onload=onTurnstileLoad",n.async=!0,n.defer=!0,window.onTurnstileLoad=function(){fe=!0,e()},n.onerror=function(){t(new Error("Failed to load Turnstile script"))},document.head.appendChild(n)})}function Ye(){return new Promise(function(e,t){if(ye()){e(null);return}let n=document.getElementById("humata-turnstile-container");if(!n){e(null);return}ve().then(function(){if(console.log("Turnstile script loaded, preparing to render widget"),O!==null&&window.turnstile){try{window.turnstile.remove(O)}catch(o){}O=null}n.innerHTML='<div id="humata-turnstile-widget"></div>',n.style.display="flex";let r=document.getElementById("humata-turnstile-widget");console.log("Turnstile container visible, widget container:",r),setTimeout(function(){try{O=window.turnstile.render(r,{sitekey:h.turnstile.siteKey,appearance:h.turnstile.appearance||"managed",theme:document.documentElement.classList.contains("humata-theme-dark")?"dark":"light",size:"normal",callback:function(o){j=o,n.style.display="none",n.innerHTML="",e(o)},"error-callback":function(o){console.error("Turnstile error:",o),n.style.display="none",n.innerHTML="",t(new Error("Turnstile verification failed: "+(o||"unknown")))},"expired-callback":function(){j=null}}),setTimeout(function(){r.querySelector("iframe")||(n.style.display="none")},100)}catch(o){console.error("Turnstile render error:",o),n.style.display="none",n.innerHTML="",t(o)}},50)}).catch(function(r){console.error("Turnstile script load error:",r),t(r)})})}function $e(){K()&&ve().catch(function(){})}function Ge(){c.sendButton&&c.sendButton.addEventListener("click",Ce),c.input&&(c.input.addEventListener("keydown",nt),c.input.addEventListener("input",ke)),c.scrollToggle&&c.scrollToggle.addEventListener("click",tt),_&&c.messages?c.messages.addEventListener("scroll",F,{passive:!0}):window.addEventListener("scroll",F,{passive:!0}),c.messages&&c.messages.addEventListener("click",Qe),c.clearButton&&c.clearButton.addEventListener("click",Ct),c.exportPdfButton&&c.exportPdfButton.addEventListener("click",kt),c.themeToggle&&c.themeToggle.addEventListener("click",Ke),Je()}function Je(){document.addEventListener("click",function(e){let t=e.target.closest("[data-humata-page-modal]");if(!t)return;e.preventDefault();let n=t.getAttribute("data-humata-page-modal"),r=document.getElementById("humata-page-modal-"+n);r&&Xe(r,t)}),document.addEventListener("click",function(e){let t=e.target.closest("[data-humata-page-close-modal]");if(!t)return;let n=t.closest(".humata-help-modal");n&&(e.preventDefault(),we(n))}),document.addEventListener("keydown",function(e){if(e.key!=="Escape")return;let t=document.querySelector(".humata-help-modal.is-open");t&&(e.preventDefault(),we(t))})}let B=null;function Xe(e,t){B=t||document.activeElement,e.hidden=!1,e.classList.add("is-open"),e.setAttribute("aria-hidden","false"),document.documentElement.classList.add("humata-help-modal-open"),document.body.classList.add("humata-help-modal-open");let n=e.querySelector(".humata-help-modal__close");if(n)try{n.focus({preventScroll:!0})}catch(r){n.focus()}}function we(e){if(e.classList.remove("is-open"),e.setAttribute("aria-hidden","true"),e.hidden=!0,document.documentElement.classList.remove("humata-help-modal-open"),document.body.classList.remove("humata-help-modal-open"),B&&typeof B.focus=="function")try{B.focus({preventScroll:!0})}catch(t){B.focus()}B=null}function Ze(){let e=parseInt(h.maxPromptChars,10);if(Number.isFinite(e)&&e>0)return e;if(c.input){let t=parseInt(c.input.getAttribute("maxlength"),10);if(Number.isFinite(t)&&t>0)return t}return 3e3}function V(){if(!c.input||!c.inputCounter)return;let e=(c.input.value||"").length,t=S||3e3;c.inputCounter.textContent=e+"/"+t,c.inputCounter.classList.toggle("humata-input-counter-over",e>t)}function Qe(e){let t=e.target.closest(".humata-regenerate-button");if(t){let s=t.closest(".humata-message");if(!s||E||p)return;let a=s.previousElementSibling;for(;a&&!a.classList.contains("humata-message-user");)a=a.previousElementSibling;if(!a)return;let i=a.querySelector(".humata-message-content");if(!i)return;let u=q(i);if(!u)return;let m=Le(a);be(a),ee(),de(u,m);return}let n=e.target.closest(".humata-copy-button");if(n){let s=n.closest(".humata-message");if(!s)return;let a=s.querySelector(".humata-message-content");if(!a)return;let i=ut(a);if(!i||!i.text&&!i.html)return;mt(i).then(function(){dt(n)}).catch(function(){ht(n)});return}let r=e.target.closest(".humata-edit-button");if(r){let s=r.closest(".humata-message");if(!s||E)return;et(s);return}if(e.target.closest(".humata-edit-cancel")){Y();return}e.target.closest(".humata-edit-save")&&Te()}function re(e){if(c.input){if(c.input.disabled=!e,c.sendButton)if(!e)c.sendButton.disabled=!0;else{let t=c.input.value||"";c.sendButton.disabled=!t.trim()||t.length>S}V()}}function et(e){var a,i,u,m;if(!e||!e.classList.contains("humata-message-user"))return;let t=e.querySelector(".humata-message-content");if(!t||p&&p.messageEl===e)return;Y();let n=q(t);if(!n)return;p={messageEl:e,contentEl:t,originalText:n},e.classList.add("humata-message-editing"),t.classList.add("humata-message-content-editing"),t.textContent="";let r=document.createElement("textarea");r.className="humata-edit-textarea",r.value=n,r.rows=1,r.maxLength=S;let o=document.createElement("div");o.className="humata-edit-actions";let l=document.createElement("button");l.type="button",l.className="humata-edit-cancel",l.innerHTML=yt(),l.setAttribute("title",((a=h.i18n)==null?void 0:a.cancel)||"Cancel"),l.setAttribute("aria-label",((i=h.i18n)==null?void 0:i.cancel)||"Cancel");let s=document.createElement("button");s.type="button",s.className="humata-edit-save",s.innerHTML=Re(),s.setAttribute("title",((u=h.i18n)==null?void 0:u.save)||"Save"),s.setAttribute("aria-label",((m=h.i18n)==null?void 0:m.save)||"Save"),o.appendChild(l),o.appendChild(s),t.appendChild(r),t.appendChild(o),re(!1),r.addEventListener("input",function(){Ee(r)}),r.addEventListener("keydown",function(d){if(d.key==="Escape"){d.preventDefault(),Y();return}d.key==="Enter"&&(d.ctrlKey||d.metaKey)&&(d.preventDefault(),Te())}),requestAnimationFrame(function(){Ee(r),r.focus(),r.setSelectionRange(r.value.length,r.value.length)})}function Ee(e){if(!e)return;e.style.height="auto";let n=(parseInt(getComputedStyle(e).lineHeight)||24)*8,r=Math.min(e.scrollHeight,n);e.style.height=r+"px",V()}function Y(){p&&(Se(p.messageEl,p.originalText),p=null,re(!0),c.input&&c.input.focus())}function Te(){var o;if(!p||E)return;let e=p.contentEl.querySelector(".humata-edit-textarea");if(!e){Y();return}let t=e.value,n=t.trim();if(!n){e.focus();return}if(t.length>S){let l=((o=h.i18n)==null?void 0:o.errorPromptTooLong)||"Message is too long. Maximum is "+S+" characters.";x(l,"bot",!0),e.focus();return}let r=Le(p.messageEl);Se(p.messageEl,n),be(p.messageEl),p=null,re(!0),ee(),de(n,r)}function Se(e,t){if(!e)return;let n=e.querySelector(".humata-message-content");n&&(e.classList.remove("humata-message-editing"),n.classList.remove("humata-message-content-editing"),n.innerHTML="",n.textContent=t,N(n),se(n))}function be(e){if(!c.messages||!e)return;ue();let t=e.nextSibling;for(;t;){let n=t.nextSibling;t.nodeType===1&&t.remove(),t=n}}function Le(e){if(!c.messages)return[];let t=[],n=c.messages.querySelectorAll(".humata-message:not(#humata-welcome-message):not(.humata-message-loading)");for(let r=0;r<n.length;r++){let o=n[r];if(o===e)break;let l=o.classList.contains("humata-message-user");if(o.classList.contains("humata-message-error"))continue;let a=o.querySelector(".humata-message-content");if(!a)continue;let i=q(a);i&&t.push({type:l?"user":"bot",content:i})}return t}function F(){if(!c.scrollToggle)return;let e,t,n;_&&c.messages?(e=c.messages.scrollHeight,t=c.messages.clientHeight,n=c.messages.scrollTop):(e=document.documentElement.scrollHeight,t=window.innerHeight,n=window.scrollY||document.documentElement.scrollTop);let r=e-t;if(r<=50){c.scrollToggle.style.display="none";return}c.scrollToggle.style.display="";let o=e-(n+t),l=r*.3,s=o<=l;c.scrollToggle.classList.toggle("humata-scroll-toggle-top",s);let a=c.scrollToggle.getAttribute("data-label-top")||"Scroll to top",i=c.scrollToggle.getAttribute("data-label-bottom")||"Scroll to bottom",u=s?a:i;c.scrollToggle.setAttribute("title",u),c.scrollToggle.setAttribute("aria-label",u)}function tt(){if(!c.scrollToggle)return;let e=c.scrollToggle.classList.contains("humata-scroll-toggle-top");if(_&&c.messages){let t=e?0:c.messages.scrollHeight;c.messages.scrollTo({top:t,behavior:"smooth"})}else{let t=e?0:document.documentElement.scrollHeight;window.scrollTo({top:t,behavior:"smooth"})}}function ke(){let e=c.input;e.style.height="auto";let n=(parseInt(getComputedStyle(e).lineHeight)||24)*5,r=Math.min(e.scrollHeight,n);e.style.height=r+"px";let o=e.value.length>S;V(),c.sendButton&&(c.sendButton.disabled=!e.value.trim()||o)}function nt(e){e.key==="Enter"&&!e.shiftKey&&(e.preventDefault(),Ce())}function Ce(){var r;let e=c.input.value,t=e.trim();if(!t||E)return;if(e.length>S){let o=((r=h.i18n)==null?void 0:r.errorPromptTooLong)||"Message is too long. Maximum is "+S+" characters.";x(o,"bot",!0),c.input&&c.input.focus();return}let n=rt();le=t,x(t,"user"),c.input.value="",c.input.style.height="auto",c.sendButton&&(c.sendButton.disabled=!0),V(),de(t,n)}function rt(){if(!c.messages)return[];let e=[];return c.messages.querySelectorAll(".humata-message:not(#humata-welcome-message):not(.humata-message-loading)").forEach(function(n){let r=n.classList.contains("humata-message-user");if(n.classList.contains("humata-message-error"))return;let l=n.querySelector(".humata-message-content");if(!l)return;let s=q(l);s&&e.push({type:r?"user":"bot",content:s})}),e}function x(e,t,n=!1){c.welcomeMessage&&(c.welcomeMessage.style.display="none");let r=document.createElement("div");r.className="humata-message humata-message-"+t,n&&r.classList.add("humata-message-error");let o=document.createElement("div");o.className="humata-message-avatar",W(o,t);let l=document.createElement("div");return l.className="humata-message-content",t==="bot"&&!n?l.innerHTML=ot(e):l.textContent=e,N(l),t==="bot"&&Ne(l),t==="user"&&!n&&se(l),r.appendChild(o),r.appendChild(l),c.messages.appendChild(r),t==="bot"&&!n&&De(),me(),ee(),r}function ot(e){if(!e)return"";let t=P(String(e).replace(/\r\n?/g,`
`)),n=[];t=t.replace(/```([a-zA-Z0-9_-]*)\n?([\s\S]*?)```/g,function(o,l,s){let a="%%HUMATA_CODEBLOCK_"+n.length+"%%",i=at(l||"plaintext");return n.push('<pre><code class="language-'+i+'">'+s.trim()+"</code></pre>"),`
`+a+`
`});let r=Ie(t);return r=r.replace(/%%HUMATA_CODEBLOCK_(\d+)%%/g,function(o,l){let s=parseInt(l,10);return Number.isFinite(s)&&n[s]?n[s]:""}),r}let $=null;function xe(e){return e==null?"":($||($=document.createElement("textarea")),$.innerHTML=String(e),$.value)}function at(e){return String(e||"").toLowerCase().replace(/[^\w-]+/g,"")||"plaintext"}function Ae(e){if(!e)return"";let t=xe(String(e)).trim();if(!t)return"";let n=t.replace(/[\u0000-\u001F\u007F\s]+/g,"");if(!n)return"";if(n.startsWith("#")||n.startsWith("/")||n.startsWith("./")||n.startsWith("../")||n.startsWith("?")||n.startsWith("//"))return P(t);let r=n.match(/^([a-zA-Z][a-zA-Z0-9+.-]*):/);if(r){let o=(r[1]||"").toLowerCase();if(!(o==="http"||o==="https"||o==="mailto"||o==="tel"))return""}return P(t)}let G=null;function J(e){return!!e&&/[A-Za-z0-9]/.test(e)}function st(){if(G!==null)return G;let e=Array.isArray(h.autoLinks)?h.autoLinks:[],t=[];for(let n=0;n<e.length;n++){let r=e[n];if(!r||typeof r!="object")continue;let o=String(r.phrase||"").trim(),l=String(r.url||"").trim();if(!o||!l)continue;let s=Ae(l);if(s&&(t.push({phrase:o,phraseLower:o.toLowerCase(),href:xe(s),len:o.length,startsWord:J(o.charAt(0)),endsWord:J(o.charAt(o.length-1))}),t.length>=200))break}return t.sort(function(n,r){return r.len-n.len}),G=t,G}function it(e,t){if(!e)return[];let n=String(e),r=n.toLowerCase(),o=[];function l(s,a){for(let i=0;i<o.length;i++){let u=o[i];if(s<u.end&&u.start<a)return!0}return!1}for(let s=0;s<t.length;s++){let a=t[s];if(!a||!a.phraseLower)continue;let i=0;for(;i=r.indexOf(a.phraseLower,i),i!==-1;){let u=i,m=i+a.phraseLower.length;if(a.startsWord){let d=u>0?n.charAt(u-1):"";if(d&&J(d)){i=i+1;continue}}if(a.endsWord){let d=m<n.length?n.charAt(m):"";if(d&&J(d)){i=i+1;continue}}l(u,m)||o.push({start:u,end:m,href:a.href}),i=m}}return o}function ct(e){if(!e)return e;let t=st();if(!t||!t.length||typeof document=="undefined"||!document.createElement||!document.createTreeWalker||typeof NodeFilter=="undefined")return e;let n=document.createElement("div");try{n.innerHTML=String(e)}catch(s){return e}let r;try{r=document.createTreeWalker(n,NodeFilter.SHOW_TEXT,{acceptNode:function(s){let a=s&&s.nodeValue?String(s.nodeValue):"";if(!a||!a.trim())return NodeFilter.FILTER_REJECT;let i=s.parentNode;for(;i&&i!==n;){let u=i.nodeName;if(u==="A"||u==="CODE"||u==="PRE")return NodeFilter.FILTER_REJECT;i=i.parentNode}return NodeFilter.FILTER_ACCEPT}})}catch(s){return e}let o=[],l;for(;l=r.nextNode();)o.push(l);for(let s=0;s<o.length;s++){let a=o[s],i=a&&a.nodeValue?String(a.nodeValue):"";if(!i)continue;let u=it(i,t);if(!u.length)continue;u.sort(function(b,g){return b.start-g.start});let m=document.createDocumentFragment(),d=0;for(let b=0;b<u.length;b++){let g=u[b];if(!g||g.start<d)continue;g.start>d&&m.appendChild(document.createTextNode(i.slice(d,g.start)));let v=document.createElement("a");v.setAttribute("href",g.href),v.setAttribute("target","_blank"),v.setAttribute("rel","noopener noreferrer"),v.textContent=i.slice(g.start,g.end),m.appendChild(v),d=g.end}d<i.length&&m.appendChild(document.createTextNode(i.slice(d))),a.parentNode&&a.parentNode.replaceChild(m,a)}return n.innerHTML}function I(e){return!e||/^\s*$/.test(e)}function Me(e){return/^%%HUMATA_CODEBLOCK_\d+%%$/.test(String(e||"").trim())}function He(e){return/^\s{0,3}(-{3,}|\*{3,})\s*$/.test(String(e||""))}function Be(e){let t=String(e||"").match(/^\s{0,3}(#{1,6})\s+(.+?)\s*$/);return t?{level:t[1].length,text:t[2]}:null}function oe(e){return/^\s{0,3}>\s?/.test(String(e||""))}function lt(e){return String(e||"").replace(/^\s{0,3}>\s?/,"")}function X(e){return/^\s{0,3}[-+*]\s+/.test(String(e||""))}function Z(e){return/^\s{0,3}\d+\.\s+/.test(String(e||""))}function Q(e){if(!e)return"";let t=String(e),n=[];return t=t.replace(/`([^`]+)`/g,function(r,o){let l="%%HUMATA_CODESPAN_"+n.length+"%%";return n.push("<code>"+o+"</code>"),l}),t=t.replace(/\[([^\]]+)\]\(([^)]+)\)/g,function(r,o,l){let s=Ae(l);return s?'<a href="'+s+'" target="_blank" rel="noopener noreferrer">'+o+"</a>":o+" ("+l+")"}),t=t.replace(/\*\*([^*]+)\*\*/g,"<strong>$1</strong>"),t=t.replace(/(^|[^*])\*([^*\n]+)\*(?!\*)/g,"$1<em>$2</em>"),t=ct(t),t=t.replace(/%%HUMATA_CODESPAN_(\d+)%%/g,function(r,o){let l=parseInt(o,10);return Number.isFinite(l)&&n[l]?n[l]:r}),t}function Ie(e){if(!e)return"";let t=String(e).split(`
`),n=[],r=0;for(;r<t.length;){let o=t[r];if(I(o)){r++;continue}if(Me(o)){n.push(String(o).trim()),r++;continue}if(He(o)){n.push("<hr>"),r++;continue}let l=Be(o);if(l){n.push("<h"+l.level+">"+Q(l.text)+"</h"+l.level+">"),r++;continue}if(oe(o)){let i=[];for(;r<t.length&&oe(t[r]);)i.push(lt(t[r])),r++;n.push("<blockquote>"+Ie(i.join(`
`))+"</blockquote>");continue}if(X(o)){let i=[];for(;r<t.length;){let u=t[r];if(I(u)){let d=r+1;for(;d<t.length&&I(t[d]);)d++;if(d<t.length&&X(t[d])){r=d;continue}break}if(!X(u))break;let m=String(u).replace(/^\s{0,3}[-+*]\s+/,"");i.push("<li>"+Q(m)+"</li>"),r++}n.push("<ul>"+i.join("")+"</ul>");continue}if(Z(o)){let i=[];for(;r<t.length;){let u=t[r];if(I(u)){let d=r+1;for(;d<t.length&&I(t[d]);)d++;if(d<t.length&&Z(t[d])){r=d;continue}break}if(!Z(u))break;let m=String(u).replace(/^\s{0,3}\d+\.\s+/,"");i.push("<li>"+Q(m)+"</li>"),r++}n.push("<ol>"+i.join("")+"</ol>");continue}let s=[];for(;r<t.length;){let i=t[r];if(I(i)||Me(i)||He(i)||Be(i)||oe(i)||X(i)||Z(i))break;s.push(String(i).trim()),r++}let a=s.join(" ").trim();a&&n.push("<p>"+Q(a)+"</p>")}return n.join("")}function P(e){let t=document.createElement("div");return t.textContent=e,t.innerHTML}function ae(e){if(!e)return null;let t=e.querySelector(".humata-message-actions");return t||(t=document.createElement("div"),t.className="humata-message-actions",e.appendChild(t),t)}function N(e){if(!e||e.querySelector(".humata-copy-button"))return;e.classList.add("humata-message-content-has-copy");let t=document.createElement("button");t.type="button",t.className="humata-copy-button",t.innerHTML=gt(),t.setAttribute("title","Copy"),t.setAttribute("aria-label","Copy message");let n=ae(e);n&&n.appendChild(t)}function Ne(e){var r,o;if(!e||e.querySelector(".humata-regenerate-button"))return;e.classList.add("humata-message-content-has-regenerate");let t=document.createElement("button");t.type="button",t.className="humata-regenerate-button",t.innerHTML=pt(),t.setAttribute("title",((r=h.i18n)==null?void 0:r.regenerate)||"Regenerate"),t.setAttribute("aria-label",((o=h.i18n)==null?void 0:o.regenerate)||"Regenerate");let n=ae(e);n&&n.appendChild(t)}function se(e){var r,o;if(!e||e.querySelector(".humata-edit-button"))return;e.classList.add("humata-message-content-has-edit");let t=document.createElement("button");t.type="button",t.className="humata-edit-button",t.innerHTML=ft(),t.setAttribute("title",((r=h.i18n)==null?void 0:r.editMessage)||"Edit message"),t.setAttribute("aria-label",((o=h.i18n)==null?void 0:o.editMessage)||"Edit message");let n=ae(e);n&&n.appendChild(t)}function q(e){let t=e?e.querySelector(".humata-edit-textarea"):null;if(t)return(t.value||"").trim();let n=e.cloneNode(!0);return n.querySelectorAll(".humata-copy-button").forEach(function(r){r.remove()}),n.querySelectorAll(".humata-regenerate-button").forEach(function(r){r.remove()}),n.querySelectorAll(".humata-edit-button").forEach(function(r){r.remove()}),n.querySelectorAll(".humata-edit-actions").forEach(function(r){r.remove()}),n.querySelectorAll(".humata-message-actions").forEach(function(r){r.remove()}),n.querySelectorAll(".humata-bot-response-disclaimer").forEach(function(r){r.remove()}),n.querySelectorAll(".humata-intent-links").forEach(function(r){r.remove()}),n.querySelectorAll(".humata-accordions").forEach(function(r){r.remove()}),((n.innerText||n.textContent||"")+"").trim()}function ie(e){let t=e.cloneNode(!0);return t.querySelectorAll(".humata-copy-button").forEach(function(n){n.remove()}),t.querySelectorAll(".humata-regenerate-button").forEach(function(n){n.remove()}),t.querySelectorAll(".humata-edit-button").forEach(function(n){n.remove()}),t.querySelectorAll(".humata-edit-actions").forEach(function(n){n.remove()}),t.querySelectorAll(".humata-message-actions").forEach(function(n){n.remove()}),t.querySelectorAll(".humata-bot-response-disclaimer").forEach(function(n){n.remove()}),t.querySelectorAll(".humata-intent-links").forEach(function(n){n.remove()}),t.querySelectorAll(".humata-accordions").forEach(function(n){n.remove()}),t.innerHTML}function ut(e){let t=e?e.querySelector(".humata-edit-textarea"):null;if(t){let r=(t.value||"").trim();return{text:r,html:r?"<div>"+P(r).replace(/\n/g,"<br>")+"</div>":""}}let n=e?ie(e):"";return n?{text:qe(n),html:"<div>"+n+"</div>"}:{text:"",html:""}}function qe(e){if(!e)return"";let t=document.createElement("div");t.innerHTML=e;let n=ce(t,{listStack:[]});return String(n||"").replace(/\r\n?/g,`
`).replace(/[ \t]+\n/g,`
`).replace(/\n{3,}/g,`

`).trim()}function ce(e,t){if(!e)return"";let n=e.nodeType;if(n===3)return e.nodeValue||"";if(n!==1)return"";let r=(e.tagName||"").toLowerCase();function o(){let a="",i=e.childNodes||[];for(let u=0;u<i.length;u++)a+=ce(i[u],t);return a}function l(a){return a?a.endsWith(`
`)?a:a+`
`:`
`}function s(a){let i=l(a);return i.endsWith(`

`)||(i+=`
`),i}if(r==="br")return`
`;if(r==="hr")return`

`;if(r==="pre"){let a=e.textContent||"";return s(a.replace(/\n$/,""))}if(r==="p"||r==="div"||r==="section"){let a=o().trim();return a?s(a):""}if(r==="blockquote"){let a=o().trim();return a?s(a):""}if(/^h[1-6]$/.test(r)){let a=o().trim();return a?s(a):""}if(r==="ul"||r==="ol"){t.listStack.push({type:r,index:0});let a="",i=e.childNodes||[];for(let u=0;u<i.length;u++)a+=ce(i[u],t);return t.listStack.pop(),s(a.trim())}if(r==="li"){let a=t.listStack||[],i=a.length?a[a.length-1]:null,u="- ";i&&i.type==="ol"?(i.index+=1,u=String(i.index)+". "):i&&i.type==="ul"&&(u="\u2022 ");let m=a.length>1?"  ".repeat(a.length-1):"",d=o().trim();return d?m+u+d+`
`:""}return o()}function mt(e){if(e==null)return Promise.reject(new Error("Nothing to copy"));if(typeof e=="string")return Fe(e);let t=String(e.text||""),n=String(e.html||"");if(n&&navigator.clipboard&&navigator.clipboard.write&&typeof ClipboardItem!="undefined")try{let r=new ClipboardItem({"text/plain":new Blob([t],{type:"text/plain"}),"text/html":new Blob([n],{type:"text/html"})});return navigator.clipboard.write([r]).catch(function(){return _e(n)})}catch(r){}return n?_e(n):Fe(t)}function _e(e){return new Promise(function(t,n){try{let r=document.createElement("div");r.setAttribute("aria-hidden","true"),r.style.position="fixed",r.style.left="-9999px",r.style.top="0",r.style.width="1px",r.style.height="1px",r.style.overflow="hidden",r.innerHTML=e,document.body.appendChild(r);let o=window.getSelection?window.getSelection():null,l=[];if(o&&o.rangeCount)for(let a=0;a<o.rangeCount;a++)l.push(o.getRangeAt(a).cloneRange());if(o){let a=document.createRange();a.selectNodeContents(r),o.removeAllRanges(),o.addRange(a)}let s=document.execCommand("copy");if(o){o.removeAllRanges();for(let a=0;a<l.length;a++)o.addRange(l[a])}r.remove(),s?t():n(new Error("Copy failed"))}catch(r){n(r)}})}function Fe(e){return navigator.clipboard&&navigator.clipboard.writeText?navigator.clipboard.writeText(e).catch(function(){return Pe(e)}):Pe(e)}function Pe(e){return new Promise(function(t,n){try{let r=document.createElement("textarea");r.value=String(e||""),r.setAttribute("readonly",""),r.style.position="fixed",r.style.top="-9999px",r.style.left="-9999px",document.body.appendChild(r),r.select(),r.setSelectionRange(0,r.value.length);let o=document.execCommand("copy");r.remove(),o?t():n(new Error("Copy failed"))}catch(r){n(r)}})}function dt(e){e&&(e.dataset.humataCopyDefault||(e.dataset.humataCopyDefault=e.innerHTML),e._humataCopyResetTimer&&clearTimeout(e._humataCopyResetTimer),e.innerHTML=Re(),e.classList.add("humata-copy-button-success"),e.setAttribute("title","Copied"),e.setAttribute("aria-label","Copied"),e._humataCopyResetTimer=setTimeout(function(){e.innerHTML=e.dataset.humataCopyDefault,e.classList.remove("humata-copy-button-success"),e.setAttribute("title","Copy"),e.setAttribute("aria-label","Copy message")},1500))}function ht(e){e&&(e.setAttribute("title","Copy failed"),e.setAttribute("aria-label","Copy failed"),e._humataCopyResetTimer&&clearTimeout(e._humataCopyResetTimer),e._humataCopyResetTimer=setTimeout(function(){e.setAttribute("title","Copy"),e.setAttribute("aria-label","Copy message")},1500))}function gt(){return'<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"><rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect><path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path></svg>'}function ft(){return'<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"><path d="M12 20h9"></path><path d="M16.5 3.5a2.121 2.121 0 0 1 3 3L7 19l-4 1 1-4Z"></path></svg>'}function pt(){return'<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"><polyline points="23 4 23 10 17 10"></polyline><polyline points="1 20 1 14 7 14"></polyline><path d="M3.51 9a9 9 0 0 1 14.13-3.36L23 10"></path><path d="M1 14l5.36 5.36A9 9 0 0 0 20.49 15"></path></svg>'}function Re(){return'<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"><path d="M20 6 9 17l-5-5"></path></svg>'}function yt(){return'<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"><path d="M18 6 6 18"></path><path d="m6 6 12 12"></path></svg>'}function vt(){let e=h.botResponseDisclaimer;if(!e||typeof e!="string"||!e.trim())return null;let t=document.getElementById("humata-bot-response-disclaimer");return t||(t=document.createElement("div"),t.id="humata-bot-response-disclaimer",t.className="humata-bot-response-disclaimer",t.innerHTML="<p>"+e+"</p>"),t}function De(){let e=vt();if(!e)return;if(!c.messages){e.remove();return}let t=c.messages.querySelectorAll(".humata-message-bot:not(.humata-message-error):not(.humata-message-loading):not(#humata-welcome-message)");if(!t.length){e.remove();return}let r=t[t.length-1].querySelector(".humata-message-content");if(!r){e.remove();return}r.appendChild(e)}function wt(){let e=document.getElementById("humata-bot-response-disclaimer");e&&e.remove()}function ze(e){return String(e||"").replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}function Et(e){let t=h.intentLinks;if(!t||!Array.isArray(t)||!t.length)return[];if(!e||typeof e!="string")return[];let n=[],r=new Set;for(let o=0;o<t.length;o++){let l=t[o],s=l.keywords,a=l.links;if(!s||!Array.isArray(s)||!s.length||!a||!Array.isArray(a)||!a.length)continue;let i=!1;for(let u=0;u<s.length;u++){let m=s[u];if(!m)continue;if(new RegExp("\\b"+ze(m)+"\\b","i").test(e)){i=!0;break}}if(i)for(let u=0;u<a.length;u++){let m=a[u];!m||!m.title||!m.url||r.has(m.url)||(r.add(m.url),n.push({title:m.title,url:m.url}))}}return n}function Tt(e){var o;if(!e||!e.length)return null;let t=document.createElement("div");t.className="humata-intent-links";let n=document.createElement("span");n.className="humata-intent-links-label",n.textContent=((o=h.i18n)==null?void 0:o.relatedResources)||"Related resources:",t.appendChild(n);let r=document.createElement("div");r.className="humata-intent-links-pills";for(let l=0;l<e.length;l++){let s=e[l],a=document.createElement("a");a.href=s.url,a.target="_blank",a.rel="noopener noreferrer",a.className="humata-intent-link",a.textContent=s.title,r.appendChild(a)}return t.appendChild(r),t}function St(e){let t=h.intentLinks;if(!t||!Array.isArray(t)||!t.length)return[];if(!e||typeof e!="string")return[];let n=[],r=new Set;for(let o=0;o<t.length;o++){let l=t[o],s=l.keywords,a=l.accordions;if(!s||!Array.isArray(s)||!s.length||!a||!Array.isArray(a)||!a.length)continue;let i=!1;for(let u=0;u<s.length;u++){let m=s[u];if(!m)continue;if(new RegExp("\\b"+ze(m)+"\\b","i").test(e)){i=!0;break}}if(i)for(let u=0;u<a.length;u++){let m=a[u];!m||!m.title||!m.content||r.has(m.title)||(r.add(m.title),n.push({title:m.title,content:m.content}))}}return n}function bt(e){if(!e||!e.length)return null;let t=document.createElement("div");t.className="humata-accordions";for(let n=0;n<e.length;n++){let r=e[n],o=document.createElement("div");o.className="humata-accordion-item";let l=document.createElement("button");l.type="button",l.className="humata-accordion-toggle",l.innerHTML="<span>"+P(r.title)+'</span><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="6 9 12 15 18 9"></polyline></svg>',l.addEventListener("click",function(){o.classList.toggle("open")});let s=document.createElement("div");s.className="humata-accordion-content",s.innerHTML=r.content,o.appendChild(l),o.appendChild(s),t.appendChild(o)}return t}function Ue(e,t){if(!e||!t)return;let n=e.querySelector(".humata-message-content");if(!n)return;let r=St(t),o=Et(t),l=bt(r);if(l){e._humataIntentAccordions=r;let i=n.querySelector(".humata-message-actions");i?n.insertBefore(l,i):n.appendChild(l)}if(!o.length)return;let s=Tt(o);if(!s)return;e._humataIntentLinks=o;let a=n.querySelector(".humata-bot-response-disclaimer");a?n.insertBefore(s,a):n.appendChild(s)}let le="";function Lt(){var l;wt();let e=document.createElement("div");e.className="humata-message humata-message-bot humata-message-loading",e.id="humata-loading-indicator";let t=document.createElement("div");t.className="humata-message-avatar",W(t,"bot");let n=document.createElement("div");n.className="humata-message-content";let r=String(h.secondLlmProvider||"").toLowerCase(),o=r!==""&&r!=="none";if(o?n.innerHTML='<div class="humata-typing-indicator"><span></span><span></span><span></span></div><div class="humata-loading-status" aria-live="polite" aria-atomic="true"><span class="humata-loading-status-text"></span></div>':n.innerHTML='<div class="humata-typing-indicator"><span></span><span></span><span></span></div>',e.appendChild(t),e.appendChild(n),c.messages.appendChild(e),o){let s=n.querySelector(".humata-loading-status-text");if(s){let a=["Processing your question\u2026",((l=h.i18n)==null?void 0:l.thinking)||"Thinking\u2026","Reviewing for accuracy\u2026","Just a few moments more\u2026","Almost ready\u2026","Finalizing answer\u2026"],i=0;s.textContent=a[i],s.style.opacity="1",e._humataStatusTimer=setInterval(function(){i=(i+1)%a.length,s.style.opacity="0",e._humataStatusFadeTimer=setTimeout(function(){s.textContent=a[i],s.style.opacity="1"},180)},2e3)}}return me(),e}function ue(){let e=document.getElementById("humata-loading-indicator");e&&(e._humataStatusTimer&&clearInterval(e._humataStatusTimer),e._humataStatusFadeTimer&&clearTimeout(e._humataStatusFadeTimer),e.remove())}function me(){_&&c.messages?c.messages.scrollTop=c.messages.scrollHeight:window.scrollTo({top:document.documentElement.scrollHeight,behavior:"smooth"}),F()}async function de(e,t=[]){var n,r,o,l,s,a,i,u;if(!E){E=!0;try{let m=null;if(K()&&!ye())try{m=await Ye()}catch(v){console.error("Turnstile error:",v),E=!1,x(((n=h.i18n)==null?void 0:n.errorTurnstile)||"Human verification failed. Please try again.","bot",!0);return}Lt();let d={"Content-Type":"application/json","X-WP-Nonce":h.wpNonce,"X-Humata-Nonce":h.nonce};m&&(d["X-Turnstile-Token"]=m);let b=await fetch(h.apiUrl,{method:"POST",credentials:"same-origin",headers:d,body:JSON.stringify({message:e,history:t})});ue();let g=await b.json();if(!b.ok){let v=((r=h.i18n)==null?void 0:r.errorRequestFailed)||"Your message request failed. Try again. If problem persists, please contact us.",A=((o=h.i18n)==null?void 0:o.errorGeneric)||"An error occurred. Please try again.";b.status===429?A=((l=h.i18n)==null?void 0:l.errorRateLimit)||"Too many requests. Please wait a moment.":g&&g.code==="turnstile_required"?(sessionStorage.removeItem(U),j=null,A=((s=h.i18n)==null?void 0:s.errorTurnstileRequired)||"Please complete the human verification to continue."):g&&g.code==="turnstile_failed"?(sessionStorage.removeItem(U),j=null,A=((a=h.i18n)==null?void 0:a.errorTurnstileFailed)||"Human verification failed. Please try again."):g&&typeof g.message=="string"&&g.message.trim()!==""?A=/\b(straico|humata|anthropic|claude)\b/i.test(g.message)?v:g.message:A=v,x(A,"bot",!0);return}if(K()&&m&&Ve(),g.success&&g.answer){let v=x(g.answer,"bot");v&&le&&(Ue(v,le),ee())}else x(((i=h.i18n)==null?void 0:i.errorGeneric)||"An error occurred. Please try again.","bot",!0)}catch(m){ue(),x(((u=h.i18n)==null?void 0:u.errorNetwork)||"Network error. Please check your connection.","bot",!0)}finally{E=!1,c.input.focus()}}}function kt(){let e=c.exportPdfButton;e&&(e.disabled=!0);try{let d=function(){let f=String(m.getFullYear()),L=String(m.getMonth()+1).padStart(2,"0"),T=String(m.getDate()).padStart(2,"0"),k="chat-export-"+f+"-"+L+"-"+T;if(C){let y=String(C).replace(/[^\w-]+/g,"").slice(0,40);y&&(k+="-"+y)}return k+".pdf"},b=function(f){return String(f||"").replace(/\u00A0/g," ").replace(/[\u200B\u200C\u200D\uFEFF]/g,"").replace(/\u2022/g,"-").replace(/[\u2018\u2019]/g,"'").replace(/[\u201C\u201D]/g,'"').replace(/[\u2013\u2014]/g,"-").replace(/\u2026/g,"...").replace(/\r\n?/g,`
`).trim()},g=function(f,L,T){try{n.text(f,L,T)}catch(k){n.text(String(f||"").replace(/[^\x09\x0A\x0D\x20-\x7E]/g,"?"),L,T)}},t=window.jspdf&&window.jspdf.jsPDF?window.jspdf.jsPDF:window.jsPDF||null;if(!t)return;let n=new t({unit:"pt",format:"a4"}),r=n.internal.pageSize.getWidth?n.internal.pageSize.getWidth():n.internal.pageSize.width,o=n.internal.pageSize.getHeight?n.internal.pageSize.getHeight():n.internal.pageSize.height,l=40,s=40,a=r-l*2,i=14,u=s,m=new Date,v=document.querySelector(".humata-chat-title"),A=((v?v.textContent:"")||"Chat Export").trim();n.setFont("helvetica","bold"),n.setFontSize(16),g(A||"Chat Export",l,u),u+=22,n.setFont("helvetica","normal"),n.setFontSize(10),g(m.toLocaleString(),l,u),u+=24;let We=c.messages?c.messages.querySelectorAll(".humata-message:not(#humata-welcome-message):not(.humata-message-loading)"):[],he=[];We.forEach(function(f){let L=f.querySelector(".humata-message-content");if(!L)return;let T=f.classList.contains("humata-message-user"),k=f.classList.contains("humata-message-error"),y="";if(T)y=q(L);else{let R=ie(L);y=qe(R)}if(y=b(y),!y)return;let w=null;!T&&!k&&f._humataIntentLinks&&f._humataIntentLinks.length&&(w=f._humataIntentLinks);let M=null;!T&&!k&&f._humataIntentAccordions&&f._humataIntentAccordions.length&&(M=f._humataIntentAccordions),he.push({role:T?"You":"Assistant",text:y,isError:k,intentLinks:w,intentAccordions:M})});let je=new Set;if(!he.length){n.setFont("helvetica","normal"),n.setFontSize(12),g("No messages.",l,u),n.save(d());return}he.forEach(function(f){var k;n.setFont("helvetica","bold"),n.setFontSize(13);let L=f.role+(f.isError?" (error)":"")+":";u+i>o-s&&(n.addPage(),u=s),g(L,l,u),u+=i,n.setFont("helvetica","normal"),n.setFontSize(12);let T=n.splitTextToSize(f.text,a);for(let y=0;y<T.length;y++)u+i>o-s&&(n.addPage(),u=s),g(T[y],l,u),u+=i;if(f.intentAccordions&&f.intentAccordions.length){let y=f.intentAccordions.filter(function(w){return je.has(w.title)?!1:(je.add(w.title),!0)});if(y.length){u+=4;for(let w=0;w<y.length;w++){let M=y[w];n.setFont("helvetica","bold"),n.setFontSize(11),u+i>o-s&&(n.addPage(),u=s),g("\u25B8 "+M.title,l,u),u+=i,n.setFont("helvetica","normal"),n.setFontSize(11);let R=M.content.replace(/<br\s*\/?>/gi,`
`).replace(/<\/p>/gi,`
`).replace(/<[^>]+>/g,"").replace(/&nbsp;/g," ").replace(/&amp;/g,"&").replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&quot;/g,'"').trim(),D=n.splitTextToSize(R,a-10);for(let H=0;H<D.length;H++)u+i>o-s&&(n.addPage(),u=s),g("  "+D[H],l,u),u+=i;u+=2}}}if(f.intentLinks&&f.intentLinks.length){u+=4,n.setFont("helvetica","italic"),n.setFontSize(11);let y=((k=h.i18n)==null?void 0:k.relatedResources)||"Related resources:";u+i>o-s&&(n.addPage(),u=s),g(y,l,u),u+=i,n.setFont("helvetica","normal");for(let w=0;w<f.intentLinks.length;w++){let M=f.intentLinks[w],R="\u2022 "+M.title+" - "+M.url,D=n.splitTextToSize(R,a);for(let H=0;H<D.length;H++)u+i>o-s&&(n.addPage(),u=s),g(D[H],l,u),u+=i}}u+=i}),n.save(d())}catch(t){console.error(t)}finally{e&&(e.disabled=!1)}}function Ct(){var e;if(c.messages&&(c.messages.innerHTML=""),c.welcomeMessage)c.welcomeMessage.style.display="",c.messages.appendChild(c.welcomeMessage),N(c.welcomeMessage.querySelector(".humata-message-content"));else{let t=document.createElement("div");t.id="humata-welcome-message",t.className="humata-message humata-message-bot";let n=document.createElement("div");n.className="humata-message-avatar",W(n,"bot");let r=document.createElement("div");r.className="humata-message-content",r.innerHTML="<p>"+(((e=h.i18n)==null?void 0:e.welcome)||"Hello! I'm here to help answer your questions. What would you like to know?")+"</p>",t.appendChild(n),t.appendChild(r),c.messages.appendChild(t),c.welcomeMessage=t,N(r)}localStorage.removeItem(z),localStorage.removeItem(ge),C=null,c.input&&c.input.focus()}function ee(){if(!c.messages)return;let e=[],t=c.messages.querySelectorAll(".humata-message:not(#humata-welcome-message):not(.humata-message-loading)"),n="";t.forEach(function(r){let o=r.classList.contains("humata-message-user"),l=r.classList.contains("humata-message-error"),s=r.querySelector(".humata-message-content");if(s){let a={type:o?"user":"bot",content:o?q(s):ie(s),isError:l};o?n=a.content:a.triggerUserMessage=n,e.push(a)}});try{localStorage.setItem(z,JSON.stringify(e))}catch(r){}}function xt(){try{let e=localStorage.getItem(z);if(!e)return;let t=JSON.parse(e);if(!Array.isArray(t)||t.length===0)return;c.welcomeMessage&&(c.welcomeMessage.style.display="none"),t.forEach(function(n){let r=document.createElement("div");r.className="humata-message humata-message-"+n.type,n.isError&&r.classList.add("humata-message-error");let o=document.createElement("div");o.className="humata-message-avatar",W(o,n.type);let l=document.createElement("div");l.className="humata-message-content",n.type==="user"?l.textContent=n.content:l.innerHTML=n.content,N(l),n.type==="bot"&&Ne(l),n.type==="user"&&!n.isError&&se(l),r.appendChild(o),r.appendChild(l),c.messages.appendChild(r),n.type==="bot"&&!n.isError&&n.triggerUserMessage&&Ue(r,n.triggerUserMessage)}),C=localStorage.getItem(ge),De(),me()}catch(e){localStorage.removeItem(z)}}document.readyState==="loading"?document.addEventListener("DOMContentLoaded",pe):pe()})();})();
//# sourceMappingURL=chat-widget.js.map
