(()=>{var an=Object.defineProperty;var ut=Object.getOwnPropertySymbols;var rn=Object.prototype.hasOwnProperty,ln=Object.prototype.propertyIsEnumerable;var dt=(s,d,f)=>d in s?an(s,d,{enumerable:!0,configurable:!0,writable:!0,value:f}):s[d]=f,Pe=(s,d)=>{for(var f in d||(d={}))rn.call(d,f)&&dt(s,f,d[f]);if(ut)for(var f of ut(d))ln.call(d,f)&&dt(s,f,d[f]);return s};var g=window.humataConfig||{},J="humata_chat_history",Ie="humata_conversation_id",fe="humata_theme_preference";var cn='<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"><path d="M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2"></path><circle cx="12" cy="7" r="4"></circle></svg>',un='<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"><path d="M12 8V4H8"></path><rect width="16" height="12" x="4" y="8" rx="2"></rect><path d="M2 14h2"></path><path d="M20 14h2"></path><path d="M15 13v2"></path><path d="M9 13v2"></path></svg>';function G(s,d){let f=d==="user"?g.userAvatarUrl:g.botAvatarUrl;if(f&&f.length>0){let p=document.createElement("img");p.src=f,p.alt=d==="user"?"User":"Bot",p.className="humata-avatar-img",s.innerHTML="",s.appendChild(p)}else s.innerHTML=d==="user"?cn:un}var I=null,Ne=null;function mt(s){if(I=document.getElementById("humata-suggested-questions"),Ne=s,!I)return;let d=g.suggestedQuestions;if(!d||!d.enabled)return;let f=dn(d);f.length!==0&&fn(f)}function dn(s){return s.mode==="fixed"?mn(s.fixedQuestions||[]):s.mode==="randomized"?hn(s.categories||[]):[]}function mn(s){return s.filter(d=>d&&d.text&&d.text.trim()!=="").slice(0,4).map(d=>d.text)}function hn(s){let d=s.filter(y=>y&&y.questions&&y.questions.length>0);if(d.length===0)return[];let f=[],p=d.length;if(p===1){let y=d[0],E=Z([...y.questions]);for(let b=0;b<4&&b<E.length;b++)f.push(E[b])}else if(p===2)for(let y=0;y<2;y++){let E=d[y],b=Z([...E.questions]);for(let C=0;C<2&&C<b.length;C++)f.push(b[C])}else if(p===3){let y=Math.floor(Math.random()*3);for(let E=0;E<3;E++){let b=d[E],C=Z([...b.questions]),T=E===y?2:1;for(let M=0;M<T&&M<C.length;M++)f.push(C[M])}}else for(let y=0;y<4&&y<d.length;y++){let E=d[y],b=Z([...E.questions]);b.length>0&&f.push(b[0])}return Z(f).slice(0,4)}function Z(s){for(let d=s.length-1;d>0;d--){let f=Math.floor(Math.random()*(d+1));[s[d],s[f]]=[s[f],s[d]]}return s}function fn(s){!I||s.length===0||(I.innerHTML="",s.forEach(d=>{let f=document.createElement("button");f.type="button",f.className="humata-suggested-question-btn",f.setAttribute("title",d);let p=document.createElement("span");p.className="humata-suggested-question-text",p.textContent=d,f.appendChild(p),f.addEventListener("click",()=>{gn(d)}),I.appendChild(f)}),I.style.display="")}function gn(s){ge(),typeof Ne=="function"&&Ne(s)}function ge(){I&&(I.style.display="none",I.innerHTML="")}var Fe=null,O=null,pe=null,ht=!1;function ft(s){Fe=s,ht="ontouchstart"in window||navigator.maxTouchPoints>0}function _e(s,d){if(ee(),!s||!d||!Array.isArray(d)||d.length===0)return;let f=document.createElement("div");f.className="humata-followup-questions",f.setAttribute("role","group"),f.setAttribute("aria-label","Follow-up questions");let p=document.createElement("span");p.className="humata-followup-questions-label",p.textContent="Follow-up questions:",f.appendChild(p);let y=document.createElement("div");y.className="humata-followup-questions-buttons",d.forEach((b,C)=>{if(!b||typeof b!="string")return;let T=document.createElement("button");T.type="button",T.className="humata-followup-question-btn",T.setAttribute("title",b),T.setAttribute("data-index",C);let M=document.createElement("span");M.className="humata-followup-question-text",M.textContent=b,T.appendChild(M);let ne=b.length>50;T.addEventListener("click",F=>{if(ht&&ne&&!T.classList.contains("humata-expanded")){F.preventDefault(),pn(),T.classList.add("humata-expanded"),pe=T;return}yn(b)}),y.appendChild(T)}),f.appendChild(y);let E=s.querySelector(".humata-message-content");E?E.appendChild(f):s.appendChild(f),O=f}function pn(){pe&&(pe.classList.remove("humata-expanded"),pe=null)}function yn(s){ee(),typeof Fe=="function"&&Fe(s)}function ee(){O&&O.parentNode&&O.parentNode.removeChild(O),O=null,document.querySelectorAll(".humata-followup-questions").forEach(d=>{d.parentNode&&d.parentNode.removeChild(d)})}var ve="humata_pow_verified",gt=0,be=!1,ye=null,we=null;function pt(){gt=g.pageLoadTime||Math.floor(Date.now()/1e3),be=sessionStorage.getItem(ve)==="true"}function te(){return g.botProtection&&g.botProtection.enabled}function wn(){return te()&&g.botProtection.honeypotEnabled}function Ee(){return te()&&g.botProtection.powEnabled}function qe(){return be||sessionStorage.getItem(ve)==="true"}function yt(){be=!0,sessionStorage.setItem(ve,"true")}function vn(){return wn()?{"X-Humata-HP":"","X-Humata-TS":String(gt)}:{}}async function bn(s,d){let f="0".repeat(d),p=0,y=1e7,E=new TextEncoder;for(;p<y;){let b=s+":"+p,C=E.encode(b),T=await crypto.subtle.digest("SHA-256",C);if(Array.from(new Uint8Array(T)).map(F=>F.toString(16).padStart(2,"0")).join("").startsWith(f))return String(p);p++,p%1e4===0&&await new Promise(F=>setTimeout(F,0))}throw new Error("Failed to solve proof-of-work challenge")}async function En(s=null){if(!Ee())return{};if(qe()&&!s)return{};if(ye&&we&&!s)return{"X-Humata-PoW-Nonce":ye,"X-Humata-PoW-Solution":we};if(s&&s.nonce&&s.difficulty){let d=await bn(s.nonce,s.difficulty);return ye=s.nonce,we=d,{"X-Humata-PoW-Nonce":s.nonce,"X-Humata-PoW-Solution":d}}return{}}async function Re(s=null){if(!te())return{};let d=vn(),f=await En(s);return Pe(Pe({},d),f)}function wt(s){return s&&(s.code==="pow_required"||s.code==="pow_expired"||s.code==="pow_invalid")&&s.data&&s.data.challenge?s.data.challenge:null}function vt(){be=!1,ye=null,we=null,sessionStorage.removeItem(ve)}(function(){"use strict";let s={},d=!1,f=null,p=null,y=3e3,E=!1,b=0;function C(){s={container:document.getElementById("humata-chat-container"),messages:document.getElementById("humata-chat-messages"),input:document.getElementById("humata-chat-input"),inputCounter:document.getElementById("humata-chat-input-counter"),sendButton:document.getElementById("humata-send-button"),scrollToggle:document.getElementById("humata-scroll-toggle"),exportPdfButton:document.getElementById("humata-export-pdf"),clearButton:document.getElementById("humata-clear-chat"),themeToggle:document.getElementById("humata-theme-toggle"),welcomeMessage:document.getElementById("humata-welcome-message")},!(!s.container||!s.messages||!s.input)&&(E=s.container.classList.contains("humata-chat-embedded"),y=Lt(),s.input&&y>0&&(s.input.maxLength=y),bt(),pt(),s.welcomeMessage&&D(s.welcomeMessage.querySelector(".humata-message-content")),sn(),xt(),ze(),R(),s.input&&s.input.focus(),R(),F(),T(),ft(ne))}function T(){s.messages&&s.messages.querySelectorAll(".humata-message-user").length>0||mt(M)}function M(e){if(!e||d)return;ge(),W=e,P(e,"user");let t=Ce();z(e,t)}function ne(e){if(!e||d)return;ee(),W=e,P(e,"user");let t=Ce();z(e,t)}function F(){if(!window.visualViewport)return;let e=document.getElementById("humata-chat-input-container");if(!e)return;let t=document.getElementById("humata-chat-page-footer");function n(){return document.querySelector(".humata-trigger-pages:not(.humata-trigger-pages--hidden)")||t}let o=window.visualViewport.height,r=!1,c=!1,a=!1;function i(){a||(a=!0,requestAnimationFrame(function(){a=!1;let l=window.visualViewport,u=l.offsetTop+l.height,h=window.innerHeight-u;if(o-l.height>150){r||(r=!0,document.body.classList.add("humata-keyboard-open"));let k=!1,me=n();if(me){let he=me.getBoundingClientRect(),K=e.offsetHeight,Y=l.height+l.offsetTop,v=Y-K;he.top<=Y&&he.top>0&&(k=!0)}k?(c||(c=!0,e.classList.add("humata-input-detached")),e.style.position="",e.style.bottom="",e.style.left="",e.style.right="",e.style.transform=""):(c&&(c=!1,e.classList.remove("humata-input-detached")),e.style.position="fixed",e.style.bottom="0",e.style.left="0",e.style.right="0",e.style.transform="translateY("+-h+"px)")}else r&&(r=!1,c=!1,document.body.classList.remove("humata-keyboard-open"),e.classList.remove("humata-input-detached")),e.style.position="",e.style.bottom="",e.style.left="",e.style.right="",e.style.transform=""}))}window.visualViewport.addEventListener("resize",i),window.visualViewport.addEventListener("scroll",i),window.addEventListener("scroll",i,{passive:!0}),s.input&&(s.input.addEventListener("focus",function(){setTimeout(i,300)}),s.input.addEventListener("blur",function(){setTimeout(i,100)}))}function bt(){let e=localStorage.getItem(fe),t=g.theme||"auto",n=e||t;n==="auto"&&(n=window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light"),xe(n),t==="auto"&&!e&&window.matchMedia("(prefers-color-scheme: dark)").addEventListener("change",function(o){localStorage.getItem(fe)||xe(o.matches?"dark":"light")})}function xe(e){let t=document.documentElement,n=document.body;t.classList.remove("humata-theme-dark","humata-theme-light"),n.classList.remove("humata-theme-dark","humata-theme-light"),e==="dark"?(t.classList.add("humata-theme-dark"),n.classList.add("humata-theme-dark")):(t.classList.add("humata-theme-light"),n.classList.add("humata-theme-light")),s.themeToggle&&s.themeToggle.setAttribute("aria-pressed",e==="dark"?"true":"false")}function Et(){let t=document.documentElement.classList.contains("humata-theme-dark")?"light":"dark";localStorage.setItem(fe,t),xe(t)}function xn(e,t,n){return Promise.race([e,new Promise(function(o,r){setTimeout(function(){let c=new Error("Operation timed out");c.type=n,r(c)},t)})])}function xt(){s.sendButton&&s.sendButton.addEventListener("click",Ve),s.input&&(s.input.addEventListener("keydown",Ht),s.input.addEventListener("input",ze)),s.scrollToggle&&s.scrollToggle.addEventListener("click",Mt),E&&s.messages?s.messages.addEventListener("scroll",R,{passive:!0}):window.addEventListener("scroll",R,{passive:!0}),s.messages&&s.messages.addEventListener("click",kt),s.clearButton&&s.clearButton.addEventListener("click",on),s.exportPdfButton&&s.exportPdfButton.addEventListener("click",nn),s.themeToggle&&s.themeToggle.addEventListener("click",Et),Ct(),Tt(),St()}function St(){typeof window!="undefined"&&(window.__humataModalFocusTrapInstalled||(window.__humataModalFocusTrapInstalled=!0,document.addEventListener("keydown",function(e){if(e.key!=="Tab")return;let t=document.querySelector(".humata-help-modal.is-open");if(!t)return;let n=t.querySelector(".humata-help-modal__dialog");if(!n)return;let o=n.querySelectorAll('a[href], area[href], button:not([disabled]), input:not([disabled]):not([type="hidden"]), select:not([disabled]), textarea:not([disabled]), iframe, object, embed, [contenteditable], [tabindex]:not([tabindex="-1"])'),r=Array.prototype.slice.call(o).filter(function(l){return!!(l.offsetWidth||l.offsetHeight||l.getClientRects().length)});if(!r.length)return;let c=r[0],a=r[r.length-1],i=document.activeElement;if(!n.contains(i)){e.preventDefault(),e.shiftKey?a.focus():c.focus();return}if(e.shiftKey&&i===c){e.preventDefault(),a.focus();return}!e.shiftKey&&i===a&&(e.preventDefault(),c.focus())})))}function Tt(){let e=document.getElementById("humata-medical-disclaimer-link"),t=document.getElementById("humata-medical-disclaimer-modal");!e||!t||(e.addEventListener("click",function(n){n.preventDefault(),Ue(t,e)}),t.addEventListener("click",function(n){n.target.closest("[data-humata-disclaimer-close]")&&(n.preventDefault(),Se(t))}))}function Ct(){document.addEventListener("click",function(e){let t=e.target.closest("[data-humata-page-modal]");if(!t)return;e.preventDefault();let n=t.getAttribute("data-humata-page-modal"),o=document.getElementById("humata-page-modal-"+n);o&&Ue(o,t)}),document.addEventListener("click",function(e){let t=e.target.closest("[data-humata-page-close-modal]");if(!t)return;let n=t.closest(".humata-help-modal");n&&(e.preventDefault(),Se(n))}),document.addEventListener("keydown",function(e){if(e.key!=="Escape")return;let t=document.querySelector(".humata-help-modal.is-open");t&&(e.preventDefault(),Se(t))})}let q=null;function Ue(e,t){q=t||document.activeElement,e.hidden=!1,e.classList.add("is-open"),e.setAttribute("aria-hidden","false"),document.documentElement.classList.add("humata-help-modal-open"),document.body.classList.add("humata-help-modal-open");let n=e.querySelector(".humata-help-modal__close");if(n)try{n.focus({preventScroll:!0})}catch(o){n.focus()}}function Se(e){if(e.classList.remove("is-open"),e.setAttribute("aria-hidden","true"),e.hidden=!0,document.documentElement.classList.remove("humata-help-modal-open"),document.body.classList.remove("humata-help-modal-open"),q&&typeof q.focus=="function")try{q.focus({preventScroll:!0})}catch(t){q.focus()}q=null}function Lt(){let e=parseInt(g.maxPromptChars,10);if(Number.isFinite(e)&&e>0)return e;if(s.input){let t=parseInt(s.input.getAttribute("maxlength"),10);if(Number.isFinite(t)&&t>0)return t}return 3e3}function oe(){if(!s.input||!s.inputCounter)return;let e=(s.input.value||"").length,t=y||3e3;s.inputCounter.textContent=e+"/"+t,s.inputCounter.classList.toggle("humata-input-counter-over",e>t)}function kt(e){let t=e.target.closest(".humata-regenerate-button");if(t){let a=t.closest(".humata-message");if(!a||d||p)return;let i=a.previousElementSibling;for(;i&&!i.classList.contains("humata-message-user");)i=i.previousElementSibling;if(!i)return;let l=i.querySelector(".humata-message-content");if(!l)return;let u=Q(l);if(!u)return;let m=We(i);je(i),V(),z(u,m);return}let n=e.target.closest(".humata-copy-button");if(n){let a=n.closest(".humata-message");if(!a)return;let i=a.querySelector(".humata-message-content");if(!i)return;let l=Ut(i);if(!l||!l.text&&!l.html)return;Dt(l).then(function(){Ot(n)}).catch(function(){jt(n)});return}let o=e.target.closest(".humata-edit-button");if(o){let a=o.closest(".humata-message");if(!a||d)return;At(a);return}if(e.target.closest(".humata-edit-cancel")){se();return}e.target.closest(".humata-edit-save")&&Qe()}function Te(e){if(s.input){if(s.input.disabled=!e,s.sendButton)if(!e)s.sendButton.disabled=!0;else{let t=s.input.value||"";s.sendButton.disabled=!t.trim()||t.length>y}oe()}}function At(e){var i,l,u,m;if(!e||!e.classList.contains("humata-message-user"))return;let t=e.querySelector(".humata-message-content");if(!t||p&&p.messageEl===e)return;se();let n=Q(t);if(!n)return;p={messageEl:e,contentEl:t,originalText:n},e.classList.add("humata-message-editing"),t.classList.add("humata-message-content-editing"),t.textContent="";let o=document.createElement("textarea");o.className="humata-edit-textarea",o.value=n,o.rows=1,o.maxLength=y;let r=document.createElement("div");r.className="humata-edit-actions";let c=document.createElement("button");c.type="button",c.className="humata-edit-cancel",c.innerHTML=Kt(),c.setAttribute("title",((i=g.i18n)==null?void 0:i.cancel)||"Cancel"),c.setAttribute("aria-label",((l=g.i18n)==null?void 0:l.cancel)||"Cancel");let a=document.createElement("button");a.type="button",a.className="humata-edit-save",a.innerHTML=it(),a.setAttribute("title",((u=g.i18n)==null?void 0:u.save)||"Save"),a.setAttribute("aria-label",((m=g.i18n)==null?void 0:m.save)||"Save"),r.appendChild(c),r.appendChild(a),t.appendChild(o),t.appendChild(r),Te(!1),o.addEventListener("input",function(){De(o)}),o.addEventListener("keydown",function(h){if(h.key==="Escape"){h.preventDefault(),se();return}h.key==="Enter"&&(h.ctrlKey||h.metaKey)&&(h.preventDefault(),Qe())}),requestAnimationFrame(function(){De(o),o.focus(),o.setSelectionRange(o.value.length,o.value.length)})}function De(e){if(!e)return;e.style.height="auto";let n=(parseInt(getComputedStyle(e).lineHeight)||24)*8,o=Math.min(e.scrollHeight,n);e.style.height=o+"px",oe()}function se(){p&&(Oe(p.messageEl,p.originalText),p=null,Te(!0),s.input&&s.input.focus())}function Qe(){var r;if(!p||d)return;let e=p.contentEl.querySelector(".humata-edit-textarea");if(!e){se();return}let t=e.value,n=t.trim();if(!n){e.focus();return}if(t.length>y){let c=((r=g.i18n)==null?void 0:r.errorPromptTooLong)||"Message is too long. Maximum is "+y+" characters.";P(c,"bot",!0),e.focus();return}let o=We(p.messageEl);Oe(p.messageEl,n),je(p.messageEl),p=null,Te(!0),V(),z(n,o)}function Oe(e,t){if(!e)return;let n=e.querySelector(".humata-message-content");n&&(e.classList.remove("humata-message-editing"),n.classList.remove("humata-message-content-editing"),n.innerHTML="",n.textContent=t,D(n),Ae(n))}function je(e){if(!s.messages||!e)return;Be();let t=e.nextSibling;for(;t;){let n=t.nextSibling;t.nodeType===1&&t.remove(),t=n}}function We(e){if(!s.messages)return[];let t=[],n=s.messages.querySelectorAll(".humata-message:not(#humata-welcome-message):not(.humata-message-loading)");for(let o=0;o<n.length;o++){let r=n[o];if(r===e)break;let c=r.classList.contains("humata-message-user");if(r.classList.contains("humata-message-error"))continue;let i=r.querySelector(".humata-message-content");if(!i)continue;let l=Q(i);l&&t.push({type:c?"user":"bot",content:l})}return t}function R(){if(!s.scrollToggle)return;let e,t,n;E&&s.messages?(e=s.messages.scrollHeight,t=s.messages.clientHeight,n=s.messages.scrollTop):(e=document.documentElement.scrollHeight,t=window.innerHeight,n=window.scrollY||document.documentElement.scrollTop);let o=e-t;if(o<=50){s.scrollToggle.style.display="none";return}s.scrollToggle.style.display="";let r=e-(n+t),c=o*.3,a=r<=c;s.scrollToggle.classList.toggle("humata-scroll-toggle-top",a);let i=s.scrollToggle.getAttribute("data-label-top")||"Scroll to top",l=s.scrollToggle.getAttribute("data-label-bottom")||"Scroll to bottom",u=a?i:l;s.scrollToggle.setAttribute("title",u),s.scrollToggle.setAttribute("aria-label",u)}function Mt(){if(!s.scrollToggle)return;let e=s.scrollToggle.classList.contains("humata-scroll-toggle-top");if(E&&s.messages){let t=e?0:s.messages.scrollHeight;s.messages.scrollTo({top:t,behavior:"smooth"})}else{let t=e?0:document.documentElement.scrollHeight;window.scrollTo({top:t,behavior:"smooth"})}}function ze(){let e=s.input;e.style.height="auto";let n=(parseInt(getComputedStyle(e).lineHeight)||24)*5,o=Math.min(e.scrollHeight,n);e.style.height=o+"px";let r=e.value.length>y;oe(),s.sendButton&&(s.sendButton.disabled=!e.value.trim()||r)}function Ht(e){e.key==="Enter"&&!e.shiftKey&&(e.preventDefault(),Ve())}function Ve(){var o;let e=s.input.value,t=e.trim();if(!t||d)return;if(ge(),ee(),e.length>y){let r=((o=g.i18n)==null?void 0:o.errorPromptTooLong)||"Message is too long. Maximum is "+y+" characters.";P(r,"bot",!0),s.input&&s.input.focus();return}let n=Ce();W=t,P(t,"user"),s.input.value="",s.input.style.height="auto",s.sendButton&&(s.sendButton.disabled=!0),oe(),z(t,n)}function Ce(){if(!s.messages)return[];let e=[];return s.messages.querySelectorAll(".humata-message:not(#humata-welcome-message):not(.humata-message-loading)").forEach(function(n){let o=n.classList.contains("humata-message-user");if(n.classList.contains("humata-message-error"))return;let c=n.querySelector(".humata-message-content");if(!c)return;let a=Q(c);a&&e.push({type:o?"user":"bot",content:a})}),e}function Bt(){let e=document.querySelector(".humata-trigger-pages");e&&!e.classList.contains("humata-trigger-pages--hidden")&&e.classList.add("humata-trigger-pages--hidden")}function P(e,t,n=!1){s.welcomeMessage&&(s.welcomeMessage.style.display="none"),t==="user"&&Bt();let o=document.createElement("div");o.className="humata-message humata-message-"+t,n&&o.classList.add("humata-message-error");let r=document.createElement("div");r.className="humata-message-avatar",G(r,t);let c=document.createElement("div");return c.className="humata-message-content",t==="bot"&&!n?c.innerHTML=Pt(e):c.textContent=e,D(c),t==="bot"&&Ze(c),t==="user"&&!n&&Ae(c),o.appendChild(r),o.appendChild(c),s.messages.appendChild(o),t==="bot"&&!n&&rt(),de(),V(),o}function Pt(e){if(!e)return"";let t=j(String(e).replace(/\r\n?/g,`
`)),n=[];t=t.replace(/```([a-zA-Z0-9_-]*)\n?([\s\S]*?)```/g,function(r,c,a){let i="%%HUMATA_CODEBLOCK_"+n.length+"%%",l=Nt(c||"plaintext");return n.push('<pre><code class="language-'+l+'">'+a.trim()+"</code></pre>"),`
`+i+`
`});let o=Ge(t);return o=It(o),o=o.replace(/%%HUMATA_CODEBLOCK_(\d+)%%/g,function(r,c){let a=parseInt(c,10);return Number.isFinite(a)&&n[a]?n[a]:""}),o}function It(e){if(!e||typeof e!="string")return e;let t=/<\/ol>(\s*(?:<p>[\s\S]*?<\/p>|<ul>[\s\S]*?<\/ul>|<blockquote>[\s\S]*?<\/blockquote>|<hr>)+\s*)<ol>/g,n=e,o="";for(;n!==o;)o=n,n=n.replace(t,function(r,c){return c+"</ol><ol>"});return n=n.replace(/<\/ol>\s*<ol>/g,""),n}let ae=null;function Ke(e){return e==null?"":(ae||(ae=document.createElement("textarea")),ae.innerHTML=String(e),ae.value)}function Nt(e){return String(e||"").toLowerCase().replace(/[^\w-]+/g,"")||"plaintext"}function Ye(e){if(!e)return"";let t=Ke(String(e)).trim();if(!t)return"";let n=t.replace(/[\u0000-\u001F\u007F\s]+/g,"");if(!n)return"";if(n.startsWith("#")||n.startsWith("/")||n.startsWith("./")||n.startsWith("../")||n.startsWith("?")||n.startsWith("//"))return j(t);let o=n.match(/^([a-zA-Z][a-zA-Z0-9+.-]*):/);if(o){let r=(o[1]||"").toLowerCase();if(!(r==="http"||r==="https"||r==="mailto"||r==="tel"))return""}return j(t)}let ie=null;function re(e){return!!e&&/[A-Za-z0-9]/.test(e)}function Ft(){if(ie!==null)return ie;let e=Array.isArray(g.autoLinks)?g.autoLinks:[],t=[];for(let n=0;n<e.length;n++){let o=e[n];if(!o||typeof o!="object")continue;let r=String(o.phrase||"").trim(),c=String(o.url||"").trim();if(!r||!c)continue;let a=Ye(c);if(a&&(t.push({phrase:r,phraseLower:r.toLowerCase(),href:Ke(a),len:r.length,startsWord:re(r.charAt(0)),endsWord:re(r.charAt(r.length-1))}),t.length>=200))break}return t.sort(function(n,o){return o.len-n.len}),ie=t,ie}function _t(e,t){if(!e)return[];let n=String(e),o=n.toLowerCase(),r=[];function c(a,i){for(let l=0;l<r.length;l++){let u=r[l];if(a<u.end&&u.start<i)return!0}return!1}for(let a=0;a<t.length;a++){let i=t[a];if(!i||!i.phraseLower)continue;let l=0;for(;l=o.indexOf(i.phraseLower,l),l!==-1;){let u=l,m=l+i.phraseLower.length;if(i.startsWord){let h=u>0?n.charAt(u-1):"";if(h&&re(h)){l=l+1;continue}}if(i.endsWord){let h=m<n.length?n.charAt(m):"";if(h&&re(h)){l=l+1;continue}}c(u,m)||r.push({start:u,end:m,href:i.href}),l=m}}return r}function qt(e){if(!e)return e;let t=Ft();if(!t||!t.length||typeof document=="undefined"||!document.createElement||!document.createTreeWalker||typeof NodeFilter=="undefined")return e;let n=document.createElement("div");try{n.innerHTML=String(e)}catch(a){return e}let o;try{o=document.createTreeWalker(n,NodeFilter.SHOW_TEXT,{acceptNode:function(a){let i=a&&a.nodeValue?String(a.nodeValue):"";if(!i||!i.trim())return NodeFilter.FILTER_REJECT;let l=a.parentNode;for(;l&&l!==n;){let u=l.nodeName;if(u==="A"||u==="CODE"||u==="PRE")return NodeFilter.FILTER_REJECT;l=l.parentNode}return NodeFilter.FILTER_ACCEPT}})}catch(a){return e}let r=[],c;for(;c=o.nextNode();)r.push(c);for(let a=0;a<r.length;a++){let i=r[a],l=i&&i.nodeValue?String(i.nodeValue):"";if(!l)continue;let u=_t(l,t);if(!u.length)continue;u.sort(function(x,w){return x.start-w.start});let m=document.createDocumentFragment(),h=0;for(let x=0;x<u.length;x++){let w=u[x];if(!w||w.start<h)continue;w.start>h&&m.appendChild(document.createTextNode(l.slice(h,w.start)));let k=document.createElement("a");k.setAttribute("href",w.href),k.setAttribute("target","_blank"),k.setAttribute("rel","noopener noreferrer"),k.textContent=l.slice(w.start,w.end),m.appendChild(k),h=w.end}h<l.length&&m.appendChild(document.createTextNode(l.slice(h))),i.parentNode&&i.parentNode.replaceChild(m,i)}return n.innerHTML}function U(e){return!e||/^\s*$/.test(e)}function Xe(e){return/^%%HUMATA_CODEBLOCK_\d+%%$/.test(String(e||"").trim())}function $e(e){return/^\s{0,3}(-{3,}|\*{3,})\s*$/.test(String(e||""))}function Je(e){let t=String(e||"").match(/^\s{0,3}(#{1,6})\s+(.+?)\s*$/);return t?{level:t[1].length,text:t[2]}:null}function Le(e){return/^\s{0,3}>\s?/.test(String(e||""))}function Rt(e){return String(e||"").replace(/^\s{0,3}>\s?/,"")}function le(e){return/^\s{0,3}[-+*]\s+/.test(String(e||""))}function ce(e){return/^\s{0,3}\d+\.\s+/.test(String(e||""))}function ue(e){if(!e)return"";let t=String(e),n=[];return t=t.replace(/`([^`]+)`/g,function(o,r){let c="%%HUMATA_CODESPAN_"+n.length+"%%";return n.push("<code>"+r+"</code>"),c}),t=t.replace(/\[([^\]]+)\]\(([^)]+)\)/g,function(o,r,c){let a=Ye(c);return a?'<a href="'+a+'" target="_blank" rel="noopener noreferrer">'+r+"</a>":r+" ("+c+")"}),t=t.replace(/\*\*([^*]+)\*\*/g,"<strong>$1</strong>"),t=t.replace(/(^|[^*])\*([^*\n]+)\*(?!\*)/g,"$1<em>$2</em>"),t=qt(t),t=t.replace(/%%HUMATA_CODESPAN_(\d+)%%/g,function(o,r){let c=parseInt(r,10);return Number.isFinite(c)&&n[c]?n[c]:o}),t}function Ge(e){if(!e)return"";let t=String(e).split(`
`),n=[],o=0;for(;o<t.length;){let r=t[o];if(U(r)){o++;continue}if(Xe(r)){n.push(String(r).trim()),o++;continue}if($e(r)){n.push("<hr>"),o++;continue}let c=Je(r);if(c){n.push("<h"+c.level+">"+ue(c.text)+"</h"+c.level+">"),o++;continue}if(Le(r)){let l=[];for(;o<t.length&&Le(t[o]);)l.push(Rt(t[o])),o++;n.push("<blockquote>"+Ge(l.join(`
`))+"</blockquote>");continue}if(le(r)){let l=[];for(;o<t.length;){let u=t[o];if(U(u)){let h=o+1;for(;h<t.length&&U(t[h]);)h++;if(h<t.length&&le(t[h])){o=h;continue}break}if(!le(u))break;let m=String(u).replace(/^\s{0,3}[-+*]\s+/,"");l.push("<li>"+ue(m)+"</li>"),o++}n.push("<ul>"+l.join("")+"</ul>");continue}if(ce(r)){let l=[];for(;o<t.length;){let u=t[o];if(U(u)){let h=o+1;for(;h<t.length&&U(t[h]);)h++;if(h<t.length&&ce(t[h])){o=h;continue}break}if(!ce(u))break;let m=String(u).replace(/^\s{0,3}\d+\.\s+/,"");l.push("<li>"+ue(m)+"</li>"),o++}n.push("<ol>"+l.join("")+"</ol>");continue}let a=[];for(;o<t.length;){let l=t[o];if(U(l)||Xe(l)||$e(l)||Je(l)||Le(l)||le(l)||ce(l))break;a.push(String(l).trim()),o++}let i=a.join(" ").trim();i&&n.push("<p>"+ue(i)+"</p>")}return n.join("")}function j(e){let t=document.createElement("div");return t.textContent=e,t.innerHTML}function ke(e){if(!e)return null;let t=e.querySelector(".humata-message-actions");return t||(t=document.createElement("div"),t.className="humata-message-actions",e.appendChild(t),t)}function D(e){if(!e||e.querySelector(".humata-copy-button"))return;e.classList.add("humata-message-content-has-copy");let t=document.createElement("button");t.type="button",t.className="humata-copy-button",t.innerHTML=Wt(),t.setAttribute("title","Copy"),t.setAttribute("aria-label","Copy message");let n=ke(e);n&&n.appendChild(t)}function Ze(e){var o,r;if(!e||e.querySelector(".humata-regenerate-button"))return;e.classList.add("humata-message-content-has-regenerate");let t=document.createElement("button");t.type="button",t.className="humata-regenerate-button",t.innerHTML=Vt(),t.setAttribute("title",((o=g.i18n)==null?void 0:o.regenerate)||"Regenerate"),t.setAttribute("aria-label",((r=g.i18n)==null?void 0:r.regenerate)||"Regenerate");let n=ke(e);n&&n.appendChild(t)}function Ae(e){var o,r;if(!e||e.querySelector(".humata-edit-button"))return;e.classList.add("humata-message-content-has-edit");let t=document.createElement("button");t.type="button",t.className="humata-edit-button",t.innerHTML=zt(),t.setAttribute("title",((o=g.i18n)==null?void 0:o.editMessage)||"Edit message"),t.setAttribute("aria-label",((r=g.i18n)==null?void 0:r.editMessage)||"Edit message");let n=ke(e);n&&n.appendChild(t)}function Q(e){let t=e?e.querySelector(".humata-edit-textarea"):null;if(t)return(t.value||"").trim();let n=e.cloneNode(!0);return n.querySelectorAll(".humata-copy-button").forEach(function(o){o.remove()}),n.querySelectorAll(".humata-regenerate-button").forEach(function(o){o.remove()}),n.querySelectorAll(".humata-edit-button").forEach(function(o){o.remove()}),n.querySelectorAll(".humata-edit-actions").forEach(function(o){o.remove()}),n.querySelectorAll(".humata-message-actions").forEach(function(o){o.remove()}),n.querySelectorAll(".humata-bot-response-disclaimer").forEach(function(o){o.remove()}),n.querySelectorAll(".humata-intent-links").forEach(function(o){o.remove()}),n.querySelectorAll(".humata-accordions").forEach(function(o){o.remove()}),((n.innerText||n.textContent||"")+"").trim()}function Me(e){let t=e.cloneNode(!0);return t.querySelectorAll(".humata-copy-button").forEach(function(n){n.remove()}),t.querySelectorAll(".humata-regenerate-button").forEach(function(n){n.remove()}),t.querySelectorAll(".humata-edit-button").forEach(function(n){n.remove()}),t.querySelectorAll(".humata-edit-actions").forEach(function(n){n.remove()}),t.querySelectorAll(".humata-message-actions").forEach(function(n){n.remove()}),t.querySelectorAll(".humata-bot-response-disclaimer").forEach(function(n){n.remove()}),t.querySelectorAll(".humata-intent-links").forEach(function(n){n.remove()}),t.querySelectorAll(".humata-accordions").forEach(function(n){n.remove()}),t.innerHTML}function Ut(e){let t=e?e.querySelector(".humata-edit-textarea"):null;if(t){let o=(t.value||"").trim();return{text:o,html:o?"<div>"+j(o).replace(/\n/g,"<br>")+"</div>":""}}let n=e?Me(e):"";return n?{text:et(n),html:"<div>"+n+"</div>"}:{text:"",html:""}}function et(e){if(!e)return"";let t=document.createElement("div");t.innerHTML=e;let n=He(t,{listStack:[]});return String(n||"").replace(/\r\n?/g,`
`).replace(/[ \t]+\n/g,`
`).replace(/\n{3,}/g,`

`).trim()}function He(e,t){if(!e)return"";let n=e.nodeType;if(n===3)return e.nodeValue||"";if(n!==1)return"";let o=(e.tagName||"").toLowerCase();function r(){let i="",l=e.childNodes||[];for(let u=0;u<l.length;u++)i+=He(l[u],t);return i}function c(i){return i?i.endsWith(`
`)?i:i+`
`:`
`}function a(i){let l=c(i);return l.endsWith(`

`)||(l+=`
`),l}if(o==="br")return`
`;if(o==="hr")return`

`;if(o==="pre"){let i=e.textContent||"";return a(i.replace(/\n$/,""))}if(o==="p"||o==="div"||o==="section"){let i=r().trim();return i?a(i):""}if(o==="blockquote"){let i=r().trim();return i?a(i):""}if(/^h[1-6]$/.test(o)){let i=r().trim();return i?a(i):""}if(o==="ul"||o==="ol"){t.listStack.push({type:o,index:0});let i="",l=e.childNodes||[];for(let u=0;u<l.length;u++)i+=He(l[u],t);return t.listStack.pop(),a(i.trim())}if(o==="li"){let i=t.listStack||[],l=i.length?i[i.length-1]:null,u="- ";l&&l.type==="ol"?(l.index+=1,u=String(l.index)+". "):l&&l.type==="ul"&&(u="\u2022 ");let m=i.length>1?"  ".repeat(i.length-1):"",h=r().trim();return h?m+u+h+`
`:""}return r()}function Dt(e){if(e==null)return Promise.reject(new Error("Nothing to copy"));if(typeof e=="string")return nt(e);let t=String(e.text||""),n=String(e.html||"");if(n&&navigator.clipboard&&navigator.clipboard.write&&typeof ClipboardItem!="undefined")try{let o=new ClipboardItem({"text/plain":new Blob([t],{type:"text/plain"}),"text/html":new Blob([n],{type:"text/html"})});return navigator.clipboard.write([o]).catch(function(){return tt(n)})}catch(o){}return n?tt(n):nt(t)}function tt(e){return st(e.replace(/<[^>]*>/g,""))}function nt(e){return navigator.clipboard&&navigator.clipboard.writeText?navigator.clipboard.writeText(e).catch(function(){return ot(e)}):ot(e)}function ot(e){return st(e)}function st(e){return new Promise(function(t,n){let c="Press "+(/Mac|iPhone|iPad|iPod/i.test(navigator.platform||navigator.userAgent)?"Cmd+C":"Ctrl+C")+" to copy";Qt(c);let a=document.createElement("textarea");a.value=String(e||""),a.setAttribute("readonly",""),a.setAttribute("aria-label","Text to copy"),a.style.position="fixed",a.style.top="50%",a.style.left="50%",a.style.transform="translate(-50%, -50%)",a.style.width="1px",a.style.height="1px",a.style.padding="0",a.style.border="none",a.style.outline="none",a.style.opacity="0",a.style.zIndex="999999",document.body.appendChild(a),a.focus(),a.select(),a.setSelectionRange(0,a.value.length);function i(m){u(),t()}function l(m){m.key==="Escape"&&(u(),n(new Error("Copy cancelled")))}function u(){document.removeEventListener("copy",i),document.removeEventListener("keydown",l),a.parentNode&&a.remove(),at()}document.addEventListener("copy",i),document.addEventListener("keydown",l),setTimeout(function(){u(),n(new Error("Copy timeout"))},1e4)})}function Qt(e){at();let t=document.createElement("div");t.id="humata-copy-prompt-toast",t.textContent=e,t.style.cssText="position:fixed;top:20px;left:50%;transform:translateX(-50%);background:#333;color:#fff;padding:12px 24px;border-radius:8px;font-size:14px;z-index:999999;box-shadow:0 4px 12px rgba(0,0,0,0.3);",document.body.appendChild(t)}function at(){let e=document.getElementById("humata-copy-prompt-toast");e&&e.remove()}function Ot(e){e&&(e.dataset.humataCopyDefault||(e.dataset.humataCopyDefault=e.innerHTML),e._humataCopyResetTimer&&clearTimeout(e._humataCopyResetTimer),e.innerHTML=it(),e.classList.add("humata-copy-button-success"),e.setAttribute("title","Copied"),e.setAttribute("aria-label","Copied"),e._humataCopyResetTimer=setTimeout(function(){e.innerHTML=e.dataset.humataCopyDefault,e.classList.remove("humata-copy-button-success"),e.setAttribute("title","Copy"),e.setAttribute("aria-label","Copy message")},1500))}function jt(e){e&&(e.setAttribute("title","Copy failed"),e.setAttribute("aria-label","Copy failed"),e._humataCopyResetTimer&&clearTimeout(e._humataCopyResetTimer),e._humataCopyResetTimer=setTimeout(function(){e.setAttribute("title","Copy"),e.setAttribute("aria-label","Copy message")},1500))}function Wt(){return'<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"><rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect><path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path></svg>'}function zt(){return'<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"><path d="M12 20h9"></path><path d="M16.5 3.5a2.121 2.121 0 0 1 3 3L7 19l-4 1 1-4Z"></path></svg>'}function Vt(){return'<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"><polyline points="23 4 23 10 17 10"></polyline><polyline points="1 20 1 14 7 14"></polyline><path d="M3.51 9a9 9 0 0 1 14.13-3.36L23 10"></path><path d="M1 14l5.36 5.36A9 9 0 0 0 20.49 15"></path></svg>'}function it(){return'<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"><path d="M20 6 9 17l-5-5"></path></svg>'}function Kt(){return'<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"><path d="M18 6 6 18"></path><path d="m6 6 12 12"></path></svg>'}function Yt(){let e=g.botResponseDisclaimer;if(!e||typeof e!="string"||!e.trim())return null;let t=document.getElementById("humata-bot-response-disclaimer");return t||(t=document.createElement("div"),t.id="humata-bot-response-disclaimer",t.className="humata-bot-response-disclaimer",t.innerHTML="<p>"+e+"</p>"),t}function rt(){let e=Yt();if(!e)return;if(!s.messages){e.remove();return}let t=s.messages.querySelectorAll(".humata-message-bot:not(.humata-message-error):not(.humata-message-loading):not(#humata-welcome-message)");if(!t.length){e.remove();return}let o=t[t.length-1].querySelector(".humata-message-content");if(!o){e.remove();return}o.appendChild(e)}function Xt(){let e=document.getElementById("humata-bot-response-disclaimer");e&&e.remove()}function lt(e){return String(e||"").replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}function $t(e){let t=g.intentLinks;if(!t||!Array.isArray(t)||!t.length)return[];if(!e||typeof e!="string")return[];let n=[],o=new Set;for(let r=0;r<t.length;r++){let c=t[r],a=c.keywords,i=c.links;if(!a||!Array.isArray(a)||!a.length||!i||!Array.isArray(i)||!i.length)continue;let l=!1;for(let u=0;u<a.length;u++){let m=a[u];if(!m)continue;if(new RegExp("\\b"+lt(m)+"\\b","i").test(e)){l=!0;break}}if(l)for(let u=0;u<i.length;u++){let m=i[u];!m||!m.title||!m.url||o.has(m.url)||(o.add(m.url),n.push({title:m.title,url:m.url}))}}return n}function Jt(e){var r;if(!e||!e.length)return null;let t=document.createElement("div");t.className="humata-intent-links";let n=document.createElement("span");n.className="humata-intent-links-label",n.textContent=((r=g.i18n)==null?void 0:r.relatedResources)||"Related resources:",t.appendChild(n);let o=document.createElement("div");o.className="humata-intent-links-pills";for(let c=0;c<e.length;c++){let a=e[c],i=document.createElement("a");i.href=a.url,i.target="_blank",i.rel="noopener noreferrer",i.className="humata-intent-link",i.textContent=a.title,o.appendChild(i)}return t.appendChild(o),t}function Gt(e){let t=g.intentLinks;if(!t||!Array.isArray(t)||!t.length)return[];if(!e||typeof e!="string")return[];let n=[],o=new Set;for(let r=0;r<t.length;r++){let c=t[r],a=c.keywords,i=c.accordions;if(!a||!Array.isArray(a)||!a.length||!i||!Array.isArray(i)||!i.length)continue;let l=!1;for(let u=0;u<a.length;u++){let m=a[u];if(!m)continue;if(new RegExp("\\b"+lt(m)+"\\b","i").test(e)){l=!0;break}}if(l)for(let u=0;u<i.length;u++){let m=i[u];!m||!m.title||!m.content||o.has(m.title)||(o.add(m.title),n.push({title:m.title,content:m.content}))}}return n}function Zt(e){if(!e||!e.length)return null;let t=document.createElement("div");t.className="humata-accordions";for(let n=0;n<e.length;n++){let o=e[n],r=document.createElement("div");r.className="humata-accordion-item";let c="humata-accordion-content-"+ ++b,a="humata-accordion-toggle-"+b,i=document.createElement("button");i.type="button",i.className="humata-accordion-toggle",i.id=a,i.setAttribute("aria-expanded","false"),i.setAttribute("aria-controls",c),i.innerHTML="<span>"+j(o.title)+'</span><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="6 9 12 15 18 9"></polyline></svg>';let l=document.createElement("div");l.className="humata-accordion-content",l.id=c,l.hidden=!0,l.setAttribute("role","region"),l.setAttribute("aria-labelledby",a),l.innerHTML=o.content,i.addEventListener("click",function(){let u=r.classList.toggle("open");i.setAttribute("aria-expanded",u?"true":"false"),l.hidden=!u}),r.appendChild(i),r.appendChild(l),t.appendChild(r)}return t}function ct(e,t){if(!e||!t)return;let n=e.querySelector(".humata-message-content");if(!n)return;let o=Gt(t),r=$t(t),c=Zt(o);if(c){e._humataIntentAccordions=o;let l=n.querySelector(".humata-message-actions");l?n.insertBefore(c,l):n.appendChild(c)}if(!r.length)return;let a=Jt(r);if(!a)return;e._humataIntentLinks=r;let i=n.querySelector(".humata-bot-response-disclaimer");i?n.insertBefore(a,i):n.appendChild(a)}let W="";function en(){var c;Xt();let e=document.createElement("div");e.className="humata-message humata-message-bot humata-message-loading",e.id="humata-loading-indicator";let t=document.createElement("div");t.className="humata-message-avatar",G(t,"bot");let n=document.createElement("div");n.className="humata-message-content";let o=String(g.secondLlmProvider||"").toLowerCase(),r=o!==""&&o!=="none";if(r?n.innerHTML='<div class="humata-typing-indicator"><span></span><span></span><span></span></div><div class="humata-loading-status" aria-live="polite" aria-atomic="true"><span class="humata-loading-status-text"></span></div>':n.innerHTML='<div class="humata-typing-indicator"><span></span><span></span><span></span></div>',e.appendChild(t),e.appendChild(n),s.messages.appendChild(e),r){let a=n.querySelector(".humata-loading-status-text");if(a){let i=["Processing your question\u2026",((c=g.i18n)==null?void 0:c.thinking)||"Thinking\u2026","Reviewing for accuracy\u2026","Just a few moments more\u2026","Almost ready\u2026","Finalizing answer\u2026"],l=0;a.textContent=i[l],a.style.opacity="1",e._humataStatusTimer=setInterval(function(){l=(l+1)%i.length,a.style.opacity="0",e._humataStatusFadeTimer=setTimeout(function(){a.textContent=i[l],a.style.opacity="1"},180)},2e3)}}return de(),e}function Be(){let e=document.getElementById("humata-loading-indicator");e&&(e._humataStatusTimer&&clearInterval(e._humataStatusTimer),e._humataStatusFadeTimer&&clearTimeout(e._humataStatusFadeTimer),e.remove())}function de(){E&&s.messages?s.messages.scrollTop=s.messages.scrollHeight:window.scrollTo({top:document.documentElement.scrollHeight,behavior:"smooth"}),R()}function tn(e){if(!e){de();return}if(E&&s.messages){let t=s.messages.getBoundingClientRect(),o=e.getBoundingClientRect().top-t.top+s.messages.scrollTop;s.messages.scrollTo({top:o,behavior:"smooth"})}else{let t=e.getBoundingClientRect(),n=window.scrollY||document.documentElement.scrollTop,o=t.top+n-80;window.scrollTo({top:Math.max(0,o),behavior:"smooth"})}R()}async function z(e,t=[]){var n,o,r,c,a;if(!d){d=!0,en();try{let i={"Content-Type":"application/json","X-WP-Nonce":g.wpNonce,"X-Humata-Nonce":g.nonce},l={},u=null;te()&&(l=await Re(),Object.assign(i,l));let m=await fetch(g.apiUrl,{method:"POST",credentials:"same-origin",headers:i,body:JSON.stringify({message:e,history:t})});if(m.status===403&&Ee()){let x=await m.json();if(u=wt(x),u){vt();let w=await Re(u);Object.assign(i,w),m=await fetch(g.apiUrl,{method:"POST",credentials:"same-origin",headers:i,body:JSON.stringify({message:e,history:t})})}}Be();let h=await m.json();if(!m.ok){let x=((n=g.i18n)==null?void 0:n.errorRequestFailed)||"Your message request failed. Try again. If problem persists, please contact us.",w=((o=g.i18n)==null?void 0:o.errorGeneric)||"An error occurred. Please try again.";m.status===429?w=((r=g.i18n)==null?void 0:r.errorRateLimit)||"Too many requests. Please wait a moment.":h&&typeof h.message=="string"&&h.message.trim()!==""?w=/\b(straico|humata|anthropic|claude)\b/i.test(h.message)?x:h.message:w=x,P(w,"bot",!0);return}if(Ee()&&!qe()&&yt(),h.success&&h.answer){let x=P(h.answer,"bot");x&&W&&(ct(x,W),V()),x&&h.followUpQuestions&&Array.isArray(h.followUpQuestions)&&h.followUpQuestions.length>0&&(_e(x,h.followUpQuestions),x._humataFollowUpQuestions=h.followUpQuestions,V()),tn(x)}else P(((c=g.i18n)==null?void 0:c.errorGeneric)||"An error occurred. Please try again.","bot",!0)}catch(i){Be(),P(((a=g.i18n)==null?void 0:a.errorNetwork)||"Network error. Please check your connection.","bot",!0)}finally{d=!1,s.input.focus()}}}function nn(){let e=s.exportPdfButton;e&&(e.disabled=!0);try{let h=function(){let v=String(m.getFullYear()),H=String(m.getMonth()+1).padStart(2,"0"),A=String(m.getDate()).padStart(2,"0"),B="chat-export-"+v+"-"+H+"-"+A;if(f){let S=String(f).replace(/[^\w-]+/g,"").slice(0,40);S&&(B+="-"+S)}return B+".pdf"},x=function(v){return String(v||"").replace(/\u00A0/g," ").replace(/[\u200B\u200C\u200D\uFEFF]/g,"").replace(/\u2022/g,"-").replace(/[\u2018\u2019]/g,"'").replace(/[\u201C\u201D]/g,'"').replace(/[\u2013\u2014]/g,"-").replace(/\u2026/g,"...").replace(/\r\n?/g,`
`).trim()},w=function(v,H,A){try{n.text(v,H,A)}catch(B){n.text(String(v||"").replace(/[^\x09\x0A\x0D\x20-\x7E]/g,"?"),H,A)}},t=window.jspdf&&window.jspdf.jsPDF?window.jspdf.jsPDF:window.jsPDF||null;if(!t)return;let n=new t({unit:"pt",format:"a4"}),o=n.internal.pageSize.getWidth?n.internal.pageSize.getWidth():n.internal.pageSize.width,r=n.internal.pageSize.getHeight?n.internal.pageSize.getHeight():n.internal.pageSize.height,c=40,a=40,i=o-c*2,l=14,u=a,m=new Date,k=document.querySelector(".humata-chat-title"),me=((k?k.textContent:"")||"Chat Export").trim();n.setFont("helvetica","bold"),n.setFontSize(16),w(me||"Chat Export",c,u),u+=22,n.setFont("helvetica","normal"),n.setFontSize(10),w(m.toLocaleString(),c,u),u+=24;let he=s.messages?s.messages.querySelectorAll(".humata-message:not(#humata-welcome-message):not(.humata-message-loading)"):[],K=[];he.forEach(function(v){let H=v.querySelector(".humata-message-content");if(!H)return;let A=v.classList.contains("humata-message-user"),B=v.classList.contains("humata-message-error"),S="";if(A)S=Q(H);else{let X=Me(H);S=et(X)}if(S=x(S),!S)return;let L=null;!A&&!B&&v._humataIntentLinks&&v._humataIntentLinks.length&&(L=v._humataIntentLinks);let N=null;!A&&!B&&v._humataIntentAccordions&&v._humataIntentAccordions.length&&(N=v._humataIntentAccordions),K.push({role:A?"You":"Assistant",text:S,isError:B,intentLinks:L,intentAccordions:N})});let Y=new Set;if(!K.length){n.setFont("helvetica","normal"),n.setFontSize(12),w("No messages.",c,u),n.save(h());return}K.forEach(function(v){var B;n.setFont("helvetica","bold"),n.setFontSize(13);let H=v.role+(v.isError?" (error)":"")+":";u+l>r-a&&(n.addPage(),u=a),w(H,c,u),u+=l,n.setFont("helvetica","normal"),n.setFontSize(12);let A=n.splitTextToSize(v.text,i);for(let S=0;S<A.length;S++)u+l>r-a&&(n.addPage(),u=a),w(A[S],c,u),u+=l;if(v.intentAccordions&&v.intentAccordions.length){let S=v.intentAccordions.filter(function(L){return Y.has(L.title)?!1:(Y.add(L.title),!0)});if(S.length){u+=4;for(let L=0;L<S.length;L++){let N=S[L];n.setFont("helvetica","bold"),n.setFontSize(11),u+l>r-a&&(n.addPage(),u=a),w("\u25B8 "+N.title,c,u),u+=l,n.setFont("helvetica","normal"),n.setFontSize(11);let X=N.content.replace(/<br\s*\/?>/gi,`
`).replace(/<\/p>/gi,`
`).replace(/<[^>]+>/g,"").replace(/&nbsp;/g," ").replace(/&amp;/g,"&").replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&quot;/g,'"').trim(),$=n.splitTextToSize(X,i-10);for(let _=0;_<$.length;_++)u+l>r-a&&(n.addPage(),u=a),w("  "+$[_],c,u),u+=l;u+=2}}}if(v.intentLinks&&v.intentLinks.length){u+=4,n.setFont("helvetica","italic"),n.setFontSize(11);let S=((B=g.i18n)==null?void 0:B.relatedResources)||"Related resources:";u+l>r-a&&(n.addPage(),u=a),w(S,c,u),u+=l,n.setFont("helvetica","normal");for(let L=0;L<v.intentLinks.length;L++){let N=v.intentLinks[L],X="\u2022 "+N.title+" - "+N.url,$=n.splitTextToSize(X,i);for(let _=0;_<$.length;_++)u+l>r-a&&(n.addPage(),u=a),w($[_],c,u),u+=l}}u+=l}),n.save(h())}catch(t){console.error(t)}finally{e&&(e.disabled=!1)}}function on(){var e;if(s.messages&&(s.messages.innerHTML=""),s.welcomeMessage)s.welcomeMessage.style.display="",s.messages.appendChild(s.welcomeMessage),D(s.welcomeMessage.querySelector(".humata-message-content"));else{let t=document.createElement("div");t.id="humata-welcome-message",t.className="humata-message humata-message-bot";let n=document.createElement("div");n.className="humata-message-avatar",G(n,"bot");let o=document.createElement("div");o.className="humata-message-content",o.innerHTML="<p>"+(((e=g.i18n)==null?void 0:e.welcome)||"Hello! I'm here to help answer your questions. What would you like to know?")+"</p>",t.appendChild(n),t.appendChild(o),s.messages.appendChild(t),s.welcomeMessage=t,D(o)}localStorage.removeItem(J),localStorage.removeItem(Ie),f=null,s.input&&s.input.focus(),T()}function V(){if(!s.messages)return;let e=[],t=s.messages.querySelectorAll(".humata-message:not(#humata-welcome-message):not(.humata-message-loading)"),n="";t.forEach(function(o){let r=o.classList.contains("humata-message-user"),c=o.classList.contains("humata-message-error"),a=o.querySelector(".humata-message-content");if(a){let i={type:r?"user":"bot",content:r?Q(a):Me(a),isError:c};r?n=i.content:(i.triggerUserMessage=n,o._humataFollowUpQuestions&&Array.isArray(o._humataFollowUpQuestions)&&(i.followUpQuestions=o._humataFollowUpQuestions)),e.push(i)}});try{localStorage.setItem(J,JSON.stringify(e))}catch(o){}}function sn(){try{let e=localStorage.getItem(J);if(!e)return;let t=JSON.parse(e);if(!Array.isArray(t)||t.length===0)return;s.welcomeMessage&&(s.welcomeMessage.style.display="none"),t.forEach(function(o){let r=document.createElement("div");r.className="humata-message humata-message-"+o.type,o.isError&&r.classList.add("humata-message-error");let c=document.createElement("div");c.className="humata-message-avatar",G(c,o.type);let a=document.createElement("div");a.className="humata-message-content",o.type==="user"?a.textContent=o.content:a.innerHTML=o.content,D(a),o.type==="bot"&&Ze(a),o.type==="user"&&!o.isError&&Ae(a),r.appendChild(c),r.appendChild(a),s.messages.appendChild(r),o.type==="bot"&&!o.isError&&o.triggerUserMessage&&ct(r,o.triggerUserMessage),o.type==="bot"&&!o.isError&&o.followUpQuestions&&Array.isArray(o.followUpQuestions)&&(r._humataFollowUpQuestions=o.followUpQuestions)});let n=s.messages.querySelector(".humata-message-bot:last-of-type:not(.humata-message-error)");n&&n._humataFollowUpQuestions&&n._humataFollowUpQuestions.length>0&&_e(n,n._humataFollowUpQuestions),f=localStorage.getItem(Ie),rt(),de()}catch(e){localStorage.removeItem(J)}}document.readyState==="loading"?document.addEventListener("DOMContentLoaded",C):C()})();})();
//# sourceMappingURL=chat-widget.js.map
