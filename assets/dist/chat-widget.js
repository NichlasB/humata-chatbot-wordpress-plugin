(()=>{var h=window.humataConfig||{},Q="humata_chat_history",be="humata_conversation_id",de="humata_theme_preference",Y="humata_turnstile_verified";var Ot='<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"><path d="M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2"></path><circle cx="12" cy="7" r="4"></circle></svg>',jt='<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"><path d="M12 8V4H8"></path><rect width="16" height="12" x="4" y="8" rx="2"></rect><path d="M2 14h2"></path><path d="M20 14h2"></path><path d="M15 13v2"></path><path d="M9 13v2"></path></svg>';function $(r,g){let v=g==="user"?h.userAvatarUrl:h.botAvatarUrl;if(v&&v.length>0){let w=document.createElement("img");w.src=v,w.alt=g==="user"?"User":"Bot",w.className="humata-avatar-img",r.innerHTML="",r.appendChild(w)}else r.innerHTML=g==="user"?Ot:jt}var I=null,Se=null;function Xe(r){if(I=document.getElementById("humata-suggested-questions"),Se=r,!I)return;let g=h.suggestedQuestions;if(!g||!g.enabled)return;let v=Ut(g);v.length!==0&&Kt(v)}function Ut(r){return r.mode==="fixed"?Wt(r.fixedQuestions||[]):r.mode==="randomized"?Vt(r.categories||[]):[]}function Wt(r){return r.filter(g=>g&&g.text&&g.text.trim()!=="").slice(0,4).map(g=>g.text)}function Vt(r){let g=r.filter(p=>p&&p.questions&&p.questions.length>0);if(g.length===0)return[];let v=[],w=g.length;if(w===1){let p=g[0],b=G([...p.questions]);for(let S=0;S<4&&S<b.length;S++)v.push(b[S])}else if(w===2)for(let p=0;p<2;p++){let b=g[p],S=G([...b.questions]);for(let k=0;k<2&&k<S.length;k++)v.push(S[k])}else if(w===3){let p=Math.floor(Math.random()*3);for(let b=0;b<3;b++){let S=g[b],k=G([...S.questions]),J=b===p?2:1;for(let z=0;z<J&&z<k.length;z++)v.push(k[z])}}else for(let p=0;p<4&&p<g.length;p++){let b=g[p],S=G([...b.questions]);S.length>0&&v.push(S[0])}return G(v).slice(0,4)}function G(r){for(let g=r.length-1;g>0;g--){let v=Math.floor(Math.random()*(g+1));[r[g],r[v]]=[r[v],r[g]]}return r}function Kt(r){!I||r.length===0||(I.innerHTML="",r.forEach(g=>{let v=document.createElement("button");v.type="button",v.className="humata-suggested-question-btn",v.setAttribute("title",g);let w=document.createElement("span");w.className="humata-suggested-question-text",w.textContent=g,v.appendChild(w),v.addEventListener("click",()=>{Qt(g)}),I.appendChild(v)}),I.style.display="")}function Qt(r){me(),typeof Se=="function"&&Se(r)}function me(){I&&(I.style.display="none",I.innerHTML="")}(function(){"use strict";let r={},g=!1,v=null,w=null,p=3e3,b=!1,S=null,k=null,J=!1,z=null;function Le(){r={container:document.getElementById("humata-chat-container"),messages:document.getElementById("humata-chat-messages"),input:document.getElementById("humata-chat-input"),inputCounter:document.getElementById("humata-chat-input-counter"),sendButton:document.getElementById("humata-send-button"),scrollToggle:document.getElementById("humata-scroll-toggle"),exportPdfButton:document.getElementById("humata-export-pdf"),clearButton:document.getElementById("humata-clear-chat"),themeToggle:document.getElementById("humata-theme-toggle"),welcomeMessage:document.getElementById("humata-welcome-message")},!(!r.container||!r.messages||!r.input)&&(b=r.container.classList.contains("humata-chat-embedded"),p=ct(),r.input&&p>0&&(r.input.maxLength=p),tt(),rt(),r.welcomeMessage&&P(r.welcomeMessage.querySelector(".humata-message-content")),zt(),it(),qe(),F(),r.input&&r.input.focus(),F(),et(),ke())}function ke(){r.messages&&r.messages.querySelectorAll(".humata-message-user").length>0||Xe(Ze)}function Ze(e){if(!e||g)return;me(),ae=e,B(e,"user");let t=Fe();ce(e,t)}function et(){if(!window.visualViewport)return;let e=document.getElementById("humata-chat-input-container");if(!e)return;let t=document.getElementById("humata-chat-page-footer");function n(){return document.querySelector(".humata-trigger-pages:not(.humata-trigger-pages--hidden)")||t}let o=window.visualViewport.height,s=!1,c=!1,l=!1;function i(){l||(l=!0,requestAnimationFrame(function(){l=!1;let a=window.visualViewport,u=a.offsetTop+a.height,m=window.innerHeight-u;if(o-a.height>150){s||(s=!0,document.body.classList.add("humata-keyboard-open"));let E=!1,A=n();if(A){let j=A.getBoundingClientRect(),U=e.offsetHeight,W=a.height+a.offsetTop,y=W-U;j.top<=W&&j.top>0&&(E=!0)}E?(c||(c=!0,e.classList.add("humata-input-detached")),e.style.position="",e.style.bottom="",e.style.left="",e.style.right="",e.style.transform=""):(c&&(c=!1,e.classList.remove("humata-input-detached")),e.style.position="fixed",e.style.bottom="0",e.style.left="0",e.style.right="0",e.style.transform="translateY("+-m+"px)")}else s&&(s=!1,c=!1,document.body.classList.remove("humata-keyboard-open"),e.classList.remove("humata-input-detached")),e.style.position="",e.style.bottom="",e.style.left="",e.style.right="",e.style.transform=""}))}window.visualViewport.addEventListener("resize",i),window.visualViewport.addEventListener("scroll",i),window.addEventListener("scroll",i,{passive:!0}),r.input&&(r.input.addEventListener("focus",function(){setTimeout(i,300)}),r.input.addEventListener("blur",function(){setTimeout(i,100)}))}function tt(){let e=localStorage.getItem(de),t=h.theme||"auto",n=e||t;n==="auto"&&(n=window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light"),he(n),t==="auto"&&!e&&window.matchMedia("(prefers-color-scheme: dark)").addEventListener("change",function(o){localStorage.getItem(de)||he(o.matches?"dark":"light")})}function he(e){let t=document.documentElement,n=document.body;t.classList.remove("humata-theme-dark","humata-theme-light"),n.classList.remove("humata-theme-dark","humata-theme-light"),e==="dark"?(t.classList.add("humata-theme-dark"),n.classList.add("humata-theme-dark")):(t.classList.add("humata-theme-light"),n.classList.add("humata-theme-light"))}function nt(){let t=document.documentElement.classList.contains("humata-theme-dark")?"light":"dark";localStorage.setItem(de,t),he(t)}function X(){return h.turnstile&&h.turnstile.enabled&&h.turnstile.siteKey}function xe(){return X()?sessionStorage.getItem(Y)==="true":!0}function ot(){sessionStorage.setItem(Y,"true")}function Ce(){return new Promise(function(e,t){if(window.turnstile){J=!0,e();return}let n=document.createElement("script");n.src="https://challenges.cloudflare.com/turnstile/v0/api.js?onload=onTurnstileLoad",n.async=!0,n.defer=!0,window.onTurnstileLoad=function(){J=!0,e()},n.onerror=function(){t(new Error("Failed to load Turnstile script"))},document.head.appendChild(n)})}function st(){return new Promise(function(e,t){if(xe()){e(null);return}let n=document.getElementById("humata-turnstile-container");if(!n){e(null);return}Ce().then(function(){if(console.log("Turnstile script loaded, preparing to render widget"),k!==null&&window.turnstile){try{window.turnstile.remove(k)}catch(s){}k=null}n.innerHTML='<div id="humata-turnstile-widget"></div>',n.style.display="flex";let o=document.getElementById("humata-turnstile-widget");console.log("Turnstile container visible, widget container:",o),setTimeout(function(){try{k=window.turnstile.render(o,{sitekey:h.turnstile.siteKey,appearance:h.turnstile.appearance||"managed",theme:document.documentElement.classList.contains("humata-theme-dark")?"dark":"light",size:"normal",callback:function(s){S=s,n.style.display="none",n.innerHTML="",e(s)},"error-callback":function(s){console.error("Turnstile error:",s),n.style.display="none",n.innerHTML="",t(new Error("Turnstile verification failed: "+(s||"unknown")))},"expired-callback":function(){S=null}}),setTimeout(function(){o.querySelector("iframe")||(n.style.display="none")},100)}catch(s){console.error("Turnstile render error:",s),n.style.display="none",n.innerHTML="",t(s)}},50)}).catch(function(o){console.error("Turnstile script load error:",o),t(o)})})}function rt(){X()&&Ce().catch(function(){})}function it(){r.sendButton&&r.sendButton.addEventListener("click",Re),r.input&&(r.input.addEventListener("keydown",ht),r.input.addEventListener("input",qe)),r.scrollToggle&&r.scrollToggle.addEventListener("click",mt),b&&r.messages?r.messages.addEventListener("scroll",F,{passive:!0}):window.addEventListener("scroll",F,{passive:!0}),r.messages&&r.messages.addEventListener("click",ut),r.clearButton&&r.clearButton.addEventListener("click",Dt),r.exportPdfButton&&r.exportPdfButton.addEventListener("click",Pt),r.themeToggle&&r.themeToggle.addEventListener("click",nt),lt(),at()}function at(){let e=document.getElementById("humata-medical-disclaimer-link"),t=document.getElementById("humata-medical-disclaimer-modal");!e||!t||(e.addEventListener("click",function(n){n.preventDefault(),Ae(t,e)}),t.addEventListener("click",function(n){n.target.closest("[data-humata-disclaimer-close]")&&(n.preventDefault(),ge(t))}))}function lt(){document.addEventListener("click",function(e){let t=e.target.closest("[data-humata-page-modal]");if(!t)return;e.preventDefault();let n=t.getAttribute("data-humata-page-modal"),o=document.getElementById("humata-page-modal-"+n);o&&Ae(o,t)}),document.addEventListener("click",function(e){let t=e.target.closest("[data-humata-page-close-modal]");if(!t)return;let n=t.closest(".humata-help-modal");n&&(e.preventDefault(),ge(n))}),document.addEventListener("keydown",function(e){if(e.key!=="Escape")return;let t=document.querySelector(".humata-help-modal.is-open");t&&(e.preventDefault(),ge(t))})}let R=null;function Ae(e,t){R=t||document.activeElement,e.hidden=!1,e.classList.add("is-open"),e.setAttribute("aria-hidden","false"),document.documentElement.classList.add("humata-help-modal-open"),document.body.classList.add("humata-help-modal-open");let n=e.querySelector(".humata-help-modal__close");if(n)try{n.focus({preventScroll:!0})}catch(o){n.focus()}}function ge(e){if(e.classList.remove("is-open"),e.setAttribute("aria-hidden","true"),e.hidden=!0,document.documentElement.classList.remove("humata-help-modal-open"),document.body.classList.remove("humata-help-modal-open"),R&&typeof R.focus=="function")try{R.focus({preventScroll:!0})}catch(t){R.focus()}R=null}function ct(){let e=parseInt(h.maxPromptChars,10);if(Number.isFinite(e)&&e>0)return e;if(r.input){let t=parseInt(r.input.getAttribute("maxlength"),10);if(Number.isFinite(t)&&t>0)return t}return 3e3}function Z(){if(!r.input||!r.inputCounter)return;let e=(r.input.value||"").length,t=p||3e3;r.inputCounter.textContent=e+"/"+t,r.inputCounter.classList.toggle("humata-input-counter-over",e>t)}function ut(e){let t=e.target.closest(".humata-regenerate-button");if(t){let l=t.closest(".humata-message");if(!l||g||w)return;let i=l.previousElementSibling;for(;i&&!i.classList.contains("humata-message-user");)i=i.previousElementSibling;if(!i)return;let a=i.querySelector(".humata-message-content");if(!a)return;let u=D(a);if(!u)return;let d=Ne(i);Ie(i),ue(),ce(u,d);return}let n=e.target.closest(".humata-copy-button");if(n){let l=n.closest(".humata-message");if(!l)return;let i=l.querySelector(".humata-message-content");if(!i)return;let a=bt(i);if(!a||!a.text&&!a.html)return;St(a).then(function(){Lt(n)}).catch(function(){kt(n)});return}let o=e.target.closest(".humata-edit-button");if(o){let l=o.closest(".humata-message");if(!l||g)return;dt(l);return}if(e.target.closest(".humata-edit-cancel")){ee();return}e.target.closest(".humata-edit-save")&&He()}function fe(e){if(r.input){if(r.input.disabled=!e,r.sendButton)if(!e)r.sendButton.disabled=!0;else{let t=r.input.value||"";r.sendButton.disabled=!t.trim()||t.length>p}Z()}}function dt(e){var i,a,u,d;if(!e||!e.classList.contains("humata-message-user"))return;let t=e.querySelector(".humata-message-content");if(!t||w&&w.messageEl===e)return;ee();let n=D(t);if(!n)return;w={messageEl:e,contentEl:t,originalText:n},e.classList.add("humata-message-editing"),t.classList.add("humata-message-content-editing"),t.textContent="";let o=document.createElement("textarea");o.className="humata-edit-textarea",o.value=n,o.rows=1,o.maxLength=p;let s=document.createElement("div");s.className="humata-edit-actions";let c=document.createElement("button");c.type="button",c.className="humata-edit-cancel",c.innerHTML=Mt(),c.setAttribute("title",((i=h.i18n)==null?void 0:i.cancel)||"Cancel"),c.setAttribute("aria-label",((a=h.i18n)==null?void 0:a.cancel)||"Cancel");let l=document.createElement("button");l.type="button",l.className="humata-edit-save",l.innerHTML=Ye(),l.setAttribute("title",((u=h.i18n)==null?void 0:u.save)||"Save"),l.setAttribute("aria-label",((d=h.i18n)==null?void 0:d.save)||"Save"),s.appendChild(c),s.appendChild(l),t.appendChild(o),t.appendChild(s),fe(!1),o.addEventListener("input",function(){Me(o)}),o.addEventListener("keydown",function(m){if(m.key==="Escape"){m.preventDefault(),ee();return}m.key==="Enter"&&(m.ctrlKey||m.metaKey)&&(m.preventDefault(),He())}),requestAnimationFrame(function(){Me(o),o.focus(),o.setSelectionRange(o.value.length,o.value.length)})}function Me(e){if(!e)return;e.style.height="auto";let n=(parseInt(getComputedStyle(e).lineHeight)||24)*8,o=Math.min(e.scrollHeight,n);e.style.height=o+"px",Z()}function ee(){w&&(Be(w.messageEl,w.originalText),w=null,fe(!0),r.input&&r.input.focus())}function He(){var s;if(!w||g)return;let e=w.contentEl.querySelector(".humata-edit-textarea");if(!e){ee();return}let t=e.value,n=t.trim();if(!n){e.focus();return}if(t.length>p){let c=((s=h.i18n)==null?void 0:s.errorPromptTooLong)||"Message is too long. Maximum is "+p+" characters.";B(c,"bot",!0),e.focus();return}let o=Ne(w.messageEl);Be(w.messageEl,n),Ie(w.messageEl),w=null,fe(!0),ue(),ce(n,o)}function Be(e,t){if(!e)return;let n=e.querySelector(".humata-message-content");n&&(e.classList.remove("humata-message-editing"),n.classList.remove("humata-message-content-editing"),n.innerHTML="",n.textContent=t,P(n),ve(n))}function Ie(e){if(!r.messages||!e)return;Te();let t=e.nextSibling;for(;t;){let n=t.nextSibling;t.nodeType===1&&t.remove(),t=n}}function Ne(e){if(!r.messages)return[];let t=[],n=r.messages.querySelectorAll(".humata-message:not(#humata-welcome-message):not(.humata-message-loading)");for(let o=0;o<n.length;o++){let s=n[o];if(s===e)break;let c=s.classList.contains("humata-message-user");if(s.classList.contains("humata-message-error"))continue;let i=s.querySelector(".humata-message-content");if(!i)continue;let a=D(i);a&&t.push({type:c?"user":"bot",content:a})}return t}function F(){if(!r.scrollToggle)return;let e,t,n;b&&r.messages?(e=r.messages.scrollHeight,t=r.messages.clientHeight,n=r.messages.scrollTop):(e=document.documentElement.scrollHeight,t=window.innerHeight,n=window.scrollY||document.documentElement.scrollTop);let o=e-t;if(o<=50){r.scrollToggle.style.display="none";return}r.scrollToggle.style.display="";let s=e-(n+t),c=o*.3,l=s<=c;r.scrollToggle.classList.toggle("humata-scroll-toggle-top",l);let i=r.scrollToggle.getAttribute("data-label-top")||"Scroll to top",a=r.scrollToggle.getAttribute("data-label-bottom")||"Scroll to bottom",u=l?i:a;r.scrollToggle.setAttribute("title",u),r.scrollToggle.setAttribute("aria-label",u)}function mt(){if(!r.scrollToggle)return;let e=r.scrollToggle.classList.contains("humata-scroll-toggle-top");if(b&&r.messages){let t=e?0:r.messages.scrollHeight;r.messages.scrollTo({top:t,behavior:"smooth"})}else{let t=e?0:document.documentElement.scrollHeight;window.scrollTo({top:t,behavior:"smooth"})}}function qe(){let e=r.input;e.style.height="auto";let n=(parseInt(getComputedStyle(e).lineHeight)||24)*5,o=Math.min(e.scrollHeight,n);e.style.height=o+"px";let s=e.value.length>p;Z(),r.sendButton&&(r.sendButton.disabled=!e.value.trim()||s)}function ht(e){e.key==="Enter"&&!e.shiftKey&&(e.preventDefault(),Re())}function Re(){var o;let e=r.input.value,t=e.trim();if(!t||g)return;if(me(),e.length>p){let s=((o=h.i18n)==null?void 0:o.errorPromptTooLong)||"Message is too long. Maximum is "+p+" characters.";B(s,"bot",!0),r.input&&r.input.focus();return}let n=Fe();ae=t,B(t,"user"),r.input.value="",r.input.style.height="auto",r.sendButton&&(r.sendButton.disabled=!0),Z(),ce(t,n)}function Fe(){if(!r.messages)return[];let e=[];return r.messages.querySelectorAll(".humata-message:not(#humata-welcome-message):not(.humata-message-loading)").forEach(function(n){let o=n.classList.contains("humata-message-user");if(n.classList.contains("humata-message-error"))return;let c=n.querySelector(".humata-message-content");if(!c)return;let l=D(c);l&&e.push({type:o?"user":"bot",content:l})}),e}function gt(){let e=document.querySelector(".humata-trigger-pages");e&&!e.classList.contains("humata-trigger-pages--hidden")&&e.classList.add("humata-trigger-pages--hidden")}function B(e,t,n=!1){r.welcomeMessage&&(r.welcomeMessage.style.display="none"),t==="user"&&gt();let o=document.createElement("div");o.className="humata-message humata-message-"+t,n&&o.classList.add("humata-message-error");let s=document.createElement("div");s.className="humata-message-avatar",$(s,t);let c=document.createElement("div");return c.className="humata-message-content",t==="bot"&&!n?c.innerHTML=ft(e):c.textContent=e,P(c),t==="bot"&&Ue(c),t==="user"&&!n&&ve(c),o.appendChild(s),o.appendChild(c),r.messages.appendChild(o),t==="bot"&&!n&&$e(),le(),ue(),o}function ft(e){if(!e)return"";let t=O(String(e).replace(/\r\n?/g,`
`)),n=[];t=t.replace(/```([a-zA-Z0-9_-]*)\n?([\s\S]*?)```/g,function(s,c,l){let i="%%HUMATA_CODEBLOCK_"+n.length+"%%",a=yt(c||"plaintext");return n.push('<pre><code class="language-'+a+'">'+l.trim()+"</code></pre>"),`
`+i+`
`});let o=je(t);return o=pt(o),o=o.replace(/%%HUMATA_CODEBLOCK_(\d+)%%/g,function(s,c){let l=parseInt(c,10);return Number.isFinite(l)&&n[l]?n[l]:""}),o}function pt(e){if(!e||typeof e!="string")return e;let t=/<\/ol>(\s*(?:<p>[\s\S]*?<\/p>|<ul>[\s\S]*?<\/ul>|<blockquote>[\s\S]*?<\/blockquote>|<hr>)+\s*)<ol>/g,n=e,o="";for(;n!==o;)o=n,n=n.replace(t,function(s,c){return c+"</ol><ol>"});return n=n.replace(/<\/ol>\s*<ol>/g,""),n}let te=null;function _e(e){return e==null?"":(te||(te=document.createElement("textarea")),te.innerHTML=String(e),te.value)}function yt(e){return String(e||"").toLowerCase().replace(/[^\w-]+/g,"")||"plaintext"}function Pe(e){if(!e)return"";let t=_e(String(e)).trim();if(!t)return"";let n=t.replace(/[\u0000-\u001F\u007F\s]+/g,"");if(!n)return"";if(n.startsWith("#")||n.startsWith("/")||n.startsWith("./")||n.startsWith("../")||n.startsWith("?")||n.startsWith("//"))return O(t);let o=n.match(/^([a-zA-Z][a-zA-Z0-9+.-]*):/);if(o){let s=(o[1]||"").toLowerCase();if(!(s==="http"||s==="https"||s==="mailto"||s==="tel"))return""}return O(t)}let ne=null;function oe(e){return!!e&&/[A-Za-z0-9]/.test(e)}function vt(){if(ne!==null)return ne;let e=Array.isArray(h.autoLinks)?h.autoLinks:[],t=[];for(let n=0;n<e.length;n++){let o=e[n];if(!o||typeof o!="object")continue;let s=String(o.phrase||"").trim(),c=String(o.url||"").trim();if(!s||!c)continue;let l=Pe(c);if(l&&(t.push({phrase:s,phraseLower:s.toLowerCase(),href:_e(l),len:s.length,startsWord:oe(s.charAt(0)),endsWord:oe(s.charAt(s.length-1))}),t.length>=200))break}return t.sort(function(n,o){return o.len-n.len}),ne=t,ne}function wt(e,t){if(!e)return[];let n=String(e),o=n.toLowerCase(),s=[];function c(l,i){for(let a=0;a<s.length;a++){let u=s[a];if(l<u.end&&u.start<i)return!0}return!1}for(let l=0;l<t.length;l++){let i=t[l];if(!i||!i.phraseLower)continue;let a=0;for(;a=o.indexOf(i.phraseLower,a),a!==-1;){let u=a,d=a+i.phraseLower.length;if(i.startsWord){let m=u>0?n.charAt(u-1):"";if(m&&oe(m)){a=a+1;continue}}if(i.endsWord){let m=d<n.length?n.charAt(d):"";if(m&&oe(m)){a=a+1;continue}}c(u,d)||s.push({start:u,end:d,href:i.href}),a=d}}return s}function Et(e){if(!e)return e;let t=vt();if(!t||!t.length||typeof document=="undefined"||!document.createElement||!document.createTreeWalker||typeof NodeFilter=="undefined")return e;let n=document.createElement("div");try{n.innerHTML=String(e)}catch(l){return e}let o;try{o=document.createTreeWalker(n,NodeFilter.SHOW_TEXT,{acceptNode:function(l){let i=l&&l.nodeValue?String(l.nodeValue):"";if(!i||!i.trim())return NodeFilter.FILTER_REJECT;let a=l.parentNode;for(;a&&a!==n;){let u=a.nodeName;if(u==="A"||u==="CODE"||u==="PRE")return NodeFilter.FILTER_REJECT;a=a.parentNode}return NodeFilter.FILTER_ACCEPT}})}catch(l){return e}let s=[],c;for(;c=o.nextNode();)s.push(c);for(let l=0;l<s.length;l++){let i=s[l],a=i&&i.nodeValue?String(i.nodeValue):"";if(!a)continue;let u=wt(a,t);if(!u.length)continue;u.sort(function(x,f){return x.start-f.start});let d=document.createDocumentFragment(),m=0;for(let x=0;x<u.length;x++){let f=u[x];if(!f||f.start<m)continue;f.start>m&&d.appendChild(document.createTextNode(a.slice(m,f.start)));let E=document.createElement("a");E.setAttribute("href",f.href),E.setAttribute("target","_blank"),E.setAttribute("rel","noopener noreferrer"),E.textContent=a.slice(f.start,f.end),d.appendChild(E),m=f.end}m<a.length&&d.appendChild(document.createTextNode(a.slice(m))),i.parentNode&&i.parentNode.replaceChild(d,i)}return n.innerHTML}function _(e){return!e||/^\s*$/.test(e)}function De(e){return/^%%HUMATA_CODEBLOCK_\d+%%$/.test(String(e||"").trim())}function ze(e){return/^\s{0,3}(-{3,}|\*{3,})\s*$/.test(String(e||""))}function Oe(e){let t=String(e||"").match(/^\s{0,3}(#{1,6})\s+(.+?)\s*$/);return t?{level:t[1].length,text:t[2]}:null}function pe(e){return/^\s{0,3}>\s?/.test(String(e||""))}function Tt(e){return String(e||"").replace(/^\s{0,3}>\s?/,"")}function se(e){return/^\s{0,3}[-+*]\s+/.test(String(e||""))}function re(e){return/^\s{0,3}\d+\.\s+/.test(String(e||""))}function ie(e){if(!e)return"";let t=String(e),n=[];return t=t.replace(/`([^`]+)`/g,function(o,s){let c="%%HUMATA_CODESPAN_"+n.length+"%%";return n.push("<code>"+s+"</code>"),c}),t=t.replace(/\[([^\]]+)\]\(([^)]+)\)/g,function(o,s,c){let l=Pe(c);return l?'<a href="'+l+'" target="_blank" rel="noopener noreferrer">'+s+"</a>":s+" ("+c+")"}),t=t.replace(/\*\*([^*]+)\*\*/g,"<strong>$1</strong>"),t=t.replace(/(^|[^*])\*([^*\n]+)\*(?!\*)/g,"$1<em>$2</em>"),t=Et(t),t=t.replace(/%%HUMATA_CODESPAN_(\d+)%%/g,function(o,s){let c=parseInt(s,10);return Number.isFinite(c)&&n[c]?n[c]:o}),t}function je(e){if(!e)return"";let t=String(e).split(`
`),n=[],o=0;for(;o<t.length;){let s=t[o];if(_(s)){o++;continue}if(De(s)){n.push(String(s).trim()),o++;continue}if(ze(s)){n.push("<hr>"),o++;continue}let c=Oe(s);if(c){n.push("<h"+c.level+">"+ie(c.text)+"</h"+c.level+">"),o++;continue}if(pe(s)){let a=[];for(;o<t.length&&pe(t[o]);)a.push(Tt(t[o])),o++;n.push("<blockquote>"+je(a.join(`
`))+"</blockquote>");continue}if(se(s)){let a=[];for(;o<t.length;){let u=t[o];if(_(u)){let m=o+1;for(;m<t.length&&_(t[m]);)m++;if(m<t.length&&se(t[m])){o=m;continue}break}if(!se(u))break;let d=String(u).replace(/^\s{0,3}[-+*]\s+/,"");a.push("<li>"+ie(d)+"</li>"),o++}n.push("<ul>"+a.join("")+"</ul>");continue}if(re(s)){let a=[];for(;o<t.length;){let u=t[o];if(_(u)){let m=o+1;for(;m<t.length&&_(t[m]);)m++;if(m<t.length&&re(t[m])){o=m;continue}break}if(!re(u))break;let d=String(u).replace(/^\s{0,3}\d+\.\s+/,"");a.push("<li>"+ie(d)+"</li>"),o++}n.push("<ol>"+a.join("")+"</ol>");continue}let l=[];for(;o<t.length;){let a=t[o];if(_(a)||De(a)||ze(a)||Oe(a)||pe(a)||se(a)||re(a))break;l.push(String(a).trim()),o++}let i=l.join(" ").trim();i&&n.push("<p>"+ie(i)+"</p>")}return n.join("")}function O(e){let t=document.createElement("div");return t.textContent=e,t.innerHTML}function ye(e){if(!e)return null;let t=e.querySelector(".humata-message-actions");return t||(t=document.createElement("div"),t.className="humata-message-actions",e.appendChild(t),t)}function P(e){if(!e||e.querySelector(".humata-copy-button"))return;e.classList.add("humata-message-content-has-copy");let t=document.createElement("button");t.type="button",t.className="humata-copy-button",t.innerHTML=xt(),t.setAttribute("title","Copy"),t.setAttribute("aria-label","Copy message");let n=ye(e);n&&n.appendChild(t)}function Ue(e){var o,s;if(!e||e.querySelector(".humata-regenerate-button"))return;e.classList.add("humata-message-content-has-regenerate");let t=document.createElement("button");t.type="button",t.className="humata-regenerate-button",t.innerHTML=At(),t.setAttribute("title",((o=h.i18n)==null?void 0:o.regenerate)||"Regenerate"),t.setAttribute("aria-label",((s=h.i18n)==null?void 0:s.regenerate)||"Regenerate");let n=ye(e);n&&n.appendChild(t)}function ve(e){var o,s;if(!e||e.querySelector(".humata-edit-button"))return;e.classList.add("humata-message-content-has-edit");let t=document.createElement("button");t.type="button",t.className="humata-edit-button",t.innerHTML=Ct(),t.setAttribute("title",((o=h.i18n)==null?void 0:o.editMessage)||"Edit message"),t.setAttribute("aria-label",((s=h.i18n)==null?void 0:s.editMessage)||"Edit message");let n=ye(e);n&&n.appendChild(t)}function D(e){let t=e?e.querySelector(".humata-edit-textarea"):null;if(t)return(t.value||"").trim();let n=e.cloneNode(!0);return n.querySelectorAll(".humata-copy-button").forEach(function(o){o.remove()}),n.querySelectorAll(".humata-regenerate-button").forEach(function(o){o.remove()}),n.querySelectorAll(".humata-edit-button").forEach(function(o){o.remove()}),n.querySelectorAll(".humata-edit-actions").forEach(function(o){o.remove()}),n.querySelectorAll(".humata-message-actions").forEach(function(o){o.remove()}),n.querySelectorAll(".humata-bot-response-disclaimer").forEach(function(o){o.remove()}),n.querySelectorAll(".humata-intent-links").forEach(function(o){o.remove()}),n.querySelectorAll(".humata-accordions").forEach(function(o){o.remove()}),((n.innerText||n.textContent||"")+"").trim()}function we(e){let t=e.cloneNode(!0);return t.querySelectorAll(".humata-copy-button").forEach(function(n){n.remove()}),t.querySelectorAll(".humata-regenerate-button").forEach(function(n){n.remove()}),t.querySelectorAll(".humata-edit-button").forEach(function(n){n.remove()}),t.querySelectorAll(".humata-edit-actions").forEach(function(n){n.remove()}),t.querySelectorAll(".humata-message-actions").forEach(function(n){n.remove()}),t.querySelectorAll(".humata-bot-response-disclaimer").forEach(function(n){n.remove()}),t.querySelectorAll(".humata-intent-links").forEach(function(n){n.remove()}),t.querySelectorAll(".humata-accordions").forEach(function(n){n.remove()}),t.innerHTML}function bt(e){let t=e?e.querySelector(".humata-edit-textarea"):null;if(t){let o=(t.value||"").trim();return{text:o,html:o?"<div>"+O(o).replace(/\n/g,"<br>")+"</div>":""}}let n=e?we(e):"";return n?{text:We(n),html:"<div>"+n+"</div>"}:{text:"",html:""}}function We(e){if(!e)return"";let t=document.createElement("div");t.innerHTML=e;let n=Ee(t,{listStack:[]});return String(n||"").replace(/\r\n?/g,`
`).replace(/[ \t]+\n/g,`
`).replace(/\n{3,}/g,`

`).trim()}function Ee(e,t){if(!e)return"";let n=e.nodeType;if(n===3)return e.nodeValue||"";if(n!==1)return"";let o=(e.tagName||"").toLowerCase();function s(){let i="",a=e.childNodes||[];for(let u=0;u<a.length;u++)i+=Ee(a[u],t);return i}function c(i){return i?i.endsWith(`
`)?i:i+`
`:`
`}function l(i){let a=c(i);return a.endsWith(`

`)||(a+=`
`),a}if(o==="br")return`
`;if(o==="hr")return`

`;if(o==="pre"){let i=e.textContent||"";return l(i.replace(/\n$/,""))}if(o==="p"||o==="div"||o==="section"){let i=s().trim();return i?l(i):""}if(o==="blockquote"){let i=s().trim();return i?l(i):""}if(/^h[1-6]$/.test(o)){let i=s().trim();return i?l(i):""}if(o==="ul"||o==="ol"){t.listStack.push({type:o,index:0});let i="",a=e.childNodes||[];for(let u=0;u<a.length;u++)i+=Ee(a[u],t);return t.listStack.pop(),l(i.trim())}if(o==="li"){let i=t.listStack||[],a=i.length?i[i.length-1]:null,u="- ";a&&a.type==="ol"?(a.index+=1,u=String(a.index)+". "):a&&a.type==="ul"&&(u="\u2022 ");let d=i.length>1?"  ".repeat(i.length-1):"",m=s().trim();return m?d+u+m+`
`:""}return s()}function St(e){if(e==null)return Promise.reject(new Error("Nothing to copy"));if(typeof e=="string")return Ke(e);let t=String(e.text||""),n=String(e.html||"");if(n&&navigator.clipboard&&navigator.clipboard.write&&typeof ClipboardItem!="undefined")try{let o=new ClipboardItem({"text/plain":new Blob([t],{type:"text/plain"}),"text/html":new Blob([n],{type:"text/html"})});return navigator.clipboard.write([o]).catch(function(){return Ve(n)})}catch(o){}return n?Ve(n):Ke(t)}function Ve(e){return new Promise(function(t,n){try{let o=document.createElement("div");o.setAttribute("aria-hidden","true"),o.style.position="fixed",o.style.left="-9999px",o.style.top="0",o.style.width="1px",o.style.height="1px",o.style.overflow="hidden",o.innerHTML=e,document.body.appendChild(o);let s=window.getSelection?window.getSelection():null,c=[];if(s&&s.rangeCount)for(let i=0;i<s.rangeCount;i++)c.push(s.getRangeAt(i).cloneRange());if(s){let i=document.createRange();i.selectNodeContents(o),s.removeAllRanges(),s.addRange(i)}let l=document.execCommand("copy");if(s){s.removeAllRanges();for(let i=0;i<c.length;i++)s.addRange(c[i])}o.remove(),l?t():n(new Error("Copy failed"))}catch(o){n(o)}})}function Ke(e){return navigator.clipboard&&navigator.clipboard.writeText?navigator.clipboard.writeText(e).catch(function(){return Qe(e)}):Qe(e)}function Qe(e){return new Promise(function(t,n){try{let o=document.createElement("textarea");o.value=String(e||""),o.setAttribute("readonly",""),o.style.position="fixed",o.style.top="-9999px",o.style.left="-9999px",document.body.appendChild(o),o.select(),o.setSelectionRange(0,o.value.length);let s=document.execCommand("copy");o.remove(),s?t():n(new Error("Copy failed"))}catch(o){n(o)}})}function Lt(e){e&&(e.dataset.humataCopyDefault||(e.dataset.humataCopyDefault=e.innerHTML),e._humataCopyResetTimer&&clearTimeout(e._humataCopyResetTimer),e.innerHTML=Ye(),e.classList.add("humata-copy-button-success"),e.setAttribute("title","Copied"),e.setAttribute("aria-label","Copied"),e._humataCopyResetTimer=setTimeout(function(){e.innerHTML=e.dataset.humataCopyDefault,e.classList.remove("humata-copy-button-success"),e.setAttribute("title","Copy"),e.setAttribute("aria-label","Copy message")},1500))}function kt(e){e&&(e.setAttribute("title","Copy failed"),e.setAttribute("aria-label","Copy failed"),e._humataCopyResetTimer&&clearTimeout(e._humataCopyResetTimer),e._humataCopyResetTimer=setTimeout(function(){e.setAttribute("title","Copy"),e.setAttribute("aria-label","Copy message")},1500))}function xt(){return'<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"><rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect><path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path></svg>'}function Ct(){return'<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"><path d="M12 20h9"></path><path d="M16.5 3.5a2.121 2.121 0 0 1 3 3L7 19l-4 1 1-4Z"></path></svg>'}function At(){return'<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"><polyline points="23 4 23 10 17 10"></polyline><polyline points="1 20 1 14 7 14"></polyline><path d="M3.51 9a9 9 0 0 1 14.13-3.36L23 10"></path><path d="M1 14l5.36 5.36A9 9 0 0 0 20.49 15"></path></svg>'}function Ye(){return'<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"><path d="M20 6 9 17l-5-5"></path></svg>'}function Mt(){return'<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"><path d="M18 6 6 18"></path><path d="m6 6 12 12"></path></svg>'}function Ht(){let e=h.botResponseDisclaimer;if(!e||typeof e!="string"||!e.trim())return null;let t=document.getElementById("humata-bot-response-disclaimer");return t||(t=document.createElement("div"),t.id="humata-bot-response-disclaimer",t.className="humata-bot-response-disclaimer",t.innerHTML="<p>"+e+"</p>"),t}function $e(){let e=Ht();if(!e)return;if(!r.messages){e.remove();return}let t=r.messages.querySelectorAll(".humata-message-bot:not(.humata-message-error):not(.humata-message-loading):not(#humata-welcome-message)");if(!t.length){e.remove();return}let o=t[t.length-1].querySelector(".humata-message-content");if(!o){e.remove();return}o.appendChild(e)}function Bt(){let e=document.getElementById("humata-bot-response-disclaimer");e&&e.remove()}function Ge(e){return String(e||"").replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}function It(e){let t=h.intentLinks;if(!t||!Array.isArray(t)||!t.length)return[];if(!e||typeof e!="string")return[];let n=[],o=new Set;for(let s=0;s<t.length;s++){let c=t[s],l=c.keywords,i=c.links;if(!l||!Array.isArray(l)||!l.length||!i||!Array.isArray(i)||!i.length)continue;let a=!1;for(let u=0;u<l.length;u++){let d=l[u];if(!d)continue;if(new RegExp("\\b"+Ge(d)+"\\b","i").test(e)){a=!0;break}}if(a)for(let u=0;u<i.length;u++){let d=i[u];!d||!d.title||!d.url||o.has(d.url)||(o.add(d.url),n.push({title:d.title,url:d.url}))}}return n}function Nt(e){var s;if(!e||!e.length)return null;let t=document.createElement("div");t.className="humata-intent-links";let n=document.createElement("span");n.className="humata-intent-links-label",n.textContent=((s=h.i18n)==null?void 0:s.relatedResources)||"Related resources:",t.appendChild(n);let o=document.createElement("div");o.className="humata-intent-links-pills";for(let c=0;c<e.length;c++){let l=e[c],i=document.createElement("a");i.href=l.url,i.target="_blank",i.rel="noopener noreferrer",i.className="humata-intent-link",i.textContent=l.title,o.appendChild(i)}return t.appendChild(o),t}function qt(e){let t=h.intentLinks;if(!t||!Array.isArray(t)||!t.length)return[];if(!e||typeof e!="string")return[];let n=[],o=new Set;for(let s=0;s<t.length;s++){let c=t[s],l=c.keywords,i=c.accordions;if(!l||!Array.isArray(l)||!l.length||!i||!Array.isArray(i)||!i.length)continue;let a=!1;for(let u=0;u<l.length;u++){let d=l[u];if(!d)continue;if(new RegExp("\\b"+Ge(d)+"\\b","i").test(e)){a=!0;break}}if(a)for(let u=0;u<i.length;u++){let d=i[u];!d||!d.title||!d.content||o.has(d.title)||(o.add(d.title),n.push({title:d.title,content:d.content}))}}return n}function Rt(e){if(!e||!e.length)return null;let t=document.createElement("div");t.className="humata-accordions";for(let n=0;n<e.length;n++){let o=e[n],s=document.createElement("div");s.className="humata-accordion-item";let c=document.createElement("button");c.type="button",c.className="humata-accordion-toggle",c.innerHTML="<span>"+O(o.title)+'</span><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="6 9 12 15 18 9"></polyline></svg>',c.addEventListener("click",function(){s.classList.toggle("open")});let l=document.createElement("div");l.className="humata-accordion-content",l.innerHTML=o.content,s.appendChild(c),s.appendChild(l),t.appendChild(s)}return t}function Je(e,t){if(!e||!t)return;let n=e.querySelector(".humata-message-content");if(!n)return;let o=qt(t),s=It(t),c=Rt(o);if(c){e._humataIntentAccordions=o;let a=n.querySelector(".humata-message-actions");a?n.insertBefore(c,a):n.appendChild(c)}if(!s.length)return;let l=Nt(s);if(!l)return;e._humataIntentLinks=s;let i=n.querySelector(".humata-bot-response-disclaimer");i?n.insertBefore(l,i):n.appendChild(l)}let ae="";function Ft(){var c;Bt();let e=document.createElement("div");e.className="humata-message humata-message-bot humata-message-loading",e.id="humata-loading-indicator";let t=document.createElement("div");t.className="humata-message-avatar",$(t,"bot");let n=document.createElement("div");n.className="humata-message-content";let o=String(h.secondLlmProvider||"").toLowerCase(),s=o!==""&&o!=="none";if(s?n.innerHTML='<div class="humata-typing-indicator"><span></span><span></span><span></span></div><div class="humata-loading-status" aria-live="polite" aria-atomic="true"><span class="humata-loading-status-text"></span></div>':n.innerHTML='<div class="humata-typing-indicator"><span></span><span></span><span></span></div>',e.appendChild(t),e.appendChild(n),r.messages.appendChild(e),s){let l=n.querySelector(".humata-loading-status-text");if(l){let i=["Processing your question\u2026",((c=h.i18n)==null?void 0:c.thinking)||"Thinking\u2026","Reviewing for accuracy\u2026","Just a few moments more\u2026","Almost ready\u2026","Finalizing answer\u2026"],a=0;l.textContent=i[a],l.style.opacity="1",e._humataStatusTimer=setInterval(function(){a=(a+1)%i.length,l.style.opacity="0",e._humataStatusFadeTimer=setTimeout(function(){l.textContent=i[a],l.style.opacity="1"},180)},2e3)}}return le(),e}function Te(){let e=document.getElementById("humata-loading-indicator");e&&(e._humataStatusTimer&&clearInterval(e._humataStatusTimer),e._humataStatusFadeTimer&&clearTimeout(e._humataStatusFadeTimer),e.remove())}function le(){b&&r.messages?r.messages.scrollTop=r.messages.scrollHeight:window.scrollTo({top:document.documentElement.scrollHeight,behavior:"smooth"}),F()}function _t(e){if(!e){le();return}if(b&&r.messages){let t=r.messages.getBoundingClientRect(),o=e.getBoundingClientRect().top-t.top+r.messages.scrollTop;r.messages.scrollTo({top:o,behavior:"smooth"})}else{let t=e.getBoundingClientRect(),n=window.scrollY||document.documentElement.scrollTop,o=t.top+n-80;window.scrollTo({top:Math.max(0,o),behavior:"smooth"})}F()}async function ce(e,t=[]){var n,o,s,c,l,i,a,u;if(!g){g=!0;try{let d=null;if(X()&&!xe())try{d=await st()}catch(E){console.error("Turnstile error:",E),g=!1,B(((n=h.i18n)==null?void 0:n.errorTurnstile)||"Human verification failed. Please try again.","bot",!0);return}Ft();let m={"Content-Type":"application/json","X-WP-Nonce":h.wpNonce,"X-Humata-Nonce":h.nonce};d&&(m["X-Turnstile-Token"]=d);let x=await fetch(h.apiUrl,{method:"POST",credentials:"same-origin",headers:m,body:JSON.stringify({message:e,history:t})});Te();let f=await x.json();if(!x.ok){let E=((o=h.i18n)==null?void 0:o.errorRequestFailed)||"Your message request failed. Try again. If problem persists, please contact us.",A=((s=h.i18n)==null?void 0:s.errorGeneric)||"An error occurred. Please try again.";x.status===429?A=((c=h.i18n)==null?void 0:c.errorRateLimit)||"Too many requests. Please wait a moment.":f&&f.code==="turnstile_required"?(sessionStorage.removeItem(Y),S=null,A=((l=h.i18n)==null?void 0:l.errorTurnstileRequired)||"Please complete the human verification to continue."):f&&f.code==="turnstile_failed"?(sessionStorage.removeItem(Y),S=null,A=((i=h.i18n)==null?void 0:i.errorTurnstileFailed)||"Human verification failed. Please try again."):f&&typeof f.message=="string"&&f.message.trim()!==""?A=/\b(straico|humata|anthropic|claude)\b/i.test(f.message)?E:f.message:A=E,B(A,"bot",!0);return}if(X()&&d&&ot(),f.success&&f.answer){let E=B(f.answer,"bot");E&&ae&&(Je(E,ae),ue()),_t(E)}else B(((a=h.i18n)==null?void 0:a.errorGeneric)||"An error occurred. Please try again.","bot",!0)}catch(d){Te(),B(((u=h.i18n)==null?void 0:u.errorNetwork)||"Network error. Please check your connection.","bot",!0)}finally{g=!1,r.input.focus()}}}function Pt(){let e=r.exportPdfButton;e&&(e.disabled=!0);try{let m=function(){let y=String(d.getFullYear()),M=String(d.getMonth()+1).padStart(2,"0"),C=String(d.getDate()).padStart(2,"0"),H="chat-export-"+y+"-"+M+"-"+C;if(v){let T=String(v).replace(/[^\w-]+/g,"").slice(0,40);T&&(H+="-"+T)}return H+".pdf"},x=function(y){return String(y||"").replace(/\u00A0/g," ").replace(/[\u200B\u200C\u200D\uFEFF]/g,"").replace(/\u2022/g,"-").replace(/[\u2018\u2019]/g,"'").replace(/[\u201C\u201D]/g,'"').replace(/[\u2013\u2014]/g,"-").replace(/\u2026/g,"...").replace(/\r\n?/g,`
`).trim()},f=function(y,M,C){try{n.text(y,M,C)}catch(H){n.text(String(y||"").replace(/[^\x09\x0A\x0D\x20-\x7E]/g,"?"),M,C)}},t=window.jspdf&&window.jspdf.jsPDF?window.jspdf.jsPDF:window.jsPDF||null;if(!t)return;let n=new t({unit:"pt",format:"a4"}),o=n.internal.pageSize.getWidth?n.internal.pageSize.getWidth():n.internal.pageSize.width,s=n.internal.pageSize.getHeight?n.internal.pageSize.getHeight():n.internal.pageSize.height,c=40,l=40,i=o-c*2,a=14,u=l,d=new Date,E=document.querySelector(".humata-chat-title"),A=((E?E.textContent:"")||"Chat Export").trim();n.setFont("helvetica","bold"),n.setFontSize(16),f(A||"Chat Export",c,u),u+=22,n.setFont("helvetica","normal"),n.setFontSize(10),f(d.toLocaleString(),c,u),u+=24;let j=r.messages?r.messages.querySelectorAll(".humata-message:not(#humata-welcome-message):not(.humata-message-loading)"):[],U=[];j.forEach(function(y){let M=y.querySelector(".humata-message-content");if(!M)return;let C=y.classList.contains("humata-message-user"),H=y.classList.contains("humata-message-error"),T="";if(C)T=D(M);else{let V=we(M);T=We(V)}if(T=x(T),!T)return;let L=null;!C&&!H&&y._humataIntentLinks&&y._humataIntentLinks.length&&(L=y._humataIntentLinks);let N=null;!C&&!H&&y._humataIntentAccordions&&y._humataIntentAccordions.length&&(N=y._humataIntentAccordions),U.push({role:C?"You":"Assistant",text:T,isError:H,intentLinks:L,intentAccordions:N})});let W=new Set;if(!U.length){n.setFont("helvetica","normal"),n.setFontSize(12),f("No messages.",c,u),n.save(m());return}U.forEach(function(y){var H;n.setFont("helvetica","bold"),n.setFontSize(13);let M=y.role+(y.isError?" (error)":"")+":";u+a>s-l&&(n.addPage(),u=l),f(M,c,u),u+=a,n.setFont("helvetica","normal"),n.setFontSize(12);let C=n.splitTextToSize(y.text,i);for(let T=0;T<C.length;T++)u+a>s-l&&(n.addPage(),u=l),f(C[T],c,u),u+=a;if(y.intentAccordions&&y.intentAccordions.length){let T=y.intentAccordions.filter(function(L){return W.has(L.title)?!1:(W.add(L.title),!0)});if(T.length){u+=4;for(let L=0;L<T.length;L++){let N=T[L];n.setFont("helvetica","bold"),n.setFontSize(11),u+a>s-l&&(n.addPage(),u=l),f("\u25B8 "+N.title,c,u),u+=a,n.setFont("helvetica","normal"),n.setFontSize(11);let V=N.content.replace(/<br\s*\/?>/gi,`
`).replace(/<\/p>/gi,`
`).replace(/<[^>]+>/g,"").replace(/&nbsp;/g," ").replace(/&amp;/g,"&").replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&quot;/g,'"').trim(),K=n.splitTextToSize(V,i-10);for(let q=0;q<K.length;q++)u+a>s-l&&(n.addPage(),u=l),f("  "+K[q],c,u),u+=a;u+=2}}}if(y.intentLinks&&y.intentLinks.length){u+=4,n.setFont("helvetica","italic"),n.setFontSize(11);let T=((H=h.i18n)==null?void 0:H.relatedResources)||"Related resources:";u+a>s-l&&(n.addPage(),u=l),f(T,c,u),u+=a,n.setFont("helvetica","normal");for(let L=0;L<y.intentLinks.length;L++){let N=y.intentLinks[L],V="\u2022 "+N.title+" - "+N.url,K=n.splitTextToSize(V,i);for(let q=0;q<K.length;q++)u+a>s-l&&(n.addPage(),u=l),f(K[q],c,u),u+=a}}u+=a}),n.save(m())}catch(t){console.error(t)}finally{e&&(e.disabled=!1)}}function Dt(){var e;if(r.messages&&(r.messages.innerHTML=""),r.welcomeMessage)r.welcomeMessage.style.display="",r.messages.appendChild(r.welcomeMessage),P(r.welcomeMessage.querySelector(".humata-message-content"));else{let t=document.createElement("div");t.id="humata-welcome-message",t.className="humata-message humata-message-bot";let n=document.createElement("div");n.className="humata-message-avatar",$(n,"bot");let o=document.createElement("div");o.className="humata-message-content",o.innerHTML="<p>"+(((e=h.i18n)==null?void 0:e.welcome)||"Hello! I'm here to help answer your questions. What would you like to know?")+"</p>",t.appendChild(n),t.appendChild(o),r.messages.appendChild(t),r.welcomeMessage=t,P(o)}localStorage.removeItem(Q),localStorage.removeItem(be),v=null,r.input&&r.input.focus(),ke()}function ue(){if(!r.messages)return;let e=[],t=r.messages.querySelectorAll(".humata-message:not(#humata-welcome-message):not(.humata-message-loading)"),n="";t.forEach(function(o){let s=o.classList.contains("humata-message-user"),c=o.classList.contains("humata-message-error"),l=o.querySelector(".humata-message-content");if(l){let i={type:s?"user":"bot",content:s?D(l):we(l),isError:c};s?n=i.content:i.triggerUserMessage=n,e.push(i)}});try{localStorage.setItem(Q,JSON.stringify(e))}catch(o){}}function zt(){try{let e=localStorage.getItem(Q);if(!e)return;let t=JSON.parse(e);if(!Array.isArray(t)||t.length===0)return;r.welcomeMessage&&(r.welcomeMessage.style.display="none"),t.forEach(function(n){let o=document.createElement("div");o.className="humata-message humata-message-"+n.type,n.isError&&o.classList.add("humata-message-error");let s=document.createElement("div");s.className="humata-message-avatar",$(s,n.type);let c=document.createElement("div");c.className="humata-message-content",n.type==="user"?c.textContent=n.content:c.innerHTML=n.content,P(c),n.type==="bot"&&Ue(c),n.type==="user"&&!n.isError&&ve(c),o.appendChild(s),o.appendChild(c),r.messages.appendChild(o),n.type==="bot"&&!n.isError&&n.triggerUserMessage&&Je(o,n.triggerUserMessage)}),v=localStorage.getItem(be),$e(),le()}catch(e){localStorage.removeItem(Q)}}document.readyState==="loading"?document.addEventListener("DOMContentLoaded",Le):Le()})();})();
//# sourceMappingURL=chat-widget.js.map
