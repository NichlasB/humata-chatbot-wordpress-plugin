{
  "version": 3,
  "sources": ["../src/chat-widget/config.js", "../src/chat-widget/avatars.js", "../src/chat-widget/suggested-questions.js", "../src/chat-widget/follow-up-questions.js", "../src/chat-widget/bot-protection.js", "../src/chat-widget/main.js"],
  "sourcesContent": ["// Shared config/constants for the chat widget bundle.\r\nexport const config = window.humataConfig || {};\r\n\r\nexport const STORAGE_KEY = 'humata_chat_history';\r\nexport const CONVERSATION_KEY = 'humata_conversation_id';\r\nexport const THEME_KEY = 'humata_theme_preference';\r\nexport const POW_VERIFIED_KEY = 'humata_pow_verified';\r\n\r\n\r\n", "import { config } from './config.js';\r\n\r\n// Default SVG icons for avatars.\r\nconst DEFAULT_USER_AVATAR_SVG =\r\n  '<svg xmlns=\"http://www.w3.org/2000/svg\" width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"1.5\" stroke-linecap=\"round\" stroke-linejoin=\"round\"><path d=\"M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2\"></path><circle cx=\"12\" cy=\"7\" r=\"4\"></circle></svg>';\r\n\r\nconst DEFAULT_BOT_AVATAR_SVG =\r\n  '<svg xmlns=\"http://www.w3.org/2000/svg\" width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"1.5\" stroke-linecap=\"round\" stroke-linejoin=\"round\"><path d=\"M12 8V4H8\"></path><rect width=\"16\" height=\"12\" x=\"4\" y=\"8\" rx=\"2\"></rect><path d=\"M2 14h2\"></path><path d=\"M20 14h2\"></path><path d=\"M15 13v2\"></path><path d=\"M9 13v2\"></path></svg>';\r\n\r\n/**\r\n * Set avatar content for a message avatar element.\r\n *\r\n * @param {HTMLElement} avatarDiv - The avatar container element.\r\n * @param {string} type - 'user' or 'bot'.\r\n */\r\nexport function setAvatarContent(avatarDiv, type) {\r\n  const avatarUrl = type === 'user' ? config.userAvatarUrl : config.botAvatarUrl;\r\n\r\n  if (avatarUrl && avatarUrl.length > 0) {\r\n    // Custom image avatar\r\n    const img = document.createElement('img');\r\n    img.src = avatarUrl;\r\n    img.alt = type === 'user' ? 'User' : 'Bot';\r\n    img.className = 'humata-avatar-img';\r\n    avatarDiv.innerHTML = '';\r\n    avatarDiv.appendChild(img);\r\n  } else {\r\n    // Default SVG icon\r\n    avatarDiv.innerHTML = type === 'user' ? DEFAULT_USER_AVATAR_SVG : DEFAULT_BOT_AVATAR_SVG;\r\n  }\r\n}\r\n\r\n\r\n", "/**\r\n * Suggested Questions Module\r\n *\r\n * Handles rendering and interaction of suggested question prompts.\r\n *\r\n * @package Humata_Chatbot\r\n * @since 1.0.0\r\n */\r\n\r\nimport { config } from './config.js';\r\n\r\nlet suggestedQuestionsContainer = null;\r\nlet onQuestionClick = null;\r\n\r\n/**\r\n * Initialize suggested questions.\r\n *\r\n * @param {Function} clickHandler Callback when a question is clicked.\r\n */\r\nexport function initSuggestedQuestions(clickHandler) {\r\n    suggestedQuestionsContainer = document.getElementById('humata-suggested-questions');\r\n    onQuestionClick = clickHandler;\r\n\r\n    if (!suggestedQuestionsContainer) {\r\n        return;\r\n    }\r\n\r\n    const sqConfig = config.suggestedQuestions;\r\n    if (!sqConfig || !sqConfig.enabled) {\r\n        return;\r\n    }\r\n\r\n    const questions = getQuestionsToDisplay(sqConfig);\r\n    if (questions.length === 0) {\r\n        return;\r\n    }\r\n\r\n    renderSuggestedQuestions(questions);\r\n}\r\n\r\n/**\r\n * Get questions to display based on mode.\r\n *\r\n * @param {Object} sqConfig Suggested questions configuration.\r\n * @returns {Array} Array of question strings.\r\n */\r\nfunction getQuestionsToDisplay(sqConfig) {\r\n    if (sqConfig.mode === 'fixed') {\r\n        return getFixedQuestions(sqConfig.fixedQuestions || []);\r\n    } else if (sqConfig.mode === 'randomized') {\r\n        return getRandomizedQuestions(sqConfig.categories || []);\r\n    }\r\n    return [];\r\n}\r\n\r\n/**\r\n * Get fixed mode questions (already ordered).\r\n *\r\n * @param {Array} fixedQuestions Array of question objects with text property.\r\n * @returns {Array} Array of question strings.\r\n */\r\nfunction getFixedQuestions(fixedQuestions) {\r\n    return fixedQuestions\r\n        .filter(q => q && q.text && q.text.trim() !== '')\r\n        .slice(0, 4)\r\n        .map(q => q.text);\r\n}\r\n\r\n/**\r\n * Get randomized questions from categories.\r\n *\r\n * Distribution:\r\n * - 1 category: all 4 slots\r\n * - 2 categories: 2 slots each\r\n * - 3 categories: one random category gets 2 slots\r\n * - 4 categories: 1 slot each\r\n *\r\n * @param {Array} categories Array of category objects.\r\n * @returns {Array} Array of question strings (max 4).\r\n */\r\nfunction getRandomizedQuestions(categories) {\r\n    const validCategories = categories.filter(\r\n        cat => cat && cat.questions && cat.questions.length > 0\r\n    );\r\n\r\n    if (validCategories.length === 0) {\r\n        return [];\r\n    }\r\n\r\n    const slots = [];\r\n    const numCategories = validCategories.length;\r\n\r\n    if (numCategories === 1) {\r\n        // 1 category gets all 4 slots\r\n        const cat = validCategories[0];\r\n        const shuffled = shuffle([...cat.questions]);\r\n        for (let i = 0; i < 4 && i < shuffled.length; i++) {\r\n            slots.push(shuffled[i]);\r\n        }\r\n    } else if (numCategories === 2) {\r\n        // 2 slots each\r\n        for (let i = 0; i < 2; i++) {\r\n            const cat = validCategories[i];\r\n            const shuffled = shuffle([...cat.questions]);\r\n            for (let j = 0; j < 2 && j < shuffled.length; j++) {\r\n                slots.push(shuffled[j]);\r\n            }\r\n        }\r\n    } else if (numCategories === 3) {\r\n        // One random category gets 2 slots, others get 1\r\n        const luckyIndex = Math.floor(Math.random() * 3);\r\n        for (let i = 0; i < 3; i++) {\r\n            const cat = validCategories[i];\r\n            const shuffled = shuffle([...cat.questions]);\r\n            const count = (i === luckyIndex) ? 2 : 1;\r\n            for (let j = 0; j < count && j < shuffled.length; j++) {\r\n                slots.push(shuffled[j]);\r\n            }\r\n        }\r\n    } else {\r\n        // 4+ categories: 1 slot each (use first 4)\r\n        for (let i = 0; i < 4 && i < validCategories.length; i++) {\r\n            const cat = validCategories[i];\r\n            const shuffled = shuffle([...cat.questions]);\r\n            if (shuffled.length > 0) {\r\n                slots.push(shuffled[0]);\r\n            }\r\n        }\r\n    }\r\n\r\n    // Shuffle final slots for variety in position\r\n    return shuffle(slots).slice(0, 4);\r\n}\r\n\r\n/**\r\n * Fisher-Yates shuffle.\r\n *\r\n * @param {Array} array Array to shuffle.\r\n * @returns {Array} Shuffled array.\r\n */\r\nfunction shuffle(array) {\r\n    for (let i = array.length - 1; i > 0; i--) {\r\n        const j = Math.floor(Math.random() * (i + 1));\r\n        [array[i], array[j]] = [array[j], array[i]];\r\n    }\r\n    return array;\r\n}\r\n\r\n/**\r\n * Render suggested questions in the container.\r\n *\r\n * @param {Array} questions Array of question strings.\r\n */\r\nfunction renderSuggestedQuestions(questions) {\r\n    if (!suggestedQuestionsContainer || questions.length === 0) {\r\n        return;\r\n    }\r\n\r\n    suggestedQuestionsContainer.innerHTML = '';\r\n\r\n    questions.forEach(question => {\r\n        const button = document.createElement('button');\r\n        button.type = 'button';\r\n        button.className = 'humata-suggested-question-btn';\r\n        button.setAttribute('title', question);\r\n\r\n        const span = document.createElement('span');\r\n        span.className = 'humata-suggested-question-text';\r\n        span.textContent = question;\r\n        button.appendChild(span);\r\n\r\n        button.addEventListener('click', () => {\r\n            handleQuestionClick(question);\r\n        });\r\n\r\n        suggestedQuestionsContainer.appendChild(button);\r\n    });\r\n\r\n    suggestedQuestionsContainer.style.display = '';\r\n}\r\n\r\n/**\r\n * Handle click on a suggested question.\r\n *\r\n * @param {string} question The question text.\r\n */\r\nfunction handleQuestionClick(question) {\r\n    hideSuggestedQuestions();\r\n\r\n    if (typeof onQuestionClick === 'function') {\r\n        onQuestionClick(question);\r\n    }\r\n}\r\n\r\n/**\r\n * Hide the suggested questions container.\r\n */\r\nexport function hideSuggestedQuestions() {\r\n    if (suggestedQuestionsContainer) {\r\n        suggestedQuestionsContainer.style.display = 'none';\r\n        suggestedQuestionsContainer.innerHTML = '';\r\n    }\r\n}\r\n\r\n/**\r\n * Check if suggested questions are currently visible.\r\n *\r\n * @returns {boolean} True if visible.\r\n */\r\nexport function areSuggestedQuestionsVisible() {\r\n    return suggestedQuestionsContainer &&\r\n           suggestedQuestionsContainer.style.display !== 'none' &&\r\n           suggestedQuestionsContainer.children.length > 0;\r\n}\r\n", "/**\r\n * Follow-Up Questions Module\r\n *\r\n * Handles rendering and interaction of AI-generated follow-up question prompts\r\n * that appear after bot responses.\r\n *\r\n * @package Humata_Chatbot\r\n * @since 1.0.0\r\n */\r\n\r\nlet onQuestionClick = null;\r\nlet currentContainer = null;\r\nlet expandedButton = null;\r\nlet isTouchDevice = false;\r\n\r\n/**\r\n * Initialize follow-up questions module.\r\n *\r\n * @param {Function} clickHandler Callback when a question is clicked.\r\n */\r\nexport function initFollowUpQuestions(clickHandler) {\r\n    onQuestionClick = clickHandler;\r\n    \r\n    // Detect touch device\r\n    isTouchDevice = 'ontouchstart' in window || navigator.maxTouchPoints > 0;\r\n}\r\n\r\n/**\r\n * Render follow-up questions after a bot message.\r\n *\r\n * @param {HTMLElement} messageElement The bot message element to attach questions to.\r\n * @param {Array} questions Array of question strings.\r\n */\r\nexport function renderFollowUpQuestions(messageElement, questions) {\r\n    // Remove any existing follow-up questions first.\r\n    hideFollowUpQuestions();\r\n\r\n    if (!messageElement || !questions || !Array.isArray(questions) || questions.length === 0) {\r\n        return;\r\n    }\r\n\r\n    // Create container.\r\n    const container = document.createElement('div');\r\n    container.className = 'humata-followup-questions';\r\n    container.setAttribute('role', 'group');\r\n    container.setAttribute('aria-label', 'Follow-up questions');\r\n\r\n    // Add label.\r\n    const label = document.createElement('span');\r\n    label.className = 'humata-followup-questions-label';\r\n    label.textContent = 'Follow-up questions:';\r\n    container.appendChild(label);\r\n\r\n    // Create buttons container.\r\n    const buttonsContainer = document.createElement('div');\r\n    buttonsContainer.className = 'humata-followup-questions-buttons';\r\n\r\n    questions.forEach((question, index) => {\r\n        if (!question || typeof question !== 'string') {\r\n            return;\r\n        }\r\n\r\n        const button = document.createElement('button');\r\n        button.type = 'button';\r\n        button.className = 'humata-followup-question-btn';\r\n        button.setAttribute('title', question);\r\n        button.setAttribute('data-index', index);\r\n\r\n        const span = document.createElement('span');\r\n        span.className = 'humata-followup-question-text';\r\n        span.textContent = question;\r\n        button.appendChild(span);\r\n\r\n        // Check if text will be truncated (rough estimate based on character count)\r\n        const isTruncated = question.length > 50;\r\n\r\n        button.addEventListener('click', (e) => {\r\n            // On touch devices with truncated text: first tap expands, second tap sends\r\n            if (isTouchDevice && isTruncated && !button.classList.contains('humata-expanded')) {\r\n                e.preventDefault();\r\n                collapseExpandedButton();\r\n                button.classList.add('humata-expanded');\r\n                expandedButton = button;\r\n                return;\r\n            }\r\n            handleQuestionClick(question);\r\n        });\r\n\r\n        buttonsContainer.appendChild(button);\r\n    });\r\n\r\n    container.appendChild(buttonsContainer);\r\n\r\n    // Insert after the message content (but inside the message wrapper).\r\n    const messageContent = messageElement.querySelector('.humata-message-content');\r\n    if (messageContent) {\r\n        // Insert after message content, before any disclaimer.\r\n        const disclaimer = messageElement.querySelector('.humata-bot-response-disclaimer');\r\n        if (disclaimer) {\r\n            messageContent.insertBefore(container, disclaimer);\r\n        } else {\r\n            messageContent.appendChild(container);\r\n        }\r\n    } else {\r\n        messageElement.appendChild(container);\r\n    }\r\n\r\n    currentContainer = container;\r\n}\r\n\r\n/**\r\n * Collapse any currently expanded button.\r\n */\r\nfunction collapseExpandedButton() {\r\n    if (expandedButton) {\r\n        expandedButton.classList.remove('humata-expanded');\r\n        expandedButton = null;\r\n    }\r\n}\r\n\r\n/**\r\n * Handle click on a follow-up question.\r\n *\r\n * @param {string} question The question text.\r\n */\r\nfunction handleQuestionClick(question) {\r\n    hideFollowUpQuestions();\r\n\r\n    if (typeof onQuestionClick === 'function') {\r\n        onQuestionClick(question);\r\n    }\r\n}\r\n\r\n/**\r\n * Hide and remove the current follow-up questions container.\r\n */\r\nexport function hideFollowUpQuestions() {\r\n    if (currentContainer && currentContainer.parentNode) {\r\n        currentContainer.parentNode.removeChild(currentContainer);\r\n    }\r\n    currentContainer = null;\r\n\r\n    // Also remove any orphaned containers.\r\n    const orphaned = document.querySelectorAll('.humata-followup-questions');\r\n    orphaned.forEach(el => {\r\n        if (el.parentNode) {\r\n            el.parentNode.removeChild(el);\r\n        }\r\n    });\r\n}\r\n\r\n/**\r\n * Check if follow-up questions are currently visible.\r\n *\r\n * @returns {boolean} True if visible.\r\n */\r\nexport function areFollowUpQuestionsVisible() {\r\n    return currentContainer !== null && currentContainer.parentNode !== null;\r\n}\r\n", "/**\r\n * Bot Protection Module\r\n *\r\n * Client-side implementation of honeypot and proof-of-work protection.\r\n *\r\n * @package Humata_Chatbot\r\n * @since 1.0.0\r\n */\r\n\r\nimport { config } from './config.js';\r\n\r\n// Session storage key for PoW verification\r\nconst POW_VERIFIED_KEY = 'humata_pow_verified';\r\n\r\n// Track page load timestamp for honeypot timing check\r\nlet pageLoadTimestamp = 0;\r\n\r\n// Track if PoW has been solved in this session\r\nlet powSolved = false;\r\n\r\n// Store the last PoW nonce/solution for reuse\r\nlet lastPowNonce = null;\r\nlet lastPowSolution = null;\r\n\r\n/**\r\n * Initialize bot protection.\r\n * Should be called on page load.\r\n */\r\nexport function initBotProtection() {\r\n    // Get page load time from server or use current time\r\n    pageLoadTimestamp = config.pageLoadTime || Math.floor(Date.now() / 1000);\r\n    \r\n    // Check if already verified in this session\r\n    powSolved = sessionStorage.getItem(POW_VERIFIED_KEY) === 'true';\r\n}\r\n\r\n/**\r\n * Check if bot protection is enabled.\r\n *\r\n * @returns {boolean}\r\n */\r\nexport function isBotProtectionEnabled() {\r\n    return config.botProtection && config.botProtection.enabled;\r\n}\r\n\r\n/**\r\n * Check if honeypot protection is enabled.\r\n *\r\n * @returns {boolean}\r\n */\r\nexport function isHoneypotEnabled() {\r\n    return isBotProtectionEnabled() && config.botProtection.honeypotEnabled;\r\n}\r\n\r\n/**\r\n * Check if proof-of-work is enabled.\r\n *\r\n * @returns {boolean}\r\n */\r\nexport function isPowEnabled() {\r\n    return isBotProtectionEnabled() && config.botProtection.powEnabled;\r\n}\r\n\r\n/**\r\n * Check if PoW has been solved in this session.\r\n *\r\n * @returns {boolean}\r\n */\r\nexport function isPowVerified() {\r\n    return powSolved || sessionStorage.getItem(POW_VERIFIED_KEY) === 'true';\r\n}\r\n\r\n/**\r\n * Mark PoW as verified for this session.\r\n */\r\nexport function setPowVerified() {\r\n    powSolved = true;\r\n    sessionStorage.setItem(POW_VERIFIED_KEY, 'true');\r\n}\r\n\r\n/**\r\n * Get the honeypot headers for a request.\r\n * Returns empty honeypot value (bots would fill this) and timestamp.\r\n *\r\n * @returns {Object} Headers object with honeypot data.\r\n */\r\nexport function getHoneypotHeaders() {\r\n    if (!isHoneypotEnabled()) {\r\n        return {};\r\n    }\r\n\r\n    return {\r\n        'X-Humata-HP': '',  // Honeypot field - must be empty for legitimate users\r\n        'X-Humata-TS': String(pageLoadTimestamp)  // Timestamp for timing check\r\n    };\r\n}\r\n\r\n/**\r\n * Solve a proof-of-work challenge.\r\n * Finds a nonce that produces a SHA256 hash with the required number of leading zeros.\r\n *\r\n * @param {string} challenge The challenge nonce from the server.\r\n * @param {number} difficulty Number of leading zeros required.\r\n * @returns {Promise<string>} The solution (counter value).\r\n */\r\nexport async function solveProofOfWork(challenge, difficulty) {\r\n    const target = '0'.repeat(difficulty);\r\n    let counter = 0;\r\n    const maxIterations = 10000000; // Safety limit\r\n    \r\n    // Use Web Crypto API for SHA256\r\n    const encoder = new TextEncoder();\r\n    \r\n    while (counter < maxIterations) {\r\n        const input = challenge + ':' + counter;\r\n        const data = encoder.encode(input);\r\n        const hashBuffer = await crypto.subtle.digest('SHA-256', data);\r\n        const hashArray = Array.from(new Uint8Array(hashBuffer));\r\n        const hashHex = hashArray.map(b => b.toString(16).padStart(2, '0')).join('');\r\n        \r\n        if (hashHex.startsWith(target)) {\r\n            return String(counter);\r\n        }\r\n        \r\n        counter++;\r\n        \r\n        // Yield to the event loop periodically to keep UI responsive\r\n        if (counter % 10000 === 0) {\r\n            await new Promise(resolve => setTimeout(resolve, 0));\r\n        }\r\n    }\r\n    \r\n    throw new Error('Failed to solve proof-of-work challenge');\r\n}\r\n\r\n/**\r\n * Get the PoW headers for a request.\r\n * If PoW is required and not yet solved, this will solve it first.\r\n *\r\n * @param {Object} challengeData Optional challenge data from a previous 403 response.\r\n * @returns {Promise<Object>} Headers object with PoW data.\r\n */\r\nexport async function getPowHeaders(challengeData = null) {\r\n    if (!isPowEnabled()) {\r\n        return {};\r\n    }\r\n\r\n    // If already verified, return empty headers (server will accept based on transient)\r\n    if (isPowVerified() && !challengeData) {\r\n        return {};\r\n    }\r\n\r\n    // If we have a cached solution and no new challenge, reuse it\r\n    if (lastPowNonce && lastPowSolution && !challengeData) {\r\n        return {\r\n            'X-Humata-PoW-Nonce': lastPowNonce,\r\n            'X-Humata-PoW-Solution': lastPowSolution\r\n        };\r\n    }\r\n\r\n    // If we have challenge data from a 403 response, solve it\r\n    if (challengeData && challengeData.nonce && challengeData.difficulty) {\r\n        const solution = await solveProofOfWork(challengeData.nonce, challengeData.difficulty);\r\n        lastPowNonce = challengeData.nonce;\r\n        lastPowSolution = solution;\r\n        \r\n        return {\r\n            'X-Humata-PoW-Nonce': challengeData.nonce,\r\n            'X-Humata-PoW-Solution': solution\r\n        };\r\n    }\r\n\r\n    // No challenge data and not verified - request will fail with 403 and challenge\r\n    return {};\r\n}\r\n\r\n/**\r\n * Get all bot protection headers for a request.\r\n *\r\n * @param {Object} powChallenge Optional PoW challenge data from a previous 403 response.\r\n * @returns {Promise<Object>} Combined headers object.\r\n */\r\nexport async function getBotProtectionHeaders(powChallenge = null) {\r\n    if (!isBotProtectionEnabled()) {\r\n        return {};\r\n    }\r\n\r\n    const honeypotHeaders = getHoneypotHeaders();\r\n    const powHeaders = await getPowHeaders(powChallenge);\r\n\r\n    return {\r\n        ...honeypotHeaders,\r\n        ...powHeaders\r\n    };\r\n}\r\n\r\n/**\r\n * Handle a 403 response that may contain a PoW challenge.\r\n * Extracts challenge data from the error response.\r\n *\r\n * @param {Object} errorData The error data from the response.\r\n * @returns {Object|null} Challenge data or null if not a PoW challenge.\r\n */\r\nexport function extractPowChallenge(errorData) {\r\n    if (!errorData) {\r\n        return null;\r\n    }\r\n\r\n    // Check for pow_required or pow_expired error codes\r\n    if (errorData.code === 'pow_required' || errorData.code === 'pow_expired' || errorData.code === 'pow_invalid') {\r\n        if (errorData.data && errorData.data.challenge) {\r\n            return errorData.data.challenge;\r\n        }\r\n    }\r\n\r\n    return null;\r\n}\r\n\r\n/**\r\n * Clear PoW verification state (e.g., when session expires).\r\n */\r\nexport function clearPowVerification() {\r\n    powSolved = false;\r\n    lastPowNonce = null;\r\n    lastPowSolution = null;\r\n    sessionStorage.removeItem(POW_VERIFIED_KEY);\r\n}\r\n", "/**\r\n * Humata Chat Widget\r\n *\r\n * Frontend JavaScript for the chat interface.\r\n *\r\n * @package Humata_Chatbot\r\n * @since 1.0.0\r\n */\r\n\r\nimport { config, STORAGE_KEY, CONVERSATION_KEY, THEME_KEY } from './config.js';\r\nimport { setAvatarContent } from './avatars.js';\r\nimport { initSuggestedQuestions, hideSuggestedQuestions } from './suggested-questions.js';\r\nimport { initFollowUpQuestions, renderFollowUpQuestions, hideFollowUpQuestions } from './follow-up-questions.js';\r\nimport {\r\n    initBotProtection,\r\n    isBotProtectionEnabled,\r\n    isPowEnabled,\r\n    isPowVerified,\r\n    setPowVerified,\r\n    getBotProtectionHeaders,\r\n    extractPowChallenge,\r\n    clearPowVerification\r\n} from './bot-protection.js';\r\n\r\n(function() {\r\n    'use strict';\r\n\r\n    // DOM Elements\r\n    let elements = {};\r\n\r\n    // State\r\n    let isLoading = false;\r\n    let conversationId = null;\r\n    let activeEdit = null;\r\n    let maxPromptChars = 3000;\r\n    let isEmbedded = false;\r\n    let accordionIdCounter = 0;\r\n\r\n    /**\r\n     * Initialize the chat widget.\r\n     */\r\n    function init() {\r\n        // Cache DOM elements\r\n        elements = {\r\n            container: document.getElementById('humata-chat-container'),\r\n            messages: document.getElementById('humata-chat-messages'),\r\n            input: document.getElementById('humata-chat-input'),\r\n            inputCounter: document.getElementById('humata-chat-input-counter'),\r\n            sendButton: document.getElementById('humata-send-button'),\r\n            scrollToggle: document.getElementById('humata-scroll-toggle'),\r\n            exportPdfButton: document.getElementById('humata-export-pdf'),\r\n            clearButton: document.getElementById('humata-clear-chat'),\r\n            themeToggle: document.getElementById('humata-theme-toggle'),\r\n            welcomeMessage: document.getElementById('humata-welcome-message')\r\n        };\r\n\r\n        if (!elements.container || !elements.messages || !elements.input) {\r\n            return;\r\n        }\r\n\r\n        // Detect embedded mode\r\n        isEmbedded = elements.container.classList.contains('humata-chat-embedded');\r\n\r\n        maxPromptChars = getMaxPromptChars();\r\n        if (elements.input && maxPromptChars > 0) {\r\n            elements.input.maxLength = maxPromptChars;\r\n        }\r\n\r\n        // Initialize theme\r\n        initTheme();\r\n\r\n        // Initialize bot protection\r\n        initBotProtection();\r\n\r\n        if (elements.welcomeMessage) {\r\n            ensureCopyButton(elements.welcomeMessage.querySelector('.humata-message-content'));\r\n        }\r\n\r\n        // Load conversation history\r\n        loadHistory();\r\n\r\n        // Bind events\r\n        bindEvents();\r\n\r\n        handleInput();\r\n\r\n        // Initialize scroll toggle state\r\n        updateScrollToggleState();\r\n\r\n        // Focus input\r\n        if (elements.input) {\r\n            elements.input.focus();\r\n        }\r\n\r\n        updateScrollToggleState();\r\n\r\n        // Initialize mobile keyboard handling\r\n        initMobileKeyboardHandler();\r\n\r\n        // Initialize suggested questions (only if no history loaded)\r\n        initSuggestedQuestionsIfEmpty();\r\n\r\n        // Initialize follow-up questions handler\r\n        initFollowUpQuestions(handleFollowUpQuestionClick);\r\n    }\r\n\r\n    /**\r\n     * Initialize suggested questions if chat is empty.\r\n     */\r\n    function initSuggestedQuestionsIfEmpty() {\r\n        const hasHistory = elements.messages &&\r\n            elements.messages.querySelectorAll('.humata-message-user').length > 0;\r\n\r\n        if (!hasHistory) {\r\n            initSuggestedQuestions(handleSuggestedQuestionClick);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Handle click on a suggested question - send it immediately.\r\n     *\r\n     * @param {string} question The question text.\r\n     */\r\n    function handleSuggestedQuestionClick(question) {\r\n        if (!question || isLoading) {\r\n            return;\r\n        }\r\n\r\n        // Hide suggested questions\r\n        hideSuggestedQuestions();\r\n\r\n        // Store user message for intent link matching\r\n        lastUserMessageForIntents = question;\r\n\r\n        // Add user message to chat\r\n        addMessage(question, 'user');\r\n\r\n        // Get history and send\r\n        const history = getChatHistoryForRequest();\r\n        sendMessage(question, history);\r\n    }\r\n\r\n    /**\r\n     * Handle click on a follow-up question - send it immediately.\r\n     *\r\n     * @param {string} question The question text.\r\n     */\r\n    function handleFollowUpQuestionClick(question) {\r\n        if (!question || isLoading) {\r\n            return;\r\n        }\r\n\r\n        // Hide follow-up questions\r\n        hideFollowUpQuestions();\r\n\r\n        // Store user message for intent link matching\r\n        lastUserMessageForIntents = question;\r\n\r\n        // Add user message to chat\r\n        addMessage(question, 'user');\r\n\r\n        // Get history and send\r\n        const history = getChatHistoryForRequest();\r\n        sendMessage(question, history);\r\n    }\r\n\r\n    /**\r\n     * Initialize mobile keyboard handler using visualViewport API.\r\n     * Adjusts the input container position when the virtual keyboard appears.\r\n     * Detaches from fixed positioning when input container reaches trigger-pages/footer.\r\n     */\r\n    function initMobileKeyboardHandler() {\r\n        if (!window.visualViewport) {\r\n            return;\r\n        }\r\n\r\n        const inputContainer = document.getElementById('humata-chat-input-container');\r\n        if (!inputContainer) {\r\n            return;\r\n        }\r\n\r\n        const pageFooter = document.getElementById('humata-chat-page-footer');\r\n\r\n        function getStopElement() {\r\n            const triggerPages = document.querySelector('.humata-trigger-pages:not(.humata-trigger-pages--hidden)');\r\n            return triggerPages || pageFooter;\r\n        }\r\n\r\n        const initialViewportHeight = window.visualViewport.height;\r\n        let isKeyboardVisible = false;\r\n        let isDetached = false;\r\n        let pendingUpdate = false;\r\n\r\n        function updateInputPosition() {\r\n            if (pendingUpdate) {\r\n                return;\r\n            }\r\n            pendingUpdate = true;\r\n\r\n            requestAnimationFrame(function() {\r\n                pendingUpdate = false;\r\n\r\n                const vv = window.visualViewport;\r\n                const viewportBottom = vv.offsetTop + vv.height;\r\n                const layoutBottom = window.innerHeight;\r\n                const bottomOffset = layoutBottom - viewportBottom;\r\n                const heightReduction = initialViewportHeight - vv.height;\r\n                const keyboardOpen = heightReduction > 150;\r\n\r\n                if (keyboardOpen) {\r\n                    if (!isKeyboardVisible) {\r\n                        isKeyboardVisible = true;\r\n                        document.body.classList.add('humata-keyboard-open');\r\n                    }\r\n\r\n                    // Check if we should detach (input container would overlap stop element)\r\n                    let shouldDetach = false;\r\n                    const stopElement = getStopElement();\r\n                    if (stopElement) {\r\n                        const stopRect = stopElement.getBoundingClientRect();\r\n                        const inputHeight = inputContainer.offsetHeight;\r\n                        const keyboardTop = vv.height + vv.offsetTop;\r\n                        const inputFixedBottom = keyboardTop - inputHeight;\r\n\r\n                        // If the stop element's top is within or above where the input would be fixed\r\n                        if (stopRect.top <= keyboardTop && stopRect.top > 0) {\r\n                            shouldDetach = true;\r\n                        }\r\n                    }\r\n\r\n                    if (shouldDetach) {\r\n                        // Detach: let input container scroll with content\r\n                        if (!isDetached) {\r\n                            isDetached = true;\r\n                            inputContainer.classList.add('humata-input-detached');\r\n                        }\r\n                        inputContainer.style.position = '';\r\n                        inputContainer.style.bottom = '';\r\n                        inputContainer.style.left = '';\r\n                        inputContainer.style.right = '';\r\n                        inputContainer.style.transform = '';\r\n                    } else {\r\n                        // Attach: fix input container above keyboard\r\n                        if (isDetached) {\r\n                            isDetached = false;\r\n                            inputContainer.classList.remove('humata-input-detached');\r\n                        }\r\n                        inputContainer.style.position = 'fixed';\r\n                        inputContainer.style.bottom = '0';\r\n                        inputContainer.style.left = '0';\r\n                        inputContainer.style.right = '0';\r\n                        inputContainer.style.transform = 'translateY(' + (-bottomOffset) + 'px)';\r\n                    }\r\n                } else {\r\n                    if (isKeyboardVisible) {\r\n                        isKeyboardVisible = false;\r\n                        isDetached = false;\r\n                        document.body.classList.remove('humata-keyboard-open');\r\n                        inputContainer.classList.remove('humata-input-detached');\r\n                    }\r\n                    inputContainer.style.position = '';\r\n                    inputContainer.style.bottom = '';\r\n                    inputContainer.style.left = '';\r\n                    inputContainer.style.right = '';\r\n                    inputContainer.style.transform = '';\r\n                }\r\n            });\r\n        }\r\n\r\n        window.visualViewport.addEventListener('resize', updateInputPosition);\r\n        window.visualViewport.addEventListener('scroll', updateInputPosition);\r\n        window.addEventListener('scroll', updateInputPosition, { passive: true });\r\n\r\n        if (elements.input) {\r\n            elements.input.addEventListener('focus', function() {\r\n                setTimeout(updateInputPosition, 300);\r\n            });\r\n            elements.input.addEventListener('blur', function() {\r\n                setTimeout(updateInputPosition, 100);\r\n            });\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Initialize theme based on settings.\r\n     */\r\n    function initTheme() {\r\n        const savedTheme = localStorage.getItem(THEME_KEY);\r\n        const configTheme = config.theme || 'auto';\r\n\r\n        let theme = savedTheme || configTheme;\r\n\r\n        if (theme === 'auto') {\r\n            theme = window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light';\r\n        }\r\n\r\n        applyTheme(theme);\r\n\r\n        // Listen for system theme changes\r\n        if (configTheme === 'auto' && !savedTheme) {\r\n            window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', function(e) {\r\n                if (!localStorage.getItem(THEME_KEY)) {\r\n                    applyTheme(e.matches ? 'dark' : 'light');\r\n                }\r\n            });\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Apply theme to the document.\r\n     *\r\n     * @param {string} theme - Theme name ('dark' or 'light').\r\n     */\r\n    function applyTheme(theme) {\r\n        const html = document.documentElement;\r\n        const body = document.body;\r\n\r\n        html.classList.remove('humata-theme-dark', 'humata-theme-light');\r\n        body.classList.remove('humata-theme-dark', 'humata-theme-light');\r\n\r\n        if (theme === 'dark') {\r\n            html.classList.add('humata-theme-dark');\r\n            body.classList.add('humata-theme-dark');\r\n        } else {\r\n            html.classList.add('humata-theme-light');\r\n            body.classList.add('humata-theme-light');\r\n        }\r\n\r\n        if (elements.themeToggle) {\r\n            elements.themeToggle.setAttribute('aria-pressed', theme === 'dark' ? 'true' : 'false');\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Toggle theme between dark and light.\r\n     */\r\n    function toggleTheme() {\r\n        const isDark = document.documentElement.classList.contains('humata-theme-dark');\r\n        const newTheme = isDark ? 'light' : 'dark';\r\n\r\n        localStorage.setItem(THEME_KEY, newTheme);\r\n        applyTheme(newTheme);\r\n    }\r\n\r\n    /**\r\n     * Wrap a promise with a timeout.\r\n     *\r\n     * @param {Promise} promise - The promise to wrap.\r\n     * @param {number} ms - Timeout in milliseconds.\r\n     * @param {string} errorType - Error type identifier for timeout.\r\n     * @returns {Promise} Resolves with promise result or rejects on timeout.\r\n     */\r\n    function withTimeout(promise, ms, errorType) {\r\n        return Promise.race([\r\n            promise,\r\n            new Promise(function(_, reject) {\r\n                setTimeout(function() {\r\n                    const error = new Error('Operation timed out');\r\n                    error.type = errorType;\r\n                    reject(error);\r\n                }, ms);\r\n            })\r\n        ]);\r\n    }\r\n\r\n    /**\r\n     * Bind event listeners.\r\n     */\r\n    function bindEvents() {\r\n        // Send button click\r\n        if (elements.sendButton) {\r\n            elements.sendButton.addEventListener('click', handleSend);\r\n        }\r\n\r\n        // Input keydown\r\n        if (elements.input) {\r\n            elements.input.addEventListener('keydown', handleKeyDown);\r\n            elements.input.addEventListener('input', handleInput);\r\n        }\r\n\r\n        // Scroll toggle\r\n        if (elements.scrollToggle) {\r\n            elements.scrollToggle.addEventListener('click', handleScrollToggle);\r\n        }\r\n\r\n        // Scroll event for scroll toggle state\r\n        if (isEmbedded && elements.messages) {\r\n            elements.messages.addEventListener('scroll', updateScrollToggleState, { passive: true });\r\n        } else {\r\n            window.addEventListener('scroll', updateScrollToggleState, { passive: true });\r\n        }\r\n\r\n        // Messages click handler\r\n        if (elements.messages) {\r\n            elements.messages.addEventListener('click', handleMessagesClick);\r\n        }\r\n\r\n        // Clear button\r\n        if (elements.clearButton) {\r\n            elements.clearButton.addEventListener('click', handleClear);\r\n        }\r\n\r\n        if (elements.exportPdfButton) {\r\n            elements.exportPdfButton.addEventListener('click', handleExportPdf);\r\n        }\r\n\r\n        // Theme toggle\r\n        if (elements.themeToggle) {\r\n            elements.themeToggle.addEventListener('click', toggleTheme);\r\n        }\r\n\r\n        // Trigger page modals\r\n        initTriggerPageModals();\r\n\r\n        // Medical disclaimer modal\r\n        initMedicalDisclaimerModal();\r\n\r\n        installModalFocusTrap();\r\n    }\r\n\r\n    function installModalFocusTrap() {\r\n        if (typeof window === 'undefined') {\r\n            return;\r\n        }\r\n\r\n        if (window.__humataModalFocusTrapInstalled) {\r\n            return;\r\n        }\r\n        window.__humataModalFocusTrapInstalled = true;\r\n\r\n        document.addEventListener('keydown', function(e) {\r\n            if (e.key !== 'Tab') {\r\n                return;\r\n            }\r\n\r\n            const openModal = document.querySelector('.humata-help-modal.is-open');\r\n            if (!openModal) {\r\n                return;\r\n            }\r\n\r\n            const dialog = openModal.querySelector('.humata-help-modal__dialog');\r\n            if (!dialog) {\r\n                return;\r\n            }\r\n\r\n            const focusableNodeList = dialog.querySelectorAll(\r\n                'a[href], area[href], button:not([disabled]), input:not([disabled]):not([type=\"hidden\"]), select:not([disabled]), textarea:not([disabled]), iframe, object, embed, [contenteditable], [tabindex]:not([tabindex=\"-1\"])'\r\n            );\r\n            const focusable = Array.prototype.slice.call(focusableNodeList).filter(function(el) {\r\n                return !!(el.offsetWidth || el.offsetHeight || el.getClientRects().length);\r\n            });\r\n\r\n            if (!focusable.length) {\r\n                return;\r\n            }\r\n\r\n            const first = focusable[0];\r\n            const last = focusable[focusable.length - 1];\r\n            const active = document.activeElement;\r\n\r\n            if (!dialog.contains(active)) {\r\n                e.preventDefault();\r\n                if (e.shiftKey) {\r\n                    last.focus();\r\n                } else {\r\n                    first.focus();\r\n                }\r\n                return;\r\n            }\r\n\r\n            if (e.shiftKey && active === first) {\r\n                e.preventDefault();\r\n                last.focus();\r\n                return;\r\n            }\r\n\r\n            if (!e.shiftKey && active === last) {\r\n                e.preventDefault();\r\n                first.focus();\r\n            }\r\n        });\r\n    }\r\n\r\n    /**\r\n     * Initialize medical disclaimer modal behavior.\r\n     */\r\n    function initMedicalDisclaimerModal() {\r\n        const disclaimerLink = document.getElementById('humata-medical-disclaimer-link');\r\n        const disclaimerModal = document.getElementById('humata-medical-disclaimer-modal');\r\n\r\n        if (!disclaimerLink || !disclaimerModal) {\r\n            return;\r\n        }\r\n\r\n        disclaimerLink.addEventListener('click', function(e) {\r\n            e.preventDefault();\r\n            openPageModal(disclaimerModal, disclaimerLink);\r\n        });\r\n\r\n        // Close on overlay or close button click\r\n        disclaimerModal.addEventListener('click', function(e) {\r\n            if (e.target.closest('[data-humata-disclaimer-close]')) {\r\n                e.preventDefault();\r\n                closePageModal(disclaimerModal);\r\n            }\r\n        });\r\n    }\r\n\r\n    /**\r\n     * Initialize trigger page modal behavior.\r\n     */\r\n    function initTriggerPageModals() {\r\n        // Open modal from trigger links\r\n        document.addEventListener('click', function(e) {\r\n            const trigger = e.target.closest('[data-humata-page-modal]');\r\n            if (!trigger) {\r\n                return;\r\n            }\r\n            e.preventDefault();\r\n            const modalIndex = trigger.getAttribute('data-humata-page-modal');\r\n            const modal = document.getElementById('humata-page-modal-' + modalIndex);\r\n            if (modal) {\r\n                openPageModal(modal, trigger);\r\n            }\r\n        });\r\n\r\n        // Close modal on overlay or close button click\r\n        document.addEventListener('click', function(e) {\r\n            const closeTarget = e.target.closest('[data-humata-page-close-modal]');\r\n            if (!closeTarget) {\r\n                return;\r\n            }\r\n            const modal = closeTarget.closest('.humata-help-modal');\r\n            if (modal) {\r\n                e.preventDefault();\r\n                closePageModal(modal);\r\n            }\r\n        });\r\n\r\n        // ESC closes modal\r\n        document.addEventListener('keydown', function(e) {\r\n            if (e.key !== 'Escape') {\r\n                return;\r\n            }\r\n            const openModal = document.querySelector('.humata-help-modal.is-open');\r\n            if (openModal) {\r\n                e.preventDefault();\r\n                closePageModal(openModal);\r\n            }\r\n        });\r\n    }\r\n\r\n    let pageModalLastFocused = null;\r\n\r\n    /**\r\n     * Open a trigger page modal.\r\n     *\r\n     * @param {HTMLElement} modal - Modal element.\r\n     * @param {HTMLElement} triggerEl - Trigger element.\r\n     */\r\n    function openPageModal(modal, triggerEl) {\r\n        pageModalLastFocused = triggerEl || document.activeElement;\r\n\r\n        modal.hidden = false;\r\n        modal.classList.add('is-open');\r\n        modal.setAttribute('aria-hidden', 'false');\r\n\r\n        document.documentElement.classList.add('humata-help-modal-open');\r\n        document.body.classList.add('humata-help-modal-open');\r\n\r\n        const closeBtn = modal.querySelector('.humata-help-modal__close');\r\n        if (closeBtn) {\r\n            try {\r\n                closeBtn.focus({ preventScroll: true });\r\n            } catch (err) {\r\n                closeBtn.focus();\r\n            }\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Close a trigger page modal.\r\n     *\r\n     * @param {HTMLElement} modal - Modal element.\r\n     */\r\n    function closePageModal(modal) {\r\n        modal.classList.remove('is-open');\r\n        modal.setAttribute('aria-hidden', 'true');\r\n        modal.hidden = true;\r\n\r\n        document.documentElement.classList.remove('humata-help-modal-open');\r\n        document.body.classList.remove('humata-help-modal-open');\r\n\r\n        if (pageModalLastFocused && typeof pageModalLastFocused.focus === 'function') {\r\n            try {\r\n                pageModalLastFocused.focus({ preventScroll: true });\r\n            } catch (err) {\r\n                pageModalLastFocused.focus();\r\n            }\r\n        }\r\n        pageModalLastFocused = null;\r\n    }\r\n\r\n    function getMaxPromptChars() {\r\n        const fromConfig = parseInt(config.maxPromptChars, 10);\r\n        if (Number.isFinite(fromConfig) && fromConfig > 0) {\r\n            return fromConfig;\r\n        }\r\n\r\n        if (elements.input) {\r\n            const fromAttr = parseInt(elements.input.getAttribute('maxlength'), 10);\r\n            if (Number.isFinite(fromAttr) && fromAttr > 0) {\r\n                return fromAttr;\r\n            }\r\n        }\r\n\r\n        return 3000;\r\n    }\r\n\r\n    function updatePromptCounter() {\r\n        if (!elements.input || !elements.inputCounter) {\r\n            return;\r\n        }\r\n\r\n        const current = (elements.input.value || '').length;\r\n        const max = maxPromptChars || 3000;\r\n\r\n        elements.inputCounter.textContent = current + '/' + max;\r\n        elements.inputCounter.classList.toggle('humata-input-counter-over', current > max);\r\n    }\r\n\r\n    function handleMessagesClick(event) {\r\n        const regenerateButton = event.target.closest('.humata-regenerate-button');\r\n        if (regenerateButton) {\r\n            const messageEl = regenerateButton.closest('.humata-message');\r\n            if (!messageEl || isLoading || activeEdit) {\r\n                return;\r\n            }\r\n\r\n            let userMessageEl = messageEl.previousElementSibling;\r\n            while (userMessageEl && !userMessageEl.classList.contains('humata-message-user')) {\r\n                userMessageEl = userMessageEl.previousElementSibling;\r\n            }\r\n\r\n            if (!userMessageEl) {\r\n                return;\r\n            }\r\n\r\n            const contentEl = userMessageEl.querySelector('.humata-message-content');\r\n            if (!contentEl) {\r\n                return;\r\n            }\r\n\r\n            const text = getMessagePlainText(contentEl);\r\n            if (!text) {\r\n                return;\r\n            }\r\n\r\n            const history = getChatHistoryForRequestBefore(userMessageEl);\r\n            truncateConversationAfter(userMessageEl);\r\n            saveHistory();\r\n            sendMessage(text, history);\r\n            return;\r\n        }\r\n\r\n        const copyButton = event.target.closest('.humata-copy-button');\r\n        if (copyButton) {\r\n            const messageEl = copyButton.closest('.humata-message');\r\n            if (!messageEl) {\r\n                return;\r\n            }\r\n\r\n            const contentEl = messageEl.querySelector('.humata-message-content');\r\n            if (!contentEl) {\r\n                return;\r\n            }\r\n\r\n            const payload = getMessageClipboardPayload(contentEl);\r\n            if (!payload || (!payload.text && !payload.html)) {\r\n                return;\r\n            }\r\n\r\n            copyToClipboard(payload)\r\n                .then(function() {\r\n                    indicateCopySuccess(copyButton);\r\n                })\r\n                .catch(function() {\r\n                    indicateCopyFailure(copyButton);\r\n                });\r\n            return;\r\n        }\r\n\r\n        const editButton = event.target.closest('.humata-edit-button');\r\n        if (editButton) {\r\n            const messageEl = editButton.closest('.humata-message');\r\n            if (!messageEl || isLoading) {\r\n                return;\r\n            }\r\n            startEditMessage(messageEl);\r\n            return;\r\n        }\r\n\r\n        const cancelButton = event.target.closest('.humata-edit-cancel');\r\n        if (cancelButton) {\r\n            cancelActiveEdit();\r\n            return;\r\n        }\r\n\r\n        const saveButton = event.target.closest('.humata-edit-save');\r\n        if (saveButton) {\r\n            saveActiveEdit();\r\n        }\r\n    }\r\n\r\n    function setComposerEnabled(enabled) {\r\n        if (!elements.input) {\r\n            return;\r\n        }\r\n\r\n        elements.input.disabled = !enabled;\r\n\r\n        if (elements.sendButton) {\r\n            if (!enabled) {\r\n                elements.sendButton.disabled = true;\r\n            } else {\r\n                const value = elements.input.value || '';\r\n                elements.sendButton.disabled = !value.trim() || value.length > maxPromptChars;\r\n            }\r\n        }\r\n\r\n        updatePromptCounter();\r\n    }\r\n\r\n    function startEditMessage(messageEl) {\r\n        if (!messageEl || !messageEl.classList.contains('humata-message-user')) {\r\n            return;\r\n        }\r\n\r\n        const contentEl = messageEl.querySelector('.humata-message-content');\r\n        if (!contentEl) {\r\n            return;\r\n        }\r\n\r\n        if (activeEdit && activeEdit.messageEl === messageEl) {\r\n            return;\r\n        }\r\n\r\n        cancelActiveEdit();\r\n\r\n        const originalText = getMessagePlainText(contentEl);\r\n        if (!originalText) {\r\n            return;\r\n        }\r\n\r\n        activeEdit = {\r\n            messageEl: messageEl,\r\n            contentEl: contentEl,\r\n            originalText: originalText\r\n        };\r\n\r\n        messageEl.classList.add('humata-message-editing');\r\n        contentEl.classList.add('humata-message-content-editing');\r\n        contentEl.textContent = '';\r\n\r\n        const textarea = document.createElement('textarea');\r\n        textarea.className = 'humata-edit-textarea';\r\n        textarea.value = originalText;\r\n        textarea.rows = 1;\r\n        textarea.maxLength = maxPromptChars;\r\n\r\n        const actions = document.createElement('div');\r\n        actions.className = 'humata-edit-actions';\r\n\r\n        const cancelButton = document.createElement('button');\r\n        cancelButton.type = 'button';\r\n        cancelButton.className = 'humata-edit-cancel';\r\n        cancelButton.innerHTML = getXIconSvg();\r\n        cancelButton.setAttribute('title', config.i18n?.cancel || 'Cancel');\r\n        cancelButton.setAttribute('aria-label', config.i18n?.cancel || 'Cancel');\r\n\r\n        const saveButton = document.createElement('button');\r\n        saveButton.type = 'button';\r\n        saveButton.className = 'humata-edit-save';\r\n        saveButton.innerHTML = getCheckIconSvg();\r\n        saveButton.setAttribute('title', config.i18n?.save || 'Save');\r\n        saveButton.setAttribute('aria-label', config.i18n?.save || 'Save');\r\n\r\n        actions.appendChild(cancelButton);\r\n        actions.appendChild(saveButton);\r\n\r\n        contentEl.appendChild(textarea);\r\n        contentEl.appendChild(actions);\r\n\r\n        setComposerEnabled(false);\r\n\r\n        textarea.addEventListener('input', function() {\r\n            autoResizeEditTextarea(textarea);\r\n        });\r\n\r\n        textarea.addEventListener('keydown', function(e) {\r\n            if (e.key === 'Escape') {\r\n                e.preventDefault();\r\n                cancelActiveEdit();\r\n                return;\r\n            }\r\n            if (e.key === 'Enter' && (e.ctrlKey || e.metaKey)) {\r\n                e.preventDefault();\r\n                saveActiveEdit();\r\n            }\r\n        });\r\n\r\n        requestAnimationFrame(function() {\r\n            autoResizeEditTextarea(textarea);\r\n            textarea.focus();\r\n            textarea.setSelectionRange(textarea.value.length, textarea.value.length);\r\n        });\r\n    }\r\n\r\n    function autoResizeEditTextarea(textarea) {\r\n        if (!textarea) {\r\n            return;\r\n        }\r\n\r\n        textarea.style.height = 'auto';\r\n\r\n        const lineHeight = parseInt(getComputedStyle(textarea).lineHeight) || 24;\r\n        const maxHeight = lineHeight * 8;\r\n        const newHeight = Math.min(textarea.scrollHeight, maxHeight);\r\n\r\n        textarea.style.height = newHeight + 'px';\r\n\r\n        updatePromptCounter();\r\n    }\r\n\r\n    function cancelActiveEdit() {\r\n        if (!activeEdit) {\r\n            return;\r\n        }\r\n\r\n        restoreUserMessageContent(activeEdit.messageEl, activeEdit.originalText);\r\n        activeEdit = null;\r\n        setComposerEnabled(true);\r\n\r\n        if (elements.input) {\r\n            elements.input.focus();\r\n        }\r\n    }\r\n\r\n    function saveActiveEdit() {\r\n        if (!activeEdit || isLoading) {\r\n            return;\r\n        }\r\n\r\n        const textarea = activeEdit.contentEl.querySelector('.humata-edit-textarea');\r\n        if (!textarea) {\r\n            cancelActiveEdit();\r\n            return;\r\n        }\r\n\r\n        const rawText = textarea.value;\r\n        const newText = rawText.trim();\r\n        if (!newText) {\r\n            textarea.focus();\r\n            return;\r\n        }\r\n\r\n        if (rawText.length > maxPromptChars) {\r\n            const errorMessage = config.i18n?.errorPromptTooLong || ('Message is too long. Maximum is ' + maxPromptChars + ' characters.');\r\n            addMessage(errorMessage, 'bot', true);\r\n            textarea.focus();\r\n            return;\r\n        }\r\n\r\n        const history = getChatHistoryForRequestBefore(activeEdit.messageEl);\r\n\r\n        restoreUserMessageContent(activeEdit.messageEl, newText);\r\n        truncateConversationAfter(activeEdit.messageEl);\r\n        activeEdit = null;\r\n        setComposerEnabled(true);\r\n        saveHistory();\r\n        sendMessage(newText, history);\r\n    }\r\n\r\n    function restoreUserMessageContent(messageEl, text) {\r\n        if (!messageEl) {\r\n            return;\r\n        }\r\n\r\n        const contentEl = messageEl.querySelector('.humata-message-content');\r\n        if (!contentEl) {\r\n            return;\r\n        }\r\n\r\n        messageEl.classList.remove('humata-message-editing');\r\n        contentEl.classList.remove('humata-message-content-editing');\r\n        contentEl.innerHTML = '';\r\n        contentEl.textContent = text;\r\n\r\n        ensureCopyButton(contentEl);\r\n        ensureEditButton(contentEl);\r\n    }\r\n\r\n    function truncateConversationAfter(messageEl) {\r\n        if (!elements.messages || !messageEl) {\r\n            return;\r\n        }\r\n\r\n        hideLoading();\r\n\r\n        let node = messageEl.nextSibling;\r\n        while (node) {\r\n            const next = node.nextSibling;\r\n            if (node.nodeType === 1) {\r\n                node.remove();\r\n            }\r\n            node = next;\r\n        }\r\n    }\r\n\r\n    function getChatHistoryForRequestBefore(messageEl) {\r\n        if (!elements.messages) {\r\n            return [];\r\n        }\r\n\r\n        const history = [];\r\n        const messageElements = elements.messages.querySelectorAll('.humata-message:not(#humata-welcome-message):not(.humata-message-loading)');\r\n\r\n        for (let i = 0; i < messageElements.length; i++) {\r\n            const el = messageElements[i];\r\n            if (el === messageEl) {\r\n                break;\r\n            }\r\n\r\n            const isUser = el.classList.contains('humata-message-user');\r\n            const isError = el.classList.contains('humata-message-error');\r\n\r\n            if (isError) {\r\n                continue;\r\n            }\r\n\r\n            const content = el.querySelector('.humata-message-content');\r\n            if (!content) {\r\n                continue;\r\n            }\r\n\r\n            const text = getMessagePlainText(content);\r\n            if (!text) {\r\n                continue;\r\n            }\r\n\r\n            history.push({\r\n                type: isUser ? 'user' : 'bot',\r\n                content: text\r\n            });\r\n        }\r\n\r\n        return history;\r\n    }\r\n\r\n    /**\r\n     * Update scroll toggle state based on current scroll position.\r\n     */\r\n    function updateScrollToggleState() {\r\n        if (!elements.scrollToggle) {\r\n            return;\r\n        }\r\n\r\n        let scrollHeight, clientHeight, scrollTop;\r\n\r\n        if (isEmbedded && elements.messages) {\r\n            scrollHeight = elements.messages.scrollHeight;\r\n            clientHeight = elements.messages.clientHeight;\r\n            scrollTop = elements.messages.scrollTop;\r\n        } else {\r\n            scrollHeight = document.documentElement.scrollHeight;\r\n            clientHeight = window.innerHeight;\r\n            scrollTop = window.scrollY || document.documentElement.scrollTop;\r\n        }\r\n\r\n        const maxScrollable = scrollHeight - clientHeight;\r\n\r\n        if (maxScrollable <= 50) {\r\n            elements.scrollToggle.style.display = 'none';\r\n            return;\r\n        }\r\n\r\n        elements.scrollToggle.style.display = '';\r\n\r\n        const distanceFromBottom = scrollHeight - (scrollTop + clientHeight);\r\n        const threshold = maxScrollable * 0.3;\r\n        const shouldScrollToTop = distanceFromBottom <= threshold;\r\n\r\n        elements.scrollToggle.classList.toggle('humata-scroll-toggle-top', shouldScrollToTop);\r\n\r\n        const labelTop = elements.scrollToggle.getAttribute('data-label-top') || 'Scroll to top';\r\n        const labelBottom = elements.scrollToggle.getAttribute('data-label-bottom') || 'Scroll to bottom';\r\n        const label = shouldScrollToTop ? labelTop : labelBottom;\r\n\r\n        elements.scrollToggle.setAttribute('title', label);\r\n        elements.scrollToggle.setAttribute('aria-label', label);\r\n    }\r\n\r\n    /**\r\n     * Handle scroll toggle click.\r\n     */\r\n    function handleScrollToggle() {\r\n        if (!elements.scrollToggle) {\r\n            return;\r\n        }\r\n\r\n        const shouldScrollToTop = elements.scrollToggle.classList.contains('humata-scroll-toggle-top');\r\n\r\n        if (isEmbedded && elements.messages) {\r\n            const targetTop = shouldScrollToTop ? 0 : elements.messages.scrollHeight;\r\n            elements.messages.scrollTo({\r\n                top: targetTop,\r\n                behavior: 'smooth'\r\n            });\r\n        } else {\r\n            const targetTop = shouldScrollToTop ? 0 : document.documentElement.scrollHeight;\r\n            window.scrollTo({\r\n                top: targetTop,\r\n                behavior: 'smooth'\r\n            });\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Handle input changes for auto-expanding textarea.\r\n     */\r\n    function handleInput() {\r\n        const textarea = elements.input;\r\n\r\n        // Reset height to auto to get the correct scrollHeight\r\n        textarea.style.height = 'auto';\r\n\r\n        // Calculate new height (max 5 rows)\r\n        const lineHeight = parseInt(getComputedStyle(textarea).lineHeight) || 24;\r\n        const maxHeight = lineHeight * 5;\r\n        const newHeight = Math.min(textarea.scrollHeight, maxHeight);\r\n\r\n        textarea.style.height = newHeight + 'px';\r\n\r\n        const tooLong = textarea.value.length > maxPromptChars;\r\n\r\n        updatePromptCounter();\r\n\r\n        // Enable/disable send button based on input\r\n        if (elements.sendButton) {\r\n            elements.sendButton.disabled = !textarea.value.trim() || tooLong;\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Handle keydown events in input.\r\n     *\r\n     * @param {KeyboardEvent} event - Keyboard event.\r\n     */\r\n    function handleKeyDown(event) {\r\n        if (event.key === 'Enter' && !event.shiftKey) {\r\n            event.preventDefault();\r\n            handleSend();\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Handle send button click.\r\n     */\r\n    function handleSend() {\r\n        const rawMessage = elements.input.value;\r\n        const message = rawMessage.trim();\r\n\r\n        if (!message || isLoading) {\r\n            return;\r\n        }\r\n\r\n        // Hide suggested questions on first send\r\n        hideSuggestedQuestions();\r\n\r\n        // Hide any existing follow-up questions\r\n        hideFollowUpQuestions();\r\n\r\n        if (rawMessage.length > maxPromptChars) {\r\n            const errorMessage = config.i18n?.errorPromptTooLong || ('Message is too long. Maximum is ' + maxPromptChars + ' characters.');\r\n            addMessage(errorMessage, 'bot', true);\r\n            if (elements.input) {\r\n                elements.input.focus();\r\n            }\r\n            return;\r\n        }\r\n\r\n        const history = getChatHistoryForRequest();\r\n\r\n        // Store user message for intent link matching\r\n        lastUserMessageForIntents = message;\r\n\r\n        // Add user message to chat\r\n        addMessage(message, 'user');\r\n\r\n        // Clear input\r\n        elements.input.value = '';\r\n        elements.input.style.height = 'auto';\r\n        if (elements.sendButton) {\r\n            elements.sendButton.disabled = true;\r\n        }\r\n\r\n        updatePromptCounter();\r\n\r\n        // Send to API\r\n        sendMessage(message, history);\r\n    }\r\n\r\n    function getChatHistoryForRequest() {\r\n        if (!elements.messages) return [];\r\n\r\n        const history = [];\r\n        const messageElements = elements.messages.querySelectorAll('.humata-message:not(#humata-welcome-message):not(.humata-message-loading)');\r\n\r\n        messageElements.forEach(function(el) {\r\n            const isUser = el.classList.contains('humata-message-user');\r\n            const isError = el.classList.contains('humata-message-error');\r\n\r\n            if (isError) {\r\n                return;\r\n            }\r\n\r\n            const content = el.querySelector('.humata-message-content');\r\n            if (!content) {\r\n                return;\r\n            }\r\n\r\n            const text = getMessagePlainText(content);\r\n            if (!text) {\r\n                return;\r\n            }\r\n\r\n            history.push({\r\n                type: isUser ? 'user' : 'bot',\r\n                content: text\r\n            });\r\n        });\r\n\r\n        return history;\r\n    }\r\n\r\n    /**\r\n     * Hide trigger pages after first user message.\r\n     */\r\n    function hideTriggerPages() {\r\n        const triggerPages = document.querySelector('.humata-trigger-pages');\r\n        if (triggerPages && !triggerPages.classList.contains('humata-trigger-pages--hidden')) {\r\n            triggerPages.classList.add('humata-trigger-pages--hidden');\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Add a message to the chat.\r\n     *\r\n     * @param {string} content - Message content.\r\n     * @param {string} type - Message type ('user' or 'bot').\r\n     * @param {boolean} isError - Whether this is an error message.\r\n     * @returns {HTMLElement} The message element.\r\n     */\r\n    function addMessage(content, type, isError = false) {\r\n        // Hide welcome message when first message is added\r\n        if (elements.welcomeMessage) {\r\n            elements.welcomeMessage.style.display = 'none';\r\n        }\r\n\r\n        // Hide trigger pages after first user message\r\n        if (type === 'user') {\r\n            hideTriggerPages();\r\n        }\r\n\r\n        const messageDiv = document.createElement('div');\r\n        messageDiv.className = 'humata-message humata-message-' + type;\r\n\r\n        if (isError) {\r\n            messageDiv.classList.add('humata-message-error');\r\n        }\r\n\r\n        // Avatar\r\n        const avatarDiv = document.createElement('div');\r\n        avatarDiv.className = 'humata-message-avatar';\r\n        setAvatarContent(avatarDiv, type);\r\n\r\n        // Content\r\n        const contentDiv = document.createElement('div');\r\n        contentDiv.className = 'humata-message-content';\r\n\r\n        // Parse markdown-like formatting for bot messages\r\n        if (type === 'bot' && !isError) {\r\n            contentDiv.innerHTML = formatMessage(content);\r\n        } else {\r\n            contentDiv.textContent = content;\r\n        }\r\n\r\n        ensureCopyButton(contentDiv);\r\n        if (type === 'bot') {\r\n            ensureRegenerateButton(contentDiv);\r\n        }\r\n        if (type === 'user' && !isError) {\r\n            ensureEditButton(contentDiv);\r\n        }\r\n\r\n        messageDiv.appendChild(avatarDiv);\r\n        messageDiv.appendChild(contentDiv);\r\n        elements.messages.appendChild(messageDiv);\r\n\r\n        // Update bot response disclaimer position for bot messages\r\n        if (type === 'bot' && !isError) {\r\n            updateBotResponseDisclaimerPosition();\r\n        }\r\n\r\n        // Scroll to bottom\r\n        scrollToBottom();\r\n\r\n        // Save to history\r\n        saveHistory();\r\n\r\n        return messageDiv;\r\n    }\r\n\r\n    /**\r\n     * Format message content with Markdown \u2192 HTML support for bot messages.\r\n     * Raw HTML is always escaped/treated as text for safety.\r\n     *\r\n     * @param {string} content - Raw message content.\r\n     * @returns {string} Formatted HTML content.\r\n     */\r\n    function formatMessage(content) {\r\n        if (!content) {\r\n            return '';\r\n        }\r\n\r\n        // Normalize newlines and escape raw HTML first.\r\n        let formatted = escapeHtml(String(content).replace(/\\r\\n?/g, '\\n'));\r\n\r\n        // Extract fenced code blocks (```lang ... ```) so we don't parse Markdown inside them.\r\n        const codeBlocks = [];\r\n        formatted = formatted.replace(/```([a-zA-Z0-9_-]*)\\n?([\\s\\S]*?)```/g, function(match, lang, code) {\r\n            const token = '%%HUMATA_CODEBLOCK_' + codeBlocks.length + '%%';\r\n            const safeLang = sanitizeCodeLanguage(lang || 'plaintext');\r\n            codeBlocks.push('<pre><code class=\"language-' + safeLang + '\">' + code.trim() + '</code></pre>');\r\n            // Surround with newlines so tokens become standalone blocks.\r\n            return '\\n' + token + '\\n';\r\n        });\r\n\r\n        // Render Markdown blocks into HTML.\r\n        let html = renderMarkdownBlocks(formatted);\r\n\r\n        // Merge consecutive ordered lists that were split by intervening content.\r\n        html = mergeConsecutiveOrderedLists(html);\r\n\r\n        // Restore code blocks.\r\n        html = html.replace(/%%HUMATA_CODEBLOCK_(\\d+)%%/g, function(match, idx) {\r\n            const i = parseInt(idx, 10);\r\n            return (Number.isFinite(i) && codeBlocks[i]) ? codeBlocks[i] : '';\r\n        });\r\n\r\n        return html;\r\n    }\r\n\r\n    /**\r\n     * Merge consecutive <ol> elements that are separated by other content.\r\n     * This handles AI responses that generate numbered lists with explanatory\r\n     * paragraphs or other content between numbered items.\r\n     *\r\n     * @param {string} html - The HTML string to process.\r\n     * @returns {string} HTML with consecutive ordered lists merged.\r\n     */\r\n    function mergeConsecutiveOrderedLists(html) {\r\n        if (!html || typeof html !== 'string') {\r\n            return html;\r\n        }\r\n\r\n        // Pattern: </ol> followed by content (not containing <ol or </ol>) followed by <ol>\r\n        // We merge by removing the </ol> and <ol> tags, keeping the content between.\r\n        // The content becomes part of the list (after the previous </li> and before the next <li>).\r\n        const pattern = /<\\/ol>(\\s*(?:<p>[\\s\\S]*?<\\/p>|<ul>[\\s\\S]*?<\\/ul>|<blockquote>[\\s\\S]*?<\\/blockquote>|<hr>)+\\s*)<ol>/g;\r\n\r\n        let result = html;\r\n        let prevResult = '';\r\n\r\n        // Keep merging until no more matches (handles multiple consecutive splits).\r\n        while (result !== prevResult) {\r\n            prevResult = result;\r\n            result = result.replace(pattern, function(match, betweenContent) {\r\n                // Insert the between content inside the list, after the last </li>.\r\n                return betweenContent + '</ol><ol>';\r\n            });\r\n        }\r\n\r\n        // Now remove empty </ol><ol> pairs that resulted from the merge.\r\n        result = result.replace(/<\\/ol>\\s*<ol>/g, '');\r\n\r\n        return result;\r\n    }\r\n\r\n    let humataHtmlEntityDecoder = null;\r\n\r\n    /**\r\n     * Decode HTML entities in a string (e.g., &amp; / &#x3A;).\r\n     * Used to validate link schemes safely.\r\n     *\r\n     * @param {string} text\r\n     * @returns {string}\r\n     */\r\n    function decodeHtmlEntities(text) {\r\n        if (text == null) {\r\n            return '';\r\n        }\r\n\r\n        if (!humataHtmlEntityDecoder) {\r\n            humataHtmlEntityDecoder = document.createElement('textarea');\r\n        }\r\n\r\n        humataHtmlEntityDecoder.innerHTML = String(text);\r\n        return humataHtmlEntityDecoder.value;\r\n    }\r\n\r\n    /**\r\n     * Sanitize a fenced code block language string for use in a CSS class name.\r\n     *\r\n     * @param {string} lang\r\n     * @returns {string}\r\n     */\r\n    function sanitizeCodeLanguage(lang) {\r\n        const clean = String(lang || '')\r\n            .toLowerCase()\r\n            .replace(/[^\\w-]+/g, '');\r\n        return clean || 'plaintext';\r\n    }\r\n\r\n    /**\r\n     * Sanitize link href to avoid unsafe schemes (e.g., javascript:).\r\n     * Returns an HTML-escaped href string safe to insert into an attribute, or an empty string.\r\n     *\r\n     * @param {string} href\r\n     * @returns {string}\r\n     */\r\n    function sanitizeLinkHref(href) {\r\n        if (!href) {\r\n            return '';\r\n        }\r\n\r\n        const decoded = decodeHtmlEntities(String(href)).trim();\r\n        if (!decoded) {\r\n            return '';\r\n        }\r\n\r\n        // Strip whitespace/control characters when evaluating scheme.\r\n        const cleaned = decoded.replace(/[\\u0000-\\u001F\\u007F\\s]+/g, '');\r\n        if (!cleaned) {\r\n            return '';\r\n        }\r\n\r\n        // Allow common relative forms and anchors.\r\n        if (\r\n            cleaned.startsWith('#') ||\r\n            cleaned.startsWith('/') ||\r\n            cleaned.startsWith('./') ||\r\n            cleaned.startsWith('../') ||\r\n            cleaned.startsWith('?') ||\r\n            cleaned.startsWith('//')\r\n        ) {\r\n            return escapeHtml(decoded);\r\n        }\r\n\r\n        const schemeMatch = cleaned.match(/^([a-zA-Z][a-zA-Z0-9+.-]*):/);\r\n        if (schemeMatch) {\r\n            const scheme = (schemeMatch[1] || '').toLowerCase();\r\n            const allowed = scheme === 'http' || scheme === 'https' || scheme === 'mailto' || scheme === 'tel';\r\n            if (!allowed) {\r\n                return '';\r\n            }\r\n        }\r\n\r\n        return escapeHtml(decoded);\r\n    }\r\n\r\n    let humataPreparedAutoLinks = null;\r\n\r\n    function humataIsWordChar(ch) {\r\n        return !!ch && /[A-Za-z0-9]/.test(ch);\r\n    }\r\n\r\n    function getPreparedAutoLinks() {\r\n        if (humataPreparedAutoLinks !== null) {\r\n            return humataPreparedAutoLinks;\r\n        }\r\n\r\n        const raw = Array.isArray(config.autoLinks) ? config.autoLinks : [];\r\n        const prepared = [];\r\n\r\n        for (let i = 0; i < raw.length; i++) {\r\n            const row = raw[i];\r\n            if (!row || typeof row !== 'object') {\r\n                continue;\r\n            }\r\n\r\n            const phrase = String(row.phrase || '').trim();\r\n            const url = String(row.url || '').trim();\r\n            if (!phrase || !url) {\r\n                continue;\r\n            }\r\n\r\n            const safeHrefEscaped = sanitizeLinkHref(url);\r\n            if (!safeHrefEscaped) {\r\n                continue;\r\n            }\r\n\r\n            prepared.push({\r\n                phrase: phrase,\r\n                phraseLower: phrase.toLowerCase(),\r\n                href: decodeHtmlEntities(safeHrefEscaped),\r\n                len: phrase.length,\r\n                startsWord: humataIsWordChar(phrase.charAt(0)),\r\n                endsWord: humataIsWordChar(phrase.charAt(phrase.length - 1))\r\n            });\r\n\r\n            if (prepared.length >= 200) {\r\n                break;\r\n            }\r\n        }\r\n\r\n        prepared.sort(function(a, b) {\r\n            return b.len - a.len;\r\n        });\r\n\r\n        humataPreparedAutoLinks = prepared;\r\n        return humataPreparedAutoLinks;\r\n    }\r\n\r\n    function humataFindAutoLinkMatches(text, rules) {\r\n        if (!text) {\r\n            return [];\r\n        }\r\n\r\n        const haystack = String(text);\r\n        const lower = haystack.toLowerCase();\r\n        const matches = [];\r\n\r\n        function overlaps(start, end) {\r\n            for (let i = 0; i < matches.length; i++) {\r\n                const m = matches[i];\r\n                if (start < m.end && m.start < end) {\r\n                    return true;\r\n                }\r\n            }\r\n            return false;\r\n        }\r\n\r\n        for (let r = 0; r < rules.length; r++) {\r\n            const rule = rules[r];\r\n            if (!rule || !rule.phraseLower) {\r\n                continue;\r\n            }\r\n\r\n            let idx = 0;\r\n            while (true) {\r\n                idx = lower.indexOf(rule.phraseLower, idx);\r\n                if (idx === -1) {\r\n                    break;\r\n                }\r\n\r\n                const start = idx;\r\n                const end = idx + rule.phraseLower.length;\r\n\r\n                // Boundary checks: avoid matching inside other words (e.g., \"Liver\" inside \"Deliver\").\r\n                if (rule.startsWord) {\r\n                    const before = start > 0 ? haystack.charAt(start - 1) : '';\r\n                    if (before && humataIsWordChar(before)) {\r\n                        idx = idx + 1;\r\n                        continue;\r\n                    }\r\n                }\r\n                if (rule.endsWord) {\r\n                    const after = end < haystack.length ? haystack.charAt(end) : '';\r\n                    if (after && humataIsWordChar(after)) {\r\n                        idx = idx + 1;\r\n                        continue;\r\n                    }\r\n                }\r\n\r\n                if (!overlaps(start, end)) {\r\n                    matches.push({\r\n                        start: start,\r\n                        end: end,\r\n                        href: rule.href\r\n                    });\r\n                }\r\n\r\n                idx = end;\r\n            }\r\n        }\r\n\r\n        return matches;\r\n    }\r\n\r\n    function humataApplyAutoLinksToInlineHtml(html) {\r\n        if (!html) {\r\n            return html;\r\n        }\r\n\r\n        const rules = getPreparedAutoLinks();\r\n        if (!rules || !rules.length) {\r\n            return html;\r\n        }\r\n\r\n        if (typeof document === 'undefined' || !document.createElement || !document.createTreeWalker || typeof NodeFilter === 'undefined') {\r\n            return html;\r\n        }\r\n\r\n        const container = document.createElement('div');\r\n        try {\r\n            container.innerHTML = String(html);\r\n        } catch (e) {\r\n            return html;\r\n        }\r\n\r\n        let walker;\r\n        try {\r\n            walker = document.createTreeWalker(container, NodeFilter.SHOW_TEXT, {\r\n                acceptNode: function(node) {\r\n                    const value = node && node.nodeValue ? String(node.nodeValue) : '';\r\n                    if (!value || !value.trim()) {\r\n                        return NodeFilter.FILTER_REJECT;\r\n                    }\r\n\r\n                    // Skip text inside existing links (avoid nested anchors) and code/pre blocks.\r\n                    let p = node.parentNode;\r\n                    while (p && p !== container) {\r\n                        const name = p.nodeName;\r\n                        if (name === 'A' || name === 'CODE' || name === 'PRE') {\r\n                            return NodeFilter.FILTER_REJECT;\r\n                        }\r\n                        p = p.parentNode;\r\n                    }\r\n\r\n                    return NodeFilter.FILTER_ACCEPT;\r\n                }\r\n            });\r\n        } catch (e) {\r\n            return html;\r\n        }\r\n\r\n        const nodes = [];\r\n        let node;\r\n        while ((node = walker.nextNode())) {\r\n            nodes.push(node);\r\n        }\r\n\r\n        for (let i = 0; i < nodes.length; i++) {\r\n            const textNode = nodes[i];\r\n            const text = textNode && textNode.nodeValue ? String(textNode.nodeValue) : '';\r\n            if (!text) {\r\n                continue;\r\n            }\r\n\r\n            const matches = humataFindAutoLinkMatches(text, rules);\r\n            if (!matches.length) {\r\n                continue;\r\n            }\r\n\r\n            matches.sort(function(a, b) {\r\n                return a.start - b.start;\r\n            });\r\n\r\n            const frag = document.createDocumentFragment();\r\n            let lastIndex = 0;\r\n\r\n            for (let m = 0; m < matches.length; m++) {\r\n                const match = matches[m];\r\n                if (!match || match.start < lastIndex) {\r\n                    continue;\r\n                }\r\n\r\n                if (match.start > lastIndex) {\r\n                    frag.appendChild(document.createTextNode(text.slice(lastIndex, match.start)));\r\n                }\r\n\r\n                const a = document.createElement('a');\r\n                a.setAttribute('href', match.href);\r\n                a.setAttribute('target', '_blank');\r\n                a.setAttribute('rel', 'noopener noreferrer');\r\n                a.textContent = text.slice(match.start, match.end);\r\n                frag.appendChild(a);\r\n\r\n                lastIndex = match.end;\r\n            }\r\n\r\n            if (lastIndex < text.length) {\r\n                frag.appendChild(document.createTextNode(text.slice(lastIndex)));\r\n            }\r\n\r\n            if (textNode.parentNode) {\r\n                textNode.parentNode.replaceChild(frag, textNode);\r\n            }\r\n        }\r\n\r\n        return container.innerHTML;\r\n    }\r\n\r\n    function isBlankLine(line) {\r\n        return !line || /^\\s*$/.test(line);\r\n    }\r\n\r\n    function isCodeBlockTokenLine(line) {\r\n        return /^%%HUMATA_CODEBLOCK_\\d+%%$/.test(String(line || '').trim());\r\n    }\r\n\r\n    function isHorizontalRuleLine(line) {\r\n        return /^\\s{0,3}(-{3,}|\\*{3,})\\s*$/.test(String(line || ''));\r\n    }\r\n\r\n    function parseHeadingLine(line) {\r\n        const match = String(line || '').match(/^\\s{0,3}(#{1,6})\\s+(.+?)\\s*$/);\r\n        if (!match) {\r\n            return null;\r\n        }\r\n        return {\r\n            level: match[1].length,\r\n            text: match[2]\r\n        };\r\n    }\r\n\r\n    function isBlockquoteLine(line) {\r\n        return /^\\s{0,3}>\\s?/.test(String(line || ''));\r\n    }\r\n\r\n    function stripBlockquotePrefix(line) {\r\n        return String(line || '').replace(/^\\s{0,3}>\\s?/, '');\r\n    }\r\n\r\n    function isUnorderedListLine(line) {\r\n        return /^\\s{0,3}[-+*]\\s+/.test(String(line || ''));\r\n    }\r\n\r\n    function isOrderedListLine(line) {\r\n        return /^\\s{0,3}\\d+\\.\\s+/.test(String(line || ''));\r\n    }\r\n\r\n    /**\r\n     * Render inline Markdown within a single block of text.\r\n     *\r\n     * @param {string} text - HTML-escaped text.\r\n     * @returns {string}\r\n     */\r\n    function renderInlineMarkdown(text) {\r\n        if (!text) {\r\n            return '';\r\n        }\r\n\r\n        let out = String(text);\r\n\r\n        // Protect inline code spans first so we don't apply other formatting within them.\r\n        const codeSpans = [];\r\n        out = out.replace(/`([^`]+)`/g, function(match, code) {\r\n            const token = '%%HUMATA_CODESPAN_' + codeSpans.length + '%%';\r\n            codeSpans.push('<code>' + code + '</code>');\r\n            return token;\r\n        });\r\n\r\n        // Links: [label](url)\r\n        out = out.replace(/\\[([^\\]]+)\\]\\(([^)]+)\\)/g, function(match, label, url) {\r\n            const safeHref = sanitizeLinkHref(url);\r\n            if (!safeHref) {\r\n                // Render as plain text if unsafe.\r\n                return label + ' (' + url + ')';\r\n            }\r\n            return '<a href=\"' + safeHref + '\" target=\"_blank\" rel=\"noopener noreferrer\">' + label + '</a>';\r\n        });\r\n\r\n        // Bold: **text**\r\n        out = out.replace(/\\*\\*([^*]+)\\*\\*/g, '<strong>$1</strong>');\r\n\r\n        // Italic: *text* (avoid consuming **bold**)\r\n        out = out.replace(/(^|[^*])\\*([^*\\n]+)\\*(?!\\*)/g, '$1<em>$2</em>');\r\n\r\n        // Auto-link configured phrases while avoiding existing anchors and code tokens.\r\n        out = humataApplyAutoLinksToInlineHtml(out);\r\n\r\n        // Restore code spans.\r\n        out = out.replace(/%%HUMATA_CODESPAN_(\\d+)%%/g, function(match, idx) {\r\n            const i = parseInt(idx, 10);\r\n            return (Number.isFinite(i) && codeSpans[i]) ? codeSpans[i] : match;\r\n        });\r\n\r\n        return out;\r\n    }\r\n\r\n    /**\r\n     * Render a limited, safe subset of Markdown into HTML block elements.\r\n     *\r\n     * @param {string} text - HTML-escaped text.\r\n     * @returns {string}\r\n     */\r\n    function renderMarkdownBlocks(text) {\r\n        if (!text) {\r\n            return '';\r\n        }\r\n\r\n        const lines = String(text).split('\\n');\r\n        const out = [];\r\n        let i = 0;\r\n\r\n        while (i < lines.length) {\r\n            const line = lines[i];\r\n\r\n            if (isBlankLine(line)) {\r\n                i++;\r\n                continue;\r\n            }\r\n\r\n            // Standalone code block token (block-level).\r\n            if (isCodeBlockTokenLine(line)) {\r\n                out.push(String(line).trim());\r\n                i++;\r\n                continue;\r\n            }\r\n\r\n            // Horizontal rule.\r\n            if (isHorizontalRuleLine(line)) {\r\n                out.push('<hr>');\r\n                i++;\r\n                continue;\r\n            }\r\n\r\n            // Heading.\r\n            const heading = parseHeadingLine(line);\r\n            if (heading) {\r\n                out.push('<h' + heading.level + '>' + renderInlineMarkdown(heading.text) + '</h' + heading.level + '>');\r\n                i++;\r\n                continue;\r\n            }\r\n\r\n            // Blockquote.\r\n            if (isBlockquoteLine(line)) {\r\n                const quoteLines = [];\r\n                while (i < lines.length && isBlockquoteLine(lines[i])) {\r\n                    quoteLines.push(stripBlockquotePrefix(lines[i]));\r\n                    i++;\r\n                }\r\n                out.push('<blockquote>' + renderMarkdownBlocks(quoteLines.join('\\n')) + '</blockquote>');\r\n                continue;\r\n            }\r\n\r\n            // Unordered list.\r\n            if (isUnorderedListLine(line)) {\r\n                const items = [];\r\n                while (i < lines.length) {\r\n                    const current = lines[i];\r\n\r\n                    if (isBlankLine(current)) {\r\n                        // Allow blank lines within a list if the next non-blank continues it.\r\n                        let j = i + 1;\r\n                        while (j < lines.length && isBlankLine(lines[j])) {\r\n                            j++;\r\n                        }\r\n                        if (j < lines.length && isUnorderedListLine(lines[j])) {\r\n                            i = j;\r\n                            continue;\r\n                        }\r\n                        break;\r\n                    }\r\n\r\n                    if (!isUnorderedListLine(current)) {\r\n                        break;\r\n                    }\r\n\r\n                    const itemText = String(current).replace(/^\\s{0,3}[-+*]\\s+/, '');\r\n                    items.push('<li>' + renderInlineMarkdown(itemText) + '</li>');\r\n                    i++;\r\n                }\r\n\r\n                out.push('<ul>' + items.join('') + '</ul>');\r\n                continue;\r\n            }\r\n\r\n            // Ordered list.\r\n            if (isOrderedListLine(line)) {\r\n                const items = [];\r\n                while (i < lines.length) {\r\n                    const current = lines[i];\r\n\r\n                    if (isBlankLine(current)) {\r\n                        let j = i + 1;\r\n                        while (j < lines.length && isBlankLine(lines[j])) {\r\n                            j++;\r\n                        }\r\n                        if (j < lines.length && isOrderedListLine(lines[j])) {\r\n                            i = j;\r\n                            continue;\r\n                        }\r\n                        break;\r\n                    }\r\n\r\n                    if (!isOrderedListLine(current)) {\r\n                        break;\r\n                    }\r\n\r\n                    const itemText = String(current).replace(/^\\s{0,3}\\d+\\.\\s+/, '');\r\n                    items.push('<li>' + renderInlineMarkdown(itemText) + '</li>');\r\n                    i++;\r\n                }\r\n\r\n                out.push('<ol>' + items.join('') + '</ol>');\r\n                continue;\r\n            }\r\n\r\n            // Paragraph: gather consecutive non-blank, non-block-start lines.\r\n            const paraLines = [];\r\n            while (i < lines.length) {\r\n                const current = lines[i];\r\n\r\n                if (isBlankLine(current)) {\r\n                    break;\r\n                }\r\n\r\n                if (\r\n                    isCodeBlockTokenLine(current) ||\r\n                    isHorizontalRuleLine(current) ||\r\n                    parseHeadingLine(current) ||\r\n                    isBlockquoteLine(current) ||\r\n                    isUnorderedListLine(current) ||\r\n                    isOrderedListLine(current)\r\n                ) {\r\n                    break;\r\n                }\r\n\r\n                paraLines.push(String(current).trim());\r\n                i++;\r\n            }\r\n\r\n            const paraText = paraLines.join(' ').trim();\r\n            if (paraText) {\r\n                out.push('<p>' + renderInlineMarkdown(paraText) + '</p>');\r\n            }\r\n        }\r\n\r\n        return out.join('');\r\n    }\r\n\r\n    /**\r\n     * Escape HTML special characters.\r\n     *\r\n     * @param {string} text - Text to escape.\r\n     * @returns {string} Escaped text.\r\n     */\r\n    function escapeHtml(text) {\r\n        const div = document.createElement('div');\r\n        div.textContent = text;\r\n        return div.innerHTML;\r\n    }\r\n\r\n    function getOrCreateMessageActionsContainer(contentEl) {\r\n        if (!contentEl) {\r\n            return null;\r\n        }\r\n\r\n        let actionsEl = contentEl.querySelector('.humata-message-actions');\r\n        if (actionsEl) {\r\n            return actionsEl;\r\n        }\r\n\r\n        actionsEl = document.createElement('div');\r\n        actionsEl.className = 'humata-message-actions';\r\n        contentEl.appendChild(actionsEl);\r\n        return actionsEl;\r\n    }\r\n\r\n    function ensureCopyButton(contentEl) {\r\n        if (!contentEl || contentEl.querySelector('.humata-copy-button')) {\r\n            return;\r\n        }\r\n\r\n        contentEl.classList.add('humata-message-content-has-copy');\r\n\r\n        const button = document.createElement('button');\r\n        button.type = 'button';\r\n        button.className = 'humata-copy-button';\r\n        button.innerHTML = getCopyIconSvg();\r\n        button.setAttribute('title', 'Copy');\r\n        button.setAttribute('aria-label', 'Copy message');\r\n\r\n        const actionsEl = getOrCreateMessageActionsContainer(contentEl);\r\n        if (!actionsEl) {\r\n            return;\r\n        }\r\n\r\n        actionsEl.appendChild(button);\r\n    }\r\n\r\n    function ensureRegenerateButton(contentEl) {\r\n        if (!contentEl || contentEl.querySelector('.humata-regenerate-button')) {\r\n            return;\r\n        }\r\n\r\n        contentEl.classList.add('humata-message-content-has-regenerate');\r\n\r\n        const button = document.createElement('button');\r\n        button.type = 'button';\r\n        button.className = 'humata-regenerate-button';\r\n        button.innerHTML = getRegenerateIconSvg();\r\n        button.setAttribute('title', config.i18n?.regenerate || 'Regenerate');\r\n        button.setAttribute('aria-label', config.i18n?.regenerate || 'Regenerate');\r\n\r\n        const actionsEl = getOrCreateMessageActionsContainer(contentEl);\r\n        if (!actionsEl) {\r\n            return;\r\n        }\r\n\r\n        actionsEl.appendChild(button);\r\n    }\r\n\r\n    function ensureEditButton(contentEl) {\r\n        if (!contentEl || contentEl.querySelector('.humata-edit-button')) {\r\n            return;\r\n        }\r\n\r\n        contentEl.classList.add('humata-message-content-has-edit');\r\n\r\n        const button = document.createElement('button');\r\n        button.type = 'button';\r\n        button.className = 'humata-edit-button';\r\n        button.innerHTML = getEditIconSvg();\r\n        button.setAttribute('title', config.i18n?.editMessage || 'Edit message');\r\n        button.setAttribute('aria-label', config.i18n?.editMessage || 'Edit message');\r\n\r\n        const actionsEl = getOrCreateMessageActionsContainer(contentEl);\r\n        if (!actionsEl) {\r\n            return;\r\n        }\r\n\r\n        actionsEl.appendChild(button);\r\n    }\r\n\r\n    function getMessagePlainText(contentEl) {\r\n        const editTextarea = contentEl ? contentEl.querySelector('.humata-edit-textarea') : null;\r\n        if (editTextarea) {\r\n            return (editTextarea.value || '').trim();\r\n        }\r\n\r\n        const cloned = contentEl.cloneNode(true);\r\n        cloned.querySelectorAll('.humata-copy-button').forEach(function(btn) {\r\n            btn.remove();\r\n        });\r\n        cloned.querySelectorAll('.humata-regenerate-button').forEach(function(btn) {\r\n            btn.remove();\r\n        });\r\n        cloned.querySelectorAll('.humata-edit-button').forEach(function(btn) {\r\n            btn.remove();\r\n        });\r\n        cloned.querySelectorAll('.humata-edit-actions').forEach(function(el) {\r\n            el.remove();\r\n        });\r\n        cloned.querySelectorAll('.humata-message-actions').forEach(function(el) {\r\n            el.remove();\r\n        });\r\n        cloned.querySelectorAll('.humata-bot-response-disclaimer').forEach(function(el) {\r\n            el.remove();\r\n        });\r\n        cloned.querySelectorAll('.humata-intent-links').forEach(function(el) {\r\n            el.remove();\r\n        });\r\n        cloned.querySelectorAll('.humata-accordions').forEach(function(el) {\r\n            el.remove();\r\n        });\r\n        return ((cloned.innerText || cloned.textContent || '') + '').trim();\r\n    }\r\n\r\n    function getMessageHtmlForStorage(contentEl) {\r\n        const cloned = contentEl.cloneNode(true);\r\n        cloned.querySelectorAll('.humata-copy-button').forEach(function(btn) {\r\n            btn.remove();\r\n        });\r\n        cloned.querySelectorAll('.humata-regenerate-button').forEach(function(btn) {\r\n            btn.remove();\r\n        });\r\n        cloned.querySelectorAll('.humata-edit-button').forEach(function(btn) {\r\n            btn.remove();\r\n        });\r\n        cloned.querySelectorAll('.humata-edit-actions').forEach(function(el) {\r\n            el.remove();\r\n        });\r\n        cloned.querySelectorAll('.humata-message-actions').forEach(function(el) {\r\n            el.remove();\r\n        });\r\n        cloned.querySelectorAll('.humata-bot-response-disclaimer').forEach(function(el) {\r\n            el.remove();\r\n        });\r\n        cloned.querySelectorAll('.humata-intent-links').forEach(function(el) {\r\n            el.remove();\r\n        });\r\n        cloned.querySelectorAll('.humata-accordions').forEach(function(el) {\r\n            el.remove();\r\n        });\r\n        return cloned.innerHTML;\r\n    }\r\n\r\n    function getMessageClipboardPayload(contentEl) {\r\n        const editTextarea = contentEl ? contentEl.querySelector('.humata-edit-textarea') : null;\r\n        if (editTextarea) {\r\n            const text = (editTextarea.value || '').trim();\r\n            return {\r\n                text: text,\r\n                html: text ? '<div>' + escapeHtml(text).replace(/\\n/g, '<br>') + '</div>' : ''\r\n            };\r\n        }\r\n\r\n        const innerHtml = contentEl ? getMessageHtmlForStorage(contentEl) : '';\r\n        if (!innerHtml) {\r\n            return { text: '', html: '' };\r\n        }\r\n\r\n        return {\r\n            text: htmlFragmentToPlainText(innerHtml),\r\n            html: '<div>' + innerHtml + '</div>'\r\n        };\r\n    }\r\n\r\n    function htmlFragmentToPlainText(html) {\r\n        if (!html) {\r\n            return '';\r\n        }\r\n\r\n        const container = document.createElement('div');\r\n        container.innerHTML = html;\r\n\r\n        const text = domNodeToPlainText(container, { listStack: [] });\r\n\r\n        return String(text || '')\r\n            .replace(/\\r\\n?/g, '\\n')\r\n            .replace(/[ \\t]+\\n/g, '\\n')\r\n            .replace(/\\n{3,}/g, '\\n\\n')\r\n            .trim();\r\n    }\r\n\r\n    function domNodeToPlainText(node, ctx) {\r\n        if (!node) {\r\n            return '';\r\n        }\r\n\r\n        const type = node.nodeType;\r\n        // Text node\r\n        if (type === 3) {\r\n            return node.nodeValue || '';\r\n        }\r\n\r\n        // Only process elements\r\n        if (type !== 1) {\r\n            return '';\r\n        }\r\n\r\n        const tag = (node.tagName || '').toLowerCase();\r\n\r\n        function childrenText() {\r\n            let out = '';\r\n            const children = node.childNodes || [];\r\n            for (let i = 0; i < children.length; i++) {\r\n                out += domNodeToPlainText(children[i], ctx);\r\n            }\r\n            return out;\r\n        }\r\n\r\n        function ensureEndsWithNewline(out) {\r\n            if (!out) {\r\n                return '\\n';\r\n            }\r\n            return out.endsWith('\\n') ? out : out + '\\n';\r\n        }\r\n\r\n        function ensureBlankLine(out) {\r\n            let t = ensureEndsWithNewline(out);\r\n            if (!t.endsWith('\\n\\n')) {\r\n                t += '\\n';\r\n            }\r\n            return t;\r\n        }\r\n\r\n        if (tag === 'br') {\r\n            return '\\n';\r\n        }\r\n\r\n        if (tag === 'hr') {\r\n            return '\\n\\n';\r\n        }\r\n\r\n        if (tag === 'pre') {\r\n            const block = node.textContent || '';\r\n            return ensureBlankLine(block.replace(/\\n$/, ''));\r\n        }\r\n\r\n        if (tag === 'p' || tag === 'div' || tag === 'section') {\r\n            const t = childrenText().trim();\r\n            return t ? ensureBlankLine(t) : '';\r\n        }\r\n\r\n        if (tag === 'blockquote') {\r\n            const t = childrenText().trim();\r\n            return t ? ensureBlankLine(t) : '';\r\n        }\r\n\r\n        if (/^h[1-6]$/.test(tag)) {\r\n            const t = childrenText().trim();\r\n            return t ? ensureBlankLine(t) : '';\r\n        }\r\n\r\n        if (tag === 'ul' || tag === 'ol') {\r\n            ctx.listStack.push({ type: tag, index: 0 });\r\n            let out = '';\r\n            const children = node.childNodes || [];\r\n            for (let i = 0; i < children.length; i++) {\r\n                out += domNodeToPlainText(children[i], ctx);\r\n            }\r\n            ctx.listStack.pop();\r\n            return ensureBlankLine(out.trim());\r\n        }\r\n\r\n        if (tag === 'li') {\r\n            const stack = ctx.listStack || [];\r\n            const current = stack.length ? stack[stack.length - 1] : null;\r\n            let prefix = '- ';\r\n            if (current && current.type === 'ol') {\r\n                current.index += 1;\r\n                prefix = String(current.index) + '. ';\r\n            } else if (current && current.type === 'ul') {\r\n                prefix = '\u2022 ';\r\n            }\r\n\r\n            const indent = stack.length > 1 ? '  '.repeat(stack.length - 1) : '';\r\n            const t = childrenText().trim();\r\n            return t ? indent + prefix + t + '\\n' : '';\r\n        }\r\n\r\n        // Default inline-ish handling\r\n        return childrenText();\r\n    }\r\n\r\n    function copyToClipboard(payload) {\r\n        if (payload == null) {\r\n            return Promise.reject(new Error('Nothing to copy'));\r\n        }\r\n\r\n        // Backward-compatible plain text copy\r\n        if (typeof payload === 'string') {\r\n            return copyPlainTextToClipboard(payload);\r\n        }\r\n\r\n        const text = String(payload.text || '');\r\n        const html = String(payload.html || '');\r\n\r\n        // Prefer the modern async clipboard API when available.\r\n        if (html && navigator.clipboard && navigator.clipboard.write && typeof ClipboardItem !== 'undefined') {\r\n            try {\r\n                const item = new ClipboardItem({\r\n                    'text/plain': new Blob([text], { type: 'text/plain' }),\r\n                    'text/html': new Blob([html], { type: 'text/html' })\r\n                });\r\n\r\n                return navigator.clipboard.write([item]).catch(function() {\r\n                    // Fall back to selection-based copy when permissions are denied.\r\n                    return copyHtmlWithSelection(html);\r\n                });\r\n            } catch (e) {\r\n                // Fall through to legacy method\r\n            }\r\n        }\r\n\r\n        if (html) {\r\n            return copyHtmlWithSelection(html);\r\n        }\r\n\r\n        return copyPlainTextToClipboard(text);\r\n    }\r\n\r\n    function copyHtmlWithSelection(html) {\r\n        return new Promise(function(resolve, reject) {\r\n            try {\r\n                const container = document.createElement('div');\r\n                container.setAttribute('aria-hidden', 'true');\r\n                container.style.position = 'fixed';\r\n                container.style.left = '-9999px';\r\n                container.style.top = '0';\r\n                container.style.width = '1px';\r\n                container.style.height = '1px';\r\n                container.style.overflow = 'hidden';\r\n                container.innerHTML = html;\r\n                document.body.appendChild(container);\r\n\r\n                const selection = window.getSelection ? window.getSelection() : null;\r\n                const savedRanges = [];\r\n                if (selection && selection.rangeCount) {\r\n                    for (let i = 0; i < selection.rangeCount; i++) {\r\n                        savedRanges.push(selection.getRangeAt(i).cloneRange());\r\n                    }\r\n                }\r\n\r\n                if (selection) {\r\n                    const range = document.createRange();\r\n                    range.selectNodeContents(container);\r\n                    selection.removeAllRanges();\r\n                    selection.addRange(range);\r\n                }\r\n\r\n                const successful = document.execCommand('copy');\r\n\r\n                if (selection) {\r\n                    selection.removeAllRanges();\r\n                    for (let i = 0; i < savedRanges.length; i++) {\r\n                        selection.addRange(savedRanges[i]);\r\n                    }\r\n                }\r\n\r\n                container.remove();\r\n\r\n                if (successful) {\r\n                    resolve();\r\n                } else {\r\n                    reject(new Error('Copy failed'));\r\n                }\r\n            } catch (e) {\r\n                reject(e);\r\n            }\r\n        });\r\n    }\r\n\r\n    function copyPlainTextToClipboard(text) {\r\n        if (navigator.clipboard && navigator.clipboard.writeText) {\r\n            return navigator.clipboard.writeText(text).catch(function() {\r\n                return copyPlainTextWithTextarea(text);\r\n            });\r\n        }\r\n\r\n        return copyPlainTextWithTextarea(text);\r\n    }\r\n\r\n    function copyPlainTextWithTextarea(text) {\r\n        return new Promise(function(resolve, reject) {\r\n            try {\r\n                const textarea = document.createElement('textarea');\r\n                textarea.value = String(text || '');\r\n                textarea.setAttribute('readonly', '');\r\n                textarea.style.position = 'fixed';\r\n                textarea.style.top = '-9999px';\r\n                textarea.style.left = '-9999px';\r\n                document.body.appendChild(textarea);\r\n                textarea.select();\r\n                textarea.setSelectionRange(0, textarea.value.length);\r\n                const successful = document.execCommand('copy');\r\n                textarea.remove();\r\n                if (successful) {\r\n                    resolve();\r\n                } else {\r\n                    reject(new Error('Copy failed'));\r\n                }\r\n            } catch (e) {\r\n                reject(e);\r\n            }\r\n        });\r\n    }\r\n\r\n    function indicateCopySuccess(button) {\r\n        if (!button) {\r\n            return;\r\n        }\r\n\r\n        if (!button.dataset.humataCopyDefault) {\r\n            button.dataset.humataCopyDefault = button.innerHTML;\r\n        }\r\n\r\n        if (button._humataCopyResetTimer) {\r\n            clearTimeout(button._humataCopyResetTimer);\r\n        }\r\n\r\n        button.innerHTML = getCheckIconSvg();\r\n        button.classList.add('humata-copy-button-success');\r\n        button.setAttribute('title', 'Copied');\r\n        button.setAttribute('aria-label', 'Copied');\r\n\r\n        button._humataCopyResetTimer = setTimeout(function() {\r\n            button.innerHTML = button.dataset.humataCopyDefault;\r\n            button.classList.remove('humata-copy-button-success');\r\n            button.setAttribute('title', 'Copy');\r\n            button.setAttribute('aria-label', 'Copy message');\r\n        }, 1500);\r\n    }\r\n\r\n    function indicateCopyFailure(button) {\r\n        if (!button) {\r\n            return;\r\n        }\r\n\r\n        button.setAttribute('title', 'Copy failed');\r\n        button.setAttribute('aria-label', 'Copy failed');\r\n\r\n        if (button._humataCopyResetTimer) {\r\n            clearTimeout(button._humataCopyResetTimer);\r\n        }\r\n\r\n        button._humataCopyResetTimer = setTimeout(function() {\r\n            button.setAttribute('title', 'Copy');\r\n            button.setAttribute('aria-label', 'Copy message');\r\n        }, 1500);\r\n    }\r\n\r\n    function getCopyIconSvg() {\r\n        return '<svg xmlns=\"http://www.w3.org/2000/svg\" width=\"16\" height=\"16\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"1.5\" stroke-linecap=\"round\" stroke-linejoin=\"round\"><rect x=\"9\" y=\"9\" width=\"13\" height=\"13\" rx=\"2\" ry=\"2\"></rect><path d=\"M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1\"></path></svg>';\r\n    }\r\n\r\n    function getEditIconSvg() {\r\n        return '<svg xmlns=\"http://www.w3.org/2000/svg\" width=\"16\" height=\"16\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"1.5\" stroke-linecap=\"round\" stroke-linejoin=\"round\"><path d=\"M12 20h9\"></path><path d=\"M16.5 3.5a2.121 2.121 0 0 1 3 3L7 19l-4 1 1-4Z\"></path></svg>';\r\n    }\r\n\r\n    function getRegenerateIconSvg() {\r\n        return '<svg xmlns=\"http://www.w3.org/2000/svg\" width=\"16\" height=\"16\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"1.5\" stroke-linecap=\"round\" stroke-linejoin=\"round\"><polyline points=\"23 4 23 10 17 10\"></polyline><polyline points=\"1 20 1 14 7 14\"></polyline><path d=\"M3.51 9a9 9 0 0 1 14.13-3.36L23 10\"></path><path d=\"M1 14l5.36 5.36A9 9 0 0 0 20.49 15\"></path></svg>';\r\n    }\r\n\r\n    function getCheckIconSvg() {\r\n        return '<svg xmlns=\"http://www.w3.org/2000/svg\" width=\"16\" height=\"16\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"1.5\" stroke-linecap=\"round\" stroke-linejoin=\"round\"><path d=\"M20 6 9 17l-5-5\"></path></svg>';\r\n    }\r\n\r\n    function getXIconSvg() {\r\n        return '<svg xmlns=\"http://www.w3.org/2000/svg\" width=\"16\" height=\"16\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"1.5\" stroke-linecap=\"round\" stroke-linejoin=\"round\"><path d=\"M18 6 6 18\"></path><path d=\"m6 6 12 12\"></path></svg>';\r\n    }\r\n\r\n    /**\r\n     * Get or create the bot response disclaimer element.\r\n     * Returns null if no disclaimer is configured.\r\n     *\r\n     * @returns {HTMLElement|null}\r\n     */\r\n    function getBotResponseDisclaimerElement() {\r\n        const disclaimerHtml = config.botResponseDisclaimer;\r\n        if (!disclaimerHtml || typeof disclaimerHtml !== 'string' || !disclaimerHtml.trim()) {\r\n            return null;\r\n        }\r\n\r\n        let disclaimerEl = document.getElementById('humata-bot-response-disclaimer');\r\n        if (!disclaimerEl) {\r\n            disclaimerEl = document.createElement('div');\r\n            disclaimerEl.id = 'humata-bot-response-disclaimer';\r\n            disclaimerEl.className = 'humata-bot-response-disclaimer';\r\n            disclaimerEl.innerHTML = '<p>' + disclaimerHtml + '</p>';\r\n        }\r\n\r\n        return disclaimerEl;\r\n    }\r\n\r\n    /**\r\n     * Update the position of the bot response disclaimer to be inside the\r\n     * latest non-error bot message's content (after the message actions).\r\n     * Hides it if no suitable bot message exists.\r\n     */\r\n    function updateBotResponseDisclaimerPosition() {\r\n        const disclaimerEl = getBotResponseDisclaimerElement();\r\n        if (!disclaimerEl) {\r\n            return;\r\n        }\r\n\r\n        if (!elements.messages) {\r\n            disclaimerEl.remove();\r\n            return;\r\n        }\r\n\r\n        // Find the latest non-error, non-loading bot message\r\n        const botMessages = elements.messages.querySelectorAll(\r\n            '.humata-message-bot:not(.humata-message-error):not(.humata-message-loading):not(#humata-welcome-message)'\r\n        );\r\n\r\n        if (!botMessages.length) {\r\n            disclaimerEl.remove();\r\n            return;\r\n        }\r\n\r\n        const latestBotMessage = botMessages[botMessages.length - 1];\r\n        const contentEl = latestBotMessage.querySelector('.humata-message-content');\r\n\r\n        if (!contentEl) {\r\n            disclaimerEl.remove();\r\n            return;\r\n        }\r\n\r\n        // Append disclaimer inside the message content (after actions if present)\r\n        contentEl.appendChild(disclaimerEl);\r\n    }\r\n\r\n    /**\r\n     * Hide the bot response disclaimer temporarily (e.g., during loading).\r\n     */\r\n    function hideBotResponseDisclaimer() {\r\n        const disclaimerEl = document.getElementById('humata-bot-response-disclaimer');\r\n        if (disclaimerEl) {\r\n            disclaimerEl.remove();\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Escape special regex characters in a string.\r\n     *\r\n     * @param {string} str - String to escape.\r\n     * @returns {string} Escaped string.\r\n     */\r\n    function escapeRegexChars(str) {\r\n        return String(str || '').replace(/[.*+?^${}()|[\\]\\\\]/g, '\\\\$&');\r\n    }\r\n\r\n    /**\r\n     * Find matching intent links based on the user's message.\r\n     * Matches keywords as whole words (case-insensitive).\r\n     *\r\n     * @param {string} userMessage - The user's question text.\r\n     * @returns {Array} Array of {title, url} objects to display (deduplicated).\r\n     */\r\n    function findMatchingIntentLinks(userMessage) {\r\n        const intents = config.intentLinks;\r\n        if (!intents || !Array.isArray(intents) || !intents.length) {\r\n            return [];\r\n        }\r\n\r\n        if (!userMessage || typeof userMessage !== 'string') {\r\n            return [];\r\n        }\r\n\r\n        const matchedLinks = [];\r\n        const seenUrls = new Set();\r\n\r\n        for (let i = 0; i < intents.length; i++) {\r\n            const intent = intents[i];\r\n            const keywords = intent.keywords;\r\n            const links = intent.links;\r\n\r\n            if (!keywords || !Array.isArray(keywords) || !keywords.length) {\r\n                continue;\r\n            }\r\n            if (!links || !Array.isArray(links) || !links.length) {\r\n                continue;\r\n            }\r\n\r\n            let matched = false;\r\n            for (let k = 0; k < keywords.length; k++) {\r\n                const keyword = keywords[k];\r\n                if (!keyword) {\r\n                    continue;\r\n                }\r\n\r\n                // Whole-word match (case-insensitive)\r\n                const pattern = new RegExp('\\\\b' + escapeRegexChars(keyword) + '\\\\b', 'i');\r\n                if (pattern.test(userMessage)) {\r\n                    matched = true;\r\n                    break;\r\n                }\r\n            }\r\n\r\n            if (matched) {\r\n                for (let j = 0; j < links.length; j++) {\r\n                    const link = links[j];\r\n                    if (!link || !link.title || !link.url) {\r\n                        continue;\r\n                    }\r\n                    if (!seenUrls.has(link.url)) {\r\n                        seenUrls.add(link.url);\r\n                        matchedLinks.push({\r\n                            title: link.title,\r\n                            url: link.url\r\n                        });\r\n                    }\r\n                }\r\n            }\r\n        }\r\n\r\n        return matchedLinks;\r\n    }\r\n\r\n    /**\r\n     * Create the intent links element with pill-shaped buttons.\r\n     *\r\n     * @param {Array} links - Array of {title, url} objects.\r\n     * @returns {HTMLElement|null} The container element or null if no links.\r\n     */\r\n    function createIntentLinksElement(links) {\r\n        if (!links || !links.length) {\r\n            return null;\r\n        }\r\n\r\n        const container = document.createElement('div');\r\n        container.className = 'humata-intent-links';\r\n\r\n        const label = document.createElement('span');\r\n        label.className = 'humata-intent-links-label';\r\n        label.textContent = config.i18n?.relatedResources || 'Related resources:';\r\n        container.appendChild(label);\r\n\r\n        const pillsWrap = document.createElement('div');\r\n        pillsWrap.className = 'humata-intent-links-pills';\r\n\r\n        for (let i = 0; i < links.length; i++) {\r\n            const link = links[i];\r\n            const a = document.createElement('a');\r\n            a.href = link.url;\r\n            a.target = '_blank';\r\n            a.rel = 'noopener noreferrer';\r\n            a.className = 'humata-intent-link';\r\n            a.textContent = link.title;\r\n            pillsWrap.appendChild(a);\r\n        }\r\n\r\n        container.appendChild(pillsWrap);\r\n        return container;\r\n    }\r\n\r\n    /**\r\n     * Find matching intent accordions based on the user's message.\r\n     * Matches keywords as whole words (case-insensitive).\r\n     *\r\n     * @param {string} userMessage - The user's question text.\r\n     * @returns {Array} Array of {title, content} objects to display (deduplicated).\r\n     */\r\n    function findMatchingIntentAccordions(userMessage) {\r\n        const intents = config.intentLinks;\r\n        if (!intents || !Array.isArray(intents) || !intents.length) {\r\n            return [];\r\n        }\r\n\r\n        if (!userMessage || typeof userMessage !== 'string') {\r\n            return [];\r\n        }\r\n\r\n        const matchedAccordions = [];\r\n        const seenTitles = new Set();\r\n\r\n        for (let i = 0; i < intents.length; i++) {\r\n            const intent = intents[i];\r\n            const keywords = intent.keywords;\r\n            const accordions = intent.accordions;\r\n\r\n            if (!keywords || !Array.isArray(keywords) || !keywords.length) {\r\n                continue;\r\n            }\r\n            if (!accordions || !Array.isArray(accordions) || !accordions.length) {\r\n                continue;\r\n            }\r\n\r\n            let matched = false;\r\n            for (let k = 0; k < keywords.length; k++) {\r\n                const keyword = keywords[k];\r\n                if (!keyword) {\r\n                    continue;\r\n                }\r\n\r\n                // Whole-word match (case-insensitive)\r\n                const pattern = new RegExp('\\\\b' + escapeRegexChars(keyword) + '\\\\b', 'i');\r\n                if (pattern.test(userMessage)) {\r\n                    matched = true;\r\n                    break;\r\n                }\r\n            }\r\n\r\n            if (matched) {\r\n                for (let j = 0; j < accordions.length; j++) {\r\n                    const acc = accordions[j];\r\n                    if (!acc || !acc.title || !acc.content) {\r\n                        continue;\r\n                    }\r\n                    if (!seenTitles.has(acc.title)) {\r\n                        seenTitles.add(acc.title);\r\n                        matchedAccordions.push({\r\n                            title: acc.title,\r\n                            content: acc.content\r\n                        });\r\n                    }\r\n                }\r\n            }\r\n        }\r\n\r\n        return matchedAccordions;\r\n    }\r\n\r\n    /**\r\n     * Create the accordion toggles element.\r\n     *\r\n     * @param {Array} accordions - Array of {title, content} objects.\r\n     * @returns {HTMLElement|null} The container element or null if no accordions.\r\n     */\r\n    function createAccordionElement(accordions) {\r\n        if (!accordions || !accordions.length) {\r\n            return null;\r\n        }\r\n\r\n        const container = document.createElement('div');\r\n        container.className = 'humata-accordions';\r\n\r\n        for (let i = 0; i < accordions.length; i++) {\r\n            const acc = accordions[i];\r\n\r\n            const item = document.createElement('div');\r\n            item.className = 'humata-accordion-item';\r\n\r\n            const contentId = 'humata-accordion-content-' + (++accordionIdCounter);\r\n            const toggleId = 'humata-accordion-toggle-' + accordionIdCounter;\r\n\r\n            const toggle = document.createElement('button');\r\n            toggle.type = 'button';\r\n            toggle.className = 'humata-accordion-toggle';\r\n            toggle.id = toggleId;\r\n            toggle.setAttribute('aria-expanded', 'false');\r\n            toggle.setAttribute('aria-controls', contentId);\r\n            toggle.innerHTML = '<span>' + escapeHtml(acc.title) + '</span>' +\r\n                '<svg xmlns=\"http://www.w3.org/2000/svg\" width=\"16\" height=\"16\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\"><polyline points=\"6 9 12 15 18 9\"></polyline></svg>';\r\n\r\n            const content = document.createElement('div');\r\n            content.className = 'humata-accordion-content';\r\n            content.id = contentId;\r\n            content.hidden = true;\r\n            content.setAttribute('role', 'region');\r\n            content.setAttribute('aria-labelledby', toggleId);\r\n            content.innerHTML = acc.content; // Pre-sanitized server-side\r\n\r\n            toggle.addEventListener('click', function() {\r\n                const isOpen = item.classList.toggle('open');\r\n                toggle.setAttribute('aria-expanded', isOpen ? 'true' : 'false');\r\n                content.hidden = !isOpen;\r\n            });\r\n\r\n            item.appendChild(toggle);\r\n            item.appendChild(content);\r\n            container.appendChild(item);\r\n        }\r\n\r\n        return container;\r\n    }\r\n\r\n    /**\r\n     * Append intent links and accordions to a bot message element based on the user's question.\r\n     *\r\n     * @param {HTMLElement} botMessageEl - The bot message element.\r\n     * @param {string} userMessage - The user's original question.\r\n     */\r\n    function appendIntentLinksToMessage(botMessageEl, userMessage) {\r\n        if (!botMessageEl || !userMessage) {\r\n            return;\r\n        }\r\n\r\n        const contentEl = botMessageEl.querySelector('.humata-message-content');\r\n        if (!contentEl) {\r\n            return;\r\n        }\r\n\r\n        // Find matching accordions and links\r\n        const accordions = findMatchingIntentAccordions(userMessage);\r\n        const links = findMatchingIntentLinks(userMessage);\r\n\r\n        // Create accordion element if any matched\r\n        const accordionEl = createAccordionElement(accordions);\r\n        if (accordionEl) {\r\n            // Store matched accordions on element for potential export\r\n            botMessageEl._humataIntentAccordions = accordions;\r\n\r\n            // Insert accordions before message-actions if present\r\n            const actionsEl = contentEl.querySelector('.humata-message-actions');\r\n            if (actionsEl) {\r\n                contentEl.insertBefore(accordionEl, actionsEl);\r\n            } else {\r\n                contentEl.appendChild(accordionEl);\r\n            }\r\n        }\r\n\r\n        // Create intent links element if any matched\r\n        if (!links.length) {\r\n            return;\r\n        }\r\n\r\n        const intentLinksEl = createIntentLinksElement(links);\r\n        if (!intentLinksEl) {\r\n            return;\r\n        }\r\n\r\n        // Store the matched links on the element for PDF export\r\n        botMessageEl._humataIntentLinks = links;\r\n\r\n        // Insert before the bot response disclaimer if present, otherwise append\r\n        const disclaimerEl = contentEl.querySelector('.humata-bot-response-disclaimer');\r\n        if (disclaimerEl) {\r\n            contentEl.insertBefore(intentLinksEl, disclaimerEl);\r\n        } else {\r\n            contentEl.appendChild(intentLinksEl);\r\n        }\r\n    }\r\n\r\n    // Track the last user message for intent link matching\r\n    let lastUserMessageForIntents = '';\r\n\r\n    /**\r\n     * Show loading indicator.\r\n     *\r\n     * @returns {HTMLElement} The loading element.\r\n     */\r\n    function showLoading() {\r\n        // Hide disclaimer while loading\r\n        hideBotResponseDisclaimer();\r\n\r\n        const loadingDiv = document.createElement('div');\r\n        loadingDiv.className = 'humata-message humata-message-bot humata-message-loading';\r\n        loadingDiv.id = 'humata-loading-indicator';\r\n\r\n        const avatarDiv = document.createElement('div');\r\n        avatarDiv.className = 'humata-message-avatar';\r\n        setAvatarContent(avatarDiv, 'bot');\r\n\r\n        const contentDiv = document.createElement('div');\r\n        contentDiv.className = 'humata-message-content';\r\n        const secondStageProvider = String(config.secondLlmProvider || '').toLowerCase();\r\n        const showStatus = secondStageProvider !== '' && secondStageProvider !== 'none';\r\n        if (showStatus) {\r\n            contentDiv.innerHTML = '' +\r\n                '<div class=\"humata-typing-indicator\"><span></span><span></span><span></span></div>' +\r\n                '<div class=\"humata-loading-status\" aria-live=\"polite\" aria-atomic=\"true\">' +\r\n                    '<span class=\"humata-loading-status-text\"></span>' +\r\n                '</div>';\r\n        } else {\r\n            contentDiv.innerHTML = '<div class=\"humata-typing-indicator\"><span></span><span></span><span></span></div>';\r\n        }\r\n\r\n        loadingDiv.appendChild(avatarDiv);\r\n        loadingDiv.appendChild(contentDiv);\r\n        elements.messages.appendChild(loadingDiv);\r\n\r\n        if (showStatus) {\r\n            const statusEl = contentDiv.querySelector('.humata-loading-status-text');\r\n            if (statusEl) {\r\n                const phrases = [\r\n                    'Processing your question\u2026',\r\n                    config.i18n?.thinking || 'Thinking\u2026',\r\n                    'Reviewing for accuracy\u2026',\r\n                    'Just a few moments more\u2026',\r\n                    'Almost ready\u2026',\r\n                    'Finalizing answer\u2026'\r\n                ];\r\n\r\n                let idx = 0;\r\n                statusEl.textContent = phrases[idx];\r\n                statusEl.style.opacity = '1';\r\n\r\n                loadingDiv._humataStatusTimer = setInterval(function() {\r\n                    idx = (idx + 1) % phrases.length;\r\n                    statusEl.style.opacity = '0';\r\n                    loadingDiv._humataStatusFadeTimer = setTimeout(function() {\r\n                        statusEl.textContent = phrases[idx];\r\n                        statusEl.style.opacity = '1';\r\n                    }, 180);\r\n                }, 2000);\r\n            }\r\n        }\r\n\r\n        scrollToBottom();\r\n\r\n        return loadingDiv;\r\n    }\r\n\r\n    /**\r\n     * Hide loading indicator.\r\n     */\r\n    function hideLoading() {\r\n        const loading = document.getElementById('humata-loading-indicator');\r\n        if (loading) {\r\n            if (loading._humataStatusTimer) {\r\n                clearInterval(loading._humataStatusTimer);\r\n            }\r\n            if (loading._humataStatusFadeTimer) {\r\n                clearTimeout(loading._humataStatusFadeTimer);\r\n            }\r\n            loading.remove();\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Scroll chat to bottom.\r\n     */\r\n    function scrollToBottom() {\r\n        if (isEmbedded && elements.messages) {\r\n            elements.messages.scrollTop = elements.messages.scrollHeight;\r\n        } else {\r\n            window.scrollTo({\r\n                top: document.documentElement.scrollHeight,\r\n                behavior: 'smooth'\r\n            });\r\n        }\r\n        updateScrollToggleState();\r\n    }\r\n\r\n    /**\r\n     * Scroll to a specific message element (to its top).\r\n     *\r\n     * @param {HTMLElement} messageEl - The message element to scroll to.\r\n     */\r\n    function scrollToMessage(messageEl) {\r\n        if (!messageEl) {\r\n            scrollToBottom();\r\n            return;\r\n        }\r\n\r\n        if (isEmbedded && elements.messages) {\r\n            // For embedded mode, scroll within the messages container\r\n            const containerRect = elements.messages.getBoundingClientRect();\r\n            const messageRect = messageEl.getBoundingClientRect();\r\n            const offsetTop = messageRect.top - containerRect.top + elements.messages.scrollTop;\r\n            elements.messages.scrollTo({\r\n                top: offsetTop,\r\n                behavior: 'smooth'\r\n            });\r\n        } else {\r\n            // For full-page mode, scroll the window\r\n            const rect = messageEl.getBoundingClientRect();\r\n            const scrollTop = window.scrollY || document.documentElement.scrollTop;\r\n            const targetTop = rect.top + scrollTop - 80; // 80px offset from top for better visibility\r\n            window.scrollTo({\r\n                top: Math.max(0, targetTop),\r\n                behavior: 'smooth'\r\n            });\r\n        }\r\n        updateScrollToggleState();\r\n    }\r\n\r\n    /**\r\n     * Send message to API.\r\n     *\r\n     * @param {string} message - User message.\r\n     */\r\n    async function sendMessage(message, history = []) {\r\n        if (isLoading) return;\r\n\r\n        isLoading = true;\r\n\r\n        // Show loading indicator immediately for user feedback\r\n        showLoading();\r\n\r\n        try {\r\n            // Build request headers\r\n            const headers = {\r\n                'Content-Type': 'application/json',\r\n                'X-WP-Nonce': config.wpNonce,\r\n                'X-Humata-Nonce': config.nonce\r\n            };\r\n\r\n            // Include bot protection headers\r\n            let botProtectionHeaders = {};\r\n            let powChallenge = null;\r\n            if (isBotProtectionEnabled()) {\r\n                botProtectionHeaders = await getBotProtectionHeaders();\r\n                Object.assign(headers, botProtectionHeaders);\r\n            }\r\n\r\n            let response = await fetch(config.apiUrl, {\r\n                method: 'POST',\r\n                credentials: 'same-origin',\r\n                headers: headers,\r\n                body: JSON.stringify({\r\n                    message: message,\r\n                    history: history\r\n                })\r\n            });\r\n\r\n            // Handle PoW challenge response - solve and retry\r\n            // Check for 403 even if client thinks it's verified (server transient may have expired)\r\n            if (response.status === 403 && isPowEnabled()) {\r\n                const errorData = await response.json();\r\n                powChallenge = extractPowChallenge(errorData);\r\n                \r\n                if (powChallenge) {\r\n                    // Clear stale client verification state if server requires new challenge\r\n                    clearPowVerification();\r\n                    \r\n                    // Solve the PoW challenge\r\n                    const powHeaders = await getBotProtectionHeaders(powChallenge);\r\n                    Object.assign(headers, powHeaders);\r\n                    \r\n                    // Retry the request with PoW solution\r\n                    response = await fetch(config.apiUrl, {\r\n                        method: 'POST',\r\n                        credentials: 'same-origin',\r\n                        headers: headers,\r\n                        body: JSON.stringify({\r\n                            message: message,\r\n                            history: history\r\n                        })\r\n                    });\r\n                }\r\n            }\r\n\r\n            hideLoading();\r\n\r\n            const data = await response.json();\r\n\r\n            if (!response.ok) {\r\n                const requestFailedMessage = config.i18n?.errorRequestFailed || 'Your message request failed. Try again. If problem persists, please contact us.';\r\n                let errorMessage = config.i18n?.errorGeneric || 'An error occurred. Please try again.';\r\n\r\n                if (response.status === 429) {\r\n                    errorMessage = config.i18n?.errorRateLimit || 'Too many requests. Please wait a moment.';\r\n                } else if (data && typeof data.message === 'string' && data.message.trim() !== '') {\r\n                    const providerMentionPattern = /\\b(straico|humata|anthropic|claude)\\b/i;\r\n                    errorMessage = providerMentionPattern.test(data.message) ? requestFailedMessage : data.message;\r\n                } else {\r\n                    errorMessage = requestFailedMessage;\r\n                }\r\n\r\n                addMessage(errorMessage, 'bot', true);\r\n                return;\r\n            }\r\n\r\n            // Mark PoW as verified on successful response\r\n            if (isPowEnabled() && !isPowVerified()) {\r\n                setPowVerified();\r\n            }\r\n\r\n            if (data.success && data.answer) {\r\n                const botMessageEl = addMessage(data.answer, 'bot');\r\n                // Append intent-based resource links if keywords matched\r\n                if (botMessageEl && lastUserMessageForIntents) {\r\n                    appendIntentLinksToMessage(botMessageEl, lastUserMessageForIntents);\r\n                    saveHistory(); // Re-save to include intent links\r\n                }\r\n                // Render follow-up questions if provided\r\n                if (botMessageEl && data.followUpQuestions && Array.isArray(data.followUpQuestions) && data.followUpQuestions.length > 0) {\r\n                    renderFollowUpQuestions(botMessageEl, data.followUpQuestions);\r\n                    // Store on element for persistence\r\n                    botMessageEl._humataFollowUpQuestions = data.followUpQuestions;\r\n                    saveHistory(); // Re-save to include follow-up questions\r\n                }\r\n                // Scroll to the beginning of the bot's response\r\n                scrollToMessage(botMessageEl);\r\n            } else {\r\n                addMessage(config.i18n?.errorGeneric || 'An error occurred. Please try again.', 'bot', true);\r\n            }\r\n\r\n        } catch (error) {\r\n            hideLoading();\r\n            addMessage(config.i18n?.errorNetwork || 'Network error. Please check your connection.', 'bot', true);\r\n        } finally {\r\n            isLoading = false;\r\n            elements.input.focus();\r\n        }\r\n    }\r\n\r\n    function handleExportPdf() {\r\n        const exportButton = elements.exportPdfButton;\r\n        if (exportButton) {\r\n            exportButton.disabled = true;\r\n        }\r\n\r\n        try {\r\n            const jsPDF = (window.jspdf && window.jspdf.jsPDF) ? window.jspdf.jsPDF : (window.jsPDF || null);\r\n            if (!jsPDF) {\r\n                return;\r\n            }\r\n\r\n            const doc = new jsPDF({ unit: 'pt', format: 'a4' });\r\n\r\n            const pageWidth = doc.internal.pageSize.getWidth ? doc.internal.pageSize.getWidth() : doc.internal.pageSize.width;\r\n            const pageHeight = doc.internal.pageSize.getHeight ? doc.internal.pageSize.getHeight() : doc.internal.pageSize.height;\r\n\r\n            const marginX = 40;\r\n            const marginY = 40;\r\n            const maxWidth = pageWidth - (marginX * 2);\r\n            const lineHeight = 14;\r\n\r\n            let y = marginY;\r\n\r\n            const now = new Date();\r\n\r\n            function buildFilename() {\r\n                const yyyy = String(now.getFullYear());\r\n                const mm = String(now.getMonth() + 1).padStart(2, '0');\r\n                const dd = String(now.getDate()).padStart(2, '0');\r\n                let name = 'chat-export-' + yyyy + '-' + mm + '-' + dd;\r\n\r\n                if (conversationId) {\r\n                    const safeId = String(conversationId).replace(/[^\\w-]+/g, '').slice(0, 40);\r\n                    if (safeId) {\r\n                        name += '-' + safeId;\r\n                    }\r\n                }\r\n\r\n                return name + '.pdf';\r\n            }\r\n\r\n            function normalizePdfText(text) {\r\n                return String(text || '')\r\n                    .replace(/\\u00A0/g, ' ')\r\n                    .replace(/[\\u200B\\u200C\\u200D\\uFEFF]/g, '')\r\n                    .replace(/\\u2022/g, '-')\r\n                    .replace(/[\\u2018\\u2019]/g, \"'\")\r\n                    .replace(/[\\u201C\\u201D]/g, '\"')\r\n                    .replace(/[\\u2013\\u2014]/g, '-')\r\n                    .replace(/\\u2026/g, '...')\r\n                    .replace(/\\r\\n?/g, '\\n')\r\n                    .trim();\r\n            }\r\n\r\n            function docTextSafe(text, x, yPos) {\r\n                try {\r\n                    doc.text(text, x, yPos);\r\n                } catch (e) {\r\n                    doc.text(String(text || '').replace(/[^\\x09\\x0A\\x0D\\x20-\\x7E]/g, '?'), x, yPos);\r\n                }\r\n            }\r\n\r\n            const titleEl = document.querySelector('.humata-chat-title');\r\n            const title = ((titleEl ? titleEl.textContent : '') || 'Chat Export').trim();\r\n\r\n            doc.setFont('helvetica', 'bold');\r\n            doc.setFontSize(16);\r\n            docTextSafe(title || 'Chat Export', marginX, y);\r\n            y += 22;\r\n\r\n            doc.setFont('helvetica', 'normal');\r\n            doc.setFontSize(10);\r\n            docTextSafe(now.toLocaleString(), marginX, y);\r\n            y += 24;\r\n\r\n            const messageEls = elements.messages ? elements.messages.querySelectorAll('.humata-message:not(#humata-welcome-message):not(.humata-message-loading)') : [];\r\n            const messages = [];\r\n\r\n            messageEls.forEach(function(el) {\r\n                const contentEl = el.querySelector('.humata-message-content');\r\n                if (!contentEl) {\r\n                    return;\r\n                }\r\n\r\n                const isUser = el.classList.contains('humata-message-user');\r\n                const isError = el.classList.contains('humata-message-error');\r\n\r\n                let text = '';\r\n                if (isUser) {\r\n                    text = getMessagePlainText(contentEl);\r\n                } else {\r\n                    const html = getMessageHtmlForStorage(contentEl);\r\n                    text = htmlFragmentToPlainText(html);\r\n                }\r\n\r\n                text = normalizePdfText(text);\r\n                if (!text) {\r\n                    return;\r\n                }\r\n\r\n                // Collect intent links if present on bot messages\r\n                let intentLinks = null;\r\n                if (!isUser && !isError && el._humataIntentLinks && el._humataIntentLinks.length) {\r\n                    intentLinks = el._humataIntentLinks;\r\n                }\r\n\r\n                // Collect accordions if present on bot messages\r\n                let intentAccordions = null;\r\n                if (!isUser && !isError && el._humataIntentAccordions && el._humataIntentAccordions.length) {\r\n                    intentAccordions = el._humataIntentAccordions;\r\n                }\r\n\r\n                messages.push({\r\n                    role: isUser ? 'You' : 'Assistant',\r\n                    text: text,\r\n                    isError: isError,\r\n                    intentLinks: intentLinks,\r\n                    intentAccordions: intentAccordions\r\n                });\r\n            });\r\n\r\n            // Track seen accordion titles globally to avoid duplicates in PDF\r\n            const seenAccordionTitles = new Set();\r\n\r\n            if (!messages.length) {\r\n                doc.setFont('helvetica', 'normal');\r\n                doc.setFontSize(12);\r\n                docTextSafe('No messages.', marginX, y);\r\n                doc.save(buildFilename());\r\n                return;\r\n            }\r\n\r\n            messages.forEach(function(msg) {\r\n                doc.setFont('helvetica', 'bold');\r\n                doc.setFontSize(13);\r\n\r\n                const label = msg.role + (msg.isError ? ' (error)' : '') + ':';\r\n                if (y + lineHeight > pageHeight - marginY) {\r\n                    doc.addPage();\r\n                    y = marginY;\r\n                }\r\n                docTextSafe(label, marginX, y);\r\n                y += lineHeight;\r\n\r\n                doc.setFont('helvetica', 'normal');\r\n                doc.setFontSize(12);\r\n\r\n                const lines = doc.splitTextToSize(msg.text, maxWidth);\r\n                for (let i = 0; i < lines.length; i++) {\r\n                    if (y + lineHeight > pageHeight - marginY) {\r\n                        doc.addPage();\r\n                        y = marginY;\r\n                    }\r\n                    docTextSafe(lines[i], marginX, y);\r\n                    y += lineHeight;\r\n                }\r\n\r\n                // Render accordions if present (deduplicated globally)\r\n                if (msg.intentAccordions && msg.intentAccordions.length) {\r\n                    // Filter to only accordions we haven't seen yet\r\n                    const newAccordions = msg.intentAccordions.filter(function(acc) {\r\n                        if (seenAccordionTitles.has(acc.title)) {\r\n                            return false;\r\n                        }\r\n                        seenAccordionTitles.add(acc.title);\r\n                        return true;\r\n                    });\r\n\r\n                    if (newAccordions.length) {\r\n                        y += 4;\r\n\r\n                        for (let a = 0; a < newAccordions.length; a++) {\r\n                            const acc = newAccordions[a];\r\n\r\n                            // Accordion title (bold)\r\n                            doc.setFont('helvetica', 'bold');\r\n                            doc.setFontSize(11);\r\n                            if (y + lineHeight > pageHeight - marginY) {\r\n                                doc.addPage();\r\n                                y = marginY;\r\n                            }\r\n                            docTextSafe('\u25B8 ' + acc.title, marginX, y);\r\n                            y += lineHeight;\r\n\r\n                            // Accordion content (normal, indented)\r\n                            doc.setFont('helvetica', 'normal');\r\n                            doc.setFontSize(11);\r\n                            // Strip HTML tags and convert to plain text\r\n                            const plainContent = acc.content\r\n                                .replace(/<br\\s*\\/?>/gi, '\\n')\r\n                                .replace(/<\\/p>/gi, '\\n')\r\n                                .replace(/<[^>]+>/g, '')\r\n                                .replace(/&nbsp;/g, ' ')\r\n                                .replace(/&amp;/g, '&')\r\n                                .replace(/&lt;/g, '<')\r\n                                .replace(/&gt;/g, '>')\r\n                                .replace(/&quot;/g, '\"')\r\n                                .trim();\r\n                            const contentLines = doc.splitTextToSize(plainContent, maxWidth - 10);\r\n                            for (let c = 0; c < contentLines.length; c++) {\r\n                                if (y + lineHeight > pageHeight - marginY) {\r\n                                    doc.addPage();\r\n                                    y = marginY;\r\n                                }\r\n                                docTextSafe('  ' + contentLines[c], marginX, y);\r\n                                y += lineHeight;\r\n                            }\r\n                            y += 2;\r\n                        }\r\n                    }\r\n                }\r\n\r\n                // Render intent links if present\r\n                if (msg.intentLinks && msg.intentLinks.length) {\r\n                    y += 4;\r\n                    doc.setFont('helvetica', 'italic');\r\n                    doc.setFontSize(11);\r\n\r\n                    const resourceLabel = config.i18n?.relatedResources || 'Related resources:';\r\n                    if (y + lineHeight > pageHeight - marginY) {\r\n                        doc.addPage();\r\n                        y = marginY;\r\n                    }\r\n                    docTextSafe(resourceLabel, marginX, y);\r\n                    y += lineHeight;\r\n\r\n                    doc.setFont('helvetica', 'normal');\r\n                    for (let k = 0; k < msg.intentLinks.length; k++) {\r\n                        const link = msg.intentLinks[k];\r\n                        const linkText = '\u2022 ' + link.title + ' - ' + link.url;\r\n                        const linkLines = doc.splitTextToSize(linkText, maxWidth);\r\n                        for (let l = 0; l < linkLines.length; l++) {\r\n                            if (y + lineHeight > pageHeight - marginY) {\r\n                                doc.addPage();\r\n                                y = marginY;\r\n                            }\r\n                            docTextSafe(linkLines[l], marginX, y);\r\n                            y += lineHeight;\r\n                        }\r\n                    }\r\n                }\r\n\r\n                y += lineHeight;\r\n            });\r\n\r\n            doc.save(buildFilename());\r\n        } catch (e) {\r\n            console.error(e);\r\n        } finally {\r\n            if (exportButton) {\r\n                exportButton.disabled = false;\r\n            }\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Handle clear chat button click.\r\n     */\r\n    function handleClear() {\r\n        // Clear messages from DOM\r\n        if (elements.messages) {\r\n            elements.messages.innerHTML = '';\r\n        }\r\n\r\n        // Show welcome message again\r\n        if (elements.welcomeMessage) {\r\n            elements.welcomeMessage.style.display = '';\r\n            elements.messages.appendChild(elements.welcomeMessage);\r\n            ensureCopyButton(elements.welcomeMessage.querySelector('.humata-message-content'));\r\n        } else {\r\n            // Recreate welcome message if it doesn't exist\r\n            const welcomeDiv = document.createElement('div');\r\n            welcomeDiv.id = 'humata-welcome-message';\r\n            welcomeDiv.className = 'humata-message humata-message-bot';\r\n\r\n            const avatarDiv = document.createElement('div');\r\n            avatarDiv.className = 'humata-message-avatar';\r\n            setAvatarContent(avatarDiv, 'bot');\r\n\r\n            const contentDiv = document.createElement('div');\r\n            contentDiv.className = 'humata-message-content';\r\n            contentDiv.innerHTML = '<p>' + (config.i18n?.welcome || \"Hello! I'm here to help answer your questions. What would you like to know?\") + '</p>';\r\n\r\n            welcomeDiv.appendChild(avatarDiv);\r\n            welcomeDiv.appendChild(contentDiv);\r\n            elements.messages.appendChild(welcomeDiv);\r\n\r\n            elements.welcomeMessage = welcomeDiv;\r\n            ensureCopyButton(contentDiv);\r\n        }\r\n\r\n        // Clear localStorage\r\n        localStorage.removeItem(STORAGE_KEY);\r\n        localStorage.removeItem(CONVERSATION_KEY);\r\n        conversationId = null;\r\n\r\n        // Focus input\r\n        if (elements.input) {\r\n            elements.input.focus();\r\n        }\r\n\r\n        // Re-initialize suggested questions since chat is now empty\r\n        initSuggestedQuestionsIfEmpty();\r\n    }\r\n\r\n    /**\r\n     * Save chat history to localStorage.\r\n     */\r\n    function saveHistory() {\r\n        if (!elements.messages) return;\r\n\r\n        const messages = [];\r\n        const messageElements = elements.messages.querySelectorAll('.humata-message:not(#humata-welcome-message):not(.humata-message-loading)');\r\n        let lastUserMessage = '';\r\n\r\n        messageElements.forEach(function(el) {\r\n            const isUser = el.classList.contains('humata-message-user');\r\n            const isError = el.classList.contains('humata-message-error');\r\n            const content = el.querySelector('.humata-message-content');\r\n\r\n            if (content) {\r\n                const msgData = {\r\n                    type: isUser ? 'user' : 'bot',\r\n                    content: isUser ? getMessagePlainText(content) : getMessageHtmlForStorage(content),\r\n                    isError: isError\r\n                };\r\n\r\n                if (isUser) {\r\n                    lastUserMessage = msgData.content;\r\n                } else {\r\n                    // Store the user message that triggered this bot response for intent links\r\n                    msgData.triggerUserMessage = lastUserMessage;\r\n                    \r\n                    // Store follow-up questions if present on this message\r\n                    if (el._humataFollowUpQuestions && Array.isArray(el._humataFollowUpQuestions)) {\r\n                        msgData.followUpQuestions = el._humataFollowUpQuestions;\r\n                    }\r\n                }\r\n\r\n                messages.push(msgData);\r\n            }\r\n        });\r\n\r\n        try {\r\n            localStorage.setItem(STORAGE_KEY, JSON.stringify(messages));\r\n        } catch (e) {\r\n            // localStorage might be full or disabled\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Load chat history from localStorage.\r\n     */\r\n    function loadHistory() {\r\n        try {\r\n            const saved = localStorage.getItem(STORAGE_KEY);\r\n            if (!saved) return;\r\n\r\n            const messages = JSON.parse(saved);\r\n            if (!Array.isArray(messages) || messages.length === 0) return;\r\n\r\n            // Hide welcome message\r\n            if (elements.welcomeMessage) {\r\n                elements.welcomeMessage.style.display = 'none';\r\n            }\r\n\r\n            // Restore messages\r\n            messages.forEach(function(msg) {\r\n                const messageDiv = document.createElement('div');\r\n                messageDiv.className = 'humata-message humata-message-' + msg.type;\r\n\r\n                if (msg.isError) {\r\n                    messageDiv.classList.add('humata-message-error');\r\n                }\r\n\r\n                const avatarDiv = document.createElement('div');\r\n                avatarDiv.className = 'humata-message-avatar';\r\n                setAvatarContent(avatarDiv, msg.type);\r\n\r\n                const contentDiv = document.createElement('div');\r\n                contentDiv.className = 'humata-message-content';\r\n\r\n                // For bot messages, use innerHTML (already formatted)\r\n                // For user messages, use textContent\r\n                if (msg.type === 'user') {\r\n                    contentDiv.textContent = msg.content;\r\n                } else {\r\n                    contentDiv.innerHTML = msg.content;\r\n                }\r\n\r\n                ensureCopyButton(contentDiv);\r\n                if (msg.type === 'bot') {\r\n                    ensureRegenerateButton(contentDiv);\r\n                }\r\n                if (msg.type === 'user' && !msg.isError) {\r\n                    ensureEditButton(contentDiv);\r\n                }\r\n\r\n                messageDiv.appendChild(avatarDiv);\r\n                messageDiv.appendChild(contentDiv);\r\n                elements.messages.appendChild(messageDiv);\r\n\r\n                // Re-apply intent links for bot messages\r\n                if (msg.type === 'bot' && !msg.isError && msg.triggerUserMessage) {\r\n                    appendIntentLinksToMessage(messageDiv, msg.triggerUserMessage);\r\n                }\r\n\r\n                // Store follow-up questions on element for later restoration\r\n                if (msg.type === 'bot' && !msg.isError && msg.followUpQuestions && Array.isArray(msg.followUpQuestions)) {\r\n                    messageDiv._humataFollowUpQuestions = msg.followUpQuestions;\r\n                }\r\n            });\r\n\r\n            // Restore follow-up questions for the last bot message only\r\n            const lastBotMessage = elements.messages.querySelector('.humata-message-bot:last-of-type:not(.humata-message-error)');\r\n            if (lastBotMessage && lastBotMessage._humataFollowUpQuestions && lastBotMessage._humataFollowUpQuestions.length > 0) {\r\n                renderFollowUpQuestions(lastBotMessage, lastBotMessage._humataFollowUpQuestions);\r\n            }\r\n\r\n            // Load conversation ID\r\n            conversationId = localStorage.getItem(CONVERSATION_KEY);\r\n\r\n            // Update bot response disclaimer position\r\n            updateBotResponseDisclaimerPosition();\r\n\r\n            // Scroll to bottom\r\n            scrollToBottom();\r\n\r\n        } catch (e) {\r\n            // Invalid JSON or other error\r\n            localStorage.removeItem(STORAGE_KEY);\r\n        }\r\n    }\r\n\r\n    // Initialize when DOM is ready\r\n    if (document.readyState === 'loading') {\r\n        document.addEventListener('DOMContentLoaded', init);\r\n    } else {\r\n        init();\r\n    }\r\n\r\n})();\r\n"],
  "mappings": "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",
  "names": ["config", "STORAGE_KEY", "CONVERSATION_KEY", "THEME_KEY", "DEFAULT_USER_AVATAR_SVG", "DEFAULT_BOT_AVATAR_SVG", "setAvatarContent", "avatarDiv", "type", "avatarUrl", "config", "img", "suggestedQuestionsContainer", "onQuestionClick", "initSuggestedQuestions", "clickHandler", "sqConfig", "config", "questions", "getQuestionsToDisplay", "renderSuggestedQuestions", "getFixedQuestions", "getRandomizedQuestions", "fixedQuestions", "q", "categories", "validCategories", "cat", "slots", "numCategories", "shuffled", "shuffle", "i", "j", "luckyIndex", "count", "array", "question", "button", "span", "handleQuestionClick", "hideSuggestedQuestions", "onQuestionClick", "currentContainer", "expandedButton", "isTouchDevice", "initFollowUpQuestions", "clickHandler", "renderFollowUpQuestions", "messageElement", "questions", "hideFollowUpQuestions", "container", "label", "buttonsContainer", "question", "index", "button", "span", "isTruncated", "e", "collapseExpandedButton", "handleQuestionClick", "messageContent", "disclaimer", "el", "POW_VERIFIED_KEY", "pageLoadTimestamp", "powSolved", "lastPowNonce", "lastPowSolution", "initBotProtection", "config", "isBotProtectionEnabled", "isHoneypotEnabled", "isPowEnabled", "isPowVerified", "setPowVerified", "getHoneypotHeaders", "solveProofOfWork", "challenge", "difficulty", "target", "counter", "maxIterations", "encoder", "input", "data", "hashBuffer", "b", "resolve", "getPowHeaders", "challengeData", "solution", "getBotProtectionHeaders", "powChallenge", "honeypotHeaders", "powHeaders", "__spreadValues", "extractPowChallenge", "errorData", "clearPowVerification", "elements", "isLoading", "conversationId", "activeEdit", "maxPromptChars", "isEmbedded", "accordionIdCounter", "init", "getMaxPromptChars", "initTheme", "initBotProtection", "ensureCopyButton", "loadHistory", "bindEvents", "handleInput", "updateScrollToggleState", "initMobileKeyboardHandler", "initSuggestedQuestionsIfEmpty", "initFollowUpQuestions", "handleFollowUpQuestionClick", "initSuggestedQuestions", "handleSuggestedQuestionClick", "question", "hideSuggestedQuestions", "lastUserMessageForIntents", "addMessage", "history", "getChatHistoryForRequest", "sendMessage", "hideFollowUpQuestions", "inputContainer", "pageFooter", "getStopElement", "initialViewportHeight", "isKeyboardVisible", "isDetached", "pendingUpdate", "updateInputPosition", "vv", "viewportBottom", "bottomOffset", "shouldDetach", "stopElement", "stopRect", "inputHeight", "keyboardTop", "inputFixedBottom", "savedTheme", "THEME_KEY", "configTheme", "config", "theme", "applyTheme", "e", "html", "body", "toggleTheme", "newTheme", "withTimeout", "promise", "ms", "errorType", "_", "reject", "error", "handleSend", "handleKeyDown", "handleScrollToggle", "handleMessagesClick", "handleClear", "handleExportPdf", "initTriggerPageModals", "initMedicalDisclaimerModal", "installModalFocusTrap", "openModal", "dialog", "focusableNodeList", "focusable", "el", "first", "last", "active", "disclaimerLink", "disclaimerModal", "openPageModal", "closePageModal", "trigger", "modalIndex", "modal", "closeTarget", "pageModalLastFocused", "triggerEl", "closeBtn", "err", "fromConfig", "fromAttr", "updatePromptCounter", "current", "max", "event", "regenerateButton", "messageEl", "userMessageEl", "contentEl", "text", "getMessagePlainText", "getChatHistoryForRequestBefore", "truncateConversationAfter", "saveHistory", "copyButton", "payload", "getMessageClipboardPayload", "copyToClipboard", "indicateCopySuccess", "indicateCopyFailure", "editButton", "startEditMessage", "cancelActiveEdit", "saveActiveEdit", "setComposerEnabled", "enabled", "value", "_a", "_b", "_c", "_d", "originalText", "textarea", "actions", "cancelButton", "getXIconSvg", "saveButton", "getCheckIconSvg", "autoResizeEditTextarea", "maxHeight", "newHeight", "restoreUserMessageContent", "rawText", "newText", "errorMessage", "ensureEditButton", "hideLoading", "node", "next", "messageElements", "i", "isUser", "content", "scrollHeight", "clientHeight", "scrollTop", "maxScrollable", "distanceFromBottom", "threshold", "shouldScrollToTop", "labelTop", "labelBottom", "label", "targetTop", "tooLong", "rawMessage", "message", "hideTriggerPages", "triggerPages", "type", "isError", "messageDiv", "avatarDiv", "setAvatarContent", "contentDiv", "formatMessage", "ensureRegenerateButton", "updateBotResponseDisclaimerPosition", "scrollToBottom", "formatted", "escapeHtml", "codeBlocks", "match", "lang", "code", "token", "safeLang", "sanitizeCodeLanguage", "renderMarkdownBlocks", "mergeConsecutiveOrderedLists", "idx", "pattern", "result", "prevResult", "betweenContent", "humataHtmlEntityDecoder", "decodeHtmlEntities", "sanitizeLinkHref", "href", "decoded", "cleaned", "schemeMatch", "scheme", "humataPreparedAutoLinks", "humataIsWordChar", "ch", "getPreparedAutoLinks", "raw", "prepared", "row", "phrase", "url", "safeHrefEscaped", "a", "b", "humataFindAutoLinkMatches", "rules", "haystack", "lower", "matches", "overlaps", "start", "end", "m", "r", "rule", "before", "after", "humataApplyAutoLinksToInlineHtml", "container", "walker", "p", "name", "nodes", "textNode", "frag", "lastIndex", "isBlankLine", "line", "isCodeBlockTokenLine", "isHorizontalRuleLine", "parseHeadingLine", "isBlockquoteLine", "stripBlockquotePrefix", "isUnorderedListLine", "isOrderedListLine", "renderInlineMarkdown", "out", "codeSpans", "safeHref", "lines", "heading", "quoteLines", "items", "j", "itemText", "paraLines", "paraText", "div", "getOrCreateMessageActionsContainer", "actionsEl", "button", "getCopyIconSvg", "getRegenerateIconSvg", "getEditIconSvg", "editTextarea", "cloned", "btn", "getMessageHtmlForStorage", "innerHtml", "htmlFragmentToPlainText", "domNodeToPlainText", "ctx", "tag", "childrenText", "children", "ensureEndsWithNewline", "ensureBlankLine", "t", "block", "stack", "prefix", "indent", "copyPlainTextToClipboard", "item", "copyHtmlWithSelection", "resolve", "selection", "savedRanges", "range", "successful", "copyPlainTextWithTextarea", "getBotResponseDisclaimerElement", "disclaimerHtml", "disclaimerEl", "botMessages", "hideBotResponseDisclaimer", "escapeRegexChars", "str", "findMatchingIntentLinks", "userMessage", "intents", "matchedLinks", "seenUrls", "intent", "keywords", "links", "matched", "k", "keyword", "link", "createIntentLinksElement", "pillsWrap", "findMatchingIntentAccordions", "matchedAccordions", "seenTitles", "accordions", "acc", "createAccordionElement", "contentId", "toggleId", "toggle", "isOpen", "appendIntentLinksToMessage", "botMessageEl", "accordionEl", "intentLinksEl", "showLoading", "loadingDiv", "secondStageProvider", "showStatus", "statusEl", "phrases", "loading", "scrollToMessage", "containerRect", "offsetTop", "rect", "_e", "headers", "botProtectionHeaders", "powChallenge", "isBotProtectionEnabled", "getBotProtectionHeaders", "response", "isPowEnabled", "errorData", "extractPowChallenge", "clearPowVerification", "powHeaders", "data", "requestFailedMessage", "isPowVerified", "setPowVerified", "renderFollowUpQuestions", "exportButton", "buildFilename", "yyyy", "now", "mm", "dd", "safeId", "normalizePdfText", "docTextSafe", "x", "yPos", "doc", "jsPDF", "pageWidth", "pageHeight", "marginX", "marginY", "maxWidth", "lineHeight", "y", "titleEl", "title", "messageEls", "messages", "intentLinks", "intentAccordions", "seenAccordionTitles", "msg", "newAccordions", "plainContent", "contentLines", "c", "resourceLabel", "linkText", "linkLines", "l", "welcomeDiv", "STORAGE_KEY", "CONVERSATION_KEY", "lastUserMessage", "msgData", "saved", "lastBotMessage"]
}
