(()=>{(function(t){"use strict";t(function(){var A=window.humataAdminConfig||{},N=String(A.nonce||"");A.documentTitles&&typeof A.documentTitles=="object"?window.humataDocumentTitles=A.documentTitles:(!window.humataDocumentTitles||typeof window.humataDocumentTitles!="object")&&(window.humataDocumentTitles={});var B=String(A.ajaxUrl||window.ajaxurl||"");function S(m,c){var i=parseInt(m,10);return isFinite(i)&&i>=0?i:c||0}(function(){var m=window.humataDocumentTitles||{},c=A.i18n&&typeof A.i18n.titleNotFetchedText=="string"?A.i18n.titleNotFetchedText:"(title not fetched)",i=100,e=0;function s(n){var o=(n||"").match(/[a-f0-9]{8}-[a-f0-9]{4}-[a-f0-9]{4}-[a-f0-9]{4}-[a-f0-9]{12}/ig)||[],u={},d=[];return t.each(o,function(b,_){_=_.toLowerCase(),u[_]||(u[_]=!0,d.push(_))}),d}function l(){return t("#humata-document-ids-tokens .humata-token").map(function(){return(t(this).attr("data-id")||"").toLowerCase()}).get()}function g(n){return n=(n||"").toLowerCase(),m[n]?m[n]:n}function v(){var n=t("#humata-document-ids-tokens"),o=n.children(".humata-token").get();o.sort(function(u,d){var b=(t(u).attr("data-id")||"").toLowerCase(),_=(t(d).attr("data-id")||"").toLowerCase(),x=t.trim(g(b)||b).toLowerCase(),f=t.trim(g(_)||_).toLowerCase();return x===f?_.localeCompare(b):f.localeCompare(x)}),t.each(o,function(u,d){n.append(d)})}function C(n){if(n=(n||"").toLowerCase(),!!n&&!t('#humata-document-ids-tokens .humata-token[data-id="'+n+'"]').length){var o=t("<span></span>").addClass("humata-token").attr("data-id",n).attr("title",g(n)),u=t("<span></span>").addClass("humata-token-label").text(g(n)),d=t("<button></button>").attr("type","button").addClass("humata-token-remove").attr("aria-label","Remove").text("\xD7");o.append(u).append(d),t("#humata-document-ids-tokens").append(o)}}function I(){var n=l();t("#humata_document_ids").val(n.join(", ")),t("#humata-document-count").text(n.length)}function F(n){var o=t("#humata-documents-pagination");if(o.length&&(o.empty(),!(!n||n<=i))){var u=Math.max(1,Math.ceil(n/i)),d=e+1,b=e*i+1,_=Math.min((e+1)*i,n),x=t("<button></button>").attr("type","button").addClass("button button-secondary").attr("id","humata-documents-page-prev").text("Previous").prop("disabled",e<=0),f=t("<button></button>").attr("type","button").addClass("button button-secondary").attr("id","humata-documents-page-next").text("Next").prop("disabled",e>=u-1),w=t("<span></span>").addClass("humata-documents-page-info").text("Showing "+b+"\u2013"+_+" of "+n+" (Page "+d+"/"+u+")");o.append(x).append(w).append(f)}}function q(){var n=t("#humata-documents-table-body");if(n.length){var o=l(),u=o.length;if(!u){n.empty(),F(0);return}var d=Math.max(1,Math.ceil(u/i));e>=d&&(e=d-1),e<0&&(e=0);var b=e*i,_=Math.min(b+i,u),x=o.slice(b,_);n.empty(),t.each(x,function(f,w){var L=m[w]?m[w]:c,R=t("<tr></tr>").attr("data-doc-id",w);R.append(t("<td></td>").addClass("humata-doc-title").text(L)),R.append(t("<td></td>").append(t("<code></code>").text(w))),n.append(R)}),F(u)}}function P(n){var o=s(n);return o.length?(t.each(o,function(u,d){C(d)}),v(),I(),q(),!0):!1}function O(){var n=t("#humata_document_ids"),o=t("#humata-document-ids-tokens");if(!(!n.length||!o.length)){var u=s(n.val());o.empty(),t.each(u,function(d,b){C(b)}),v(),I(),q()}}O(),t(document).on("click","#humata-documents-page-prev",function(){e>0&&(e--,q())}),t(document).on("click","#humata-documents-page-next",function(){var n=l().length,o=Math.max(1,Math.ceil(n/i));e<o-1&&(e++,q())}),t(document).on("click","#humata-document-ids-control, #humata-document-ids-tokens",function(n){t(n.target).closest(".humata-token-remove").length||t("#humata_document_ids_input").trigger("focus")}),t(document).on("click",".humata-token-remove",function(){t(this).closest(".humata-token").remove(),I(),q()}),t(document).on("keydown","#humata_document_ids_input",function(n){var o=n.key;if(o===","||o==="Enter"||o==="Tab"){var u=t(this).val(),d=P(u);if(o==="Enter"||o===","){n.preventDefault(),d&&t(this).val("");return}if(o==="Tab"&&d){n.preventDefault(),t(this).val("");return}}if(o==="Backspace"&&t(this).val()===""){var b=t("#humata-document-ids-tokens .humata-token").last();b.length&&(b.remove(),I(),q(),n.preventDefault())}}),t(document).on("paste","#humata_document_ids_input",function(){var n=t(this);setTimeout(function(){var o=P(n.val());o&&n.val("")},0)}),t(document).on("blur","#humata_document_ids_input",function(){var n=t(this).val(),o=P(n);o&&t(this).val("")});function k(n,o){var u=t("#humata-document-ids-io-status");u.length&&(u.removeClass("humata-io-status-success humata-io-status-error humata-io-status-info"),o==="success"?u.addClass("humata-io-status-success"):o==="error"?u.addClass("humata-io-status-error"):o==="info"&&u.addClass("humata-io-status-info"),u.text(n||""))}function E(){var n=l();return!n||!n.length?"":n.join("\\n")}function a(n,o,u){try{var d=u||"text/plain;charset=utf-8",b=new Blob([o||""],{type:d}),_=URL.createObjectURL(b),x=document.createElement("a");x.href=_,x.download=n||"humata-document-ids.txt",document.body.appendChild(x),x.click(),setTimeout(function(){try{document.body.removeChild(x)}catch(f){}try{URL.revokeObjectURL(_)}catch(f){}},0)}catch(f){k("Download failed.","error")}}function r(n){return navigator.clipboard&&navigator.clipboard.writeText?navigator.clipboard.writeText(n):p(n)}function p(n){return new Promise(function(o,u){var d=/Mac|iPhone|iPad|iPod/i.test(navigator.platform||navigator.userAgent),b=d?"Cmd+C":"Ctrl+C",_="Press "+b+" to copy";h(_);var x=t("<textarea></textarea>").attr("readonly","").attr("aria-label","Text to copy").css({position:"fixed",top:"50%",left:"50%",transform:"translate(-50%, -50%)",width:"1px",height:"1px",padding:"0",border:"none",outline:"none",opacity:"0",zIndex:"999999"}).val(n||"");t("body").append(x),x[0].focus(),x[0].select(),x[0].setSelectionRange(0,x[0].value.length);function f(){L(),o()}function w(R){R.key==="Escape"&&(L(),u(new Error("copy_cancelled")))}function L(){t(document).off("copy",f),t(document).off("keydown",w),x.remove(),y()}t(document).on("copy",f),t(document).on("keydown",w),setTimeout(function(){L(),u(new Error("copy_timeout"))},1e4)})}function h(n){y();var o=t("<div></div>").attr("id","humata-admin-copy-toast").text(n).css({position:"fixed",top:"20px",left:"50%",transform:"translateX(-50%)",background:"#333",color:"#fff",padding:"12px 24px",borderRadius:"8px",fontSize:"14px",zIndex:"999999",boxShadow:"0 4px 12px rgba(0,0,0,0.3)"});t("body").append(o)}function y(){t("#humata-admin-copy-toast").remove()}function T(){var n=t('input[name="humata_document_ids_import_mode"]:checked'),o=n.length?String(n.val()||""):"";return o=t.trim(o),o==="replace"?"replace":"merge"}function D(n,o){var u=String(n||""),d=o==="replace"?"replace":"merge",b=l().length,_=s(u);if(!_.length)return k("No valid UUIDs found to import.","error"),!1;var x=b;d==="replace"&&(t("#humata-document-ids-tokens").empty(),e=0,x=0),t.each(_,function(R,M){C(M)}),v(),I(),q();var f=l().length;if(d==="merge"){var w=Math.max(0,f-x),L=Math.max(0,_.length-w);k("Imported "+w+" IDs ("+L+" duplicates ignored). Click Save Settings to persist.","success")}else k("Replaced "+b+" IDs with "+f+" imported IDs. Click Save Settings to persist.","success");return!0}t(document).on("click","#humata-document-ids-export-copy",function(){var n=E(),o=l().length;if(!n){k("No document IDs to export.","error");return}r(n).then(function(){k("Copied "+o+" IDs to clipboard.","success")}).catch(function(){k("Copy failed. Try Download TXT instead.","error")})}),t(document).on("click","#humata-document-ids-export-download",function(){var n=l();if(!n.length){k("No document IDs to export.","error");return}var o=n.join("\\n")+"\\n";a("humata-document-ids.txt",o,"text/plain;charset=utf-8"),k("Downloaded TXT for "+n.length+" IDs.","info")}),t(document).on("click","#humata-document-ids-export-download-json",function(){var n=l();if(!n.length){k("No document IDs to export.","error");return}var o=JSON.stringify({document_ids:n},null,2);a("humata-document-ids.json",o+"\\n","application/json;charset=utf-8"),k("Downloaded JSON for "+n.length+" IDs.","info")}),t(document).on("change","#humata-document-ids-import-file",function(){var n=this,o=n&&n.files&&n.files[0]?n.files[0]:null;if(o){var u=new FileReader;u.onload=function(d){var b=d&&d.target&&d.target.result?String(d.target.result):"";t("#humata-document-ids-import-text").val(b),k("Loaded file. Choose Merge/Replace and click Apply Import.","info")},u.onerror=function(){k("Failed to read file.","error")};try{u.readAsText(o)}catch(d){k("Failed to read file.","error")}}}),t(document).on("click","#humata-document-ids-import-apply",function(){var n=t("#humata-document-ids-import-text").val(),o=T();D(n,o)}),t(document).on("click","#humata-document-ids-clear-all",function(){var n=l().length;if(!n){k("No document IDs to clear.","info");return}window.confirm("Remove all configured Document IDs?")&&(t("#humata-document-ids-tokens").empty(),e=0,I(),q(),k("Cleared all Document IDs. Click Save Settings to persist.","success"))}),t("#humata-test-api").on("click",function(){var n=t(this),o=t("#humata-test-result");n.prop("disabled",!0).text("Testing..."),o.html(""),t.post(B,{action:"humata_test_api",nonce:N},function(u){n.prop("disabled",!1).text("Test API Connection"),u.success?o.html('<span style="color:green;">\u2713 '+u.data.message+"</span>"):o.html('<span style="color:red;">\u2717 '+u.data.message+"</span>")}).fail(function(){n.prop("disabled",!1).text("Test API Connection"),o.html('<span style="color:red;">\u2717 Request failed</span>')})}),t("#humata-clear-cache").on("click",function(){var n=t(this);n.prop("disabled",!0).text("Clearing..."),t.post(B,{action:"humata_clear_cache",nonce:N},function(o){n.prop("disabled",!1).text("Clear Cache"),o.success?(alert("Cache cleared!"),location.reload()):alert("Failed to clear cache.")})}),t("#humata-test-ask").on("click",function(){var n=t(this),o=t("#humata-test-result");n.prop("disabled",!0).text("Testing Ask..."),o.html(""),t.post(B,{action:"humata_test_ask",nonce:N},function(u){n.prop("disabled",!1).text("Test Ask"),u.success?o.html('<span style="color:green;">\u2713 '+u.data.message+"</span>"):o.html('<span style="color:red;">\u2717 '+u.data.message+"</span>")}).fail(function(){n.prop("disabled",!1).text("Test Ask"),o.html('<span style="color:red;">\u2717 Request failed</span>')})}),t("#humata-fetch-titles").on("click",function(){var n=t(this),o=t("#humata-test-result"),u=0,d=5,b=2e3,_=t("#humata_document_ids").val();n.prop("disabled",!0).text("Fetching..."),o.html("");function x(){t.post(B,{action:"humata_fetch_titles",nonce:N,offset:u,limit:d,document_ids:_},function(f){if(!f.success){n.prop("disabled",!1).text("Fetch Titles");var w=f.data&&f.data.message?f.data.message:"Request failed";f.data&&f.data.errorMessage&&(w=w+" ("+f.data.errorMessage+")"),o.html('<span style="color:red;">\u2717 '+w+"</span>");return}f.data&&f.data.titles&&t.each(f.data.titles,function(R,M){if(R=(R||"").toLowerCase(),!(!R||!M)){m[R]=M;var j=t('#humata-document-ids-tokens .humata-token[data-id="'+R+'"]');j.find(".humata-token-label").text(M),j.attr("title",M),t('#humata-documents-table-body tr[data-doc-id="'+R+'"] .humata-doc-title').text(M)}}),v(),I(),q(),u=f.data.nextOffset;var L=f.data.message||"";if(f.data.errors&&f.data.errorMessage&&(L=L+" ("+f.data.errorMessage+")"),o.html('<span style="color:green;">\u2713 '+L+"</span>"),f.data.done){n.prop("disabled",!1).text("Fetch Titles");return}setTimeout(x,b)}).fail(function(){n.prop("disabled",!1).text("Fetch Titles"),o.html('<span style="color:red;">\u2717 Request failed</span>')})}x()})})(),function(){function m(){var i=t('input[name="humata_search_provider"]:checked'),e=i.length?String(i.val()||""):"";return e=t.trim(e),e||(e="humata"),e}function c(){if(t('input[name="humata_search_provider"]').length){var i=m(),e=i==="humata",s=i==="local";t("#humata_api_key").closest("table").closest("tbody").parent().closest("table").prev("h2:contains('Humata API')").toggle(e),t(".form-table").each(function(){var l=t(this),g=l.prev("h2, p").prev("h2");g.length||(g=l.prev("h2"));var v=g.text()||"";(v.indexOf("Humata API")!==-1||v.indexOf("Humata System Prompt")!==-1||v.indexOf("Second-Stage LLM System Prompt")!==-1)&&v.indexOf("Local Search")===-1&&(g.toggle(e),g.next("p").toggle(e),l.toggle(e)),v.indexOf("Local Search")!==-1&&(g.toggle(s),g.next("p").toggle(s),l.toggle(s))})}}t(document).on("change",'input[name="humata_search_provider"]',c),setTimeout(c,100)}(),function(){function m(){var i=t('input[name="humata_second_llm_provider"]:checked'),e=i.length?String(i.val()||""):"";return e=t.trim(e),e||(e="none"),e}function c(){var i=m(),e=i==="straico",s=i==="anthropic",l=i==="openrouter";t(".humata-api-key-pool[data-option='humata_straico_api_key']").closest("tr").toggle(e),t("#humata_straico_model").closest("tr").toggle(e),t(".humata-api-key-pool[data-option='humata_anthropic_api_key']").closest("tr").toggle(s),t("#humata_anthropic_model").closest("tr").toggle(s),t("#humata_anthropic_extended_thinking").closest("tr").toggle(s),t(".humata-api-key-pool[data-option='humata_openrouter_api_key']").closest("tr").toggle(l),t("#humata_openrouter_model").closest("tr").toggle(l)}t(document).on("change",'input[name="humata_second_llm_provider"]',c),c()}(),function(){function m(){var i=t('input[name="humata_local_first_llm_provider"]:checked'),e=i.length?String(i.val()||""):"";return e=t.trim(e),e||(e="straico"),e}function c(){var i=m(),e=i==="straico",s=i==="anthropic",l=i==="openrouter";t(".humata-api-key-pool[data-option='humata_local_first_straico_api_key']").closest("tr").toggle(e),t("#humata_local_first_straico_model").closest("tr").toggle(e),t(".humata-api-key-pool[data-option='humata_local_first_anthropic_api_key']").closest("tr").toggle(s),t("#humata_local_first_anthropic_model").closest("tr").toggle(s),t("#humata_local_first_anthropic_extended_thinking").closest("tr").toggle(s),t(".humata-api-key-pool[data-option='humata_local_first_openrouter_api_key']").closest("tr").toggle(l),t("#humata_local_first_openrouter_model").closest("tr").toggle(l)}t(document).on("change",'input[name="humata_local_first_llm_provider"]',c),c()}(),function(){function m(){var i=t('input[name="humata_local_second_llm_provider"]:checked'),e=i.length?String(i.val()||""):"";return e=t.trim(e),e||(e="none"),e}function c(){var i=m(),e=i==="straico",s=i==="anthropic",l=i==="openrouter";t(".humata-api-key-pool[data-option='humata_local_second_straico_api_key']").closest("tr").toggle(e),t("#humata_local_second_straico_model").closest("tr").toggle(e),t(".humata-api-key-pool[data-option='humata_local_second_anthropic_api_key']").closest("tr").toggle(s),t("#humata_local_second_anthropic_model").closest("tr").toggle(s),t("#humata_local_second_anthropic_extended_thinking").closest("tr").toggle(s),t(".humata-api-key-pool[data-option='humata_local_second_openrouter_api_key']").closest("tr").toggle(l),t("#humata_local_second_openrouter_model").closest("tr").toggle(l)}t(document).on("change",'input[name="humata_local_second_llm_provider"]',c),c()}(),function(){function m(a){return'<tr class="humata-repeater-row"><td class="humata-repeater-handle-cell"><span class="dashicons dashicons-move humata-repeater-handle" aria-hidden="true"></span><span class="screen-reader-text">Drag to reorder</span></td><td style="width: 28%"><input type="text" class="regular-text" name="humata_floating_help[external_links]['+a+'][label]" value="" placeholder="Label"></td><td><input type="url" class="regular-text" name="humata_floating_help[external_links]['+a+'][url]" value="" placeholder="https://example.com/"></td><td style="width: 90px"><button type="button" class="button link-delete humata-repeater-remove">Remove</button></td></tr>'}function c(a){return'<tr class="humata-repeater-row"><td class="humata-repeater-handle-cell"><span class="dashicons dashicons-move humata-repeater-handle" aria-hidden="true"></span><span class="screen-reader-text">Drag to reorder</span></td><td style="width: 38%"><input type="text" class="regular-text" name="humata_auto_links['+a+'][phrase]" value="" placeholder="Phrase (exact match)"></td><td><input type="url" class="regular-text" name="humata_auto_links['+a+'][url]" value="" placeholder="https://example.com/"></td><td style="width: 90px"><button type="button" class="button link-delete humata-repeater-remove">Remove</button></td></tr>'}function i(a){return'<tr class="humata-repeater-row"><td class="humata-repeater-handle-cell"><span class="dashicons dashicons-move humata-repeater-handle" aria-hidden="true"></span><span class="screen-reader-text">Drag to reorder</span></td><td style="width: 34%"><input type="text" class="regular-text" name="humata_floating_help[faq_items]['+a+'][question]" value="" placeholder="Question"></td><td><textarea class="large-text" rows="3" name="humata_floating_help[faq_items]['+a+'][answer]" placeholder="Answer"></textarea></td><td style="width: 90px"><button type="button" class="button link-delete humata-repeater-remove">Remove</button></td></tr>'}function e(a){if(!(!a||!a.length)){var r=a.find("tbody");if(r.length&&r.sortable&&!r.data("humataSortableInit")){r.sortable({axis:"y",items:"> tr",handle:".humata-repeater-handle",placeholder:"humata-repeater-placeholder",forcePlaceholderSize:!0,tolerance:"pointer"});try{r.disableSelection()}catch(p){}r.data("humataSortableInit",!0)}}}function s(a){if(!(!a||!a.length)){var r=String(a.data("humataRepeater")||""),p=S(a.attr("data-next-index"),a.find("tbody tr").length),h="";if(r==="external_links"?h=m(p):r==="auto_links"?h=c(p):r==="faq_items"&&(h=i(p)),!!h){var y=a.find("tbody");y.length&&(y.append(h),a.attr("data-next-index",String(p+1)),e(a))}}}t(document).on("click",".humata-floating-help-repeater .humata-repeater-add",function(){s(t(this).closest(".humata-floating-help-repeater"))}),t(document).on("click",".humata-floating-help-repeater .humata-repeater-remove",function(){t(this).closest("tr").remove()}),t(".humata-floating-help-repeater").each(function(){e(t(this))}),t(document).on("click",".humata-upload-avatar",function(a){a.preventDefault();var r=t(this).data("target"),p=r.indexOf("logo")!==-1,h=p?"Select Logo Image":"Select Avatar Image",y=wp.media({title:h,button:{text:"Use this image"},multiple:!1,library:{type:["image/jpeg","image/png","image/gif","image/webp"]}});y.on("select",function(){var T=y.state().get("selection").first().toJSON();t("#"+r).val(T.url);var D=p?'<img src="'+T.url+'" alt="Logo Preview" />':'<img src="'+T.url+'" style="max-width:64px;max-height:64px;border-radius:6px;" />';t("#"+r+"_preview").html(D),t('.humata-remove-avatar[data-target="'+r+'"]').show()}),y.open()}),t(document).on("click",".humata-remove-avatar",function(a){a.preventDefault();var r=t(this).data("target");t("#"+r).val(""),t("#"+r+"_preview").empty(),t(this).hide()});function l(a,r){return'<tr class="humata-intent-link-row"><td><input type="text" class="regular-text" name="humata_intent_links['+a+"][links]["+r+'][title]" value="" placeholder="Shipping Policy"></td><td><input type="url" class="regular-text" name="humata_intent_links['+a+"][links]["+r+'][url]" value="" placeholder="https://example.com/shipping"></td><td><button type="button" class="button link-delete humata-intent-link-remove">Remove</button></td></tr>'}function g(a,r){return'<tr class="humata-intent-accordion-row"><td><input type="text" class="regular-text" name="humata_intent_links['+a+"][accordions]["+r+'][title]" value="" placeholder="e.g., Shipping Restrictions"></td><td><div class="humata-accordion-toolbar"><button type="button" class="button button-small humata-format-bold" title="Bold"><strong>B</strong></button><button type="button" class="button button-small humata-format-italic" title="Italic"><em>I</em></button><button type="button" class="button button-small humata-format-link" title="Insert Link">\u{1F517}</button></div><textarea class="large-text humata-accordion-content-input" rows="3" name="humata_intent_links['+a+"][accordions]["+r+'][content]" placeholder="Content shown when expanded... (supports formatting)" maxlength="1000"></textarea></td><td><button type="button" class="button link-delete humata-intent-accordion-remove">Remove</button></td></tr>'}function v(a){return'<div class="humata-intent-card" data-intent-index="'+a+'"><div class="humata-intent-card-header"><button type="button" class="humata-intent-toggle" aria-expanded="true" aria-label="Toggle intent"><span class="dashicons dashicons-arrow-down-alt2"></span></button><span class="humata-intent-card-title">Intent #'+(a+1)+'</span><button type="button" class="button link-delete humata-intent-remove">Remove Intent</button></div><div class="humata-intent-card-body"><p><label><strong>Intent Name</strong></label><br><input type="text" class="regular-text" name="humata_intent_links['+a+'][intent_name]" value="" placeholder="e.g., shipping_intent"> <span class="description">Internal label (not shown to users).</span></p><p><label><strong>Keywords</strong></label><br><textarea class="large-text" rows="2" name="humata_intent_links['+a+`][keywords]" placeholder="shipping, ship, delivery, deliver, track, package"></textarea> <span class="description">Comma-separated keywords. If any keyword appears in the user's question, the links below are shown.</span></p><div class="humata-intent-links-sub" data-links-next-index="1"><label><strong>Resource Links</strong></label><table class="widefat striped humata-intent-links-table" style="max-width: 800px; margin-top: 6px;"><thead><tr><th>Title</th><th>URL</th><th style="width: 80px;">Actions</th></tr></thead><tbody><tr class="humata-intent-link-row"><td><input type="text" class="regular-text" name="humata_intent_links[`+a+'][links][0][title]" value="" placeholder="Shipping Policy"></td><td><input type="url" class="regular-text" name="humata_intent_links['+a+'][links][0][url]" value="" placeholder="https://example.com/shipping"></td><td><button type="button" class="button link-delete humata-intent-link-remove">Remove</button></td></tr></tbody></table><p style="margin-top: 8px;"><button type="button" class="button button-secondary humata-intent-link-add">Add Link</button></p></div><div class="humata-intent-accordions-sub" data-accordions-next-index="1" style="margin-top: 20px;"><label><strong>Custom Accordions</strong></label><span class="description" style="display: block; margin-bottom: 6px;">FAQ-style collapsible toggles shown in the chat response.</span><table class="widefat striped humata-intent-accordions-table" style="max-width: 800px; margin-top: 6px;"><thead><tr><th style="width: 200px;">Title</th><th>Content</th><th style="width: 80px;">Actions</th></tr></thead><tbody><tr class="humata-intent-accordion-row"><td><input type="text" class="regular-text" name="humata_intent_links['+a+'][accordions][0][title]" value="" placeholder="e.g., Shipping Restrictions"></td><td><div class="humata-accordion-toolbar"><button type="button" class="button button-small humata-format-bold" title="Bold"><strong>B</strong></button><button type="button" class="button button-small humata-format-italic" title="Italic"><em>I</em></button><button type="button" class="button button-small humata-format-link" title="Insert Link">\u{1F517}</button></div><textarea class="large-text humata-accordion-content-input" rows="3" name="humata_intent_links['+a+'][accordions][0][content]" placeholder="Content shown when expanded... (supports formatting)" maxlength="1000"></textarea></td><td><button type="button" class="button link-delete humata-intent-accordion-remove">Remove</button></td></tr></tbody></table><p style="margin-top: 8px;"><button type="button" class="button button-secondary humata-intent-accordion-add">Add Accordion</button></p></div></div></div>'}t(document).on("click",".humata-intent-add",function(){var a=t(this).closest(".humata-intent-links-repeater"),r=a.find(".humata-intent-links-container"),p=S(a.attr("data-next-index"),r.find(".humata-intent-card").length);r.append(v(p)),a.attr("data-next-index",String(p+1))}),t(document).on("click",".humata-intent-remove",function(){t(this).closest(".humata-intent-card").remove()}),t(document).on("click",".humata-intent-link-add",function(){var a=t(this).closest(".humata-intent-links-sub"),r=a.find("tbody"),p=t(this).closest(".humata-intent-card"),h=S(p.attr("data-intent-index"),0),y=S(a.attr("data-links-next-index"),r.find("tr").length);r.append(l(h,y)),a.attr("data-links-next-index",String(y+1))}),t(document).on("click",".humata-intent-link-remove",function(){var a=t(this).closest("tbody");if(t(this).closest("tr").remove(),a.find("tr").length===0){var r=a.closest(".humata-intent-card"),p=a.closest(".humata-intent-links-sub"),h=S(r.attr("data-intent-index"),0);a.append(l(h,0)),p.attr("data-links-next-index","1")}}),t(document).on("click",".humata-intent-accordion-add",function(){var a=t(this).closest(".humata-intent-accordions-sub"),r=a.find("tbody"),p=t(this).closest(".humata-intent-card"),h=S(p.attr("data-intent-index"),0),y=S(a.attr("data-accordions-next-index"),r.find("tr").length);r.find("tr").length>=5||(r.append(g(h,y)),a.attr("data-accordions-next-index",String(y+1)))}),t(document).on("click",".humata-intent-accordion-remove",function(){var a=t(this).closest("tbody");if(t(this).closest("tr").remove(),a.find("tr").length===0){var r=a.closest(".humata-intent-card"),p=a.closest(".humata-intent-accordions-sub"),h=S(r.attr("data-intent-index"),0);a.append(g(h,0)),p.attr("data-accordions-next-index","1")}});function C(a,r,p){var h=a.selectionStart,y=a.selectionEnd,T=a.value,D=T.substring(h,y);D||(D="text");var n=T.substring(0,h)+r+D+p+T.substring(y);a.value=n,a.focus(),a.setSelectionRange(h+r.length,h+r.length+D.length)}t(document).on("click",".humata-format-bold",function(){var a=t(this).closest("td").find("textarea");a.length&&C(a[0],"<strong>","</strong>")}),t(document).on("click",".humata-format-italic",function(){var a=t(this).closest("td").find("textarea");a.length&&C(a[0],"<em>","</em>")}),t(document).on("click",".humata-format-link",function(){var a=t(this).closest("td").find("textarea");if(a.length){var r=prompt("Enter URL:","https://");r&&r!=="https://"&&C(a[0],'<a href="'+r+'" target="_blank">',"</a>")}});function I(){var a=t(".humata-trigger-pages-list");if(!(!a.length||!a.sortable)&&!a.data("humataSortableInit")){a.sortable({axis:"y",items:"> .humata-trigger-page-item",handle:".humata-repeater-handle",placeholder:"humata-repeater-placeholder",forcePlaceholderSize:!0,tolerance:"pointer",update:function(){F()}});try{a.disableSelection()}catch(r){}a.data("humataSortableInit",!0)}}function F(){t(".humata-trigger-pages-list .humata-trigger-page-item").each(function(r){var p=t(this);p.find('input[name*="humata_trigger_pages"]').each(function(){var h=t(this).attr("name");h=h.replace(/humata_trigger_pages\[\d+\]/,"humata_trigger_pages["+r+"]"),t(this).attr("name",h)}),p.find('textarea[name*="humata_trigger_pages"]').each(function(){var h=t(this).attr("name");h=h.replace(/humata_trigger_pages\[\d+\]/,"humata_trigger_pages["+r+"]"),t(this).attr("name",h)})});var a=t(".humata-trigger-pages-repeater");a.attr("data-next-index",String(t(".humata-trigger-pages-list .humata-trigger-page-item").length))}t(document).on("click",".humata-trigger-pages-repeater .humata-repeater-remove",function(){var a=t(this).closest(".humata-trigger-page-item"),r=a.find(".wp-editor-area").attr("id");r&&typeof tinymce!="undefined"&&tinymce.get(r)&&tinymce.get(r).remove(),a.remove(),F()}),t(document).on("click",".humata-trigger-pages-add",function(){var a=t(".humata-trigger-pages-list .humata-trigger-page-item").last();a.length&&(a[0].scrollIntoView({behavior:"smooth",block:"center"}),a.find('input[type="text"]').first().focus())}),I();var q="humata_intent_collapsed";function P(){try{var a=localStorage.getItem(q);if(a){var r=JSON.parse(a);if(Array.isArray(r))return r}}catch(p){}return[]}function O(a){try{localStorage.setItem(q,JSON.stringify(a))}catch(r){}}function k(a){var r=a.find(".humata-intent-toggle");a.addClass("humata-intent-collapsed"),r.attr("aria-expanded","false"),r.find(".dashicons").removeClass("dashicons-arrow-down-alt2").addClass("dashicons-arrow-right-alt2")}function E(a){var r=a.find(".humata-intent-toggle");a.removeClass("humata-intent-collapsed"),r.attr("aria-expanded","true"),r.find(".dashicons").removeClass("dashicons-arrow-right-alt2").addClass("dashicons-arrow-down-alt2")}(function(){var a=P();a.length&&t(".humata-intent-card").each(function(){var r=S(t(this).attr("data-intent-index"),-1);r>=0&&a.indexOf(r)!==-1&&k(t(this))})})(),t(document).on("click",".humata-intent-toggle",function(){var a=t(this),r=a.closest(".humata-intent-card"),p=a.attr("aria-expanded")==="true",h=S(r.attr("data-intent-index"),-1);p?k(r):E(r);var y=P(),T=y.indexOf(h);p&&T===-1?y.push(h):!p&&T!==-1&&y.splice(T,1),O(y)})}(),function(){function m(){var e=t('input[name="humata_suggested_questions[mode]"]:checked').val()||"fixed",s=t("#humata_sq_fixed_questions").closest("tr").parent().closest("table").prev("h2").addBack().add(t("#humata_sq_fixed_questions").closest("tr")),l=t("#humata_sq_randomized_categories").closest("tr").parent().closest("table").prev("h2").addBack().add(t("#humata_sq_randomized_categories").closest("tr"));t(".humata-sq-fixed-section").closest("tr").toggle(e==="fixed"),t(".humata-sq-randomized-section").closest("tr").toggle(e==="randomized")}t(document).on("change",".humata-sq-mode-radio",m),m(),t(document).on("click",".humata-sq-fixed-add",function(){var e=t(this).closest(".humata-sq-fixed-section"),s=e.find("tbody"),l=s.find("tr").length;if(!(l>=4)){var g=S(e.attr("data-next-index"),l),v='<tr class="humata-repeater-row humata-sq-fixed-row"><td class="humata-repeater-handle-cell"><span class="dashicons dashicons-move humata-repeater-handle" aria-hidden="true"></span><span class="screen-reader-text">Drag to reorder</span></td><td><input type="text" class="large-text" name="humata_suggested_questions[fixed_questions]['+g+'][text]" value="" placeholder="e.g., What are your business hours?" maxlength="150"></td><td><button type="button" class="button link-delete humata-repeater-remove">Remove</button></td></tr>';s.append(v),e.attr("data-next-index",String(g+1))}}),t(document).on("click",".humata-sq-fixed-section .humata-repeater-remove",function(){t(this).closest("tr").remove()}),t.fn.sortable&&t(".humata-sq-fixed-section tbody").sortable({handle:".humata-repeater-handle",axis:"y",cursor:"move",opacity:.7}),t(document).on("click",".humata-sq-category-add",function(){var e=t(this).closest(".humata-sq-randomized-section"),s=e.find(".humata-sq-categories-container"),l=s.find(".humata-sq-category-card").length;if(!(l>=4)){var g=S(e.attr("data-next-cat-index"),l),v=i(g);s.append(v),e.attr("data-next-cat-index",String(g+1))}}),t(document).on("click",".humata-sq-category-remove",function(){t(this).closest(".humata-sq-category-card").remove()}),t(document).on("click",".humata-sq-question-add",function(){var e=t(this).closest(".humata-sq-questions-sub"),s=e.find("tbody"),l=t(this).closest(".humata-sq-category-card"),g=S(l.attr("data-cat-index"),0),v=S(e.attr("data-next-q-index"),s.find("tr").length);if(!(s.find("tr").length>=20)){var C=c(g,v);s.append(C),e.attr("data-next-q-index",String(v+1))}}),t(document).on("click",".humata-sq-question-remove",function(){var e=t(this).closest("tbody");if(t(this).closest("tr").remove(),e.find("tr").length===0){var s=e.closest(".humata-sq-category-card"),l=e.closest(".humata-sq-questions-sub"),g=S(s.attr("data-cat-index"),0);e.append(c(g,0)),l.attr("data-next-q-index","1")}}),t(document).on("click",".humata-sq-category-toggle",function(){var e=t(this),s=e.closest(".humata-sq-category-card"),l=e.attr("aria-expanded")==="true";l?(s.addClass("humata-sq-category-collapsed"),e.attr("aria-expanded","false"),e.find(".dashicons").removeClass("dashicons-arrow-down-alt2").addClass("dashicons-arrow-right-alt2")):(s.removeClass("humata-sq-category-collapsed"),e.attr("aria-expanded","true"),e.find(".dashicons").removeClass("dashicons-arrow-right-alt2").addClass("dashicons-arrow-down-alt2"))});function c(e,s){return'<tr class="humata-sq-question-row"><td><input type="text" class="large-text" name="humata_suggested_questions[categories]['+e+"][questions]["+s+']" value="" placeholder="e.g., How do I track my order?" maxlength="150"></td><td><button type="button" class="button link-delete humata-sq-question-remove">Remove</button></td></tr>'}function i(e){return'<div class="humata-sq-category-card" data-cat-index="'+e+'"><div class="humata-sq-category-header"><button type="button" class="humata-sq-category-toggle" aria-expanded="true" aria-label="Toggle category"><span class="dashicons dashicons-arrow-down-alt2"></span></button><span class="humata-sq-category-title">Category #'+(e+1)+'</span><button type="button" class="button link-delete humata-sq-category-remove">Remove Category</button></div><div class="humata-sq-category-body"><p><label><strong>Category Name</strong> <span class="description">(optional)</span></label><br><input type="text" class="regular-text" name="humata_suggested_questions[categories]['+e+'][name]" value="" placeholder="e.g., Product Questions" maxlength="50"></p><div class="humata-sq-questions-sub" data-next-q-index="1"><label><strong>Questions</strong></label><p class="description">At least 1 question required per category.</p><table class="widefat striped humata-sq-questions-table" style="max-width: 650px; margin-top: 6px;"><thead><tr><th>Question Text</th><th style="width: 80px;">Actions</th></tr></thead><tbody><tr class="humata-sq-question-row"><td><input type="text" class="large-text" name="humata_suggested_questions[categories]['+e+'][questions][0]" value="" placeholder="e.g., How do I track my order?" maxlength="150"></td><td><button type="button" class="button link-delete humata-sq-question-remove">Remove</button></td></tr></tbody></table><p style="margin-top: 8px;"><button type="button" class="button button-secondary humata-sq-question-add">Add Question</button></p></div></div></div>'}}(),function(){function m(i,e){return'<div class="humata-api-key-pool__row"><input type="password" id="'+i+"_"+e+'" name="'+i+'[]" value="" class="regular-text humata-api-key-pool__input" autocomplete="off" placeholder="API Key"/><button type="button" class="button humata-api-key-pool__remove" title="Remove"><span class="dashicons dashicons-trash"></span></button></div>'}function c(i){var e=i.find(".humata-api-key-pool__count"),s=i.find(".humata-api-key-pool__input").filter(function(){return t.trim(t(this).val())!==""}).length;s>1?(e.length||(e=t('<span class="humata-api-key-pool__count"></span>'),i.find(".humata-api-key-pool__add").after(e)),e.text(s+" keys configured (rotation enabled)").show()):e.hide()}t(document).on("click",".humata-api-key-pool__add",function(){var i=t(this).closest(".humata-api-key-pool"),e=i.data("option")||"",s=i.find(".humata-api-key-pool__keys"),l=s.find(".humata-api-key-pool__row").length;s.append(m(e,l)),c(i),s.find(".humata-api-key-pool__row").last().find("input").focus()}),t(document).on("click",".humata-api-key-pool__remove",function(){var i=t(this).closest(".humata-api-key-pool"),e=t(this).closest(".humata-api-key-pool__row"),s=i.find(".humata-api-key-pool__row");s.length<=1?e.find("input").val(""):e.remove(),c(i)}),t(document).on("input",".humata-api-key-pool__input",function(){var i=t(this).closest(".humata-api-key-pool");c(i)}),t(".humata-api-key-pool").each(function(){c(t(this))})}(),function(){var m=t(".humata-followup-provider-radio");if(!m.length)return;function c(){var i=t('input[name="humata_followup_questions[provider]"]:checked').val()||"straico",e=t(".humata-followup-straico-fields"),s=t(".humata-followup-anthropic-fields"),l=t(".humata-followup-openrouter-fields");e.closest("tr").toggle(i==="straico"),s.closest("tr").toggle(i==="anthropic"),l.closest("tr").toggle(i==="openrouter")}m.on("change",c),c()}(),function(){var m=t("#humata-docs-table");if(!m.length)return;var c=t("#humata-select-all"),i=m.find(".humata-doc-checkbox"),e=t("#humata-select-count"),s=null;function l(){var v=m.find(".humata-doc-checkbox:checked").length;v>0?e.text(v+" selected"):e.text("")}function g(){var v=i.length,C=m.find(".humata-doc-checkbox:checked").length;C===0?(c.prop("checked",!1),c.prop("indeterminate",!1)):C===v?(c.prop("checked",!0),c.prop("indeterminate",!1)):(c.prop("checked",!1),c.prop("indeterminate",!0))}c.on("change",function(){var v=t(this).prop("checked");i.prop("checked",v),s=null,l()}),i.on("click",function(v){var C=t(this),I=parseInt(C.closest("tr").attr("data-index"),10);if(v.shiftKey&&s!==null){var F=Math.min(s,I),q=Math.max(s,I),P=C.prop("checked");m.find("tbody tr").each(function(){var O=parseInt(t(this).attr("data-index"),10);O>=F&&O<=q&&t(this).find(".humata-doc-checkbox").prop("checked",P)})}s=I,g(),l()}),i.on("change",function(){g(),l()}),l(),g()}()})})(jQuery);})();
//# sourceMappingURL=admin-settings.js.map
