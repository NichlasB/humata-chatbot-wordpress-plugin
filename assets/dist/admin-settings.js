(()=>{(function(t){"use strict";t(function(){var L=window.humataAdminConfig||{},O=String(L.nonce||"");L.documentTitles&&typeof L.documentTitles=="object"?window.humataDocumentTitles=L.documentTitles:(!window.humataDocumentTitles||typeof window.humataDocumentTitles!="object")&&(window.humataDocumentTitles={});var N=String(L.ajaxUrl||window.ajaxurl||"");function C(d,u){var o=parseInt(d,10);return isFinite(o)&&o>=0?o:u||0}(function(){var d=window.humataDocumentTitles||{},u=L.i18n&&typeof L.i18n.titleNotFetchedText=="string"?L.i18n.titleNotFetchedText:"(title not fetched)",o=100,a=0;function s(n){var r=(n||"").match(/[a-f0-9]{8}-[a-f0-9]{4}-[a-f0-9]{4}-[a-f0-9]{4}-[a-f0-9]{12}/ig)||[],c={},m=[];return t.each(r,function(b,y){y=y.toLowerCase(),c[y]||(c[y]=!0,m.push(y))}),m}function l(){return t("#humata-document-ids-tokens .humata-token").map(function(){return(t(this).attr("data-id")||"").toLowerCase()}).get()}function h(n){return n=(n||"").toLowerCase(),d[n]?d[n]:n}function f(){var n=t("#humata-document-ids-tokens"),r=n.children(".humata-token").get();r.sort(function(c,m){var b=(t(c).attr("data-id")||"").toLowerCase(),y=(t(m).attr("data-id")||"").toLowerCase(),x=t.trim(h(b)||b).toLowerCase(),v=t.trim(h(y)||y).toLowerCase();return x===v?y.localeCompare(b):v.localeCompare(x)}),t.each(r,function(c,m){n.append(m)})}function w(n){if(n=(n||"").toLowerCase(),!!n&&!t('#humata-document-ids-tokens .humata-token[data-id="'+n+'"]').length){var r=t("<span></span>").addClass("humata-token").attr("data-id",n).attr("title",h(n)),c=t("<span></span>").addClass("humata-token-label").text(h(n)),m=t("<button></button>").attr("type","button").addClass("humata-token-remove").attr("aria-label","Remove").text("\xD7");r.append(c).append(m),t("#humata-document-ids-tokens").append(r)}}function I(){var n=l();t("#humata_document_ids").val(n.join(", ")),t("#humata-document-count").text(n.length)}function F(n){var r=t("#humata-documents-pagination");if(r.length&&(r.empty(),!(!n||n<=o))){var c=Math.max(1,Math.ceil(n/o)),m=a+1,b=a*o+1,y=Math.min((a+1)*o,n),x=t("<button></button>").attr("type","button").addClass("button button-secondary").attr("id","humata-documents-page-prev").text("Previous").prop("disabled",a<=0),v=t("<button></button>").attr("type","button").addClass("button button-secondary").attr("id","humata-documents-page-next").text("Next").prop("disabled",a>=c-1),S=t("<span></span>").addClass("humata-documents-page-info").text("Showing "+b+"\u2013"+y+" of "+n+" (Page "+m+"/"+c+")");r.append(x).append(S).append(v)}}function q(){var n=t("#humata-documents-table-body");if(n.length){var r=l(),c=r.length;if(!c){n.empty(),F(0);return}var m=Math.max(1,Math.ceil(c/o));a>=m&&(a=m-1),a<0&&(a=0);var b=a*o,y=Math.min(b+o,c),x=r.slice(b,y);n.empty(),t.each(x,function(v,S){var D=d[S]?d[S]:u,R=t("<tr></tr>").attr("data-doc-id",S);R.append(t("<td></td>").addClass("humata-doc-title").text(D)),R.append(t("<td></td>").append(t("<code></code>").text(S))),n.append(R)}),F(c)}}function A(n){var r=s(n);return r.length?(t.each(r,function(c,m){w(m)}),f(),I(),q(),!0):!1}function B(){var n=t("#humata_document_ids"),r=t("#humata-document-ids-tokens");if(!(!n.length||!r.length)){var c=s(n.val());r.empty(),t.each(c,function(m,b){w(b)}),f(),I(),q()}}B(),t(document).on("click","#humata-documents-page-prev",function(){a>0&&(a--,q())}),t(document).on("click","#humata-documents-page-next",function(){var n=l().length,r=Math.max(1,Math.ceil(n/o));a<r-1&&(a++,q())}),t(document).on("click","#humata-document-ids-control, #humata-document-ids-tokens",function(n){t(n.target).closest(".humata-token-remove").length||t("#humata_document_ids_input").trigger("focus")}),t(document).on("click",".humata-token-remove",function(){t(this).closest(".humata-token").remove(),I(),q()}),t(document).on("keydown","#humata_document_ids_input",function(n){var r=n.key;if(r===","||r==="Enter"||r==="Tab"){var c=t(this).val(),m=A(c);if(r==="Enter"||r===","){n.preventDefault(),m&&t(this).val("");return}if(r==="Tab"&&m){n.preventDefault(),t(this).val("");return}}if(r==="Backspace"&&t(this).val()===""){var b=t("#humata-document-ids-tokens .humata-token").last();b.length&&(b.remove(),I(),q(),n.preventDefault())}}),t(document).on("paste","#humata_document_ids_input",function(){var n=t(this);setTimeout(function(){var r=A(n.val());r&&n.val("")},0)}),t(document).on("blur","#humata_document_ids_input",function(){var n=t(this).val(),r=A(n);r&&t(this).val("")});function k(n,r){var c=t("#humata-document-ids-io-status");c.length&&(c.removeClass("humata-io-status-success humata-io-status-error humata-io-status-info"),r==="success"?c.addClass("humata-io-status-success"):r==="error"?c.addClass("humata-io-status-error"):r==="info"&&c.addClass("humata-io-status-info"),c.text(n||""))}function E(){var n=l();return!n||!n.length?"":n.join("\\n")}function e(n,r,c){try{var m=c||"text/plain;charset=utf-8",b=new Blob([r||""],{type:m}),y=URL.createObjectURL(b),x=document.createElement("a");x.href=y,x.download=n||"humata-document-ids.txt",document.body.appendChild(x),x.click(),setTimeout(function(){try{document.body.removeChild(x)}catch(v){}try{URL.revokeObjectURL(y)}catch(v){}},0)}catch(v){k("Download failed.","error")}}function i(n){return navigator.clipboard&&navigator.clipboard.writeText?navigator.clipboard.writeText(n):g(n)}function g(n){return new Promise(function(r,c){var m=/Mac|iPhone|iPad|iPod/i.test(navigator.platform||navigator.userAgent),b=m?"Cmd+C":"Ctrl+C",y="Press "+b+" to copy";p(y);var x=t("<textarea></textarea>").attr("readonly","").attr("aria-label","Text to copy").css({position:"fixed",top:"50%",left:"50%",transform:"translate(-50%, -50%)",width:"1px",height:"1px",padding:"0",border:"none",outline:"none",opacity:"0",zIndex:"999999"}).val(n||"");t("body").append(x),x[0].focus(),x[0].select(),x[0].setSelectionRange(0,x[0].value.length);function v(){D(),r()}function S(R){R.key==="Escape"&&(D(),c(new Error("copy_cancelled")))}function D(){t(document).off("copy",v),t(document).off("keydown",S),x.remove(),_()}t(document).on("copy",v),t(document).on("keydown",S),setTimeout(function(){D(),c(new Error("copy_timeout"))},1e4)})}function p(n){_();var r=t("<div></div>").attr("id","humata-admin-copy-toast").text(n).css({position:"fixed",top:"20px",left:"50%",transform:"translateX(-50%)",background:"#333",color:"#fff",padding:"12px 24px",borderRadius:"8px",fontSize:"14px",zIndex:"999999",boxShadow:"0 4px 12px rgba(0,0,0,0.3)"});t("body").append(r)}function _(){t("#humata-admin-copy-toast").remove()}function T(){var n=t('input[name="humata_document_ids_import_mode"]:checked'),r=n.length?String(n.val()||""):"";return r=t.trim(r),r==="replace"?"replace":"merge"}function P(n,r){var c=String(n||""),m=r==="replace"?"replace":"merge",b=l().length,y=s(c);if(!y.length)return k("No valid UUIDs found to import.","error"),!1;var x=b;m==="replace"&&(t("#humata-document-ids-tokens").empty(),a=0,x=0),t.each(y,function(R,M){w(M)}),f(),I(),q();var v=l().length;if(m==="merge"){var S=Math.max(0,v-x),D=Math.max(0,y.length-S);k("Imported "+S+" IDs ("+D+" duplicates ignored). Click Save Settings to persist.","success")}else k("Replaced "+b+" IDs with "+v+" imported IDs. Click Save Settings to persist.","success");return!0}t(document).on("click","#humata-document-ids-export-copy",function(){var n=E(),r=l().length;if(!n){k("No document IDs to export.","error");return}i(n).then(function(){k("Copied "+r+" IDs to clipboard.","success")}).catch(function(){k("Copy failed. Try Download TXT instead.","error")})}),t(document).on("click","#humata-document-ids-export-download",function(){var n=l();if(!n.length){k("No document IDs to export.","error");return}var r=n.join("\\n")+"\\n";e("humata-document-ids.txt",r,"text/plain;charset=utf-8"),k("Downloaded TXT for "+n.length+" IDs.","info")}),t(document).on("click","#humata-document-ids-export-download-json",function(){var n=l();if(!n.length){k("No document IDs to export.","error");return}var r=JSON.stringify({document_ids:n},null,2);e("humata-document-ids.json",r+"\\n","application/json;charset=utf-8"),k("Downloaded JSON for "+n.length+" IDs.","info")}),t(document).on("change","#humata-document-ids-import-file",function(){var n=this,r=n&&n.files&&n.files[0]?n.files[0]:null;if(r){var c=new FileReader;c.onload=function(m){var b=m&&m.target&&m.target.result?String(m.target.result):"";t("#humata-document-ids-import-text").val(b),k("Loaded file. Choose Merge/Replace and click Apply Import.","info")},c.onerror=function(){k("Failed to read file.","error")};try{c.readAsText(r)}catch(m){k("Failed to read file.","error")}}}),t(document).on("click","#humata-document-ids-import-apply",function(){var n=t("#humata-document-ids-import-text").val(),r=T();P(n,r)}),t(document).on("click","#humata-document-ids-clear-all",function(){var n=l().length;if(!n){k("No document IDs to clear.","info");return}window.confirm("Remove all configured Document IDs?")&&(t("#humata-document-ids-tokens").empty(),a=0,I(),q(),k("Cleared all Document IDs. Click Save Settings to persist.","success"))}),t("#humata-test-api").on("click",function(){var n=t(this),r=t("#humata-test-result");n.prop("disabled",!0).text("Testing..."),r.html(""),t.post(N,{action:"humata_test_api",nonce:O},function(c){n.prop("disabled",!1).text("Test API Connection"),c.success?r.html('<span style="color:green;">\u2713 '+c.data.message+"</span>"):r.html('<span style="color:red;">\u2717 '+c.data.message+"</span>")}).fail(function(){n.prop("disabled",!1).text("Test API Connection"),r.html('<span style="color:red;">\u2717 Request failed</span>')})}),t("#humata-clear-cache").on("click",function(){var n=t(this);n.prop("disabled",!0).text("Clearing..."),t.post(N,{action:"humata_clear_cache",nonce:O},function(r){n.prop("disabled",!1).text("Clear Cache"),r.success?(alert("Cache cleared!"),location.reload()):alert("Failed to clear cache.")})}),t("#humata-test-ask").on("click",function(){var n=t(this),r=t("#humata-test-result");n.prop("disabled",!0).text("Testing Ask..."),r.html(""),t.post(N,{action:"humata_test_ask",nonce:O},function(c){n.prop("disabled",!1).text("Test Ask"),c.success?r.html('<span style="color:green;">\u2713 '+c.data.message+"</span>"):r.html('<span style="color:red;">\u2717 '+c.data.message+"</span>")}).fail(function(){n.prop("disabled",!1).text("Test Ask"),r.html('<span style="color:red;">\u2717 Request failed</span>')})}),t("#humata-fetch-titles").on("click",function(){var n=t(this),r=t("#humata-test-result"),c=0,m=5,b=2e3,y=t("#humata_document_ids").val();n.prop("disabled",!0).text("Fetching..."),r.html("");function x(){t.post(N,{action:"humata_fetch_titles",nonce:O,offset:c,limit:m,document_ids:y},function(v){if(!v.success){n.prop("disabled",!1).text("Fetch Titles");var S=v.data&&v.data.message?v.data.message:"Request failed";v.data&&v.data.errorMessage&&(S=S+" ("+v.data.errorMessage+")"),r.html('<span style="color:red;">\u2717 '+S+"</span>");return}v.data&&v.data.titles&&t.each(v.data.titles,function(R,M){if(R=(R||"").toLowerCase(),!(!R||!M)){d[R]=M;var j=t('#humata-document-ids-tokens .humata-token[data-id="'+R+'"]');j.find(".humata-token-label").text(M),j.attr("title",M),t('#humata-documents-table-body tr[data-doc-id="'+R+'"] .humata-doc-title').text(M)}}),f(),I(),q(),c=v.data.nextOffset;var D=v.data.message||"";if(v.data.errors&&v.data.errorMessage&&(D=D+" ("+v.data.errorMessage+")"),r.html('<span style="color:green;">\u2713 '+D+"</span>"),v.data.done){n.prop("disabled",!1).text("Fetch Titles");return}setTimeout(x,b)}).fail(function(){n.prop("disabled",!1).text("Fetch Titles"),r.html('<span style="color:red;">\u2717 Request failed</span>')})}x()})})(),function(){function d(){var o=t('input[name="humata_search_provider"]:checked'),a=o.length?String(o.val()||""):"";return a=t.trim(a),a||(a="humata"),a}function u(){if(t('input[name="humata_search_provider"]').length){var o=d(),a=o==="humata",s=o==="local";t("#humata_api_key").closest("table").closest("tbody").parent().closest("table").prev("h2:contains('Humata API')").toggle(a),t(".form-table").each(function(){var l=t(this),h=l.prev("h2, p").prev("h2");h.length||(h=l.prev("h2"));var f=h.text()||"";(f.indexOf("Humata API")!==-1||f.indexOf("Humata System Prompt")!==-1||f.indexOf("Second-Stage LLM System Prompt")!==-1)&&f.indexOf("Local Search")===-1&&(h.toggle(a),h.next("p").toggle(a),l.toggle(a)),f.indexOf("Local Search")!==-1&&(h.toggle(s),h.next("p").toggle(s),l.toggle(s))})}}t(document).on("change",'input[name="humata_search_provider"]',u),setTimeout(u,100)}(),function(){function d(){var o=t('input[name="humata_second_llm_provider"]:checked'),a=o.length?String(o.val()||""):"";return a=t.trim(a),a||(a="none"),a}function u(){var o=d(),a=o==="straico",s=o==="anthropic",l=o==="openrouter";t(".humata-api-key-pool[data-option='humata_straico_api_key']").closest("tr").toggle(a),t("#humata_straico_model").closest("tr").toggle(a),t(".humata-api-key-pool[data-option='humata_anthropic_api_key']").closest("tr").toggle(s),t("#humata_anthropic_model").closest("tr").toggle(s),t("#humata_anthropic_extended_thinking").closest("tr").toggle(s),t(".humata-api-key-pool[data-option='humata_openrouter_api_key']").closest("tr").toggle(l),t("#humata_openrouter_model").closest("tr").toggle(l)}t(document).on("change",'input[name="humata_second_llm_provider"]',u),u()}(),function(){function d(){var o=t('input[name="humata_local_first_llm_provider"]:checked'),a=o.length?String(o.val()||""):"";return a=t.trim(a),a||(a="straico"),a}function u(){var o=d(),a=o==="straico",s=o==="anthropic",l=o==="openrouter";t(".humata-api-key-pool[data-option='humata_local_first_straico_api_key']").closest("tr").toggle(a),t("#humata_local_first_straico_model").closest("tr").toggle(a),t(".humata-api-key-pool[data-option='humata_local_first_anthropic_api_key']").closest("tr").toggle(s),t("#humata_local_first_anthropic_model").closest("tr").toggle(s),t("#humata_local_first_anthropic_extended_thinking").closest("tr").toggle(s),t(".humata-api-key-pool[data-option='humata_local_first_openrouter_api_key']").closest("tr").toggle(l),t("#humata_local_first_openrouter_model").closest("tr").toggle(l)}t(document).on("change",'input[name="humata_local_first_llm_provider"]',u),u()}(),function(){function d(){var o=t('input[name="humata_local_second_llm_provider"]:checked'),a=o.length?String(o.val()||""):"";return a=t.trim(a),a||(a="none"),a}function u(){var o=d(),a=o==="straico",s=o==="anthropic",l=o==="openrouter";t(".humata-api-key-pool[data-option='humata_local_second_straico_api_key']").closest("tr").toggle(a),t("#humata_local_second_straico_model").closest("tr").toggle(a),t(".humata-api-key-pool[data-option='humata_local_second_anthropic_api_key']").closest("tr").toggle(s),t("#humata_local_second_anthropic_model").closest("tr").toggle(s),t("#humata_local_second_anthropic_extended_thinking").closest("tr").toggle(s),t(".humata-api-key-pool[data-option='humata_local_second_openrouter_api_key']").closest("tr").toggle(l),t("#humata_local_second_openrouter_model").closest("tr").toggle(l)}t(document).on("change",'input[name="humata_local_second_llm_provider"]',u),u()}(),function(){function d(e){return'<tr class="humata-repeater-row"><td class="humata-repeater-handle-cell"><span class="dashicons dashicons-move humata-repeater-handle" aria-hidden="true"></span><span class="screen-reader-text">Drag to reorder</span></td><td style="width: 28%"><input type="text" class="regular-text" name="humata_floating_help[external_links]['+e+'][label]" value="" placeholder="Label"></td><td><input type="url" class="regular-text" name="humata_floating_help[external_links]['+e+'][url]" value="" placeholder="https://example.com/"></td><td style="width: 90px"><button type="button" class="button link-delete humata-repeater-remove">Remove</button></td></tr>'}function u(e){return'<tr class="humata-repeater-row"><td class="humata-repeater-handle-cell"><span class="dashicons dashicons-move humata-repeater-handle" aria-hidden="true"></span><span class="screen-reader-text">Drag to reorder</span></td><td style="width: 38%"><input type="text" class="regular-text" name="humata_auto_links['+e+'][phrase]" value="" placeholder="Phrase (exact match)"></td><td><input type="url" class="regular-text" name="humata_auto_links['+e+'][url]" value="" placeholder="https://example.com/"></td><td style="width: 90px"><button type="button" class="button link-delete humata-repeater-remove">Remove</button></td></tr>'}function o(e){return'<tr class="humata-repeater-row"><td class="humata-repeater-handle-cell"><span class="dashicons dashicons-move humata-repeater-handle" aria-hidden="true"></span><span class="screen-reader-text">Drag to reorder</span></td><td style="width: 34%"><input type="text" class="regular-text" name="humata_floating_help[faq_items]['+e+'][question]" value="" placeholder="Question"></td><td><textarea class="large-text" rows="3" name="humata_floating_help[faq_items]['+e+'][answer]" placeholder="Answer"></textarea></td><td style="width: 90px"><button type="button" class="button link-delete humata-repeater-remove">Remove</button></td></tr>'}function a(e){if(!(!e||!e.length)){var i=e.find("tbody");if(i.length&&i.sortable&&!i.data("humataSortableInit")){i.sortable({axis:"y",items:"> tr",handle:".humata-repeater-handle",placeholder:"humata-repeater-placeholder",forcePlaceholderSize:!0,tolerance:"pointer"});try{i.disableSelection()}catch(g){}i.data("humataSortableInit",!0)}}}function s(e){if(!(!e||!e.length)){var i=String(e.data("humataRepeater")||""),g=C(e.attr("data-next-index"),e.find("tbody tr").length),p="";if(i==="external_links"?p=d(g):i==="auto_links"?p=u(g):i==="faq_items"&&(p=o(g)),!!p){var _=e.find("tbody");_.length&&(_.append(p),e.attr("data-next-index",String(g+1)),a(e))}}}t(document).on("click",".humata-floating-help-repeater .humata-repeater-add",function(){s(t(this).closest(".humata-floating-help-repeater"))}),t(document).on("click",".humata-floating-help-repeater .humata-repeater-remove",function(){t(this).closest("tr").remove()}),t(".humata-floating-help-repeater").each(function(){a(t(this))}),t(document).on("click",".humata-upload-avatar",function(e){e.preventDefault();var i=t(this).data("target"),g=i.indexOf("logo")!==-1,p=g?"Select Logo Image":"Select Avatar Image",_=wp.media({title:p,button:{text:"Use this image"},multiple:!1,library:{type:["image/jpeg","image/png","image/gif","image/webp"]}});_.on("select",function(){var T=_.state().get("selection").first().toJSON();t("#"+i).val(T.url);var P=g?'<img src="'+T.url+'" alt="Logo Preview" />':'<img src="'+T.url+'" style="max-width:64px;max-height:64px;border-radius:6px;" />';t("#"+i+"_preview").html(P),t('.humata-remove-avatar[data-target="'+i+'"]').show()}),_.open()}),t(document).on("click",".humata-remove-avatar",function(e){e.preventDefault();var i=t(this).data("target");t("#"+i).val(""),t("#"+i+"_preview").empty(),t(this).hide()});function l(e,i){return'<tr class="humata-intent-link-row"><td><input type="text" class="regular-text" name="humata_intent_links['+e+"][links]["+i+'][title]" value="" placeholder="Shipping Policy"></td><td><input type="url" class="regular-text" name="humata_intent_links['+e+"][links]["+i+'][url]" value="" placeholder="https://example.com/shipping"></td><td><button type="button" class="button link-delete humata-intent-link-remove">Remove</button></td></tr>'}function h(e,i){return'<tr class="humata-intent-accordion-row"><td><input type="text" class="regular-text" name="humata_intent_links['+e+"][accordions]["+i+'][title]" value="" placeholder="e.g., Shipping Restrictions"></td><td><div class="humata-accordion-toolbar"><button type="button" class="button button-small humata-format-bold" title="Bold"><strong>B</strong></button><button type="button" class="button button-small humata-format-italic" title="Italic"><em>I</em></button><button type="button" class="button button-small humata-format-link" title="Insert Link">\u{1F517}</button></div><textarea class="large-text humata-accordion-content-input" rows="3" name="humata_intent_links['+e+"][accordions]["+i+'][content]" placeholder="Content shown when expanded... (supports formatting)" maxlength="1000"></textarea></td><td><button type="button" class="button link-delete humata-intent-accordion-remove">Remove</button></td></tr>'}function f(e){return'<div class="humata-intent-card" data-intent-index="'+e+'"><div class="humata-intent-card-header"><button type="button" class="humata-intent-toggle" aria-expanded="true" aria-label="Toggle intent"><span class="dashicons dashicons-arrow-down-alt2"></span></button><span class="humata-intent-card-title">Intent #'+(e+1)+'</span><button type="button" class="button link-delete humata-intent-remove">Remove Intent</button></div><div class="humata-intent-card-body"><p><label><strong>Intent Name</strong></label><br><input type="text" class="regular-text" name="humata_intent_links['+e+'][intent_name]" value="" placeholder="e.g., shipping_intent"> <span class="description">Internal label (not shown to users).</span></p><p><label><strong>Keywords</strong></label><br><textarea class="large-text" rows="2" name="humata_intent_links['+e+`][keywords]" placeholder="shipping, ship, delivery, deliver, track, package"></textarea> <span class="description">Comma-separated keywords. If any keyword appears in the user's question, the links below are shown.</span></p><div class="humata-intent-links-sub" data-links-next-index="1"><label><strong>Resource Links</strong></label><table class="widefat striped humata-intent-links-table" style="max-width: 800px; margin-top: 6px;"><thead><tr><th>Title</th><th>URL</th><th style="width: 80px;">Actions</th></tr></thead><tbody><tr class="humata-intent-link-row"><td><input type="text" class="regular-text" name="humata_intent_links[`+e+'][links][0][title]" value="" placeholder="Shipping Policy"></td><td><input type="url" class="regular-text" name="humata_intent_links['+e+'][links][0][url]" value="" placeholder="https://example.com/shipping"></td><td><button type="button" class="button link-delete humata-intent-link-remove">Remove</button></td></tr></tbody></table><p style="margin-top: 8px;"><button type="button" class="button button-secondary humata-intent-link-add">Add Link</button></p></div><div class="humata-intent-accordions-sub" data-accordions-next-index="1" style="margin-top: 20px;"><label><strong>Custom Accordions</strong></label><span class="description" style="display: block; margin-bottom: 6px;">FAQ-style collapsible toggles shown in the chat response.</span><table class="widefat striped humata-intent-accordions-table" style="max-width: 800px; margin-top: 6px;"><thead><tr><th style="width: 200px;">Title</th><th>Content</th><th style="width: 80px;">Actions</th></tr></thead><tbody><tr class="humata-intent-accordion-row"><td><input type="text" class="regular-text" name="humata_intent_links['+e+'][accordions][0][title]" value="" placeholder="e.g., Shipping Restrictions"></td><td><div class="humata-accordion-toolbar"><button type="button" class="button button-small humata-format-bold" title="Bold"><strong>B</strong></button><button type="button" class="button button-small humata-format-italic" title="Italic"><em>I</em></button><button type="button" class="button button-small humata-format-link" title="Insert Link">\u{1F517}</button></div><textarea class="large-text humata-accordion-content-input" rows="3" name="humata_intent_links['+e+'][accordions][0][content]" placeholder="Content shown when expanded... (supports formatting)" maxlength="1000"></textarea></td><td><button type="button" class="button link-delete humata-intent-accordion-remove">Remove</button></td></tr></tbody></table><p style="margin-top: 8px;"><button type="button" class="button button-secondary humata-intent-accordion-add">Add Accordion</button></p></div></div></div>'}t(document).on("click",".humata-intent-add",function(){var e=t(this).closest(".humata-intent-links-repeater"),i=e.find(".humata-intent-links-container"),g=C(e.attr("data-next-index"),i.find(".humata-intent-card").length);i.append(f(g)),e.attr("data-next-index",String(g+1))}),t(document).on("click",".humata-intent-remove",function(){t(this).closest(".humata-intent-card").remove()}),t(document).on("click",".humata-intent-link-add",function(){var e=t(this).closest(".humata-intent-links-sub"),i=e.find("tbody"),g=t(this).closest(".humata-intent-card"),p=C(g.attr("data-intent-index"),0),_=C(e.attr("data-links-next-index"),i.find("tr").length);i.append(l(p,_)),e.attr("data-links-next-index",String(_+1))}),t(document).on("click",".humata-intent-link-remove",function(){var e=t(this).closest("tbody");if(t(this).closest("tr").remove(),e.find("tr").length===0){var i=e.closest(".humata-intent-card"),g=e.closest(".humata-intent-links-sub"),p=C(i.attr("data-intent-index"),0);e.append(l(p,0)),g.attr("data-links-next-index","1")}}),t(document).on("click",".humata-intent-accordion-add",function(){var e=t(this).closest(".humata-intent-accordions-sub"),i=e.find("tbody"),g=t(this).closest(".humata-intent-card"),p=C(g.attr("data-intent-index"),0),_=C(e.attr("data-accordions-next-index"),i.find("tr").length);i.find("tr").length>=5||(i.append(h(p,_)),e.attr("data-accordions-next-index",String(_+1)))}),t(document).on("click",".humata-intent-accordion-remove",function(){var e=t(this).closest("tbody");if(t(this).closest("tr").remove(),e.find("tr").length===0){var i=e.closest(".humata-intent-card"),g=e.closest(".humata-intent-accordions-sub"),p=C(i.attr("data-intent-index"),0);e.append(h(p,0)),g.attr("data-accordions-next-index","1")}});function w(e,i,g){var p=e.selectionStart,_=e.selectionEnd,T=e.value,P=T.substring(p,_);P||(P="text");var n=T.substring(0,p)+i+P+g+T.substring(_);e.value=n,e.focus(),e.setSelectionRange(p+i.length,p+i.length+P.length)}t(document).on("click",".humata-format-bold",function(){var e=t(this).closest("td").find("textarea");e.length&&w(e[0],"<strong>","</strong>")}),t(document).on("click",".humata-format-italic",function(){var e=t(this).closest("td").find("textarea");e.length&&w(e[0],"<em>","</em>")}),t(document).on("click",".humata-format-link",function(){var e=t(this).closest("td").find("textarea");if(e.length){var i=prompt("Enter URL:","https://");i&&i!=="https://"&&w(e[0],'<a href="'+i+'" target="_blank">',"</a>")}});function I(){var e=t(".humata-trigger-pages-list");if(!(!e.length||!e.sortable)&&!e.data("humataSortableInit")){e.sortable({axis:"y",items:"> .humata-trigger-page-item",handle:".humata-repeater-handle",placeholder:"humata-repeater-placeholder",forcePlaceholderSize:!0,tolerance:"pointer",update:function(){F()}});try{e.disableSelection()}catch(i){}e.data("humataSortableInit",!0)}}function F(){t(".humata-trigger-pages-list .humata-trigger-page-item").each(function(i){var g=t(this);g.find('input[name*="humata_trigger_pages"]').each(function(){var p=t(this).attr("name");p=p.replace(/humata_trigger_pages\[\d+\]/,"humata_trigger_pages["+i+"]"),t(this).attr("name",p)}),g.find('textarea[name*="humata_trigger_pages"]').each(function(){var p=t(this).attr("name");p=p.replace(/humata_trigger_pages\[\d+\]/,"humata_trigger_pages["+i+"]"),t(this).attr("name",p)})});var e=t(".humata-trigger-pages-repeater");e.attr("data-next-index",String(t(".humata-trigger-pages-list .humata-trigger-page-item").length))}t(document).on("click",".humata-trigger-pages-repeater .humata-repeater-remove",function(){var e=t(this).closest(".humata-trigger-page-item"),i=e.find(".wp-editor-area").attr("id");i&&typeof tinymce!="undefined"&&tinymce.get(i)&&tinymce.get(i).remove(),e.remove(),F()}),t(document).on("click",".humata-trigger-pages-add",function(){var e=t(".humata-trigger-pages-list .humata-trigger-page-item").last();e.length&&(e[0].scrollIntoView({behavior:"smooth",block:"center"}),e.find('input[type="text"]').first().focus())}),I();var q="humata_intent_collapsed";function A(){try{var e=localStorage.getItem(q);if(e){var i=JSON.parse(e);if(Array.isArray(i))return i}}catch(g){}return[]}function B(e){try{localStorage.setItem(q,JSON.stringify(e))}catch(i){}}function k(e){var i=e.find(".humata-intent-toggle");e.addClass("humata-intent-collapsed"),i.attr("aria-expanded","false"),i.find(".dashicons").removeClass("dashicons-arrow-down-alt2").addClass("dashicons-arrow-right-alt2")}function E(e){var i=e.find(".humata-intent-toggle");e.removeClass("humata-intent-collapsed"),i.attr("aria-expanded","true"),i.find(".dashicons").removeClass("dashicons-arrow-right-alt2").addClass("dashicons-arrow-down-alt2")}(function(){var e=A();e.length&&t(".humata-intent-card").each(function(){var i=C(t(this).attr("data-intent-index"),-1);i>=0&&e.indexOf(i)!==-1&&k(t(this))})})(),t(document).on("click",".humata-intent-toggle",function(){var e=t(this),i=e.closest(".humata-intent-card"),g=e.attr("aria-expanded")==="true",p=C(i.attr("data-intent-index"),-1);g?k(i):E(i);var _=A(),T=_.indexOf(p);g&&T===-1?_.push(p):!g&&T!==-1&&_.splice(T,1),B(_)})}(),function(){function d(){var a=t('input[name="humata_suggested_questions[mode]"]:checked').val()||"fixed",s=t("#humata_sq_fixed_questions").closest("tr").parent().closest("table").prev("h2").addBack().add(t("#humata_sq_fixed_questions").closest("tr")),l=t("#humata_sq_randomized_categories").closest("tr").parent().closest("table").prev("h2").addBack().add(t("#humata_sq_randomized_categories").closest("tr"));t(".humata-sq-fixed-section").closest("tr").toggle(a==="fixed"),t(".humata-sq-randomized-section").closest("tr").toggle(a==="randomized")}t(document).on("change",".humata-sq-mode-radio",d),d(),t(document).on("click",".humata-sq-fixed-add",function(){var a=t(this).closest(".humata-sq-fixed-section"),s=a.find("tbody"),l=s.find("tr").length;if(!(l>=4)){var h=C(a.attr("data-next-index"),l),f='<tr class="humata-repeater-row humata-sq-fixed-row"><td class="humata-repeater-handle-cell"><span class="dashicons dashicons-move humata-repeater-handle" aria-hidden="true"></span><span class="screen-reader-text">Drag to reorder</span></td><td><input type="text" class="large-text" name="humata_suggested_questions[fixed_questions]['+h+'][text]" value="" placeholder="e.g., What are your business hours?" maxlength="150"></td><td><button type="button" class="button link-delete humata-repeater-remove">Remove</button></td></tr>';s.append(f),a.attr("data-next-index",String(h+1))}}),t(document).on("click",".humata-sq-fixed-section .humata-repeater-remove",function(){t(this).closest("tr").remove()}),t.fn.sortable&&t(".humata-sq-fixed-section tbody").sortable({handle:".humata-repeater-handle",axis:"y",cursor:"move",opacity:.7}),t(document).on("click",".humata-sq-category-add",function(){var a=t(this).closest(".humata-sq-randomized-section"),s=a.find(".humata-sq-categories-container"),l=s.find(".humata-sq-category-card").length;if(!(l>=4)){var h=C(a.attr("data-next-cat-index"),l),f=o(h);s.append(f),a.attr("data-next-cat-index",String(h+1))}}),t(document).on("click",".humata-sq-category-remove",function(){t(this).closest(".humata-sq-category-card").remove()}),t(document).on("click",".humata-sq-question-add",function(){var a=t(this).closest(".humata-sq-questions-sub"),s=a.find("tbody"),l=t(this).closest(".humata-sq-category-card"),h=C(l.attr("data-cat-index"),0),f=C(a.attr("data-next-q-index"),s.find("tr").length);if(!(s.find("tr").length>=20)){var w=u(h,f);s.append(w),a.attr("data-next-q-index",String(f+1))}}),t(document).on("click",".humata-sq-question-remove",function(){var a=t(this).closest("tbody");if(t(this).closest("tr").remove(),a.find("tr").length===0){var s=a.closest(".humata-sq-category-card"),l=a.closest(".humata-sq-questions-sub"),h=C(s.attr("data-cat-index"),0);a.append(u(h,0)),l.attr("data-next-q-index","1")}}),t(document).on("click",".humata-sq-category-toggle",function(){var a=t(this),s=a.closest(".humata-sq-category-card"),l=a.attr("aria-expanded")==="true";l?(s.addClass("humata-sq-category-collapsed"),a.attr("aria-expanded","false"),a.find(".dashicons").removeClass("dashicons-arrow-down-alt2").addClass("dashicons-arrow-right-alt2")):(s.removeClass("humata-sq-category-collapsed"),a.attr("aria-expanded","true"),a.find(".dashicons").removeClass("dashicons-arrow-right-alt2").addClass("dashicons-arrow-down-alt2"))});function u(a,s){return'<tr class="humata-sq-question-row"><td><input type="text" class="large-text" name="humata_suggested_questions[categories]['+a+"][questions]["+s+']" value="" placeholder="e.g., How do I track my order?" maxlength="150"></td><td><button type="button" class="button link-delete humata-sq-question-remove">Remove</button></td></tr>'}function o(a){return'<div class="humata-sq-category-card" data-cat-index="'+a+'"><div class="humata-sq-category-header"><button type="button" class="humata-sq-category-toggle" aria-expanded="true" aria-label="Toggle category"><span class="dashicons dashicons-arrow-down-alt2"></span></button><span class="humata-sq-category-title">Category #'+(a+1)+'</span><button type="button" class="button link-delete humata-sq-category-remove">Remove Category</button></div><div class="humata-sq-category-body"><p><label><strong>Category Name</strong> <span class="description">(optional)</span></label><br><input type="text" class="regular-text" name="humata_suggested_questions[categories]['+a+'][name]" value="" placeholder="e.g., Product Questions" maxlength="50"></p><div class="humata-sq-questions-sub" data-next-q-index="1"><label><strong>Questions</strong></label><p class="description">At least 1 question required per category.</p><table class="widefat striped humata-sq-questions-table" style="max-width: 650px; margin-top: 6px;"><thead><tr><th>Question Text</th><th style="width: 80px;">Actions</th></tr></thead><tbody><tr class="humata-sq-question-row"><td><input type="text" class="large-text" name="humata_suggested_questions[categories]['+a+'][questions][0]" value="" placeholder="e.g., How do I track my order?" maxlength="150"></td><td><button type="button" class="button link-delete humata-sq-question-remove">Remove</button></td></tr></tbody></table><p style="margin-top: 8px;"><button type="button" class="button button-secondary humata-sq-question-add">Add Question</button></p></div></div></div>'}}(),function(){function d(o,a){return'<div class="humata-api-key-pool__row"><input type="password" id="'+o+"_"+a+'" name="'+o+'[]" value="" class="regular-text humata-api-key-pool__input" autocomplete="off" placeholder="API Key"/><button type="button" class="button humata-api-key-pool__remove" title="Remove"><span class="dashicons dashicons-trash"></span></button></div>'}function u(o){var a=o.find(".humata-api-key-pool__count"),s=o.find(".humata-api-key-pool__input").filter(function(){return t.trim(t(this).val())!==""}).length;s>1?(a.length||(a=t('<span class="humata-api-key-pool__count"></span>'),o.find(".humata-api-key-pool__add").after(a)),a.text(s+" keys configured (rotation enabled)").show()):a.hide()}t(document).on("click",".humata-api-key-pool__add",function(){var o=t(this).closest(".humata-api-key-pool"),a=o.data("option")||"",s=o.find(".humata-api-key-pool__keys"),l=s.find(".humata-api-key-pool__row").length;s.append(d(a,l)),u(o),s.find(".humata-api-key-pool__row").last().find("input").focus()}),t(document).on("click",".humata-api-key-pool__remove",function(){var o=t(this).closest(".humata-api-key-pool"),a=t(this).closest(".humata-api-key-pool__row"),s=o.find(".humata-api-key-pool__row");s.length<=1?a.find("input").val(""):a.remove(),u(o)}),t(document).on("input",".humata-api-key-pool__input",function(){var o=t(this).closest(".humata-api-key-pool");u(o)}),t(".humata-api-key-pool").each(function(){u(t(this))})}(),function(){var d=t(".humata-followup-provider-radio");if(!d.length)return;function u(){var o=t('input[name="humata_followup_questions[provider]"]:checked').val()||"straico",a=t(".humata-followup-straico-fields"),s=t(".humata-followup-anthropic-fields"),l=t(".humata-followup-openrouter-fields");a.closest("tr").toggle(o==="straico"),s.closest("tr").toggle(o==="anthropic"),l.closest("tr").toggle(o==="openrouter")}d.on("change",u),u()}(),function(){var d=t("#humata-docs-table");if(!d.length)return;var u=t("#humata-select-all"),o=d.find(".humata-doc-checkbox"),a=t("#humata-select-count"),s=null;function l(){var f=d.find(".humata-doc-checkbox:checked").length;f>0?a.text(f+" selected"):a.text("")}function h(){var f=o.length,w=d.find(".humata-doc-checkbox:checked").length;w===0?(u.prop("checked",!1),u.prop("indeterminate",!1)):w===f?(u.prop("checked",!0),u.prop("indeterminate",!1)):(u.prop("checked",!1),u.prop("indeterminate",!0))}u.on("change",function(){var f=t(this).prop("checked");o.prop("checked",f),s=null,l()}),o.on("click",function(f){var w=t(this),I=parseInt(w.closest("tr").attr("data-index"),10);if(f.shiftKey&&s!==null){var F=Math.min(s,I),q=Math.max(s,I),A=w.prop("checked");d.find("tbody tr").each(function(){var B=parseInt(t(this).attr("data-index"),10);B>=F&&B<=q&&t(this).find(".humata-doc-checkbox").prop("checked",A)})}s=I,h(),l()}),o.on("change",function(){h(),l()}),l(),h()}(),function(){t(document).on("change",".humata-font-enabled-toggle",function(){var d=t(this).closest(".humata-typography-card"),u=d.find(".humata-typography-card__fields");t(this).is(":checked")?u.show():u.hide()}),t(document).on("change",".humata-font-type-radio",function(){var d=t(this).closest(".humata-typography-card"),u=d.find(".humata-typography-card__variable"),o=d.find(".humata-typography-card__static");t(this).val()==="variable"?(u.show(),o.hide()):(u.hide(),o.show())}),t(document).on("click",".humata-upload-font",function(d){d.preventDefault();var u=t(this),o=u.closest(".humata-font-uploader"),a=o.find(".humata-font-url-input"),s=o.find(".humata-font-filename"),l=o.find(".humata-remove-font"),h=wp.media({title:"Select Font File",button:{text:"Use this font"},multiple:!1,library:{type:["font/woff2","font/woff","font/ttf","font/otf"]}});h.on("select",function(){var f=h.state().get("selection").first().toJSON();a.val(f.url);var w=f.filename||f.url.split("/").pop();s.text(w),l.show()}),h.open()}),t(document).on("click",".humata-remove-font",function(d){d.preventDefault();var u=t(this).closest(".humata-font-uploader"),o=u.find(".humata-font-url-input"),a=u.find(".humata-font-filename");o.val(""),a.text(""),t(this).hide()}),t(document).on("click",".humata-add-weight",function(d){d.preventDefault();var u=t(this).closest(".humata-typography-card__static"),o=u.find(".humata-static-weights"),a=o.data("prefix"),s=o.find(".humata-static-weight-row").length,l=s,h='<div class="humata-static-weight-row"><select name="'+a+"[static_weights]["+l+'][weight]"><option value="100">100 (Thin)</option><option value="200">200 (Extra Light)</option><option value="300">300 (Light)</option><option value="400" selected>400 (Regular)</option><option value="500">500 (Medium)</option><option value="600">600 (Semi Bold)</option><option value="700">700 (Bold)</option><option value="800">800 (Extra Bold)</option><option value="900">900 (Black)</option></select><div class="humata-font-uploader"><input type="hidden" name="'+a+"[static_weights]["+l+'][url]" value="" class="humata-font-url-input" /><button type="button" class="button humata-upload-font">Select File</button><button type="button" class="button humata-remove-font" style="display:none;">Remove</button><span class="humata-font-filename"></span></div><button type="button" class="button humata-remove-weight-row" title="Remove weight">&times;</button></div>';o.append(h)}),t(document).on("click",".humata-remove-weight-row",function(d){d.preventDefault();var u=t(this).closest(".humata-static-weight-row");u.remove()})}()})})(jQuery);})();
//# sourceMappingURL=admin-settings.js.map
