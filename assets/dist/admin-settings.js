(()=>{(function(t){"use strict";t(function(){var I=window.humataAdminConfig||{},P=String(I.nonce||"");I.documentTitles&&typeof I.documentTitles=="object"?window.humataDocumentTitles=I.documentTitles:(!window.humataDocumentTitles||typeof window.humataDocumentTitles!="object")&&(window.humataDocumentTitles={});var F=String(I.ajaxUrl||window.ajaxurl||"");function k(v,b){var s=parseInt(v,10);return isFinite(s)&&s>=0?s:b||0}(function(){var v=window.humataDocumentTitles||{},b=I.i18n&&typeof I.i18n.titleNotFetchedText=="string"?I.i18n.titleNotFetchedText:"(title not fetched)",s=100,n=0;function l(a){var r=(a||"").match(/[a-f0-9]{8}-[a-f0-9]{4}-[a-f0-9]{4}-[a-f0-9]{4}-[a-f0-9]{12}/ig)||[],i={},u=[];return t.each(r,function(p,f){f=f.toLowerCase(),i[f]||(i[f]=!0,u.push(f))}),u}function c(){return t("#humata-document-ids-tokens .humata-token").map(function(){return(t(this).attr("data-id")||"").toLowerCase()}).get()}function g(a){return a=(a||"").toLowerCase(),v[a]?v[a]:a}function x(){var a=t("#humata-document-ids-tokens"),r=a.children(".humata-token").get();r.sort(function(i,u){var p=(t(i).attr("data-id")||"").toLowerCase(),f=(t(u).attr("data-id")||"").toLowerCase(),y=t.trim(g(p)||p).toLowerCase(),h=t.trim(g(f)||f).toLowerCase();return y===h?f.localeCompare(p):h.localeCompare(y)}),t.each(r,function(i,u){a.append(u)})}function C(a){if(a=(a||"").toLowerCase(),!!a&&!t('#humata-document-ids-tokens .humata-token[data-id="'+a+'"]').length){var r=t("<span></span>").addClass("humata-token").attr("data-id",a).attr("title",g(a)),i=t("<span></span>").addClass("humata-token-label").text(g(a)),u=t("<button></button>").attr("type","button").addClass("humata-token-remove").attr("aria-label","Remove").text("\xD7");r.append(i).append(u),t("#humata-document-ids-tokens").append(r)}}function T(){var a=c();t("#humata_document_ids").val(a.join(", ")),t("#humata-document-count").text(a.length)}function A(a){var r=t("#humata-documents-pagination");if(r.length&&(r.empty(),!(!a||a<=s))){var i=Math.max(1,Math.ceil(a/s)),u=n+1,p=n*s+1,f=Math.min((n+1)*s,a),y=t("<button></button>").attr("type","button").addClass("button button-secondary").attr("id","humata-documents-page-prev").text("Previous").prop("disabled",n<=0),h=t("<button></button>").attr("type","button").addClass("button button-secondary").attr("id","humata-documents-page-next").text("Next").prop("disabled",n>=i-1),w=t("<span></span>").addClass("humata-documents-page-info").text("Showing "+p+"\u2013"+f+" of "+a+" (Page "+u+"/"+i+")");r.append(y).append(w).append(h)}}function q(){var a=t("#humata-documents-table-body");if(a.length){var r=c(),i=r.length;if(!i){a.empty(),A(0);return}var u=Math.max(1,Math.ceil(i/s));n>=u&&(n=u-1),n<0&&(n=0);var p=n*s,f=Math.min(p+s,i),y=r.slice(p,f);a.empty(),t.each(y,function(h,w){var L=v[w]?v[w]:b,S=t("<tr></tr>").attr("data-doc-id",w);S.append(t("<td></td>").addClass("humata-doc-title").text(L)),S.append(t("<td></td>").append(t("<code></code>").text(w))),a.append(S)}),A(i)}}function D(a){var r=l(a);return r.length?(t.each(r,function(i,u){C(u)}),x(),T(),q(),!0):!1}function M(){var a=t("#humata_document_ids"),r=t("#humata-document-ids-tokens");if(!(!a.length||!r.length)){var i=l(a.val());r.empty(),t.each(i,function(u,p){C(p)}),x(),T(),q()}}M(),t(document).on("click","#humata-documents-page-prev",function(){n>0&&(n--,q())}),t(document).on("click","#humata-documents-page-next",function(){var a=c().length,r=Math.max(1,Math.ceil(a/s));n<r-1&&(n++,q())}),t(document).on("click","#humata-document-ids-control, #humata-document-ids-tokens",function(a){t(a.target).closest(".humata-token-remove").length||t("#humata_document_ids_input").trigger("focus")}),t(document).on("click",".humata-token-remove",function(){t(this).closest(".humata-token").remove(),T(),q()}),t(document).on("keydown","#humata_document_ids_input",function(a){var r=a.key;if(r===","||r==="Enter"||r==="Tab"){var i=t(this).val(),u=D(i);if(r==="Enter"||r===","){a.preventDefault(),u&&t(this).val("");return}if(r==="Tab"&&u){a.preventDefault(),t(this).val("");return}}if(r==="Backspace"&&t(this).val()===""){var p=t("#humata-document-ids-tokens .humata-token").last();p.length&&(p.remove(),T(),q(),a.preventDefault())}}),t(document).on("paste","#humata_document_ids_input",function(){var a=t(this);setTimeout(function(){var r=D(a.val());r&&a.val("")},0)}),t(document).on("blur","#humata_document_ids_input",function(){var a=t(this).val(),r=D(a);r&&t(this).val("")});function _(a,r){var i=t("#humata-document-ids-io-status");i.length&&(i.removeClass("humata-io-status-success humata-io-status-error humata-io-status-info"),r==="success"?i.addClass("humata-io-status-success"):r==="error"?i.addClass("humata-io-status-error"):r==="info"&&i.addClass("humata-io-status-info"),i.text(a||""))}function N(){var a=c();return!a||!a.length?"":a.join("\\n")}function e(a,r,i){try{var u=i||"text/plain;charset=utf-8",p=new Blob([r||""],{type:u}),f=URL.createObjectURL(p),y=document.createElement("a");y.href=f,y.download=a||"humata-document-ids.txt",document.body.appendChild(y),y.click(),setTimeout(function(){try{document.body.removeChild(y)}catch(h){}try{URL.revokeObjectURL(f)}catch(h){}},0)}catch(h){_("Download failed.","error")}}function o(a){return navigator.clipboard&&navigator.clipboard.writeText?navigator.clipboard.writeText(a):new Promise(function(r,i){try{var u=t("<textarea></textarea>").css({position:"absolute",left:"-9999px",top:"0"}).val(a||"");t("body").append(u),u[0].focus(),u[0].select();var p=!1;try{p=document.execCommand("copy")}catch(f){p=!1}u.remove(),p?r():i(new Error("copy_failed"))}catch(f){i(f)}})}function m(){var a=t('input[name="humata_document_ids_import_mode"]:checked'),r=a.length?String(a.val()||""):"";return r=t.trim(r),r==="replace"?"replace":"merge"}function d(a,r){var i=String(a||""),u=r==="replace"?"replace":"merge",p=c().length,f=l(i);if(!f.length)return _("No valid UUIDs found to import.","error"),!1;var y=p;u==="replace"&&(t("#humata-document-ids-tokens").empty(),n=0,y=0),t.each(f,function(S,R){C(R)}),x(),T(),q();var h=c().length;if(u==="merge"){var w=Math.max(0,h-y),L=Math.max(0,f.length-w);_("Imported "+w+" IDs ("+L+" duplicates ignored). Click Save Settings to persist.","success")}else _("Replaced "+p+" IDs with "+h+" imported IDs. Click Save Settings to persist.","success");return!0}t(document).on("click","#humata-document-ids-export-copy",function(){var a=N(),r=c().length;if(!a){_("No document IDs to export.","error");return}o(a).then(function(){_("Copied "+r+" IDs to clipboard.","success")}).catch(function(){_("Copy failed. Try Download TXT instead.","error")})}),t(document).on("click","#humata-document-ids-export-download",function(){var a=c();if(!a.length){_("No document IDs to export.","error");return}var r=a.join("\\n")+"\\n";e("humata-document-ids.txt",r,"text/plain;charset=utf-8"),_("Downloaded TXT for "+a.length+" IDs.","info")}),t(document).on("click","#humata-document-ids-export-download-json",function(){var a=c();if(!a.length){_("No document IDs to export.","error");return}var r=JSON.stringify({document_ids:a},null,2);e("humata-document-ids.json",r+"\\n","application/json;charset=utf-8"),_("Downloaded JSON for "+a.length+" IDs.","info")}),t(document).on("change","#humata-document-ids-import-file",function(){var a=this,r=a&&a.files&&a.files[0]?a.files[0]:null;if(r){var i=new FileReader;i.onload=function(u){var p=u&&u.target&&u.target.result?String(u.target.result):"";t("#humata-document-ids-import-text").val(p),_("Loaded file. Choose Merge/Replace and click Apply Import.","info")},i.onerror=function(){_("Failed to read file.","error")};try{i.readAsText(r)}catch(u){_("Failed to read file.","error")}}}),t(document).on("click","#humata-document-ids-import-apply",function(){var a=t("#humata-document-ids-import-text").val(),r=m();d(a,r)}),t(document).on("click","#humata-document-ids-clear-all",function(){var a=c().length;if(!a){_("No document IDs to clear.","info");return}window.confirm("Remove all configured Document IDs?")&&(t("#humata-document-ids-tokens").empty(),n=0,T(),q(),_("Cleared all Document IDs. Click Save Settings to persist.","success"))}),t("#humata-test-api").on("click",function(){var a=t(this),r=t("#humata-test-result");a.prop("disabled",!0).text("Testing..."),r.html(""),t.post(F,{action:"humata_test_api",nonce:P},function(i){a.prop("disabled",!1).text("Test API Connection"),i.success?r.html('<span style="color:green;">\u2713 '+i.data.message+"</span>"):r.html('<span style="color:red;">\u2717 '+i.data.message+"</span>")}).fail(function(){a.prop("disabled",!1).text("Test API Connection"),r.html('<span style="color:red;">\u2717 Request failed</span>')})}),t("#humata-clear-cache").on("click",function(){var a=t(this);a.prop("disabled",!0).text("Clearing..."),t.post(F,{action:"humata_clear_cache",nonce:P},function(r){a.prop("disabled",!1).text("Clear Cache"),r.success?(alert("Cache cleared!"),location.reload()):alert("Failed to clear cache.")})}),t("#humata-test-ask").on("click",function(){var a=t(this),r=t("#humata-test-result");a.prop("disabled",!0).text("Testing Ask..."),r.html(""),t.post(F,{action:"humata_test_ask",nonce:P},function(i){a.prop("disabled",!1).text("Test Ask"),i.success?r.html('<span style="color:green;">\u2713 '+i.data.message+"</span>"):r.html('<span style="color:red;">\u2717 '+i.data.message+"</span>")}).fail(function(){a.prop("disabled",!1).text("Test Ask"),r.html('<span style="color:red;">\u2717 Request failed</span>')})}),t("#humata-fetch-titles").on("click",function(){var a=t(this),r=t("#humata-test-result"),i=0,u=5,p=2e3,f=t("#humata_document_ids").val();a.prop("disabled",!0).text("Fetching..."),r.html("");function y(){t.post(F,{action:"humata_fetch_titles",nonce:P,offset:i,limit:u,document_ids:f},function(h){if(!h.success){a.prop("disabled",!1).text("Fetch Titles");var w=h.data&&h.data.message?h.data.message:"Request failed";h.data&&h.data.errorMessage&&(w=w+" ("+h.data.errorMessage+")"),r.html('<span style="color:red;">\u2717 '+w+"</span>");return}h.data&&h.data.titles&&t.each(h.data.titles,function(S,R){if(S=(S||"").toLowerCase(),!(!S||!R)){v[S]=R;var B=t('#humata-document-ids-tokens .humata-token[data-id="'+S+'"]');B.find(".humata-token-label").text(R),B.attr("title",R),t('#humata-documents-table-body tr[data-doc-id="'+S+'"] .humata-doc-title').text(R)}}),x(),T(),q(),i=h.data.nextOffset;var L=h.data.message||"";if(h.data.errors&&h.data.errorMessage&&(L=L+" ("+h.data.errorMessage+")"),r.html('<span style="color:green;">\u2713 '+L+"</span>"),h.data.done){a.prop("disabled",!1).text("Fetch Titles");return}setTimeout(y,p)}).fail(function(){a.prop("disabled",!1).text("Fetch Titles"),r.html('<span style="color:red;">\u2717 Request failed</span>')})}y()})})(),function(){function v(){var s=t('input[name="humata_search_provider"]:checked'),n=s.length?String(s.val()||""):"";return n=t.trim(n),n||(n="humata"),n}function b(){if(t('input[name="humata_search_provider"]').length){var s=v(),n=s==="humata",l=s==="local";t("#humata_api_key").closest("table").closest("tbody").parent().closest("table").prev("h2:contains('Humata API')").toggle(n),t(".form-table").each(function(){var c=t(this),g=c.prev("h2, p").prev("h2");g.length||(g=c.prev("h2"));var x=g.text()||"";(x.indexOf("Humata API")!==-1||x.indexOf("Humata System Prompt")!==-1||x.indexOf("Second-Stage LLM System Prompt")!==-1)&&x.indexOf("Local Search")===-1&&(g.toggle(n),g.next("p").toggle(n),c.toggle(n)),x.indexOf("Local Search")!==-1&&(g.toggle(l),g.next("p").toggle(l),c.toggle(l))})}}t(document).on("change",'input[name="humata_search_provider"]',b),setTimeout(b,100)}(),function(){function v(){var s=t('input[name="humata_second_llm_provider"]:checked'),n=s.length?String(s.val()||""):"";return n=t.trim(n),n||(n="none"),n}function b(){var s=v(),n=s==="straico",l=s==="anthropic";t("#humata_straico_api_key").closest("tr").toggle(n),t("#humata_straico_model").closest("tr").toggle(n),t("#humata_anthropic_api_key").closest("tr").toggle(l),t("#humata_anthropic_model").closest("tr").toggle(l),t("#humata_anthropic_extended_thinking").closest("tr").toggle(l)}t(document).on("change",'input[name="humata_second_llm_provider"]',b),b()}(),function(){function v(){var s=t('input[name="humata_local_first_llm_provider"]:checked'),n=s.length?String(s.val()||""):"";return n=t.trim(n),n||(n="straico"),n}function b(){var s=v(),n=s==="straico",l=s==="anthropic";t("#humata_local_first_straico_api_key").closest("tr").toggle(n),t("#humata_local_first_straico_model").closest("tr").toggle(n),t("#humata_local_first_anthropic_api_key").closest("tr").toggle(l),t("#humata_local_first_anthropic_model").closest("tr").toggle(l),t("#humata_local_first_anthropic_extended_thinking").closest("tr").toggle(l)}t(document).on("change",'input[name="humata_local_first_llm_provider"]',b),b()}(),function(){function v(){var s=t('input[name="humata_local_second_llm_provider"]:checked'),n=s.length?String(s.val()||""):"";return n=t.trim(n),n||(n="none"),n}function b(){var s=v(),n=s==="straico",l=s==="anthropic";t("#humata_local_second_straico_api_key").closest("tr").toggle(n),t("#humata_local_second_straico_model").closest("tr").toggle(n),t("#humata_local_second_anthropic_api_key").closest("tr").toggle(l),t("#humata_local_second_anthropic_model").closest("tr").toggle(l),t("#humata_local_second_anthropic_extended_thinking").closest("tr").toggle(l)}t(document).on("change",'input[name="humata_local_second_llm_provider"]',b),b()}(),function(){function v(e){return'<tr class="humata-repeater-row"><td class="humata-repeater-handle-cell"><span class="dashicons dashicons-move humata-repeater-handle" aria-hidden="true"></span><span class="screen-reader-text">Drag to reorder</span></td><td style="width: 28%"><input type="text" class="regular-text" name="humata_floating_help[external_links]['+e+'][label]" value="" placeholder="Label"></td><td><input type="url" class="regular-text" name="humata_floating_help[external_links]['+e+'][url]" value="" placeholder="https://example.com/"></td><td style="width: 90px"><button type="button" class="button link-delete humata-repeater-remove">Remove</button></td></tr>'}function b(e){return'<tr class="humata-repeater-row"><td class="humata-repeater-handle-cell"><span class="dashicons dashicons-move humata-repeater-handle" aria-hidden="true"></span><span class="screen-reader-text">Drag to reorder</span></td><td style="width: 38%"><input type="text" class="regular-text" name="humata_auto_links['+e+'][phrase]" value="" placeholder="Phrase (exact match)"></td><td><input type="url" class="regular-text" name="humata_auto_links['+e+'][url]" value="" placeholder="https://example.com/"></td><td style="width: 90px"><button type="button" class="button link-delete humata-repeater-remove">Remove</button></td></tr>'}function s(e){return'<tr class="humata-repeater-row"><td class="humata-repeater-handle-cell"><span class="dashicons dashicons-move humata-repeater-handle" aria-hidden="true"></span><span class="screen-reader-text">Drag to reorder</span></td><td style="width: 34%"><input type="text" class="regular-text" name="humata_floating_help[faq_items]['+e+'][question]" value="" placeholder="Question"></td><td><textarea class="large-text" rows="3" name="humata_floating_help[faq_items]['+e+'][answer]" placeholder="Answer"></textarea></td><td style="width: 90px"><button type="button" class="button link-delete humata-repeater-remove">Remove</button></td></tr>'}function n(e){if(!(!e||!e.length)){var o=e.find("tbody");if(o.length&&o.sortable&&!o.data("humataSortableInit")){o.sortable({axis:"y",items:"> tr",handle:".humata-repeater-handle",placeholder:"humata-repeater-placeholder",forcePlaceholderSize:!0,tolerance:"pointer"});try{o.disableSelection()}catch(m){}o.data("humataSortableInit",!0)}}}function l(e){if(!(!e||!e.length)){var o=String(e.data("humataRepeater")||""),m=k(e.attr("data-next-index"),e.find("tbody tr").length),d="";if(o==="external_links"?d=v(m):o==="auto_links"?d=b(m):o==="faq_items"&&(d=s(m)),!!d){var a=e.find("tbody");a.length&&(a.append(d),e.attr("data-next-index",String(m+1)),n(e))}}}t(document).on("click",".humata-floating-help-repeater .humata-repeater-add",function(){l(t(this).closest(".humata-floating-help-repeater"))}),t(document).on("click",".humata-floating-help-repeater .humata-repeater-remove",function(){t(this).closest("tr").remove()}),t(".humata-floating-help-repeater").each(function(){n(t(this))}),t(document).on("click",".humata-upload-avatar",function(e){e.preventDefault();var o=t(this).data("target"),m=o.indexOf("logo")!==-1,d=m?"Select Logo Image":"Select Avatar Image",a=wp.media({title:d,button:{text:"Use this image"},multiple:!1,library:{type:["image/jpeg","image/png","image/gif","image/webp"]}});a.on("select",function(){var r=a.state().get("selection").first().toJSON();t("#"+o).val(r.url);var i=m?'<img src="'+r.url+'" alt="Logo Preview" />':'<img src="'+r.url+'" style="max-width:64px;max-height:64px;border-radius:6px;" />';t("#"+o+"_preview").html(i),t('.humata-remove-avatar[data-target="'+o+'"]').show()}),a.open()}),t(document).on("click",".humata-remove-avatar",function(e){e.preventDefault();var o=t(this).data("target");t("#"+o).val(""),t("#"+o+"_preview").empty(),t(this).hide()});function c(e,o){return'<tr class="humata-intent-link-row"><td><input type="text" class="regular-text" name="humata_intent_links['+e+"][links]["+o+'][title]" value="" placeholder="Shipping Policy"></td><td><input type="url" class="regular-text" name="humata_intent_links['+e+"][links]["+o+'][url]" value="" placeholder="https://example.com/shipping"></td><td><button type="button" class="button link-delete humata-intent-link-remove">Remove</button></td></tr>'}function g(e,o){return'<tr class="humata-intent-accordion-row"><td><input type="text" class="regular-text" name="humata_intent_links['+e+"][accordions]["+o+'][title]" value="" placeholder="e.g., Shipping Restrictions"></td><td><div class="humata-accordion-toolbar"><button type="button" class="button button-small humata-format-bold" title="Bold"><strong>B</strong></button><button type="button" class="button button-small humata-format-italic" title="Italic"><em>I</em></button><button type="button" class="button button-small humata-format-link" title="Insert Link">\u{1F517}</button></div><textarea class="large-text humata-accordion-content-input" rows="3" name="humata_intent_links['+e+"][accordions]["+o+'][content]" placeholder="Content shown when expanded... (supports formatting)" maxlength="1000"></textarea></td><td><button type="button" class="button link-delete humata-intent-accordion-remove">Remove</button></td></tr>'}function x(e){return'<div class="humata-intent-card" data-intent-index="'+e+'"><div class="humata-intent-card-header"><button type="button" class="humata-intent-toggle" aria-expanded="true" aria-label="Toggle intent"><span class="dashicons dashicons-arrow-down-alt2"></span></button><span class="humata-intent-card-title">Intent #'+(e+1)+'</span><button type="button" class="button link-delete humata-intent-remove">Remove Intent</button></div><div class="humata-intent-card-body"><p><label><strong>Intent Name</strong></label><br><input type="text" class="regular-text" name="humata_intent_links['+e+'][intent_name]" value="" placeholder="e.g., shipping_intent"> <span class="description">Internal label (not shown to users).</span></p><p><label><strong>Keywords</strong></label><br><textarea class="large-text" rows="2" name="humata_intent_links['+e+`][keywords]" placeholder="shipping, ship, delivery, deliver, track, package"></textarea> <span class="description">Comma-separated keywords. If any keyword appears in the user's question, the links below are shown.</span></p><div class="humata-intent-links-sub" data-links-next-index="1"><label><strong>Resource Links</strong></label><table class="widefat striped humata-intent-links-table" style="max-width: 800px; margin-top: 6px;"><thead><tr><th>Title</th><th>URL</th><th style="width: 80px;">Actions</th></tr></thead><tbody><tr class="humata-intent-link-row"><td><input type="text" class="regular-text" name="humata_intent_links[`+e+'][links][0][title]" value="" placeholder="Shipping Policy"></td><td><input type="url" class="regular-text" name="humata_intent_links['+e+'][links][0][url]" value="" placeholder="https://example.com/shipping"></td><td><button type="button" class="button link-delete humata-intent-link-remove">Remove</button></td></tr></tbody></table><p style="margin-top: 8px;"><button type="button" class="button button-secondary humata-intent-link-add">Add Link</button></p></div><div class="humata-intent-accordions-sub" data-accordions-next-index="1" style="margin-top: 20px;"><label><strong>Custom Accordions</strong></label><span class="description" style="display: block; margin-bottom: 6px;">FAQ-style collapsible toggles shown in the chat response.</span><table class="widefat striped humata-intent-accordions-table" style="max-width: 800px; margin-top: 6px;"><thead><tr><th style="width: 200px;">Title</th><th>Content</th><th style="width: 80px;">Actions</th></tr></thead><tbody><tr class="humata-intent-accordion-row"><td><input type="text" class="regular-text" name="humata_intent_links['+e+'][accordions][0][title]" value="" placeholder="e.g., Shipping Restrictions"></td><td><div class="humata-accordion-toolbar"><button type="button" class="button button-small humata-format-bold" title="Bold"><strong>B</strong></button><button type="button" class="button button-small humata-format-italic" title="Italic"><em>I</em></button><button type="button" class="button button-small humata-format-link" title="Insert Link">\u{1F517}</button></div><textarea class="large-text humata-accordion-content-input" rows="3" name="humata_intent_links['+e+'][accordions][0][content]" placeholder="Content shown when expanded... (supports formatting)" maxlength="1000"></textarea></td><td><button type="button" class="button link-delete humata-intent-accordion-remove">Remove</button></td></tr></tbody></table><p style="margin-top: 8px;"><button type="button" class="button button-secondary humata-intent-accordion-add">Add Accordion</button></p></div></div></div>'}t(document).on("click",".humata-intent-add",function(){var e=t(this).closest(".humata-intent-links-repeater"),o=e.find(".humata-intent-links-container"),m=k(e.attr("data-next-index"),o.find(".humata-intent-card").length);o.append(x(m)),e.attr("data-next-index",String(m+1))}),t(document).on("click",".humata-intent-remove",function(){t(this).closest(".humata-intent-card").remove()}),t(document).on("click",".humata-intent-link-add",function(){var e=t(this).closest(".humata-intent-links-sub"),o=e.find("tbody"),m=t(this).closest(".humata-intent-card"),d=k(m.attr("data-intent-index"),0),a=k(e.attr("data-links-next-index"),o.find("tr").length);o.append(c(d,a)),e.attr("data-links-next-index",String(a+1))}),t(document).on("click",".humata-intent-link-remove",function(){var e=t(this).closest("tbody");if(t(this).closest("tr").remove(),e.find("tr").length===0){var o=e.closest(".humata-intent-card"),m=e.closest(".humata-intent-links-sub"),d=k(o.attr("data-intent-index"),0);e.append(c(d,0)),m.attr("data-links-next-index","1")}}),t(document).on("click",".humata-intent-accordion-add",function(){var e=t(this).closest(".humata-intent-accordions-sub"),o=e.find("tbody"),m=t(this).closest(".humata-intent-card"),d=k(m.attr("data-intent-index"),0),a=k(e.attr("data-accordions-next-index"),o.find("tr").length);o.find("tr").length>=5||(o.append(g(d,a)),e.attr("data-accordions-next-index",String(a+1)))}),t(document).on("click",".humata-intent-accordion-remove",function(){var e=t(this).closest("tbody");if(t(this).closest("tr").remove(),e.find("tr").length===0){var o=e.closest(".humata-intent-card"),m=e.closest(".humata-intent-accordions-sub"),d=k(o.attr("data-intent-index"),0);e.append(g(d,0)),m.attr("data-accordions-next-index","1")}});function C(e,o,m){var d=e.selectionStart,a=e.selectionEnd,r=e.value,i=r.substring(d,a);i||(i="text");var u=r.substring(0,d)+o+i+m+r.substring(a);e.value=u,e.focus(),e.setSelectionRange(d+o.length,d+o.length+i.length)}t(document).on("click",".humata-format-bold",function(){var e=t(this).closest("td").find("textarea");e.length&&C(e[0],"<strong>","</strong>")}),t(document).on("click",".humata-format-italic",function(){var e=t(this).closest("td").find("textarea");e.length&&C(e[0],"<em>","</em>")}),t(document).on("click",".humata-format-link",function(){var e=t(this).closest("td").find("textarea");if(e.length){var o=prompt("Enter URL:","https://");o&&o!=="https://"&&C(e[0],'<a href="'+o+'" target="_blank">',"</a>")}});function T(){var e=t(".humata-trigger-pages-list");if(!(!e.length||!e.sortable)&&!e.data("humataSortableInit")){e.sortable({axis:"y",items:"> .humata-trigger-page-item",handle:".humata-repeater-handle",placeholder:"humata-repeater-placeholder",forcePlaceholderSize:!0,tolerance:"pointer",update:function(){A()}});try{e.disableSelection()}catch(o){}e.data("humataSortableInit",!0)}}function A(){t(".humata-trigger-pages-list .humata-trigger-page-item").each(function(o){var m=t(this);m.find('input[name*="humata_trigger_pages"]').each(function(){var d=t(this).attr("name");d=d.replace(/humata_trigger_pages\[\d+\]/,"humata_trigger_pages["+o+"]"),t(this).attr("name",d)}),m.find('textarea[name*="humata_trigger_pages"]').each(function(){var d=t(this).attr("name");d=d.replace(/humata_trigger_pages\[\d+\]/,"humata_trigger_pages["+o+"]"),t(this).attr("name",d)})});var e=t(".humata-trigger-pages-repeater");e.attr("data-next-index",String(t(".humata-trigger-pages-list .humata-trigger-page-item").length))}t(document).on("click",".humata-trigger-pages-repeater .humata-repeater-remove",function(){var e=t(this).closest(".humata-trigger-page-item"),o=e.find(".wp-editor-area").attr("id");o&&typeof tinymce!="undefined"&&tinymce.get(o)&&tinymce.get(o).remove(),e.remove(),A()}),t(document).on("click",".humata-trigger-pages-add",function(){var e=t(".humata-trigger-pages-list .humata-trigger-page-item").last();e.length&&(e[0].scrollIntoView({behavior:"smooth",block:"center"}),e.find('input[type="text"]').first().focus())}),T();var q="humata_intent_collapsed";function D(){try{var e=localStorage.getItem(q);if(e){var o=JSON.parse(e);if(Array.isArray(o))return o}}catch(m){}return[]}function M(e){try{localStorage.setItem(q,JSON.stringify(e))}catch(o){}}function _(e){var o=e.find(".humata-intent-toggle");e.addClass("humata-intent-collapsed"),o.attr("aria-expanded","false"),o.find(".dashicons").removeClass("dashicons-arrow-down-alt2").addClass("dashicons-arrow-right-alt2")}function N(e){var o=e.find(".humata-intent-toggle");e.removeClass("humata-intent-collapsed"),o.attr("aria-expanded","true"),o.find(".dashicons").removeClass("dashicons-arrow-right-alt2").addClass("dashicons-arrow-down-alt2")}(function(){var e=D();e.length&&t(".humata-intent-card").each(function(){var o=k(t(this).attr("data-intent-index"),-1);o>=0&&e.indexOf(o)!==-1&&_(t(this))})})(),t(document).on("click",".humata-intent-toggle",function(){var e=t(this),o=e.closest(".humata-intent-card"),m=e.attr("aria-expanded")==="true",d=k(o.attr("data-intent-index"),-1);m?_(o):N(o);var a=D(),r=a.indexOf(d);m&&r===-1?a.push(d):!m&&r!==-1&&a.splice(r,1),M(a)})}(),function(){function v(){var n=t('input[name="humata_suggested_questions[mode]"]:checked').val()||"fixed",l=t("#humata_sq_fixed_questions").closest("tr").parent().closest("table").prev("h2").addBack().add(t("#humata_sq_fixed_questions").closest("tr")),c=t("#humata_sq_randomized_categories").closest("tr").parent().closest("table").prev("h2").addBack().add(t("#humata_sq_randomized_categories").closest("tr"));t(".humata-sq-fixed-section").closest("tr").toggle(n==="fixed"),t(".humata-sq-randomized-section").closest("tr").toggle(n==="randomized")}t(document).on("change",".humata-sq-mode-radio",v),v(),t(document).on("click",".humata-sq-fixed-add",function(){var n=t(this).closest(".humata-sq-fixed-section"),l=n.find("tbody"),c=l.find("tr").length;if(!(c>=4)){var g=k(n.attr("data-next-index"),c),x='<tr class="humata-repeater-row humata-sq-fixed-row"><td class="humata-repeater-handle-cell"><span class="dashicons dashicons-move humata-repeater-handle" aria-hidden="true"></span><span class="screen-reader-text">Drag to reorder</span></td><td><input type="text" class="large-text" name="humata_suggested_questions[fixed_questions]['+g+'][text]" value="" placeholder="e.g., What are your business hours?" maxlength="150"></td><td><button type="button" class="button link-delete humata-repeater-remove">Remove</button></td></tr>';l.append(x),n.attr("data-next-index",String(g+1))}}),t(document).on("click",".humata-sq-fixed-section .humata-repeater-remove",function(){t(this).closest("tr").remove()}),t.fn.sortable&&t(".humata-sq-fixed-section tbody").sortable({handle:".humata-repeater-handle",axis:"y",cursor:"move",opacity:.7}),t(document).on("click",".humata-sq-category-add",function(){var n=t(this).closest(".humata-sq-randomized-section"),l=n.find(".humata-sq-categories-container"),c=l.find(".humata-sq-category-card").length;if(!(c>=4)){var g=k(n.attr("data-next-cat-index"),c),x=s(g);l.append(x),n.attr("data-next-cat-index",String(g+1))}}),t(document).on("click",".humata-sq-category-remove",function(){t(this).closest(".humata-sq-category-card").remove()}),t(document).on("click",".humata-sq-question-add",function(){var n=t(this).closest(".humata-sq-questions-sub"),l=n.find("tbody"),c=t(this).closest(".humata-sq-category-card"),g=k(c.attr("data-cat-index"),0),x=k(n.attr("data-next-q-index"),l.find("tr").length);if(!(l.find("tr").length>=20)){var C=b(g,x);l.append(C),n.attr("data-next-q-index",String(x+1))}}),t(document).on("click",".humata-sq-question-remove",function(){var n=t(this).closest("tbody");if(t(this).closest("tr").remove(),n.find("tr").length===0){var l=n.closest(".humata-sq-category-card"),c=n.closest(".humata-sq-questions-sub"),g=k(l.attr("data-cat-index"),0);n.append(b(g,0)),c.attr("data-next-q-index","1")}}),t(document).on("click",".humata-sq-category-toggle",function(){var n=t(this),l=n.closest(".humata-sq-category-card"),c=n.attr("aria-expanded")==="true";c?(l.addClass("humata-sq-category-collapsed"),n.attr("aria-expanded","false"),n.find(".dashicons").removeClass("dashicons-arrow-down-alt2").addClass("dashicons-arrow-right-alt2")):(l.removeClass("humata-sq-category-collapsed"),n.attr("aria-expanded","true"),n.find(".dashicons").removeClass("dashicons-arrow-right-alt2").addClass("dashicons-arrow-down-alt2"))});function b(n,l){return'<tr class="humata-sq-question-row"><td><input type="text" class="large-text" name="humata_suggested_questions[categories]['+n+"][questions]["+l+']" value="" placeholder="e.g., How do I track my order?" maxlength="150"></td><td><button type="button" class="button link-delete humata-sq-question-remove">Remove</button></td></tr>'}function s(n){return'<div class="humata-sq-category-card" data-cat-index="'+n+'"><div class="humata-sq-category-header"><button type="button" class="humata-sq-category-toggle" aria-expanded="true" aria-label="Toggle category"><span class="dashicons dashicons-arrow-down-alt2"></span></button><span class="humata-sq-category-title">Category #'+(n+1)+'</span><button type="button" class="button link-delete humata-sq-category-remove">Remove Category</button></div><div class="humata-sq-category-body"><p><label><strong>Category Name</strong> <span class="description">(optional)</span></label><br><input type="text" class="regular-text" name="humata_suggested_questions[categories]['+n+'][name]" value="" placeholder="e.g., Product Questions" maxlength="50"></p><div class="humata-sq-questions-sub" data-next-q-index="1"><label><strong>Questions</strong></label><p class="description">At least 1 question required per category.</p><table class="widefat striped humata-sq-questions-table" style="max-width: 650px; margin-top: 6px;"><thead><tr><th>Question Text</th><th style="width: 80px;">Actions</th></tr></thead><tbody><tr class="humata-sq-question-row"><td><input type="text" class="large-text" name="humata_suggested_questions[categories]['+n+'][questions][0]" value="" placeholder="e.g., How do I track my order?" maxlength="150"></td><td><button type="button" class="button link-delete humata-sq-question-remove">Remove</button></td></tr></tbody></table><p style="margin-top: 8px;"><button type="button" class="button button-secondary humata-sq-question-add">Add Question</button></p></div></div></div>'}}()})})(jQuery);})();
//# sourceMappingURL=admin-settings.js.map
